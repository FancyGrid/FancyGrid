Fancy.modules.summary=!0,function(){const e=Fancy,t=e.GRID_CELL_CLS,s=e.GRID_CELL_INNER_CLS,i=e.GRID_CELL_EVEN_CLS,a=e.GRID_ROW_SUMMARY_CLS,n=e.GRID_ROW_SUMMARY_CONTAINER_CLS,l=e.GRID_ROW_SUMMARY_BOTTOM_CLS,r=e.GRID_COLUMN_SPARKLINE_CLS,o=e.GRID_COLUMN_SPARKLINE_BULLET_CLS,c=e.GRID_COLUMN_SPARK_PROGRESS_DONUT_CLS,d=e.GRID_COLUMN_GROSSLOSS_CLS,u=`.${t}`;e.define("Fancy.grid.plugin.Summary",{extend:e.Plugin,ptype:"grid.summary",inWidgetName:"summary",position:"top",sumDisplayed:!0,topOffSet:0,bottomOffSet:0,striped:!1,constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){const e=this,t=e.widget;t.once("render",()=>{e.calcOffSets(),e.options&&e.initOptions()}),t.once("init",()=>{e.render(),e.update(),t.on("update",()=>e.update()),t.on("set",()=>e.update())}),t.on("columnresize",()=>e.onColumnResize(),e),t.on("columnhide",e.onColumnHide,e),t.on("columnshow",e.onColumnShow,e),e.sumDisplayed&&t.on("changepage",e.onChangePage,e),t.on("columndrag",e.onColumnDrag,e)},render(){var e,t=this,s=t.widget,i=s.centerEl,a=s.leftEl,r=s.rightEl,o=s.body,c=s.leftBody,d=s.rightBody,u=s.getCenterFullWidth(),m=s.getLeftFullWidth(),h=s.getRightFullWidth(),g="top"===t.position?"before":"after";i.select(`.${n}`).length||i.select(`.${l}`).length||((e=t.generateRow("center")).css("width",s.startWidths.center),e.firstChild().css("width",u),e.css("height",s.cellHeight),e.firstChild().css("height",s.cellHeight),t.el=e,o.el[g](e.dom)),s.leftColumns.length&&(a.select(`.${n}`).length||a.select(`.${l}`).length||(e=t.generateRow("left"),"bottom"===t.position?e.css("width",m):e.css("width",m-2),e.firstChild().css("width",m),e.css("height",s.cellHeight),t.leftEl=e,c.el[g](e.dom))),s.rightColumns.length&&(r.select(`.${n}`).length||r.select(`.${l}`).length||(e=t.generateRow("right"),"bottom"===t.position?e.css("width",h):e.css("width",h-1),e.firstChild().css("width",h),e.css("height",s.cellHeight),t.rightEl=e,d.el[g](e.dom)))},generateRow(i){var r=this.widget,o=r.cellHeight,c=r.getColumnsWidth(i),d=e.newEl("div"),u="";e.each(r.getColumns(i),(e,i)=>{u+=['<div index="'+i+'" style="width:'+e.width+"px;height:"+o+"px;"+(e.cellAlign?"text-align:"+e.cellAlign+";":"")+'" class="'+t+'">','<div class="'+s+'"></div>',"</div>"].join("")});const m=['<div style="position: relative;" class="'+a+'">',u,"</div>"].join("");return d.update(m),d.css("width",c+"px"),d.addCls(n),"bottom"===this.position&&d.addCls(l),d},calcPlusScroll(){const e=this.widget;this.plusScroll=this.groups.length*e.groupRowHeight},scrollLeft(e){this.el&&this.el.firstChild().css("left",e)},update(){const e=this,s=e.widget;if(e.updateSide("center"),s.leftColumns.length&&e.updateSide("left"),s.rightColumns.length&&e.updateSide("right"),e.striped&&"bottom"===e.position){const e=s.el.select(`.${l} .${t}`);s.getViewTotal()%2==1?e.addCls(i):e.removeCls(i)}},getEl(e){const t=this;switch(e){case"center":return t.el;case"left":return t.leftEl;case"right":return t.rightEl;default:return t.el}},updateSide(t){var i=this.widget,a=i.lang,n=i.getBody(t),l=i.store,u=this.getEl(t).select(`.${s}`),m="data";this.sumDisplayed&&(m="dataView"),e.each(i.getColumns(t),(t,s)=>{if(t.summary){var h=t.index,g=l.getColumnOriginalValues(h,{smartIndexFn:t.smartIndexFn,dataProperty:m}),p="",y=u.item(s).parent(),C={},S={};switch(e.typeOf(t.summary)){case"string":if("none"===t.summary)p="&nbsp;";else{if(p=e.Array[t.summary](g),"number"===t.type||"currency"===t.type){const e=t.precision||0;p=p.toFixed(e)}if("currency"===t.type&&""!==p){p=(t.currency||a.currencySign)+p}}break;case"object":p=e.Array[t.summary.type](g),t.summary.fn&&(p=t.summary.fn(p,t.summary.type));break;case"function":p=t.summary(g)}switch(t.type){case"sparklineline":case"sparklinebar":case"sparklinetristate":case"sparklinebullet":case"sparklinebox":case"sparklinepie":case"sparklinediscrete":y.addCls(r);var f,w=t.width,M=i.cellHeight-1,v=w-20,b=t.type.replace("sparkline","");switch(b){case"line":case"pie":case"box":f="width";break;case"bullet":f="width",M-=11,y.addCls(o);break;case"discrete":f="width",v=w,M-=2;break;case"bar":case"tristate":f="barWidth"}S=t.sparkConfig||{},C={type:b,fillColor:"transparent",height:M},e.apply(C,S),"bar"!==b&&"tristate"!==b||(v=w-20,v/=p.length),C[f]=v,u.item(s).$dom.sparkline(p,C);break;case"progressdonut":y.addCls(c),C=t.sparkConfig||{},e.apply(C,{renderTo:u.item(s).dom,value:p}),C.size||C.height||C.width||(C.size=i.cellHeaderHeight-6),e.get(C.renderTo).update(""),new e.spark.ProgressDonut(C);break;case"grossloss":y.addCls(d),(C=t.sparkConfig||{}).showOnMax&&(C.maxValue=Math.max.apply(Math,g)),p>50&&(p=50),e.apply(C,{renderTo:u.item(s).dom,value:p,column:t}),new e.spark.GrossLoss(C);break;default:t.format&&(p=n.format(p,t.format,t.precision)),u.item(s).update(p)}}else u.item(s).update("")})},onColumnResize(){const e=this,t=e.widget;e.updateSizes("center"),t.leftColumns.length&&e.updateSizes("left"),t.rightColumns.length&&e.updateSizes("right"),e.update()},onColumnHide(){const e=this,t=e.widget;e.updateSizes("center"),t.leftColumns.length&&e.updateSizes("left"),t.rightColumns.length&&e.updateSizes("right"),e.update()},onColumnShow(){const e=this,t=e.widget;e.updateSizes("center"),t.leftColumns.length&&e.updateSizes("left"),t.rightColumns.length&&e.updateSizes("right"),e.update()},updateSizes(e){var t=this,s=t.widget,i=t.getEl(e),a=i.select(u),n=0;switch(s.getColumns(e).forEach((e,t)=>{const s=a.item(t),{hidden:i,width:l}=e;n+=e.width,s.css("display",i?"none":""),s.animate({width:l},ANIMATE_DURATION)}),i.firstChild().animate({width:n},ANIMATE_DURATION),e){case"center":t.el.animate({width:n},ANIMATE_DURATION),0===n?t.el.css({display:"none"}):"none"===t.el.css("display")&&t.el.css({display:""});break;case"left":"bottom"===t.position?t.leftEl.animate({width:n},ANIMATE_DURATION):t.leftEl.animate({width:n-2},ANIMATE_DURATION),0===n?t.leftEl.css({display:"none"}):"none"===t.leftEl.css("display")&&t.leftEl.css({display:""});break;case"right":"bottom"===t.position?t.rightEl.animate({width:n},ANIMATE_DURATION):t.rightEl.animate({width:n-1},ANIMATE_DURATION),0===n?t.rightEl.css({display:"none"}):"none"===t.rightEl.css("display")&&t.rightEl.css({display:""})}},calcOffSets(){const e=this,t=e.widget;switch(e.position){case"top":e.topOffSet=t.cellHeight;break;case"bottom":e.bottomOffSet=t.cellHeight;break;case"both":e.topOffSet=t.cellHeight,e.bottomOffSet=t.cellHeight}},removeColumn(e,t){this.getEl(t).select(u).item(e).destroy(),this.updateSizes(t)},insertColumn(i,a){var n=this,l=n.widget,r=l.getColumns(a);"left"!==a&&"right"!==a||1!==r.length||n.render();var o,c=(r=l.getColumns(a))[i],d=n.getEl(a),m=d.select(u),h=e.newEl("div");0===m.length&&0===i||(o=0===i?m.item(0):m.item(i-1)),h.css({width:c.width,height:l.cellHeight}),h.addCls(t),h.update('<div class="'+s+'"></div>'),0===m.length&&0===i?d.append(h.dom):0===i?o.before(h.dom):o.after(h.dom),n.updateSizes(a),n.updateSide(a)},onChangePage(){const e=this;setTimeout(()=>{e.update()},100)},onColumnDrag(){const e=this.widget;this.updateSizes("center"),e.leftColumns.length&&this.updateSizes("left"),e.rightColumns.length&&this.updateSizes("right")},initOptions(){const s=this,i=s.widget,a=e.get(document.body);i.addCls("fancy-grid-summary-options"),i.el.on("click",s.onOptionClick,s,`.${n} .${t}`),a.on("click",t=>{const i=e.get(t.target);s.justShownSummaryMenu?delete s.justShownSummaryMenu:!i.closest(".fancy-menu").dom&&s.activeSummaryMenu&&(s.activeSummaryMenu.hide(),delete s.activeSummaryMenu)})},onOptionClick(t){var s,i=this,a=i.widget,n=e.get(t.currentTarget),l=i.getColumnBySummaryCell(n);if(i.justShownSummaryMenu=!0,i.activeSummaryMenu&&(i.activeSummaryMenu.hide(),delete i.activeSummaryMenu),l.summaryMenu)s=l.summaryMenu;else{const e=i.generateColumnSummaryItems(l);s=new Fancy.Menu({minWidth:100,width:parseInt(n.css("width"))+1,theme:a.theme,items:e})}var r=n.offset(),o=r.top+parseInt(n.css("height")),c=r.left,d=20,u=-1;if("bottom"===i.position){o=o-parseInt(s.el.css("height"))-parseInt(n.css("height")),d*=-1,u=1}let m=parseInt(n.css("width"))+1;m<100&&(m=100),s.el.css({position:"absolute",width:m,minWidth:70,top:o+d,left:c-1}),s.show(),s.el.animate({duration:200,top:o+u}),l.summaryMenu=s,i.activeSummaryMenu=s},generateColumnSummaryItems(t){var s=this,i=[],a=["None","Sum","Average","Count","Min","Max"],n=["None"],l=e.typeOf(t.summary);switch(t.type){case"number":switch(l){case"string":e.each(a,(e,a)=>{i.push({text:e,checked:e.toLocaleLowerCase()===t.summary,handler(){t.summary=e.toLocaleLowerCase(),s.update(),s.activeSummaryMenu.setChecked(a,!0),s.activeSummaryMenu.hide(),delete s.activeSummaryMenu}})});break;case"function":case"object":e.each(a,(e,a)=>{i.push({text:e,checked:!1,handler(){switch(l){case"function":t.summary={type:e.toLocaleLowerCase(),fn:t.summary};break;case"object":t.summary.type=e.toLocaleLowerCase()}s.update(),s.activeSummaryMenu.setChecked(a,!0),s.activeSummaryMenu.hide(),delete s.activeSummaryMenu}})}),"object"!==l&&i.push({text:"Custom",checked:!0,handler(){t.summary=t._summary,s.update(),s.activeSummaryMenu.hide(),s.activeSummaryMenu.setChecked(i.length-1,!0),delete s.activeSummaryMenu}})}break;case"string":switch(l){case"string":e.each(n,(e,a)=>{i.push({text:e,checked:e.toLocaleLowerCase()===t.summary,handler(){t.summary.type=e.toLocaleLowerCase(),s.update(),s.activeSummaryMenu.setChecked(a,!0),s.activeSummaryMenu.hide(),delete s.activeSummaryMenu}})});break;case"function":case"object":e.each(n,(e,a)=>{i.push({text:e,checked:!1,handler(){t._summary||(t._summary=t.summary),t.summary="none",s.update(),s.activeSummaryMenu.setChecked(a,!0),s.activeSummaryMenu.hide(),delete s.activeSummaryMenu}})}),i.push({text:"Custom",checked:!0,handler(){t.summary=t._summary,s.update(),s.activeSummaryMenu.setChecked(i.length-1,!0),s.activeSummaryMenu.hide(),delete s.activeSummaryMenu}})}}return i},getColumnBySummaryCell(e){var t,s=this.widget,i=e.attr("index");return e.closest(".fancy-grid-center").dom?t=s.columns[i]:e.closest(".fancy-grid-left").dom?t=s.leftColumns[i]:e.closest(".fancy-grid-right")&&(t=s.rightColumns[i]),t}})}();