Fancy.define("Fancy.toolbar.Tab",{extend:Fancy.Button,constructor:function(a,b){this.Super("const",arguments)},init:function(){this.Super("init",arguments)},cls:"fancy fancy-button fancy-toolbar-tab",render:function(){this.Super("render",arguments)}}),Fancy.Mixin("Fancy.form.mixin.Form",{init:function(){var a=this;if(a.calcFieldSize(),a.Super("init",arguments),a.addEvents("init","set"),!0!==Fancy.fullBuilt&&!1!==Fancy.MODULELOAD&&!1!==Fancy.MODULESLOAD&&!0!==a.fullBuilt&&!0!==a.neededModules)return void a.loadModules();a.fire("beforerender"),a.applyDefaults(),a.preRender(),a.render(),a.ons(),a.fire("init")},cls:"",widgetCls:"fancy-form",value:"",width:200,height:300,emptyText:"",tpl:['<div class="fancy-form-body">',"</div>"],preRender:function(){var a=this;a.initRenderTo(),(a.title||a.tbar||a.bbar||a.buttons)&&a.renderPanel()},renderPanel:function(){var a=this,b={renderTo:a.renderTo,title:a.title,subTitle:a.subTitle,subTitleHeight:a.subTitleHeight,width:a.width,height:a.height,titleHeight:a.titleHeight,barHeight:a.barHeight,theme:a.theme,shadow:a.shadow,style:a.style||{},window:a.window,modal:a.modal,frame:a.frame,items:[a],tabs:a.tabs,draggable:a.draggable,minWidth:a.minWidth,minHeight:a.minHeight,panelBodyBorders:a.panelBodyBorders,resizable:a.resizable};a.tabs&&(b.tbar=a.generateTabs(),a.height-=a.barHeight),a.bbar&&(b.bbar=a.bbar,a.height-=a.barHeight),a.tbar&&(b.tbar=a.tbar,a.height-=a.barHeight),a.buttons&&(b.buttons=a.buttons,a.height-=a.barHeight,b.buttons=a.buttons),a.footer&&(b.footer=a.footer,a.height-=a.barHeight),a.panel=new Fancy.Panel(b),a.bbar=a.panel.bbar,a.tbar=a.panel.tbar,a.buttons=a.panel.buttons,a.wrapped||a.panel.addCls("fancy-panel-grid-inside"),a.extraCls&&a.panel&&a.panel.addCls(a.extraCls),a.title&&(a.height-=a.titleHeight),a.subTitle&&(a.height-=a.subTitleHeight,a.height+=a.panelBodyBorders[2]),a.height-=a.panelBodyBorders[0],a.renderTo=a.panel.el.select(".fancy-panel-body-inner").dom},initRenderTo:function(){var a=this,b=a.renderTo||document.body;Fancy.isString(b)&&((b=document.getElementById(b))||(b=Fancy.select(b).item(0))),a.renderTo=b},render:function(){var a=this,b=a.renderTo,c=Fancy.get(document.createElement("div"));c.addCls(a.cls,Fancy.cls,a.widgetCls),c.attr("id",a.id),c.css({width:a.width+"px",height:a.height+"px"}),c.update(a.tpl.join(" ")),a.el=Fancy.get(Fancy.get(b).dom.appendChild(c.dom)),void 0===a.panel&&(a.shadow&&c.addCls("fancy-panel-shadow"),"default"!==a.theme&&c.addCls("fancy-theme-"+a.theme)),a._items=[],a.renderItems(),a.items=a._items,delete a._items,(a.tabs||a.tabbed)&&a.setActiveTab(),a.fire("afterrender"),a.fire("render")},generateTabs:function(){var a=this,b=[];if(a.tabs)for(var c=0,d=a.tabs.length;c<d;c++){var e={type:"tab"};Fancy.isString(a.tabs[c])?e.text=a.tabs[c]:e=a.tabs[c],a.tabs[c]=e,void 0===a.tabs[c].handler&&(a.tabs[c].handler=function(b){return function(){a.setActiveTab(b)}}(c)),b.push(a.tabs[c])}return b},setActiveTab:function(a){var b=this,c=b.el.select(".fancy-field-tab"),d=b.el.select(".fancy-field-tab-active");if(void 0!==a&&(b.activeTab=a),void 0===b.activeTab&&(b.activeTab=0),d.removeCls("fancy-field-tab-active"),c.item(b.activeTab).addCls("fancy-field-tab-active"),b.tabs){var e=b.panel.el.select(".fancy-panel-tbar .fancy-toolbar-tab");e.removeCls("fancy-toolbar-tab-active"),e.item(b.activeTab).addCls("fancy-toolbar-tab-active")}},renderItems:function(a,b){var c,d=this,e=0;for(b=b||d.items,c=b.length,a=a||d.el.getByClass("fancy-form-body");e<c;e++){var f,g=b[e];switch(g.theme=d.theme,g.type){case"pass":case"password":f=Fancy.form.field.String,g.type="string",g.isPassword=!0;break;case"hidden":f=Fancy.form.field.String,g.hidden=!0;break;case"line":case"row":f=Fancy.form.field.Line,g=d.applyDefaults(g);break;case"set":case"fieldset":g.form=d,f=Fancy.form.field.Set,g=d.applyDefaults(g);break;case"tab":f=Fancy.form.field.Tab,g=d.applyDefaults(g);break;case"string":case void 0:f=Fancy.form.field.String;break;case"number":f=Fancy.form.field.Number;break;case"textarea":f=Fancy.form.field.TextArea;break;case"checkbox":f=Fancy.form.field.CheckBox;break;case"switcher":f=Fancy.form.field.Switcher;break;case"combo":f=Fancy.form.field.Combo;break;case"html":f=Fancy.form.field.HTML;break;case"radio":f=Fancy.form.field.Radio;break;case"date":f=Fancy.form.field.Date;break;case"recaptcha":f=Fancy.form.field.ReCaptcha;break;case"button":f=Fancy.form.field.Button;break;case"segbutton":f=Fancy.form.field.SegButton;break;default:throw new Error("type "+g.type+" is not set")}g.renderTo=g.renderTo||a;var h=new f(g);switch(g.type){case"line":case"row":case"set":case"fieldset":case"tab":d.renderItems(h.el.select(".fancy-field-text").dom,h.items);break;default:d._items.push(h)}}},applyDefaults:function(a){var b=this;{if(void 0!==a){var c,d;if(a.defaults)for(c=0,d=a.items.length;c<d;c++)Fancy.applyIf(a.items[c],a.defaults);return a}for(var e=b.items,f=0,g=e.length,h=b.defaults||{};f<g;f++)Fancy.applyIf(e[f],h)}},ons:function(){var a=this;Fancy.each(a.items,function(b){switch(b.type){case"line":case"row":break;case"set":case"fieldset":break;case"tab":case"button":case"segbutton":break;default:b.on("change",a.onChange,a)}})},onChange:function(a,b,c){this.fire("set",{name:a.name,value:b,oldValue:c})},get:function(a){var b=this;if(a){var c;return Fancy.each(b.items,function(b){switch(b.type){case"html":case"button":return}if(b.name===a)return c=b.get(),!0}),c}var d={};return Fancy.each(b.items,function(a){switch(a.type){case"html":case"button":return}void 0!==a.name&&(d[a.name]=a.get())}),d},set:function(a,b){var c=this;if(Fancy.isObject(a))for(var d in a)c.set(d,a[d]);else if(a)return Fancy.each(c.items,function(c){c.name===a&&c.set(b)}),b},clear:function(a){var b=this;Fancy.each(b.items,function(c){switch(c.type){case"html":case"recaptcha":case"button":return}!1!==a&&c.clear(),b.hasCls("fancy-field-not-valid")&&(b.removeCls("fancy-field-not-valid"),b.css("height",parseInt(b.css("height"))-6+"px")),b.hasCls("fancy-field-blank-err")&&(b.removeCls("fancy-field-blank-err"),b.css("height",parseInt(b.css("height"))-6+"px")),c.name&&b.params&&b.params[c.name]&&delete b.params[c.name]})},submit:function(a){var b=this,a=a||{},c=b.params||{};if(b.params=b.params||{},Fancy.apply(b,a),a.params&&(Fancy.apply(c,b.params),b.params=c),b.clear(!1),!1!==b.valid()){var d=b.get();if(Fancy.apply(b.params,d),"wait"===b.params.recaptcha)return void b.submit(a);""!==b.params.recaptcha&&(b.params["g-recaptcha-response"]=b.params.recaptcha,delete b.params.recaptcha,Fancy.Ajax(b))}},valid:function(){var a=this,b=!0;return Fancy.each(a.items,function(a){!0===b?b=a.onBlur():a.onBlur()}),!!b},getItem:function(a){var b=this,c=!1;return Fancy.each(b.items,function(b){if(b.name===a)return c=b,!0}),c},showAt:function(){var a=this;a.panel&&a.panel.showAt.apply(a.panel,arguments)},show:function(){var a=this;a.panel?a.panel.show.apply(a.panel,arguments):a.el.show()},hide:function(){var a=this;a.panel?a.panel.css({display:"none"}):a.css({display:"none"});var b=Fancy.select(".fancy-modal");b.dom&&b.css("display","none");for(var c=0,d=a.items.length;c<d;c++)"combo"===a.items[c].type&&a.items[c].hideList()},setHeight:function(a){var b=this;b.panel&&(b.panel.css("height",a),b.buttons&&(a-=b.barHeight),b.bbar&&(a-=b.barHeight),(b.tbar||b.tabs)&&(a-=b.barHeight),b.title&&(a-=b.titleHeight),a-=b.panelBodyBorders[0],a-=b.panelBodyBorders[2]),b.css("height",a)},setWidth:function(){},getHeight:function(){var a=this;return a.panel?a.panel.getHeight():parseInt(a.css("height"))},calcFieldSize:function(){var a,b=this,c=b.width,d=b.defaults||{},e=b.maxLabelNumber;d.width=c-2*b.panelBorderWidth,Fancy.each(b.items,function(a){switch(a.type){case"set":case"tab":"tab"===a.type&&(b.tabbed=!0);var d="set"===a.type?62:20;Fancy.each(a.items,function(a){void 0===a.width&&(a.width=c-d),a.label&&a.label.length>e&&(e=a.label.length)}),a.defaults=a.defaults||{},a.defaults.labelWidth=a.defaults.labelWidth||8*(e+1);break;case"line":var f=a.items.length,g=!1,h=(c-8-8-8)/f;Fancy.each(a.items,function(a){a.width=h,(a.labelWidth||a.inputWidth)&&(g=!0)}),!1===g&&Fancy.each(a.items,function(a){"top"===a.labelAlign?a.labelWidth=h:a.labelWidth=100}),a.defaults=a.defaults||{},void 0===a.defaults.labelWidth&&(a.defaults.labelWidth=b.labelWidth);break;default:a.label&&a.label.length>e&&(e=a.label.length)}}),e++,a=6*e,a<80&&(a=80),d.labelWidth=a,b.inputWidth&&(d.inputWidth=b.inputWidth),b.defaults=d},destroy:function(){var a=this;a.el.destroy(),a.panel&&a.panel.el.destroy()},each:function(a,b){var c=this,d=c.items,e=0,f=d.length;if(b)for(;e<f;e++)a.apply(this,[d[e]]);else for(;e<f;e++)a(d[e])},loadModules:function(){var a=this,b=Fancy.modules||{},c={},d=a.items||[];Fancy.modules=b,Fancy.nojQuery&&(c.dom=!0),Fancy.isTouch&&(c.touch=!0);for(var e=0,f=d.length;e<f;e++){var g=d[e];if("date"===g.type&&(c.grid=!0,c.selection=!0,c.date=!0),g.items)for(var h=0,i=g.items.length;h<i;h++){var j=g.items[h];"date"===j.type&&(c.grid=!0,c.selection=!0,c.date=!0)}}a.neededModules={length:0};for(var k in c)void 0===Fancy.modules[k]&&(a.neededModules[k]=!0,a.neededModules.length++);if(0===a.neededModules.length)return a.neededModules=!0,void a.init();var l=function(b){delete a.neededModules[b],0===--a.neededModules.length&&(a.neededModules=!0,a.init())};for(var k in a.neededModules)"length"!==k&&Fancy.loadModule(k,l)},prevTab:function(){var a=this;a.activeTab--,a.activeTab<0&&(a.activeTab=0),a.setActiveTab()},nextTab:function(){var a=this,b=a.el.select(".fancy-field-tab").length;a.activeTab++,a.activeTab>=b&&(a.activeTab=b-1),a.setActiveTab()}}),Fancy.Mixin("Fancy.form.mixin.PrepareConfig",{prepareConfig:function(a,b){var c=this;return a=c.prepareConfigTheme(a,b),a=c.prepareConfigLang(a,b),a=c.prepareConfigDefaults(a),a=c.prepareConfigItems(a),a=c.prepareConfigFooter(a)},prepareConfigDefaults:function(a){if(a.defaults)for(var b in a.defaults)Fancy.each(a.items,function(c){void 0===c[b]&&(c[b]=a.defaults[b])});return a},prepareConfigItems:function(a){var b=this,c=function(a){a.theme=b.theme||"",void 0===a.labelWidth&&(a.labelWidth=b.labelWidth),void 0===a.inputWidth&&(a.inputWidth=b.inputWidth),"pass"!==a.type&&"password"!==a.type||(a.type="string",a.isPassword=!0),a.items&&Fancy.each(a.items,c)};return Fancy.each(a.items,c),a}}),Fancy.define(["Fancy.form.field.Line","Fancy.FieldLine"],{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.line",constructor:function(a){var b=this,a=a||{};Fancy.apply(b,a),b.Super("const",arguments)},init:function(){var a=this;a.addEvents(),a.Super("init",arguments);for(var b,c=0,d=a.items.length;c<d;c++){var e=a.items[c];e.style=e.style||{},"top"===e.labelAlign?b=!0:e.style["padding-top"]="0px",0===c&&(e.style["padding-left"]="0px")}a.preRender(),a.render(),b&&a.css("height","48px")},fieldCls:"fancy fancy-field fancy-field-line",value:"",width:100,emptyText:"",tpl:['<div class="fancy-field-text fancy-field-line-items">',"</div>"]}),Fancy.define(["Fancy.form.field.Set","Fancy.SetField"],{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.set",constructor:function(a){var b=this,a=a||{};Fancy.apply(b,a),b.Super("const",arguments)},init:function(){var a=this;a.addEvents("beforecollapse","collapse","expanded"),a.Super("init",arguments),Fancy.each(a.items,function(a,b){"top"===a.labelAlign&&0===b&&(a.style={"padding-left":"0px"})}),a.preRender(),a.render(),void 0!==a.checkbox&&a.initCheckBox(),a.on("beforecollapse",a.onBeforeCollapsed,a),a.on("expanded",a.onExpanded,a)},fieldCls:"fancy-field-set",value:"",width:100,emptyText:"",tpl:["<fieldset>","<legend>",'<div class="fancy-field-checkbox-input" style="float:left;margin-top: 4px;display: none;"></div>','<div class="fancy-field-set-label" style="float:left;">{label}</div>','<div class="fancy-clearfix"></div>',"</legend>",'<div class="fancy-field-text fancy-field-set-items">',"</div>","</fieldset>"],initCheckBox:function(){var a=this,b=a.el.select(".fancy-field-checkbox-input");b.css("display",""),!0===a.checkbox&&a.addCls("fancy-checkbox-on");var c=a.el.select(".fancy-field-set-items");setTimeout(function(){!0===a.checkbox||a.fire("collapse")},1),!0===a.checkbox?(c.css("display",""),a.removeCls("fancy-set-collapsed")):(c.css("display","none"),a.addCls("fancy-set-collapsed")),b.on("click",function(){a.toggleCls("fancy-checkbox-on");var b=a.el.hasCls("fancy-checkbox-on"),c=a.el.select(".fancy-field-set-items");b?(a.fire("beforeexpanded"),c.css("display",""),a.removeCls("fancy-set-collapsed"),a.fire("expanded")):(a.fire("beforecollapse"),c.css("display","none"),a.addCls("fancy-set-collapsed"),a.fire("collapse"))})},onBeforeCollapsed:function(){var a=this,b=a.form,c=a.el.select(".fancy-field-set-items"),d=parseInt(c.css("height"));b.setHeight(b.getHeight()-d)},onExpanded:function(){var a=this,b=a.form,c=a.el.select(".fancy-field-set-items"),d=parseInt(c.css("height"));b.setHeight(b.getHeight()+d)}}),Fancy.define(["Fancy.form.field.HTML","Fancy.HTMLField"],{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.html",constructor:function(a){var b=this,a=a||{};Fancy.apply(b,a),b.Super("const",arguments)},init:function(){var a=this;a.addEvents("focus","blur","input","enter","up","down","change","key"),a.Super("init",arguments),a.preRender(),a.render(),a.hidden&&a.css("display","none"),a.style&&a.css(a.style)},fieldCls:"fancy fancy-field-html",value:"",width:100,emptyText:"",tpl:['<div class="" style="">',"{value}","</div>"],render:function(){var a=this,b=a.renderTo||document.body,c=document.createElement("div");a.fire("beforerender"),c.innerHTML=a.tpl.getHTML({value:a.value,height:a.height}),a.el=b.appendChild(c),a.el=Fancy.get(a.el),a.addCls(a.cls,a.fieldCls),a.acceptedValue=a.value,a.fire("afterrender"),a.fire("render")},set:function(a,b){var c=this;c.el.firstChild().update(a),!1!==b&&c.onInput()},get:function(){return this.el.firstChild().dom.innerHTML}}),Fancy.define(["Fancy.form.field.ReCaptcha","Fancy.ReCaptcha"],{type:"field.recaptcha",mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,constructor:function(a){var b=this,a=a||{};Fancy.apply(b,a),b.Super("const",arguments)},init:function(){var a=this;a.addEvents("focus","blur","input","enter","up","down","change","key"),a.Super("init",arguments),a.tpl=new Fancy.Template(a.tpl),a.render(),a.name="recaptcha",a.hidden&&a.css("display","none"),a.style&&a.css(a.style);var b=document.createElement("script");b.type="text/javascript",b.src="https://www.google.com/recaptcha/api.js",Fancy.get(document.head).append(b)},get:function(){var a=this,b=a.el.select("form");return a.value?a.value:(a.value="wait",b.one("submit",function(b){b.preventDefault(),a.value=$(this).serialize().replace("g-recaptcha-response=","")}),b.submit(),a.value)},fieldCls:Fancy.fieldCls,value:"",width:100,tpl:['<form method="POST">','<div class="g-recaptcha" data-sitekey="{key}"></div>',"</form>"]});