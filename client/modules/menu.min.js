Fancy.modules.menu=!0,function(){var a=Fancy,b=a.MENU_CLS,c=a.MENU_ITEM_CLS,d=a.MENU_ITEM_IMAGE_CLS,e=a.MENU_ITEM_TEXT_CLS,f=a.MENU_ITEM_SIDE_TEXT_CLS,g=a.MENU_ITEM_ACTIVE_CLS,h=a.MENU_ITEM_RIGHT_IMAGE_CLS,i=a.MENU_ITEM_EXPAND_CLS,j=a.MENU_ITEM_DISABLED_CLS,k=a.MENU_ITEM_SEP_CLS,l=a.MENU_ITEM_NO_IMAGE_CLS;Fancy.define("Fancy.Menu",{extend:Fancy.Widget,constructor:function(a){Fancy.applyConfig(this,a),this.theme&&(this.itemHeight=Fancy.themes[this.theme].config.menuItemHeight),this.Super("const",arguments)},init:function(){var a=this;a.addEvents("hide"),a.Super("init",arguments),a.width<a.minWidth&&(a.width=a.minWidth),a.applyDefaults(),a.render(),a.ons()},ons:function(){var a=this,b=a.el;b.on("mousedown",a.onItemMouseDown,a,"."+c),b.on("click",a.onItemClick,a,"."+c),b.on("mouseenter",a.onItemEnter,a,"."+c),b.on("mouseleave",a.onItemLeave,a,"."+c)},widgetCls:b,itemCls:c,itemImageCls:d,cls:"",extraCls:"",width:142,minWidth:50,itemHeight:30,maxHeight:200,rendered:!1,theme:"default",render:function(){var a,b=this,c=Fancy.get(document.createElement("div"));b.fire("beforerender"),"default"!==b.theme&&c.addCls(Fancy.getThemeCSSCls(b.theme)),c.addClass(Fancy.cls,b.widgetCls,b.cls,b.extraCls),b.width<b.minWidth&&(b.width=b.minWidth),c.css({width:b.width,height:b.getItemsHeight()}),b.height&&c.css({height:b.height,"overflow-y":"scroll"}),a=Fancy.get(b.renderTo||document.body),b.el=a.dom.appendChild(c.dom),b.el=Fancy.get(b.el),b.renderItems(),b.items.length||b.el.css("border","0px"),b.fire("afterrender"),b.fire("render"),b.rendered=!0,b.checkHeight()},checkHeight:function(){var a=this;parseInt(a.el.css("height"))>a.maxHeight&&a.el.css({height:a.maxHeight,"overflow-y":"scroll"})},getItemsHeight:function(){for(var a=this,b=a.items,c=this.itemHeight,d=0,e=0,f=b.length;e<f;e++){var g=b[e];"sep"===g.type||"-"===g.type||"-"===g?d+=2:d+=c}return d},renderItems:function(){for(var a,b=this,c=0,g=b.items.length;c<g;c++){a=b.items[c],"-"===a&&(a={type:"sep"});var m=Fancy.get(document.createElement("div"));m.attr("index",c),m.addCls(b.itemCls),"sep"===a.type?m.addCls(k):m.css("height",b.itemHeight),b.el.dom.appendChild(m.dom),a.el=m;var n=a.imageCls||"";if(a.cls&&m.addCls(a.cls),"sep"!==a.type&&"-"!==a.type){var o=[!1===a.image?"":'<div class="'+d+" "+n+'"></div>','<div class="'+e+'"></div>'];a.sideText&&o.push('<div class="'+f+'">'+a.sideText+"</div>"),o.push('<div class="'+h+" "+(a.items?i:"")+'"></div>'),m.update(o.join(""))}switch(!1===a.image&&m.addCls(l),!0===a.disabled&&m.addCls(j),a.type){case"":case"-":case"sep":break;case"number":b.items[c].field=new Fancy.NumberField({label:!1,theme:b.theme,padding:"1px 0px 0px",width:90,renderAfter:m.select("."+d).item(0).dom,events:b.items[c].events,value:a.value||""});break;case"string":b.items[c].field=new Fancy.StringField({label:!1,theme:b.theme,padding:"1px 0px 0px",width:90,renderAfter:m.select("."+d).item(0).dom,events:b.items[c].events,value:a.value||""});break;default:m.select("."+e).item(0).update(a.text||"")}void 0!==a.checked&&(b.items[c].checkbox=new Fancy.CheckBox({label:!1,theme:b.theme,padding:"1px 8px 0px",renderTo:m.select("."+d).item(0).dom,value:a.checked}))}},applyDefaults:function(){var a=this,b=0,c=a.items.length;if(a.defaults)for(;b<c;b++)Fancy.applyIf(a.items[b],a.defaults)},onItemClick:function(a){var b=this,c=Fancy.get(a.currentTarget),d=c.attr("index"),e=b.items[d],f=[b,e];e.handler&&!e.disabled&&(e.scope?e.handler.apply(e.scope,f):e.handler(b,e))},onItemEnter:function(a){var b=this,c=Fancy.get(a.currentTarget),d=c.attr("index"),e=b.items[d],f=c.offset();if(b.shownSubMenu&&b.shownSubMenu.hide(),b.deActivateItem(),b.activateItem(d),e.items){if(!e.menu){var g=b.items[d];Fancy.apply(g,{parentItem:e,parentMenu:b,defaults:e.defaults,items:e.items,theme:b.theme}),b.items[d].menu=new Fancy.Menu(g)}e.menu.showAt(f.left+parseInt(c.width()),f.top),b.shownSubMenu=e.menu}},onItemLeave:function(){},showAt:function(b,c,d){var e=this;e.css("position","absolute"),e.css("left",b),e.css("top",c),e.css("z-index",1e3+a.zIndex++),e.el.show(),!1!==d&&e.checkPosition(),e.parentMenu||Fancy.MenuManager.add(e)},hide:function(){var a=this;a.el.hide(),a.deActivateItem(),a.shownSubMenu&&a.shownSubMenu.hide(),a.fire("hide")},hideAll:function(){var a=this.parentMenu;a&&"none"!==a.el.css("display")&&a.hide(),this.hide()},activateItem:function(a){var b=this,c=b.items[a];"sep"===c.type||"-"===c||c.disabled||(b.activeItem=c,c.el.addCls(g))},deActivateItem:function(){var a=this.activeItem;a&&(a.el.removeClass(g),delete this.activeItem)},onItemMouseDown:function(a){"input"===a.target.tagName.toLocaleLowerCase()||a.preventDefault()},enableItem:function(a){var b=this,c=b.items[a];c.el.removeCls(j),c.disabled=!1},disableItem:function(a){var b=this,c=b.items[a];c.el.addCls(j),c.disabled=!0},checkPosition:function(){var b=this,c=b.el,d=c.offset(),e=parseInt(c.css("height")),f=parseInt(c.css("width")),g=a.getViewSize(),h=a.getScroll(),i=d.top+e,j=d.left+f,k=d.top,l=d.left,m=20;if(i>g[0]+h[0]-m&&(k=d.top-(i-(g[0]+h[0]))-m),j>g[1]+h[1]-m)if(b.parentMenu){var n=parseInt(b.parentMenu.el.css("left"));l=n-f}else l=d.left-(j-(g[1]+h[1]))-m;b.showAt(l,k,!1)},setChecked:function(b,c){var d=this;c&&d.clearChecked();var e=d.el.select(".fancy-menu-item").item(b);a.getWidget(e.select(".fancy-field-checkbox").attr("id")).set(!0)},clearChecked:function(){this.el.select(".fancy-checkbox-on").each(function(b){var c=b.attr("id");a.getWidget(c).set(!1)})}}),Fancy.define("Fancy.MenuManager",{singleton:!0,inited:!1,constructor:function(){},init:function(){Fancy.get(document).on("click",this.onDocClick,this)},add:function(a){var b=this;b.inited||b.init(),b.activeMenu=a},onDocClick:function(a){var c=this,d=Fancy.get(a.target),e=10,f=d;if(c.activeMenu){for(;e>0&&f.dom;){if(f.hasCls(b))return;f=f.parent(),e--}c.activeMenu.hide(),delete c.activeMenu}}})}(),function(){var a=Fancy,b=a.MENU_ITEM_IMG_COPY_CLS,c=a.MENU_ITEM_IMG_DELETE_CLS,d=a.MENU_ITEM_IMG_DUPLICATE_CLS,e=a.MENU_ITEM_IMG_EDIT_CLS;a.define("Fancy.grid.plugin.ContextMenu",{extend:a.Plugin,ptype:"grid.contextmenu",inWidgetName:"contextmenu",defaultItems:["copy","copy+","delete","-","export"],width:200,constructor:function(){this.Super("const",arguments)},init:function(){this.Super("init",arguments),this.ons()},ons:function(){var a=this;a.widget.on("contextmenu",a.onContextMenu,a)},onContextMenu:function(a,b){var c=this,d=b.e;c.activeItem=b,d.preventDefault(),c.menu||c.initMenu(),setTimeout(function(){c.showMenu(d,!0)},50)},initMenu:function(){var f=this,g=f.widget,h=[],i=f.items||a.Array.copy(f.defaultItems);a.each(i,function(i,j){var k=i,l={};switch(i.type&&(k=i.type,a.apply(l,i)),k){case"copy":a.applyIf(l,{text:"Copy",sideText:"CTRL+C",imageCls:b,handler:function(){g.copy()}}),h.push(l);break;case"copyWidthHeader":case"copy+":a.applyIf(l,{text:"Copy with Headers",imageCls:b,handler:function(){g.copy(!0)}}),h.push(l);break;case"delete":a.applyIf(l,{text:"Delete",imageCls:c,handler:function(){switch(g.selection.selModel){case"rows":case"row":var a=g.getSelection();0===a.length&&f.activeItem&&(a=f.activeItem.data),g.remove(a),g.clearSelection()}}}),h.push(l);break;case"edit":f.editItemIndex=j,a.applyIf(l,{text:"Edit",imageCls:e,disabled:!0,handler:function(){if(g.rowEdit){var a=g.selection.getActiveCell(),b=g.getSideByCell(a),c=g.getBody(b),d=c.getEventParams({currentTarget:a.dom});g.rowedit.edit(d)}}}),h.push(l);break;case"export":a.applyIf(l,{text:"Export",items:[{text:"CSV Export",handler:function(){g.exportToCSV({header:!0})}},{text:"Excel Export",handler:function(){g.exportToExcel({header:!0})}}]}),h.push(l);break;case"duplicate":a.applyIf(l,{text:"Duplicate",imageCls:d,handler:function(){switch(g.selection.selModel){case"rows":case"row":var b,c=g.getSelection(),d=[];if(c.length)b=g.getRowById(c[c.length-1].id)+1,a.each(c,function(b){var c=a.Object.copy(b);c.id=a.id(null,"TEMP-"),d.push(c)});else{if(!f.activeItem)return;b=g.getRowById(f.activeItem.data.id)+1,d=a.Object.copy(f.activeItem.data),d.id=a.id(null,"TEMP-")}g.insert(b,d),a.each(d,function(a){var b=g.getRowById(a.id);g.flashRow(b)})}}}),h.push(l);break;default:h.push(i)}}),f.menu=new Fancy.Menu({width:f.width,theme:g.theme,items:h})},showMenu:function(b,c){var d=this,e=d.widget,f=e.selection,g=d.menu.el,h=Fancy.get(b.target),i=h.offset(),j=i.top+40,k=i.left;if(c&&(j=b.pageY+40,k=b.pageX),a.isTouch&&(j=b.targetTouches[0].clientY+20,k=b.targetTouches[0].clientX),g.css({position:"absolute",top:j,left:k}),d.menu.css("z-index",1e3+a.zIndex++),d.menu.show(),g.animate({duration:200,top:j-20}),f&&d.editItemIndex)switch(f.selModel){case"rows":case"row":var l=e.getSelection();0===l.length||l.length>1?d.menu.disableItem(d.editItemIndex):d.menu.enableItem(d.editItemIndex)}setTimeout(function(){Fancy.get(document).once("click",function(){d.hideMenu()})},50)},hideMenu:function(){var a=this;setTimeout(function(){a.menu.hide()},50),delete a.activeItem}})}(),function(){var a=Fancy,b=a.GRID_HEADER_COLUMN_TRIGGERED_CLS,c=a.GRID_HEADER_CELL_TRIGGER_UP_CLS,d=a.GRID_HEADER_CELL_TRIGGER_DOWN_CLS;a.Mixin("Fancy.grid.header.mixin.Menu",{triggeredColumnCls:b,triggerUpCls:c,triggerDownCls:d,showMenu:function(c,d,e,f){var g=this,h=g.widget,i=c.offset();if(e.menu&&e.menu.rendered&&"block"===e.menu.el.css("display"))return void g.hideMenu();g.hideMenu(),c.addCls(b),e.menu.rendered?!1!==e.menuColumns&&g.updateColumnsMenu(e,f):(e._menu=e.menu,e.menu=g.generateMenu(e,f),e.menu=new a.Menu({column:e,items:e.menu,theme:h.theme,events:[{hide:g.onMenuHide,scope:g}]})),e.menu.showAt(i.left+parseInt(c.css("width"))-26,i.top+parseInt(c.css("height"))-1),g.activeMenu=e.menu,g.activeCell=c},hideMenu:function(){var a=this,c=a.widget,d=c.header,e=c.rightHeader,f=c.leftHeader;switch(a.side){case"left":d.activeMenu&&(d.activeMenu.hide(),d.activeCell.removeCls(b),delete d.activeMenu,delete d.activeCell),e.activeMenu&&(e.activeMenu.hide(),e.activeCell.removeCls(b),delete e.activeMenu,delete e.activeCell);break;case"center":f.activeMenu&&(f.activeMenu.hide(),f.activeCell.removeCls(b),delete f.activeMenu,delete f.activeCell),e.activeMenu&&(e.activeMenu.hide(),e.activeCell.removeCls(b),delete e.activeMenu,delete e.activeCell);break;case"right":f.activeMenu&&(f.activeMenu.hide(),f.activeCell.removeCls(b),delete f.activeMenu,delete f.activeCell),d.activeMenu&&(d.activeMenu.hide(),d.activeCell.removeCls(b),delete d.activeMenu,delete d.activeCell)}a.activeMenu&&(a.activeMenu.hide(),a.activeCell.removeCls(b)),delete a.activeMenu,delete a.activeCell},generateMenu:function(b,e){for(var f,g=this,h=g.widget,i=h.lang,j=[],k=!1===b.sortable?"fancy-menu-item-disabled":"",l=b.sortable&&!1!==b.menuSortable,m=!1!==b.lockable&&!1!==b.menuLockable,n=!1!==b.menuColumns,o=0,p=e.length,q={text:i.sortAsc,cls:k,imageCls:c,handler:function(){h.sorter.sort("asc",b.index,g.side),b.menu.hide()}},r={text:i.sortDesc,cls:k,imageCls:d,handler:function(){h.sorter.sort("desc",b.index,g.side),b.menu.hide()}},s={text:i.columns,index:"columns",items:g.prepareColumns(e)},t={text:i.autoSizeColumn,cls:k,handler:function(){h.autoSizeColumn(b.index,g.side,b),b.menu.hide()}},u={text:i.autoSizeColumns,cls:k,handler:function(){h.autoSizeColumns(),b.menu.hide()}};o<p;o++)if(b.index===e[o].index){f=o;break}if("columns"===b.menu)return j=s.items;if("size"===b.menu)return j.push(t),j.push(u),j;if(Fancy.isArray(b.menu))a.each(b.menu,function(a){switch(a){case"|":j.push("-");break;case"sort":j.push(q),j.push(r);break;case"columns":j.push(s);break;case"size":j.push(t),j.push(u);break;case"lock":switch(g.side){case"left":case"right":j.push({text:i.unlock,handler:function(){b.menu.hide(),h.unLockColumn(f,g.side)}});break;case"center":j.push({text:i.lock,handler:function(){b.menu.hide(),h.lockColumn(f,g.side)}}),j.push({text:i.rightLock,handler:function(){b.menu.hide(),h.rightLockColumn(f,g.side)}})}break;default:j.push(a)}});else if(l&&(j.push(q),j.push(r),j.push("-")),n&&j.push(s),m)switch(g.side){case"left":case"right":!1!==b.menuColumns&&j.push("-"),j.push({text:i.unlock,handler:function(){b.menu.hide(),h.unLockColumn(f,g.side)}});break;case"center":!1!==b.menuColumns&&j.push("-"),j.push({text:i.lock,handler:function(){b.menu.hide(),h.lockColumn(f,g.side)}}),j.push({text:i.rightLock,handler:function(){b.menu.hide(),h.rightLockColumn(f,g.side)}})}return j},prepareColumns:function(b){var c,d=this,e=d.widget,f=[],g=[];return a.each(b,function(a){var b=!0;if(!1!==a.columnMenu){a.hidden&&(b=!1);var h={text:a.title,checked:b,index:a.index,column:a,handler:function(b,c){if(!0!==c.checked||c.checkbox.get()||c.checkbox.set(!0),c.checked&&1===b.el.select(".fancy-checkbox-on").length)return void c.checkbox.set(!0);c.checked=!c.checked,c.checkbox.set(c.checked),c.checked?e.showColumn(d.side,c.index,a):e.hideColumn(d.side,c.index,a),e.responsive&&e.onWindowResize()}};if(a.grouping)return g=g||[],g.push(h),void(c=a.grouping);g.length&&(f.push({text:c,items:g}),c=void 0,g=[]),f.push(h)}}),g.length&&f.push({text:c,items:g}),f},onMenuHide:function(){this.el.select("."+b).removeCls(b)},updateColumnsMenu:function(a,b,c){for(var d,e,f=this,g=a.menu,h=0,i=g.items.length;h<i;h++)if(e=g.items[h],"columns"===e.index){d=e;break}if(d){h=0,i=d.items.length;for(var j=!1;h<i;h++){e=d.items[h];var k=b[h];e.checkbox&&(e.checkbox.set(!k.hidden,!1),j=!0)}j||c||(d.items=f.prepareColumns(b))}},destroyMenus:function(){for(var b,c=this,d=c.widget,e=d.getColumns(c.side),f=0,g=e.length;f<g;f++)b=e[f],a.isObject(b.menu)&&b.menu.destroy()}})}();