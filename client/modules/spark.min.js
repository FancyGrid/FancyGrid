Fancy.define("Fancy.spark.ProgressDonut",{svgns:"http://www.w3.org/2000/svg",sum:100,prefix:"fancy-spark-progress-donut-",colorBGPlus:"#eee",colorPlus:"#44A4D3",colorBGMinus:"#F9DDE0",colorMinus:"#EA7369",tipTpl:"{value}",tip:!0,tooltip:!0,constructor:function(e){Fancy.apply(this,e),this.init()},init(){const e=this;e.initId(),e.initChart(),e.setSize(),e.setRadius(),e.setInnerRadius(),e.setParams(),e.iniColors(),e.preRender(),e.render(),!0!==e.inited&&(e.renderTo.appendChild(e.chart),e.ons())},initId(){const e=this,t=e.prefix||Fancy.prefix;e.id=e.id||Fancy.id(null,t),Fancy.addWidget(e.id,e)},ons(){const e=this;e.el.on("mouseenter",e.onMouseEnter,e),e.el.on("mouseleave",e.onMouseLeave,e),e.el.on("mousemove",e.onMouseMove,e)},onMouseEnter(){let e=this,t=e.el.attr("value");if(!e.tip||!e.tipTpl)return;t=new Fancy.Template(e.tipTpl).getHTML({value:t}),Fancy.tip.update('<span style="color: '+e.color+';">●</span> '+t)},onMouseLeave(){this.tip&&this.tipTpl&&Fancy.tip.hide(500)},onMouseMove(e){this.tooltip&&this.tip&&this.tipTpl&&Fancy.tip.show(e.pageX+15,e.pageY-25)},iniColors(){const e=this;e.value<0?(e.backColor=e.colorBGMinus,e.color=e.colorMinus):(e.backColor=e.colorBGPlus,e.color=e.colorPlus)},preRender(){const e=this.size,t=this.chart;t.setAttribute("width",e),t.setAttribute("height",e),t.setAttribute("viewBox","0 0 "+e+" "+e)},render(){this.renderBack(),this.renderProgress()},renderBack(){const e=this,t=e.radius,a=e.innerRadius,i=["M",e.cx,e.y1,"A",t,t,0,1,1,e.x2,e.y1,"L",e.x2,e.y2,"A",a,a,0,1,0,e.cx,e.y2].join(" "),s=document.createElementNS(e.svgns,"path");s.setAttribute("d",i),s.setAttribute("fill",e.backColor),e.chart.appendChild(s)},renderProgress(){var e=this,t=e.radius,a=e.innerRadius,i=document.createElementNS(e.svgns,"path"),s=e.value,n=0;s>99&&(s=99.99999),s<-99&&(s=99.99999),s<0&&(n=100+s,s*=-1);const l=s/e.sum,r=n+s;var o=["M"].concat(e.scale(n,t),"A",t,t,0,l>.5?1:0,1,e.scale(r,t),"L");a&&(o=o.concat(e.scale(r,a),"A",a,a,0,l>.5?1:0,0,e.scale(n,a))),o=o.join(" "),i.setAttribute("d",o),i.setAttribute("fill",e.color),e.chart.appendChild(i)},initChart(){const e=this,t=Fancy.get(e.renderTo);e.renderTo=Fancy.get(e.renderTo).dom,0===t.select("svg").length?e.chart=document.createElementNS(e.svgns,"svg:svg"):(e.chart=t.select("svg").dom,e.chart.innerHTML="",e.inited=!0),e.el=Fancy.get(e.chart),e.el.attr("id",e.id),e.value<1&&e.value>0?e.el.attr("value",e.value.toFixed(1)):e.value>-1&&e.value<0?e.el.attr("value",e.value.toFixed(1)):e.el.attr("value",e.value.toFixed(0))},scale(e,t){const a=Math.PI,i=e/this.sum*a*2-a/2;return[t*Math.cos(i)+this.cx,t*Math.sin(i)+this.cy]},radians:e=>e*Math.PI/180,setSize(){const e=this;e.width=e.width||e.height||e.size||30,e.height=e.height||e.width||e.size||30,e.size=e.size||e.height},setRadius(){this.radius=this.radius||this.height/2},setInnerRadius(){this.innerRadius=this.innerRadius||this.height/2-this.height/4},setParams(){const e=this,t=e.radius,a=e.innerRadius,i=e.height,s=e.width;e.cy=i/2,e.y1=e.cy-t,e.y2=e.cy-a,e.cx=s/2,e.x2=e.cx-.01}}),Fancy.modules.spark=!0,Fancy.define("Fancy.spark.GrossLoss",{maxValue:100,tipTpl:'<span style="color: {color};">●</span> {value} {suffix}',tip:!0,constructor:function(e){Fancy.apply(this,e),this.init()},init(){const e=this;e.preRender(),e.render(),!0!==e.inited&&e.ons()},ons(){const e=this;e.el.on("mouseenter",e.onMouseEnter,e),e.el.on("mouseleave",e.onMouseLeave,e),e.el.on("mousemove",e.onMouseMove,e)},onMouseEnter(){let e,t=this,a=t.el.attr("value"),i=t.el.css("background-color"),s="";if(!t.tipTpl||!t.tip)return;t.percents&&(s=" %"),e=new Fancy.Template(t.tipTpl).getHTML({value:a,color:i,suffix:s}),Fancy.tip.update(e)},onMouseLeave(){this.tipTpl&&this.tip&&Fancy.tip.hide(500)},onMouseMove(e){this.tipTpl&&this.tip&&Fancy.tip.show(e.pageX+15,e.pageY-25)},preRender(){},render(){var e=this,t=e.column.width/e.maxValue,a=0,i=0,s=e.value,n="";s<0?(a=-s*t/2,e.lossColor&&(n="background-color:"+e.lossColor+";"),s='<div class="fancy-grid-grossloss-loss" style="'+n+"width:"+a+'%">&nbsp;</div>'):(i=s*t/2,e.grossColor&&(n="background-color:"+e.grossColor+";"),s='<div class="fancy-grid-grossloss-gross" style="'+n+"width:"+i+'%">&nbsp;</div>'),e.renderTo.innerHTML=s,e.value<0?e.el=Fancy.get(e.renderTo).select(".fancy-grid-grossloss-loss").item(0):e.el=Fancy.get(e.renderTo).select(".fancy-grid-grossloss-gross").item(0),e.el.attr("value",e.value.toFixed(2))}}),Fancy.define("Fancy.spark.ProgressBar",{tipTpl:"{value} {suffix}",tip:!0,constructor:function(e){Fancy.apply(this,e),this.init()},init(){const e=this;e.initId(),e.render(),!0!==e.inited&&e.ons()},initId(){const e=this,t=e.prefix||Fancy.prefix;e.id=e.id||Fancy.id(null,t),Fancy.addWidget(e.id,e)},ons(){const e=this;!1!==e.tip&&(e.el.on("mouseenter",e.onMouseEnter,e),e.el.on("mouseleave",e.onMouseLeave,e),e.el.on("mousemove",e.onMouseMove,e))},onMouseEnter(){var e,t=this,a=t.el.attr("value"),i="%";if(!1===t.percents&&(i=""),!1!==t.tip&&t.tipTpl){if(Fancy.isFunction(t.tipTpl))e=t.tipTpl({value:a,suffix:i});else e=new Fancy.Template(t.tipTpl).getHTML({value:a,suffix:i});Fancy.tip.update(e)}},onMouseLeave(){this.tip&&this.tipTpl&&Fancy.tip.hide(500)},onMouseMove(e){this.tip&&this.tipTpl&&Fancy.tip.show(e.pageX+15,e.pageY-25)},render(){var e,t=this,a=t.column,i=(a.width-18)/t.maxValue,s=t.value*i,n=t.value,l=a.sparkConfig;n=!1===t.percents?t.value:n<1?t.value.toFixed(1):t.value.toFixed(0);var r="&nbsp;",o="",d="";if(l.label)switch(l.label.type){case"left":r='<div class="fancy-grid-bar-label" style="float: left;">'+n+"</div>",s<7*String(n).length&&(r="&nbsp;",o='<div class="fancy-grid-bar-label-out" style="">'+n+"</div>");break;case"right":r='<div class="fancy-grid-bar-label" style="float: right;">'+n+"</div>",s<7*String(n).length&&(r="&nbsp;",o="right"===l.align?'<div class="fancy-grid-bar-label-out-left" style="">'+n+"</div>":'<div class="fancy-grid-bar-label-out" style="">'+n+"</div>");break;default:r='<div class="fancy-grid-bar-label" style="float: left;">'+n+"</div>",s<7*String(n).length&&(r="&nbsp;",d='<div class="fancy-grid-bar-label-out-left" style="">'+n+"</div>")}var c="width:"+s+"px;",u="";if(l.align&&(u="float:"+l.align+";"),e='<div id="'+t.id+'" value="'+n+'" class="fancy-grid-column-progress-bar" style="'+c+u+'">'+r+"</div>"+o+d,t.renderTo.innerHTML=e,t.el=Fancy.get(t.renderTo).select(".fancy-grid-column-progress-bar").item(0),Fancy.isFunction(t.style)){var p=t.style({value:t.value,column:t.column,rowIndex:t.rowIndex,data:t.data});t.el.css(p)}},update(){var e=this,t=e.column,a=(t.width-18)/e.maxValue,i=e.value,s=i*a,n=t.sparkConfig,l=e.el.parent();if(e.el.css("width",s),e.el.attr("value",i),n.label)if("right"===n.label.type){var r=l.select(".fancy-grid-column-progress-bar"),o=l.select(".fancy-grid-bar-label"),d=l.select(".fancy-grid-bar-label-out");10*String(i).length+10>s?(o.dom&&(r.update("&nbsp;"),o.destroy()),d.dom?d.update(i):l.append('<div class="fancy-grid-bar-label-out">'+i+"</div>")):(o.dom||(r.append('<div class="fancy-grid-bar-label" style="float: right;"></div>'),o=l.select(".fancy-grid-bar-label")),o.update(i),d.dom&&d.destroy())}else{r=l.select(".fancy-grid-column-progress-bar"),o=l.select(".fancy-grid-bar-label");var c=l.select(".fancy-grid-bar-label-out-left");10*String(i).length+10>s?(o.dom&&(r.update("&nbsp;"),o.destroy()),c.dom?c.update(i):l.append('<div class="fancy-grid-bar-label-out-left">'+i+"</div>")):(o.dom||(r.append('<div class="fancy-grid-bar-label" style="float: left;"></div>'),o=l.select(".fancy-grid-bar-label")),o.update(i),c.dom&&c.destroy())}}}),Fancy.define("Fancy.spark.HBar",{tipTpl:"{value}",tip:!0,maxValue:100,stacked:!1,fullStack:!1,constructor:function(e){Fancy.apply(this,e),this.init()},init(){const e=this;e.initId(),e.render(),!0!==e.inited&&e.ons()},initId(){const e=this,t=e.prefix||Fancy.prefix;e.id=e.id||Fancy.id(null,t),Fancy.addWidget(e.id,e)},ons(){const e=this;!1!==e.tip&&(e.el.on("mouseenter",e.onMouseEnter,e,".fancy-grid-column-h-bar-node"),e.el.on("mouseleave",e.onMouseLeave,e,".fancy-grid-column-h-bar-node"),e.el.on("mousemove",e.onMouseMove,e,".fancy-grid-column-h-bar-node"))},onMouseEnter(e){var t=this,a=Fancy.get(e.target),i=a.attr("key"),s=a.attr("data-title"),n=Number(a.attr("value")),l=Number(a.attr("percents"));if(!t.tip||!t.tipTpl)return;if(t.tipFormat){const e={value:n,percents:l,key:i,column:t.column,data:t.data,title:s};n=t.tipFormat(e)}const r=new Fancy.Template(t.tipTpl).getHTML({value:n});Fancy.tip.update(r)},onMouseLeave(){this.tip&&this.tipTpl&&Fancy.tip.hide(500)},onMouseMove(e){this.tip&&this.tipTpl&&Fancy.tip.show(e.pageX+15,e.pageY-25)},render(){var e,t,a=this,i=a.column,s=(i.width-18)/100,n=i.index,l=0,r=i.disabled||{},o="",d="",c=0,u=n.length;i.fields?(u=i.fields.length,Fancy.each(i.fields,e=>{const t=i.index+"."+e;r[t]||(l+=a.data[i.index][t])})):Fancy.each(n,e=>{r[e]||(l+=a.data[e])}),a.stacked?a.fullStack||(l=a.maxValue):(l=a.maxItemValue,o="line-height:"+((a.height-1)/n.length-2)+"px;"),e=l/100,c=0;let p="fancy-spark-hbar";for(a.stacked&&(p+=" fancy-spark-stacked "),t='<div id="'+a.id+'" class="'+p+'">';c<u;c++){if(i.fields)var h=i.fields[c],y=a.data[i.index][h];else h=n[c],y=a.data[h];var g=y/e,v=g*s;if(!r[h]){0!==c&&v--,a.stacked||(d="margin-top:2px;"),v>0&&v<1&&(v=2);var f="background: "+Fancy.COLORS[c]+";",m="width:"+v+";",b="",F='data-title=""';0===v&&(b="display: none;"),a.title&&(F='data-title="'+a.title[c]+'" '),t+="<div "+F+('key="'+h+'" ')+(y='value="'+y+'" ')+('percents="'+g+'" ')+'" class="fancy-grid-column-h-bar-node" style="'+b+m+f+o+d+'">&nbsp;</div>'}}t+="</div>",a.renderTo.innerHTML=t,a.el=Fancy.get(a.renderTo)},update(e){var t,a,i=this,s=i.column,n=(s.width-18)/100,l=s.index,r=0,o=s.disabled||{};i.data=e;var d=0,c=l.length,u=0;for(s.fields?(c=s.fields.length,Fancy.each(s.fields,e=>{o[s.index+"."+e]?u++:r+=i.data[s.index][e]})):Fancy.each(l,e=>{o[e]?u++:r+=i.data[e]}),i.stacked?i.fullStack||(r=i.maxValue):(r=i.maxItemValue,a=(i.height-1)/(l.length-u)-2),t=r/100,d=0;d<c;d++){if(s.fields)var p=s.fields[d],h=i.data[s.index][p];else p=l[d],h=i.data[p];var y=h/t*n,g=i.el.select('.fancy-grid-column-h-bar-node[key="'+p+'"]');s.fields&&o[s.index+"."+p]?(g.css("width","0px"),g.hide()):o[p]?(g.css("width","0px"),g.hide()):(0!==d&&y--,i.stacked||(g.css("line-height",a+"px"),g.css("margin-top","2px")),0===y||-1===y?g.css("display","none"):g.css("display","block"),y>0&&y<2&&(y=2),g.animate({duration:2,width:y}))}}});