Fancy.define("Fancy.toolbar.Tab",{extend:Fancy.Button,constructor:function(a,b){this.Super("const",arguments)},init:function(){this.Super("init",arguments)},cls:Fancy.BUTTON_CLS+" "+Fancy.TAB_TBAR_CLS,render:function(){this.Super("render",arguments)}}),function(){var a=Fancy,b=a.MODAL_CLS,c=a.FIELD_NOT_VALID_CLS,d=a.FORM_CLS,e=a.FORM_BODY_CLS,f=a.PANEL_BODY_INNER_CLS,g=a.PANEL_GRID_INSIDE_CLS,h=a.PANEL_SHADOW_CLS,i=a.FIELD_BLANK_ERR_CLS,j=a.FIELD_TAB_CLS,k=a.FIELD_TAB_ACTIVE_CLS,l=a.TAB_TBAR_ACTIVE_CLS,m=a.PANEL_TBAR_CLS,n=a.TAB_TBAR_CLS,o=a.FIELD_TEXT_CLS;a.Mixin("Fancy.form.mixin.Form",{init:function(){var b=this;if(b.calcFieldSize(),b.Super("init",arguments),b.addEvents("init","set"),!0!==a.fullBuilt&&!1!==a.MODULELOAD&&!1!==a.MODULESLOAD&&!0!==b.fullBuilt&&!0!==b.neededModules)return void b.loadModules();b.fire("beforerender"),b.applyDefaults(),b.preRender(),b.render(),b.ons(),b.fire("init")},cls:"",widgetCls:d,value:"",width:200,height:300,emptyText:"",tpl:['<div class="'+e+'"></div>'],preRender:function(){var a=this;a.initRenderTo(),(a.title||a.tbar||a.bbar||a.buttons)&&a.renderPanel()},renderPanel:function(){var b=this,c={renderTo:b.renderTo,title:b.title,subTitle:b.subTitle,subTitleHeight:b.subTitleHeight,width:b.width,height:b.height,titleHeight:b.titleHeight,barHeight:b.barHeight,theme:b.theme,shadow:b.shadow,style:b.style||{},window:b.window,modal:b.modal,frame:b.frame,items:[b],tabs:b.tabs,draggable:b.draggable,minWidth:b.minWidth,minHeight:b.minHeight,panelBodyBorders:b.panelBodyBorders,resizable:b.resizable};b.cls&&(c.cls=b.cls,delete b.cls),b.tabs&&(c.tbar=b.generateTabs(),b.height-=b.barHeight),b.bbar&&(c.bbar=b.bbar,b.height-=b.barHeight),b.tbar&&(c.tbar=b.tbar,b.height-=b.barHeight),b.buttons&&(c.buttons=b.buttons,b.height-=b.barHeight,c.buttons=b.buttons),b.footer&&(c.footer=b.footer,b.height-=b.barHeight),b.panel=new a.Panel(c),b.bbar=b.panel.bbar,b.tbar=b.panel.tbar,b.buttons=b.panel.buttons,b.wrapped||b.panel.addCls(g),b.extraCls&&b.panel&&b.panel.addCls(b.extraCls),b.title&&(b.height-=b.titleHeight),b.subTitle&&(b.height-=b.subTitleHeight,b.height+=b.panelBodyBorders[2]),b.height-=b.panelBodyBorders[0],b.renderTo=b.panel.el.select("."+f).dom},initRenderTo:function(){var b=this,c=b.renderTo||document.body;a.isString(c)&&((c=document.getElementById(c))||(c=a.select(c).item(0))),b.renderTo=c},render:function(){var b=this,c=b.renderTo,d=a.get(document.createElement("div"));d.addCls(b.cls,a.cls,b.widgetCls),d.attr("id",b.id),d.css({width:b.width+"px",height:b.height+"px"}),d.update(b.tpl.join(" ")),b.el=a.get(a.get(c).dom.appendChild(d.dom)),void 0===b.panel&&(b.shadow&&d.addCls(h),"default"!==b.theme&&d.addCls("fancy-theme-"+b.theme)),b._items=[],b.renderItems(),b.items=b._items,delete b._items,(b.tabs||b.tabbed)&&b.setActiveTab(),b.fire("afterrender"),b.fire("render")},generateTabs:function(){var b=this,c=[];if(b.tabs)for(var d=0,e=b.tabs.length;d<e;d++){var f={type:"tab"};a.isString(b.tabs[d])?f.text=b.tabs[d]:f=b.tabs[d],b.tabs[d]=f,void 0===b.tabs[d].handler&&(b.tabs[d].handler=function(a){return function(){b.setActiveTab(a)}}(d)),c.push(b.tabs[d])}return c},setActiveTab:function(a){var b=this,c=b.el.select("."+j),d=b.el.select("."+k);if(void 0!==a&&(b.activeTab=a),void 0===b.activeTab&&(b.activeTab=0),d.removeCls(k),c.item(b.activeTab).addCls(k),b.tabs){var e=b.panel.el.select("."+m+" ."+n);e.removeCls(l),e.item(b.activeTab).addCls(l)}},renderItems:function(b,c){var d,f=this,g=0;for(c=c||f.items,d=c.length,b=b||f.el.getByClass(e);g<d;g++){var h,i=c[g];switch(i.theme=f.theme,i.type){case"pass":case"password":h=a.form.field.String,i.type="string",i.isPassword=!0;break;case"hidden":h=a.form.field.String,i.hidden=!0;break;case"line":case"row":h=a.form.field.Line,i=f.applyDefaults(i);break;case"set":case"fieldset":i.form=f,h=a.form.field.Set,i=f.applyDefaults(i);break;case"tab":h=a.form.field.Tab,i=f.applyDefaults(i);break;case"string":case void 0:h=a.form.field.String;break;case"number":h=a.form.field.Number;break;case"textarea":h=a.form.field.TextArea;break;case"checkbox":h=a.form.field.CheckBox;break;case"switcher":h=a.form.field.Switcher;break;case"combo":h=a.form.field.Combo;break;case"html":h=a.form.field.HTML;break;case"radio":h=a.form.field.Radio;break;case"date":h=a.form.field.Date;break;case"recaptcha":h=a.form.field.ReCaptcha;break;case"button":h=a.form.field.Button;break;case"segbutton":h=a.form.field.SegButton;break;default:throw new Error("type "+i.type+" is not set")}i.renderTo=i.renderTo||b;var j=new h(i);switch(i.type){case"line":case"row":case"set":case"fieldset":case"tab":f.renderItems(j.el.select("."+o).dom,j.items);break;default:f._items.push(j)}}},applyDefaults:function(b){var c=this;{if(void 0!==b){var d,e;if(b.defaults)for(d=0,e=b.items.length;d<e;d++)a.applyIf(b.items[d],b.defaults);return b}for(var f=c.items,g=0,h=f.length,i=c.defaults||{};g<h;g++)a.applyIf(f[g],i)}},ons:function(){var b=this;a.each(b.items,function(a){switch(a.type){case"line":case"row":break;case"set":case"fieldset":break;case"tab":case"button":case"segbutton":break;default:a.on("change",b.onChange,b)}})},onChange:function(a,b,c){this.fire("set",{name:a.name,value:b,oldValue:c})},get:function(b){var c=this;if(b){var d;return a.each(c.items,function(a){switch(a.type){case"html":case"button":return}if(a.name===b)return d=a.get(),!0}),d}var e={};return a.each(c.items,function(a){switch(a.type){case"html":case"button":return}void 0!==a.name&&(e[a.name]=a.get())}),e},set:function(b,c){var d=this;if(a.isObject(b))for(var e in b)d.set(e,b[e]);else if(b)return a.each(d.items,function(a){a.name===b&&a.set(c)}),c},clear:function(b){var d=this;a.each(d.items,function(a){switch(a.type){case"html":case"recaptcha":case"button":return}!1!==b&&a.clear(),d.hasCls(c)&&(d.removeCls(c),d.css("height",parseInt(d.css("height"))-6+"px")),d.hasCls(i)&&(d.removeCls(i),d.css("height",parseInt(d.css("height"))-6+"px")),a.name&&d.params&&d.params[a.name]&&delete d.params[a.name]})},submit:function(b){var c=this,b=b||{},d=c.params||{};if(c.params=c.params||{},a.apply(c,b),b.params&&(a.apply(d,c.params),c.params=d),c.clear(!1),!1!==c.valid()){var e=c.get();if(a.apply(c.params,e),"wait"===c.params.recaptcha)return void c.submit(b);""!==c.params.recaptcha&&(c.params["g-recaptcha-response"]=c.params.recaptcha,delete c.params.recaptcha,a.Ajax(c))}},valid:function(){var b=!0;return a.each(this.items,function(a){!0===b?b=a.onBlur():a.onBlur()}),!!b},getItem:function(b){var c=!1;return a.each(this.items,function(a){if(a.name===b)return c=a,!0}),c},showAt:function(){var a=this.panel;a&&a.showAt.apply(a,arguments)},show:function(){var a=this.panel;a?a.show.apply(a,arguments):this.el.show()},hide:function(){var c=this;c.panel?c.panel.css({display:"none"}):c.css({display:"none"});var d=a.select("."+b);d.dom&&d.css("display","none");for(var e=0,f=c.items.length;e<f;e++)"combo"===c.items[e].type&&c.items[e].hideList()},setHeight:function(a){var b=this;b.panel&&(b.panel.css("height",a),b.buttons&&(a-=b.barHeight),b.bbar&&(a-=b.barHeight),(b.tbar||b.tabs)&&(a-=b.barHeight),b.title&&(a-=b.titleHeight),a-=b.panelBodyBorders[0],a-=b.panelBodyBorders[2]),b.css("height",a)},setWidth:function(){},getHeight:function(){var a=this.panel;return a?a.getHeight():parseInt(this.css("height"))},calcFieldSize:function(){var b,c=this,d=c.width,e=c.defaults||{},f=c.maxLabelNumber;e.width=d-2*c.panelBorderWidth,a.each(c.items,function(b){switch(b.type){case"set":case"tab":"tab"===b.type&&(c.tabbed=!0);var e="set"===b.type?62:20;a.each(b.items,function(a){void 0===a.width&&(a.width=d-e),a.label&&a.label.length>f&&(f=a.label.length)}),b.defaults=b.defaults||{},b.defaults.labelWidth=b.defaults.labelWidth||8*(f+1);break;case"line":var g=b.items.length,h=!1,i=(d-8-8-8)/g;a.each(b.items,function(a){a.width=i,(a.labelWidth||a.inputWidth)&&(h=!0)}),!1===h&&a.each(b.items,function(a){"top"===a.labelAlign?a.labelWidth=i:a.labelWidth=100}),b.defaults=b.defaults||{},void 0===b.defaults.labelWidth&&(b.defaults.labelWidth=c.labelWidth);break;default:b.label&&b.label.length>f&&(f=b.label.length)}}),f++,b=6*f,b<80&&(b=80),e.labelWidth=b,c.inputWidth&&(e.inputWidth=c.inputWidth),c.defaults=e},destroy:function(){var a=this;a.el.destroy(),a.panel&&a.panel.el.destroy()},each:function(a,b){var c=this,d=c.items,e=0,f=d.length;if(b)for(;e<f;e++)a.apply(this,[d[e]]);else for(;e<f;e++)a(d[e])},loadModules:function(){var b=this,c=a.modules||{},d={},e=b.items||[];a.modules=c,a.nojQuery&&(d.dom=!0),a.isTouch&&(d.touch=!0);for(var f=0,g=e.length;f<g;f++){var h=e[f];if("date"===h.type&&(d.grid=!0,d.selection=!0,d.date=!0),h.items)for(var i=0,j=h.items.length;i<j;i++){var k=h.items[i];"date"===k.type&&(d.grid=!0,d.selection=!0,d.date=!0)}}b.neededModules={length:0};for(var l in d)void 0===a.modules[l]&&(b.neededModules[l]=!0,b.neededModules.length++);if(0===b.neededModules.length)return b.neededModules=!0,void b.init();var m=function(a){delete b.neededModules[a],0===--b.neededModules.length&&(b.neededModules=!0,b.init())};for(var l in b.neededModules)"length"!==l&&a.loadModule(l,m)},prevTab:function(){var a=this;a.activeTab--,a.activeTab<0&&(a.activeTab=0),a.setActiveTab()},nextTab:function(){var a=this,b=a.el.select("."+j).length;a.activeTab++,a.activeTab>=b&&(a.activeTab=b-1),a.setActiveTab()}})}(),Fancy.Mixin("Fancy.form.mixin.PrepareConfig",{prepareConfig:function(a,b){var c=this;return a=c.prepareConfigTheme(a,b),a=c.prepareConfigLang(a,b),a=c.prepareConfigDefaults(a),a=c.prepareConfigItems(a),a=c.prepareConfigFooter(a)},prepareConfigDefaults:function(a){if(a.defaults)for(var b in a.defaults)Fancy.each(a.items,function(c){void 0===c[b]&&(c[b]=a.defaults[b])});return a},prepareConfigItems:function(a){var b=this,c=function(a){a.theme=b.theme||"",void 0===a.labelWidth&&(a.labelWidth=b.labelWidth),void 0===a.inputWidth&&(a.inputWidth=b.inputWidth),"pass"!==a.type&&"password"!==a.type||(a.type="string",a.isPassword=!0),a.items&&Fancy.each(a.items,c)};return Fancy.each(a.items,c),a}}),Fancy.define(["Fancy.form.field.Line","Fancy.FieldLine"],{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.line",constructor:function(a){Fancy.apply(this,a),this.Super("const",arguments)},init:function(){var a=this;a.addEvents(),a.Super("init",arguments);for(var b,c=0,d=a.items.length;c<d;c++){var e=a.items[c];e.style=e.style||{},"top"===e.labelAlign?b=!0:e.style["padding-top"]="0px",0===c&&(e.style["padding-left"]="0px")}a.preRender(),a.render(),b&&a.css("height","48px")},fieldCls:"fancy fancy-field fancy-field-line",value:"",width:100,emptyText:"",tpl:['<div class="fancy-field-text fancy-field-line-items">',"</div>"]}),Fancy.define(["Fancy.form.field.Set","Fancy.SetField"],{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.set",constructor:function(a){Fancy.apply(this,a),this.Super("const",arguments)},init:function(){var a=this;a.addEvents("beforecollapse","collapse","expanded"),a.Super("init",arguments),Fancy.each(a.items,function(a,b){"top"===a.labelAlign&&0===b&&(a.style={"padding-left":"0px"})}),a.preRender(),a.render(),void 0!==a.checkbox&&a.initCheckBox(),a.on("beforecollapse",a.onBeforeCollapsed,a),a.on("expanded",a.onExpanded,a)},fieldCls:"fancy-field-set",value:"",width:100,emptyText:"",tpl:["<fieldset>","<legend>",'<div class="fancy-field-checkbox-input" style="float:left;margin-top: 4px;display: none;"></div>','<div class="fancy-field-set-label" style="float:left;">{label}</div>','<div class="fancy-clearfix"></div>',"</legend>",'<div class="fancy-field-text fancy-field-set-items">',"</div>","</fieldset>"],initCheckBox:function(){var a=this,b=a.el.select(".fancy-field-checkbox-input");b.css("display",""),!0===a.checkbox&&a.addCls("fancy-checkbox-on");var c=a.el.select(".fancy-field-set-items");setTimeout(function(){!0===a.checkbox||a.fire("collapse")},1),!0===a.checkbox?(c.css("display",""),a.removeCls("fancy-set-collapsed")):(c.css("display","none"),a.addCls("fancy-set-collapsed")),b.on("click",function(){a.toggleCls("fancy-checkbox-on");var b=a.el.hasCls("fancy-checkbox-on"),c=a.el.select(".fancy-field-set-items");b?(a.fire("beforeexpanded"),c.css("display",""),a.removeCls("fancy-set-collapsed"),a.fire("expanded")):(a.fire("beforecollapse"),c.css("display","none"),a.addCls("fancy-set-collapsed"),a.fire("collapse"))})},onBeforeCollapsed:function(){var a=this,b=a.form,c=a.el.select(".fancy-field-set-items"),d=parseInt(c.css("height"));b.setHeight(b.getHeight()-d)},onExpanded:function(){var a=this,b=a.form,c=a.el.select(".fancy-field-set-items"),d=parseInt(c.css("height"));b.setHeight(b.getHeight()+d)}}),Fancy.define(["Fancy.form.field.HTML","Fancy.HTMLField"],{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.html",constructor:function(a){Fancy.apply(this,a),this.Super("const",arguments)},init:function(){var a=this;a.addEvents("focus","blur","input","enter","up","down","change","key"),a.Super("init",arguments),a.preRender(),a.render(),a.hidden&&a.css("display","none"),a.style&&a.css(a.style)},fieldCls:"fancy-field-html",value:"",width:100,emptyText:"",tpl:['<div class="" style="">',"{value}","</div>"],render:function(){var a=this,b=a.renderTo||document.body,c=document.createElement("div");a.fire("beforerender"),c.innerHTML=a.tpl.getHTML({value:a.value,height:a.height}),a.el=b.appendChild(c),a.el=Fancy.get(a.el),a.el.addCls(a.cls,Fancy.cls,a.fieldCls),a.acceptedValue=a.value,a.fire("afterrender"),a.fire("render")},set:function(a,b){var c=this;c.el.firstChild().update(a),!1!==b&&c.onInput()},get:function(){return this.el.firstChild().dom.innerHTML}}),Fancy.define(["Fancy.form.field.ReCaptcha","Fancy.ReCaptcha"],{type:"field.recaptcha",mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,constructor:function(a){Fancy.apply(this,a),this.Super("const",arguments)},init:function(){var a=this;a.addEvents("focus","blur","input","enter","up","down","change","key"),a.Super("init",arguments),a.tpl=new Fancy.Template(a.tpl),a.render(),a.name="recaptcha",a.hidden&&a.css("display","none"),a.style&&a.css(a.style);var b=document.createElement("script");b.type="text/javascript",b.src="https://www.google.com/recaptcha/api.js",Fancy.get(document.head).append(b)},get:function(){var a=this,b=a.el.select("form");return a.value?a.value:(a.value="wait",b.one("submit",function(b){b.preventDefault(),a.value=Fancy.$(this).serialize().replace("g-recaptcha-response=","")}),b.submit(),a.value)},fieldCls:Fancy.FIELD_CLS,value:"",width:100,tpl:['<form method="POST">','<div class="g-recaptcha" data-sitekey="{key}"></div>',"</form>"]});