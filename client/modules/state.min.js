Fancy.modules.state=!0,function(){var a=Fancy;a.define("Fancy.grid.plugin.State",{extend:a.Plugin,ptype:"grid.state",inWidgetName:"state",stateful:!1,$log:{filter:!0,sort:!0,columnresize:!0,columndrag:!0,changepage:!0,columnhide:!0,resize:!0},constructor:function(){this.log=this.log||{},this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.initLog(),a.ons()},ons:function(){var a=this,b=a.widget;b.on("beforeinit",a.onBeforeInit,a),a.stateful&&(a.log.sort&&b.on("sort",a.onSort,a),a.log.filter&&b.on("filter",a.onFilter,a),a.log.columnresize&&b.on("columnresize",a.onColumnResize,a),a.log.columndrag&&(b.on("columndrag",a.onColumnDrag,a),b.on("lockcolumn",a.onColumnLock,a),b.on("rightlockcolumn",a.onColumnRightLock,a),b.on("unlockcolumn",a.onColumnUnLock,a)),a.log.changepage&&b.on("changepage",a.onChangePage,a),a.log.columnhide&&(b.on("columnhide",a.onColumnHide,a),b.on("columnshow",a.onColumnShow,a)),b.on("columnremove",a.onColumnRemove,a),b.on("columnadd",a.onColumnAdd,a),b.on("init",function(){b.panel&&a.log.resize&&b.panel.on("resize",a.onResize,a)}),b.on("changewidth",a.onChangeWidth,a),b.on("changeheight",a.onChangeHeight,a))},onSort:function(){var a=this,b=a.widget,c=b.store,d=b.getStateName(),e=localStorage.getItem(d)||"{}";e=JSON.parse(e),e.sorters=JSON.stringify(c.sorters),localStorage.setItem(d,JSON.stringify(e)),a.copyColumns(),a.widget.fire("statechange",a.getState(),"sorters",e.sorters)},onFilter:function(){var a=this,b=a.widget,c=b.store,d=b.getStateName(),e=localStorage.getItem(d)||"{}";e=JSON.parse(e),e.filters=JSON.stringify(c.filters),localStorage.setItem(d,JSON.stringify(e)),a.copyColumns(),a.widget.fire("statechange",a.getState(),"filters",e.filters)},onColumnResize:function(){var a=this;a.copyColumns(),a.widget.fire("statechange",a.getState(),"columns")},onColumnDrag:function(){var a=this;a.copyColumns(),a.widget.fire("statechange",a.getState(),"columns")},onColumnLock:function(){var a=this;a.copyColumns(),a.widget.fire("statechange",a.getState(),"columns")},onColumnRightLock:function(){var a=this;a.copyColumns(),a.widget.fire("statechange",a.getState(),"columns")},onColumnUnLock:function(){var a=this;a.copyColumns(),a.widget.fire("statechange",a.getState(),"columns")},onColumnHide:function(){var a=this;a.copyColumns(),a.widget.fire("statechange",a.getState(),"columns")},onColumnShow:function(){var a=this;a.copyColumns(),a.widget.fire("statechange",a.getState(),"columns")},onColumnRemove:function(){var a=this;a.copyColumns(),a.widget.fire("statechange",a.getState(),"columns")},onColumnAdd:function(){var a=this;a.copyColumns(),a.widget.fire("statechange",a.getState(),"columns")},copyColumns:function(){var b=this,c=b.widget,d=c.getStateName(),e=localStorage.getItem(d)||"{}";e=JSON.parse(e);var f=[].concat(c.leftColumns).concat(c.columns).concat(c.rightColumns),g=[];a.each(f,function(b){var c={};a.each(b,function(b,d){switch(a.typeOf(b)){case"string":case"number":case"boolean":c[d]=b;break;case"object":switch(d){case"filterField":break;default:c[d]="OBJECT"}break;case"array":c[d]="ARRAY";break;case"function":c[d]="FUNCTION"}}),g.push(c)}),e.columns=JSON.stringify(g),localStorage.setItem(d,JSON.stringify(e))},onBeforeInit:function(){var b=this,c=b.widget,d=c.getStateName(),e=localStorage.getItem(d)||"{}",f=b.startState;"{}"===e&&c.autoColumnWidth&&(c.allowAutoWidthStateIsEmpty=!0);var g=function(){for(var a in f.filters){var b=f.filters[a];for(var d in b)"*"===d&&c.searching?c.addFilter(a,b[d],d,!1):c.addFilter(a,b[d],d)}},h=function(){a.each(f.sorters,function(a){c.sort(a.key,a.dir,!1)})};if(f){if(c.waitingForFilters=!0,c.stateIsWaiting=!0,c.WAIT_FOR_STATE_TO_LOAD&&(f.filters&&(g(),c.store.remoteFilter&&c.store.serverFilter(!1)),f.sorters&&h(),delete c.WAIT_FOR_STATE_TO_LOAD,c.store.loadData()),c.store.loading)return void c.once("load",function(){b.onBeforeInit()},b);setTimeout(function(){c.SERVER_FILTER_SORT||(f.filters&&g(),f.sorters&&h()),void 0!==f.page&&c.setPage(Number(f.page),!1),delete c.waitingForFilters,c.store.changeDataView(),delete c.stateIsWaiting,c.update(),c.setSidesHeight()},100)}e.width&&c.setWidth(e.width),e.height&&c.setHeight(e.height)},onChangePage:function(a,b){var c=this,d=c.widget,e=d.getStateName(),f=localStorage.getItem(e)||"{}";void 0!==b&&f&&d.inited&&(f=JSON.parse(f),f.page=b+1,localStorage.setItem(e,JSON.stringify(f)),c.widget.fire("statechange",c.getState(),"page",f.page))},onResize:function(a,b){var c=this,d=c.widget,e=d.getStateName(),f=localStorage.getItem(e)||"{}";f=JSON.parse(f),d.responsiveWidth||d.wrapped||(f.width=b.width),d.responsiveHeight||d.wrapped||(f.height=b.height),localStorage.setItem(e,JSON.stringify(f)),c.widget.fire("statechange",c.getState(),"size",[f.width,f.height])},onChangeWidth:function(a,b){var c=this,d=c.widget,e=d.getStateName(),f=localStorage.getItem(e)||"{}";f=JSON.parse(f),d.responsiveWidth||d.wrapped||(f.width=b),localStorage.setItem(e,JSON.stringify(f)),c.widget.fire("statechange",c.getState(),"width",f.width)},onChangeHeight:function(a,b){var c=this,d=c.widget,e=d.getStateName(),f=localStorage.getItem(e)||"{}";f=JSON.parse(f),d.responsiveHeight||d.wrapped||(f.height=b),localStorage.setItem(e,JSON.stringify(f)),c.widget.fire("statechange",c.getState(),"height",f.height)},initLog:function(){var b=this;a.applyIf(b.log,b.$log)},getState:function(){var b=this,c=b.widget,d=c.getStateName(),e=localStorage.getItem(d)||"{}";return"{}"===e&&(e=b.startState),a.isString(e)?JSON.parse(e):e}})}();