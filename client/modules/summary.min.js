Fancy.modules.summary=!0,function(){var a=Fancy,b=a.GRID_CELL_CLS,c=a.GRID_CELL_INNER_CLS,d=a.GRID_CELL_EVEN_CLS,e=a.GRID_ROW_SUMMARY_CLS,f=a.GRID_ROW_SUMMARY_CONTAINER_CLS,g=a.GRID_ROW_SUMMARY_BOTTOM_CLS,h=a.GRID_COLUMN_SPARKLINE_CLS,i=a.GRID_COLUMN_SPARKLINE_BULLET_CLS,j=a.GRID_COLUMN_SPARK_PROGRESS_DONUT_CLS,k=a.GRID_COLUMN_GROSSLOSS_CLS,l=a.ANIMATE_DURATION;a.define("Fancy.grid.plugin.Summary",{extend:a.Plugin,ptype:"grid.summary",inWidgetName:"summary",position:"top",sumDisplayed:!0,topOffSet:0,bottomOffSet:0,striped:!1,constructor:function(){this.Super("const",arguments)},init:function(){this.Super("init",arguments),this.ons()},ons:function(){var a=this,b=a.widget;b.once("render",function(){a.calcOffSets(),a.options&&a.initOptions()}),b.once("init",function(){a.render(),a.update(),b.on("update",function(){a.update()}),b.on("set",function(){a.update()})}),b.on("columnresize",function(){a.onColumnResize()},a),b.on("columnhide",a.onColumnHide,a),b.on("columnshow",a.onColumnShow,a),a.sumDisplayed&&b.on("changepage",a.onChangePage,a),b.on("columndrag",a.onColumnDrag,a)},render:function(){var a,b=this,c=b.widget,d=c.centerEl,e=c.leftEl,h=c.rightEl,i=c.body,j=c.leftBody,k=c.rightBody,l=c.getCenterFullWidth(),m=c.getLeftFullWidth(),n=c.getRightFullWidth(),o="top"===b.position?"before":"after";d.select("."+f).length||d.select("."+g).length||(a=b.generateRow("center"),a.css("width",c.startWidths.center),a.firstChild().css("width",l),a.css("height",c.cellHeight),a.firstChild().css("height",c.cellHeight),b.el=a,i.el[o](a.dom)),c.leftColumns.length&&(e.select("."+f).length||e.select("."+g).length||(a=b.generateRow("left"),"bottom"===b.position?a.css("width",m):a.css("width",m-2),a.firstChild().css("width",m),a.css("height",c.cellHeight),b.leftEl=a,j.el[o](a.dom))),c.rightColumns.length&&(h.select("."+f).length||h.select("."+g).length||(a=b.generateRow("right"),"bottom"===b.position?a.css("width",n):a.css("width",n-1),a.firstChild().css("width",n),a.css("height",c.cellHeight),b.rightEl=a,k.el[o](a.dom)))},generateRow:function(d){var h=this,i=h.widget,j=i.cellHeight,k=i.getColumnsWidth(d),l=a.get(document.createElement("div")),m="";a.each(i.getColumns(d),function(a,d){m+=['<div index="'+d+'" style="width:'+a.width+"px;height:"+j+"px;"+(a.cellAlign?"text-align:"+a.cellAlign+";":"")+'" class="'+b+'">','<div class="'+c+'"></div>',"</div>"].join("")});var n=['<div style="position: relative;" class="'+e+'">',m,"</div>"].join("");return l.update(n),l.css("width",k+"px"),l.addCls(f),"bottom"===h.position&&l.addCls(g),l},calcPlusScroll:function(){var a=this,b=a.widget;a.plusScroll=a.groups.length*b.groupRowHeight},scrollLeft:function(a){this.el&&this.el.firstChild().css("left",a)},update:function(){var a=this,c=a.widget;if(a.updateSide("center"),c.leftColumns.length&&a.updateSide("left"),c.rightColumns.length&&a.updateSide("right"),a.striped&&"bottom"===a.position){var e=c.el.select("."+g+" ."+b);c.getViewTotal()%2==1?e.addCls(d):e.removeCls(d)}},getEl:function(a){var b=this;switch(a){case"center":return b.el;case"left":return b.leftEl;case"right":return b.rightEl;default:return b.el}},updateSide:function(b){var d=this,e=d.widget,f=e.lang,g=e.getBody(b),l=e.store,m=d.getEl(b).select("."+c),n="data";d.sumDisplayed&&(n="dataView"),a.each(e.getColumns(b),function(b,c){if(!b.summary)return void m.item(c).update("");var d=b.index,o=l.getColumnOriginalValues(d,{smartIndexFn:b.smartIndexFn,dataProperty:n}),p="",q=m.item(c).parent();switch(a.typeOf(b.summary)){case"string":if("none"===b.summary)p="&nbsp;";else{if(p=a.Array[b.summary](o),"number"===b.type||"currency"===b.type){var r=b.precision||0;p=p.toFixed(r)}if("currency"===b.type&&""!==p){p=(b.currency||f.currencySign)+p}}break;case"object":p=a.Array[b.summary.type](o),b.summary.fn&&(p=b.summary.fn(p,b.summary.type));break;case"function":p=b.summary(o)}switch(b.type){case"sparklineline":case"sparklinebar":case"sparklinetristate":case"sparklinebullet":case"sparklinebox":case"sparklinepie":case"sparklinediscrete":q.addCls(h);var s,t=b.width,u=e.cellHeight-1,v=t-20,w=b.type.replace("sparkline","");switch(w){case"line":case"pie":case"box":s="width";break;case"bullet":s="width",u-=11,q.addCls(i);break;case"discrete":s="width",v=t,u-=2;break;case"bar":case"tristate":s="barWidth"}var x=b.sparkConfig||{},y={type:w,fillColor:"transparent",height:u};a.apply(y,x),"bar"!==w&&"tristate"!==w||(v=t-20,v/=p.length),y[s]=v,m.item(c).$dom.sparkline(p,y);break;case"progressdonut":q.addCls(j);var y=b.sparkConfig||{};a.apply(y,{renderTo:m.item(c).dom,value:p}),y.size||y.height||y.width||(y.size=e.cellHeaderHeight-6),a.get(y.renderTo).update(""),new a.spark.ProgressDonut(y);break;case"grossloss":q.addCls(k);var y=b.sparkConfig||{};y.showOnMax&&(y.maxValue=Math.max.apply(Math,o)),p>50&&(p=50),a.apply(y,{renderTo:m.item(c).dom,value:p,column:b}),new a.spark.GrossLoss(y);break;default:b.format&&(p=g.format(p,b.format,b.precision)),m.item(c).update(p)}})},onColumnResize:function(){var a=this,b=a.widget;a.updateSizes("center"),b.leftColumns.length&&a.updateSizes("left"),b.rightColumns.length&&a.updateSizes("right"),a.update()},onColumnHide:function(){var a=this,b=a.widget;a.updateSizes("center"),b.leftColumns.length&&a.updateSizes("left"),b.rightColumns.length&&a.updateSizes("right"),a.update()},onColumnShow:function(){var a=this,b=a.widget;a.updateSizes("center"),b.leftColumns.length&&a.updateSizes("left"),b.rightColumns.length&&a.updateSizes("right"),a.update()},updateSizes:function(c){var d=this,e=d.widget,f=d.getEl(c),g=f.select("."+b),h=0,i=e.getColumns(c);switch(a.each(i,function(a,b){h+=a.width;var c=g.item(b);a.hidden?c.css("display","none"):c.css("display",""),c.animate({width:a.width},l)}),f.firstChild().animate({width:h},l),c){case"center":d.el.animate({width:h},l),0===h?d.el.css({display:"none"}):"none"===d.el.css("display")&&d.el.css({display:""});break;case"left":"bottom"===d.position?d.leftEl.animate({width:h},l):d.leftEl.animate({width:h-2},l),0===h?d.leftEl.css({display:"none"}):"none"===d.leftEl.css("display")&&d.leftEl.css({display:""});break;case"right":"bottom"===d.position?d.rightEl.animate({width:h},l):d.rightEl.animate({width:h-1},l),0===h?d.rightEl.css({display:"none"}):"none"===d.rightEl.css("display")&&d.rightEl.css({display:""})}},calcOffSets:function(){var a=this,b=a.widget;switch(a.position){case"top":a.topOffSet=b.cellHeight;break;case"bottom":a.bottomOffSet=b.cellHeight;break;case"both":a.topOffSet=b.cellHeight,a.bottomOffSet=b.cellHeight}},removeColumn:function(a,c){this.getEl(c).select("."+b).item(a).destroy(),this.updateSizes(c)},insertColumn:function(d,e){var f=this,g=f.widget,h=g.getColumns(e);"left"!==e&&"right"!==e||1!==h.length||f.render();var i,h=g.getColumns(e),j=h[d],k=f.getEl(e),l=k.select("."+b),m=a.get(document.createElement("div"));0===l.length&&0===d||(i=0===d?l.item(0):l.item(d-1)),m.css({width:j.width,height:g.cellHeight}),m.addCls(b),m.update('<div class="'+c+'"></div>'),0===l.length&&0===d?k.append(m.dom):0===d?i.before(m.dom):i.after(m.dom),f.updateSizes(e),f.updateSide(e)},onChangePage:function(){var a=this;setTimeout(function(){a.update()},100)},onColumnDrag:function(){var a=this,b=a.widget;a.updateSizes("center"),b.leftColumns.length&&a.updateSizes("left"),b.rightColumns.length&&a.updateSizes("right")},initOptions:function(){var c=this,d=c.widget,e=a.get(document.body);d.addCls("fancy-grid-summary-options"),d.el.on("click",c.onOptionClick,c,"."+f+" ."+b),e.on("click",function(b){var d=a.get(b.target);if(c.justShownSummaryMenu)return void delete c.justShownSummaryMenu;!d.closest(".fancy-menu").dom&&c.activeSummaryMenu&&(c.activeSummaryMenu.hide(),delete c.activeSummaryMenu)})},onOptionClick:function(b){var c,d=this,e=d.widget,f=a.get(b.currentTarget),g=d.getColumnBySummaryCell(f),h=100;if(d.justShownSummaryMenu=!0,d.activeSummaryMenu&&(d.activeSummaryMenu.hide(),delete d.activeSummaryMenu),g.summaryMenu)c=g.summaryMenu;else{var i=d.generateColumnSummaryItems(g);c=new Fancy.Menu({minWidth:h,width:parseInt(f.css("width"))+1,theme:e.theme,items:i})}var j=f.offset(),k=j.top+parseInt(f.css("height")),l=j.left,m=20,n=-1;if("bottom"===d.position){k=k-parseInt(c.el.css("height"))-parseInt(f.css("height")),m*=-1,n=1}var o=parseInt(f.css("width"))+1;o<h&&(o=h),c.el.css({position:"absolute",width:o,minWidth:70,top:k+m,left:l-1}),c.show(),c.el.animate({duration:200,top:k+n}),g.summaryMenu=c,d.activeSummaryMenu=c},generateColumnSummaryItems:function(b){var c=this,d=[],e=["None","Sum","Average","Count","Min","Max"],f=["None"],g=a.typeOf(b.summary);switch(b.type){case"number":switch(g){case"string":a.each(e,function(a,e){d.push({text:a,checked:a.toLocaleLowerCase()===b.summary,handler:function(){b.summary=a.toLocaleLowerCase(),c.update(),c.activeSummaryMenu.setChecked(e,!0),c.activeSummaryMenu.hide(),delete c.activeSummaryMenu}})});break;case"function":case"object":a.each(e,function(a,e){d.push({text:a,checked:!1,handler:function(){switch(g){case"function":b.summary={type:a.toLocaleLowerCase(),fn:b.summary};break;case"object":b.summary.type=a.toLocaleLowerCase()}c.update(),c.activeSummaryMenu.setChecked(e,!0),c.activeSummaryMenu.hide(),delete c.activeSummaryMenu}})}),"object"!==g&&d.push({text:"Custom",checked:!0,handler:function(){b.summary=b._summary,c.update(),c.activeSummaryMenu.hide(),c.activeSummaryMenu.setChecked(d.length-1,!0),delete c.activeSummaryMenu}})}break;case"string":switch(g){case"string":a.each(f,function(a,e){d.push({text:a,checked:a.toLocaleLowerCase()===b.summary,handler:function(){b.summary.type=a.toLocaleLowerCase(),c.update(),c.activeSummaryMenu.setChecked(e,!0),c.activeSummaryMenu.hide(),delete c.activeSummaryMenu}})});break;case"function":case"object":a.each(f,function(a,e){d.push({text:a,checked:!1,handler:function(){b._summary||(b._summary=b.summary),b.summary="none",c.update(),c.activeSummaryMenu.setChecked(e,!0),c.activeSummaryMenu.hide(),delete c.activeSummaryMenu}})}),d.push({text:"Custom",checked:!0,handler:function(){b.summary=b._summary,c.update(),c.activeSummaryMenu.setChecked(d.length-1,!0),c.activeSummaryMenu.hide(),delete c.activeSummaryMenu}})}}return d},getColumnBySummaryCell:function(a){var b,c=this,d=c.widget,e=a.attr("index");return a.closest(".fancy-grid-center").dom?b=d.columns[e]:a.closest(".fancy-grid-left").dom?b=d.leftColumns[e]:a.closest(".fancy-grid-right")&&(b=d.rightColumns[e]),b}})}();