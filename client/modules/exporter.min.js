Fancy.modules.exporter=!0,Fancy.define("Fancy.grid.plugin.Exporter",{extend:Fancy.Plugin,ptype:"grid.exporter",inWidgetName:"exporter",csvSeparator:",",csvHeader:!1,csvFileName:"export",excelFileName:"export",constructor:function(){this.Super("const",arguments),Fancy.fullBuilt&&Fancy.loadModule("excel")},init:function(){},exportToExcel:function(a){function b(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d!=a.length;++d)c[d]=255&a.charCodeAt(d);return b}a=a||{};var c=this,d=c.widget,e=c.getColumnsData(a),f=c.getData(a),g=!1===a.header?f:[e].concat(f),h=function(){if(!(this instanceof h))return new h;this.SheetNames=[],this.Sheets={}},i=new h,j=c.sheet_from_array_of_arrays(g);j["!cols"]=[],Fancy.each(c.widths,function(a){j["!cols"].push({wch:a})});var k=d.title;a.fileName?k=a.fileName:Fancy.isObject(k)&&(k=k.text);var l=k||c.excelFileName;i.SheetNames.push(l),i.Sheets[l]=j;var m=window.XLSX.write(i,{bookType:"xlsx",bookSST:!0,type:"binary"});window.saveAs(new Blob([b(m)],{type:"application/octet-stream"}),l+".xlsx")},getColumnsData:function(a){var b,c=this,d=c.widget,e=d.getColumns(),f=[];return c.widths=[],a&&a.indexes&&(b={},Fancy.each(a.indexes,function(a){b[a]=!0})),Fancy.each(e,function(a){b&&!0!==b[a.index]||c.isColumnExportable(a)&&(c.widths.push(a.width),f.push(a.title||""))}),f},getData:function(a){if((a=a||{})&&a.data)return a.data;var b=this,c=b.widget,d=[],e=a.all?c.getDisplayedData(!0,a.ignoreRender,a.rowIds,!0):c.getDisplayedData(null,a.ingoreRender,a.rowIds,!0);return Fancy.each(e,function(a){var b=[];Fancy.each(a,function(a){b.push(a)}),d.push(b)}),d},sheet_from_array_of_arrays:function(a){for(var b={},c={s:{c:1e7,r:1e7},e:{c:0,r:0}},d=0,e=a.length,f=function(a,b){return b&&(a+=1462),(Date.parse(a)-new Date(Date.UTC(1899,11,30)))/864e5};d!=e;++d)for(var g=0;g!=a[d].length;++g){c.s.r>d&&(c.s.r=d),c.s.c>g&&(c.s.c=g),c.e.r<d&&(c.e.r=d),c.e.c<g&&(c.e.c=g);var h={v:a[d][g]};if(null!=h.v){var i=window.XLSX.utils.encode_cell({c:g,r:d});"number"==typeof h.v?h.t="n":"boolean"==typeof h.v?h.t="b":h.v instanceof Date?(h.t="n",h.z=window.XLSX.SSF._table[14],h.v=f(h.v)):h.t="s",b[i]=h}}return c.s.c<1e7&&(b["!ref"]=window.XLSX.utils.encode_range(c)),b},getDataAsCsv:function(a){var b,c=this,d=c.widget,e=c.getData(a),f="",a=a||{},g=a.separator||c.csvSeparator,h=a.header||c.csvHeader;if(a&&a.indexes&&(b={},Fancy.each(a.indexes,function(a){b[a]=!0})),h){var i=function(a){b&&!0!==b[a.index]||c.isColumnExportable(a)&&(f+='"'+(a.title||"")+'"'+g)};Fancy.each(d.leftColumns,i),Fancy.each(d.columns,i),Fancy.each(d.rightColumns,i),f=f.substring(0,f.length-1),f+="\r\n"}return Fancy.each(e,function(a){Fancy.each(a,function(a){Fancy.isString(a)&&(a='"'+a+'"'),f+=a+g}),f=f.substring(0,f.length-1),f+="\r\n"}),f},exportToCSV:function(a){a=a||{};var b=this,c=b.getDataAsCsv(a),d=a.fileName||b.csvFileName,e=new Blob([c],{type:"text/csv;charset=utf-8;"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(e,d);else{var f=document.createElement("a");f.href=window.URL.createObjectURL(e),f.download=d+".csv",document.body.appendChild(f),f.click(),document.body.removeChild(f)}},isColumnExportable:function(a){if(/spark/.test(a.type))return!1;switch(a.type){case"select":case"action":case"expand":case"grossloss":case"hbar":case"rowdrag":return!1}return!a.hidden&&!1!==a.exportable}});