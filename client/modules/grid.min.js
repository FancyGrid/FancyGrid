Fancy.Mixin("Fancy.grid.mixin.PrepareConfig",{prepareConfig:function(a,b){var c=this;return a._plugins=a._plugins||[],a=c.prepareConfigTheme(a,b),a=c.prepareConfigLang(a,b),a=c.prepareConfigPaging(a,b),a=c.prepareConfigGrouping(a),a=c.prepareConfigGroupHeader(a),a=c.prepareConfigSorting(a),a=c.prepareConfigEdit(a),a=c.prepareConfigSelection(a),a=c.prepareConfigLoadMask(a,b),a=c.prepareConfigDefaults(a),a=c.prepareConfigFilter(a),a=c.prepareConfigSmartIndex(a),a=c.prepareConfigActionColumn(a),a=c.prepareConfigChart(a,b),a=c.prepareConfigSize(a,b),a=c.prepareConfigCellTip(a),a=c.prepareConfigColumnsWidth(a),a=c.prepareConfigColumns(a),a=c.prepareConfigColumnsResizer(a),a=c.prepareConfigTBar(a),a=c.prepareConfigFooter(a)},prepareConfigLoadMask:function(a){a.data;return a._plugins.push({type:"grid.loadmask"}),a},reConfigStore:function(a){var b=this,c=b.store,d=b.getFieldsFromData(a),e="Fancy.model."+Fancy.id();Fancy.define(e,{extend:Fancy.Model,fields:d}),b.model=e,c.model=e,b.fields=d,c.fields=d,c.setModel()},prepareConfigDefaults:function(a){a.defaults=a.defaults||{},void 0===a.defaults.type&&(a.defaults.type="string");for(var b in a.defaults)for(var c=0,d=a.columns.length;d>c;c++)void 0===a.columns[c][b]&&(a.columns[c][b]=a.defaults[b]);return a},prepareConfigCellTip:function(a){for(var b=a.columns,c=0,d=b.length;d>c;c++){var e=b[c];if(e.cellTip){a._plugins.push({type:"grid.celltip"});break}}return a},prepareConfigDateColumn:function(a){for(var b=a.columns,c=0,d=b.length;d>c;c++){var e=b[c];"date"===e.type&&void 0===e.format&&(e.format="date")}return a},prepareConfigColumns:function(a){for(var b=a.columns,c=[],d=[],e=0,f=b.length;f>e;e++){var g=b[e];switch(g.type){case"checkbox":void 0===g.cellAlign&&(g.cellAlign="center");break;case"currency":void 0===g.format&&(g.format="number")}g.locked?(c.push(g),b.splice(e,1),e--,f--):g.rightLocked&&(d.push(g),b.splice(e,1),e--,f--)}return a.leftColumns=c,a.rightColumns=d,a},prepareConfigColumnsWidth:function(a){for(var b,c=a.columns,d=0,e=c.length,f=a.width-2*a.panelBorderWidth-a.bottomScrollHeight,g=[],h=[],i=100,j=50,k=i,l=0,m=!1,n=!1;e>d;d++)b=c[d],b.locked&&(m=!0),b.rightLocked&&(n=!0),void 0===b.width?(b.flex&&(l+=b.flex,h.push(d)),g.push(d)):Fancy.isNumber(b.width)&&(f-=b.width);m&&n&&(f-=2);var o=f/g.length;j>o&&(o=j),o>i&&(k=i),j>o&&(k=j),d=0,e=g.length;for(var p=!1,q=f;e>d;d++)b=c[g[d]],void 0===b.flex&&(q-=k);if(l)for(d=0,e=h.length;e>d;d++)q-=q/l*b.flex;for(0>q&&(p=!0),d=0,e=g.length;e>d;d++)b=c[g[d]],void 0===b.flex&&(b.width=k,f-=k);if(l)for(d=0,e=h.length;e>d;d++)b=c[h[d]],p?b.width=k*b.flex:b.width=f/l*b.flex;return a},prepareConfigActionRender:function(a){return function(b){for(var c=a.items||[],d=0,e=c.length;e>d;d++){var f=c[d],g=f.text||"",h=Fancy.styleToString(f.style),i=f.cls||"";b.value+=['<div class="fancy-grid-column-action-item '+i+'" style="'+h+'">',g,"</div>"].join(" ")}return b}},prepareConfigSmartIndex:function(a){for(var b=a.columns,c=0,d=b.length;d>c;c++){var e=b[c];if(/\+|\-|\/|\*|\[|\./.test(e.index)){isSmartIndex=!0;var f=e.index;f=f.replace(/(\w+)/g,function(a,a,b,c){return"."===c[b-1]?a:isNaN(Number(a))?"data."+a:a}),f="return "+f+";",e.smartIndexFn=new Function("data",f)}}return a},prepareConfigActionColumn:function(a){for(var b=this,c=a.columns,d=0,e=c.length;e>d;d++){var f=c[d];if("action"===f.type){f.sortable=!1,f.editable=!1,f.render=b.prepareConfigActionRender(f);var g=f.items;if(void 0!==g&&0!==g.length)for(var h,i=0,j=g.length;j>i;i++)switch(h=g[i],h.action){case"remove":void 0===h.handler&&(h.handler=function(a,b){a.remove(b)});break;case"dialog":if(void 0===h.handler){var k=[{label:"Login",emptyText:"Login",allowBlank:!1,name:"login"},{label:"Pass",emptyText:"Pass",allowBlank:!1,name:"pass",type:"password"},{type:"checkbox",label:"Remember",name:"remember"}];h.handler=function(a,c){new FancyForm({window:!0,modal:!0,title:"Edit Row",width:300,height:250,items:k,buttons:[{text:"Clear",handler:function(){this.clear()}},{text:"Save",handler:function(){var a=this.get();a.id&&(b.getById(a.id).set(a),b.update())}}]})}}}}}return a},prepareConfigSorting:function(a){var b=a.defaults||{};if(b.sortable)return a._plugins.push({type:"grid.sorter"}),a;for(var c=0,d=a.columns.length;d>c;c++){var e=a.columns[c];e.sortable&&a._plugins.push({type:"grid.sorter"})}return a},prepareConfigSelection:function(a){var b=!1,c={type:"grid.selection"};return(a.trackOver||a.columnTrackOver||a.cellTrackOver)&&(b=!0),a.selModel&&(b=!0,a.selection=a.selection||{},a.selection.selModel=a.selModel,a.selection[a.selModel]=!0),a.selection&&(b=!0,Fancy.isObject(a.selection)&&Fancy.apply(c,a.selection)),b===!0&&a._plugins.push(c),a},prepareConfigEdit:function(a){var b=a.defaults||{},c={type:"grid.edit"},d=!1;a.clicksToEdit&&(c.clicksToEdit=a.clicksToEdit),b.editable&&(a._plugins.push(c),a._plugins.push({type:"grid.celledit"}),d=!0);for(var e=0,f=a.columns.length;f>e;e++){var g=a.columns[e];switch(void 0===g.index&&void 0===g.key&&(g.editable=!1),g.type){case"image":g.sortable=!1;break;case"sparklineline":case"sparklinebar":case"sparklinetristate":case"sparklinediscrete":case"sparklinebullet":case"sparklinepie":case"sparklinebox":g.editable=!1,g.sortable=!1}g.editable&&d===!1&&(a._plugins.push(c),a._plugins.push({type:"grid.celledit"}))}return a},prepareConfigGrouping:function(a){if(a.grouping){var b=a.grouping;Fancy.apply(b,{type:"grid.grouping"}),a.expanded={},a._plugins.push(b)}return a},prepareConfigFilter:function(a){var b=a.columns,c=0,d=b.length,e=!1,f=!1,g={type:"grid.filter"};for(a.filter&&(a.filter===!0&&(a.filter={}),Fancy.apply(g,a.filter));d>c;c++){var h=b[c];h.filter&&(e=!0,h.filter.header&&(f=!0))}return g.header=f,e&&a._plugins.push(g),a},prepareConfigGroupHeader:function(a){for(var b=a.columns,c=0,d=b.length,e=[],f=!1,g=[];d>c;c++){var h=b[c];h.columns&&(f=!0,e.push(h))}if(f){c=0;for(;d>c;c++){var h=b[c];if(h.columns){for(var i=0,j=h.columns.length,k=h.text||"  ";j>i;i++)h.locked&&(h.columns[i].locked=!0),h.rightLocked&&(h.columns[i].rightLocked=!0),h.columns[i].grouping=k;g=g.concat(h.columns),f=!0,e.push(h)}else g=g.concat(b.slice(c,c+1))}a.columns=g,a._plugins.push({type:"grid.groupheader",groups:e}),a.isGroupedHeader=!0}return a},prepareConfigPaging:function(a,b){var c=this,d={"float":"left","margin-right":"5px","margin-top":"3px"},e="fancy-bar-button-disabled",f=a.lang;return void 0===a.paging?a:(a._plugins.push({i18n:b.i18n,type:"grid.paging"}),a.bbar=[{imageCls:"fancy-paging-first",disabledCls:e,role:"first",handler:function(a){c.paging.firstPage()},style:{"float":"left","margin-left":"5px","margin-right":"5px","margin-top":"3px"}},{imageCls:"fancy-paging-prev",disabledCls:e,role:"prev",handler:function(){c.paging.prevPage()},style:d},"|",{type:"text",text:f.paging.page},{type:"number",label:!1,padding:!1,style:{"float":"left","margin-left":"-1px","margin-right":"8px","margin-top":"4px"},role:"pagenumber",min:1,width:30,listeners:[{enter:function(a){c.paging.setPage(parseInt(a.getValue())-1)}}]},{type:"text",text:"",role:"ofText"},"|",{imageCls:"fancy-paging-next",disabledCls:e,role:"next",style:d,handler:function(){c.paging.nextPage()}},{imageCls:"fancy-paging-last",disabledCls:e,role:"last",style:d,handler:function(){c.paging.lastPage()}},{type:"combo"},"side",{type:"text",role:"info",text:""}],a)},prepareConfigColumnsResizer:function(a){var b=a.defaults||{};if(b.resizable)return a._plugins.push({type:"grid.columnresizer"}),a;for(var c=0,d=a.columns.length;d>c;c++){var e=a.columns[c];e.resizable&&a._plugins.push({type:"grid.columnresizer"})}return a},prepareConfigTBar:function(a){var b=this,c=a.tbar;if(c)for(var d=0,e=c.length;e>d;d++)switch(c[d].action){case"add":void 0===c[d].handler&&(c[d].handler=function(){b.insert(0,{})});break;case"remove":void 0===c[d].handler&&(c[d].disabled=!0,c[d].handler=function(){for(var a=b.getSelection(),c=a.items,d=0,e=a.items.length;e>d;d++){var f=c[d];a.row?f.rowIndex=a.row:a.rows&&(f.rowIndex=a.rows[d]),b.remove(f)}b.selection.clearSelection()},c[d].events=[{render:function(){var a=this;setTimeout(function(){var b=Fancy.getWidget(a.el.parent().parent().select(".fancy-grid").dom.id);b.on("select",function(){a.enable()}),b.on("clearselect",function(){a.disable()})},10)}}])}return a},prepareConfigChart:function(a){var b=a.data,c=b.chart;if(Fancy.isObject(c)&&(c=[c]),b&&b.chart){a._plugins.push({type:"grid.chartintegration",chart:c,toChart:b.items?!0:b.proxy?!0:!1});for(var d=0,e=c.length;e>d;d++){var f=c[d],g=f.type;switch(g){case"highchart":case"highcharts":a._plugins.push({type:"grid.highchart"});break;case void 0:throw new Error("[FancyGrid Error] - type of chart is undefined");default:throw new Error("[FancyGrid Error] - type of chart "+g+" does not exist")}}}return a},prepareConfigSize:function(a,b){var c,d=this,e=a.renderTo,f=!!(d.title||d.subTitle||d.tbar||d.bbar||d.buttons||d.panel);if(void 0===a.width)e&&(a.responsive=!0,c=Fancy.get(e),a.width=parseInt(c.width()));else if("fit"===a.width){for(var g=a.columns,h=0,i=g.length,j=0;i>h;h++)j+=g[h].width;j+=a.title||a.subTitle?2:2*a.panelBorderWidth,a.width=j}if("fit"===a.height){var k=0;Fancy.isArray(a.data)?k=a.data.length:a.data&&Fancy.isArray(a.data.items)&&(k=a.data.items.length),height=k*a.cellHeight,a.title&&(height+=a.titleHeight),a.header!==!1&&(height+=a.cellHeaderHeight),f?height+=2:height+=2*a.panelBorderWidth,a.height=height}return a}}),Fancy.Mixin("Fancy.grid.mixin.ActionColumn",{initActionColumnHandler:function(){var a=this;a.on("cellclick",a.onCellClickColumnAction,a)},onCellClickColumnAction:function(a,b){var c,d,e=this,f=b.column,g=(Fancy.get(b.cell),b.e.target,f.items);"action"===f.type&&(c=e.getActiveActionColumnItem(b),g&&void 0!==c&&(d=g[c],d.handler&&d.handler(e,b)))},getActiveActionColumnItem:function(a){for(var b=Fancy.get(a.cell),c=a.e.target,d=b.select(".fancy-grid-column-action-item"),e=0,f=d.length;f>e;e++)if(d.item(e).within(c))return e}}),Fancy.Mixin("Fancy.grid.mixin.Grid",{tpl:['<div class="fancy-grid-left fancy-grid-left-empty"></div>','<div class="fancy-grid-center"></div>','<div class="fancy-grid-right fancy-grid-right-empty"></div>','<div class="fancy-grid-editors"></div>'],initStore:function(){var a,b,c=this,d=c.getFieldsFromData(c.data),e="Fancy.model."+Fancy.id(),f=c.data,g=!1;c.data.items&&(f=c.data.items),a=c.data.remoteSort,b=c.data.remoteFilter,Fancy.define(e,{extend:Fancy.Model,fields:d}),c.grouping&&void 0!==c.grouping.collapsed&&(g=c.grouping.collapsed);var h={widget:c,model:e,data:f,paging:c.paging,remoteSort:a,remoteFilter:b,collapsed:g};f.pageSize&&(h.pageSize=f.pageSize),c.store=new Fancy.Store(h),c.model=e,c.fields=d},initTouch:function(){var a=this;Fancy.isTouch&&window.FastClick&&(a.panel?(FastClick.attach(a.panel.el.dom),a.panel.el.addClass("fancy-touch")):(FastClick.attach(a.el.dom),a.el.addClass("fancy-touch")))},initElements:function(){var a=this;a.header!==!1&&(a.leftHeader=new Fancy.grid.Header({widget:a,side:"left"}),a.header=new Fancy.grid.Header({widget:a,side:"center"}),a.rightHeader=new Fancy.grid.Header({widget:a,side:"right"})),a.leftBody=new Fancy.grid.Body({widget:a,side:"left"}),a.body=new Fancy.grid.Body({widget:a,side:"center"}),a.rightBody=new Fancy.grid.Body({widget:a,side:"right"}),a.leftEl=a.el.select(".fancy-grid-left"),a.centerEl=a.el.select(".fancy-grid-center"),a.rightEl=a.el.select(".fancy-grid-right")},getFieldsFromData:function(a){var b=a.items||a;if(a.fields)return a.fields;if(!b)throw new Error("not set fields of data");var c=b[0],d=[];for(var e in c)d.push(e);return d},render:function(){var a=this,b=a.renderTo||document.body,c=Fancy.get(document.createElement("div")),d=a.panelBodyBorders;c.addClass(Fancy.cls),c.addClass(a.cls),c.attr("id",a.id),void 0===a.panel&&a.shadow&&c.addClass("fancy-panel-shadow"),a.columnLines===!1&&c.addClass("fancy-grid-disable-column-lines"),"default"===a.theme||a.panel||c.addClass("fancy-theme-"+a.theme);var e=0,f=0;a.panel&&(e=d[1]+d[3]),c.css({width:a.width-e+"px",height:a.height-f+"px"}),c.update(a.tpl.join(" ")),a.el=Fancy.get(Fancy.get(b).dom.appendChild(c.dom))},update:function(){var a=this,b=a.store;b.loading||(a.updater.update(),a.fire("update"))},setSides:function(){var a=this,b=a.leftColumns,c=a.columns,d=a.rightColumns,e=0,f=b.length,g=0,h=0,i=0,j=0,k=(a.borders,a.gridBorders),l=a.panelBodyBorders,m=a.gridWithoutPanelBorders;for(a.panel&&(j=a.panelBorderWidth),b.length>0&&a.leftEl.removeClass("fancy-grid-left-empty"),d.length>0&&a.rightEl.removeClass("fancy-grid-right-empty");f>e;e++)g+=b[e].width;for(e=0,f=c.length;f>e;e++)h+=c[e].width;for(e=0,f=d.length;f>e;e++)i+=d[e].width;h=0===g&&0===i?a.panel?a.width-k[1]-k[3]-l[1]-l[3]:a.width-m[1]-m[3]:0===i?a.panel?a.width-g-k[1]-k[3]-l[1]-l[3]:a.width-g-m[1]-m[3]:0===g?a.panel?a.width-i-k[1]-k[3]-l[1]-l[3]:a.width-i-m[1]-m[3]:a.width>g+h+i?a.panel?a.width-g-i-k[1]-k[3]-l[1]-l[3]:a.width-g-i-m[1]-m[3]:a.panel?a.width-g-i-k[1]-k[3]-l[1]-l[3]:a.width-g-i-m[1]-m[3],a.leftEl.css({width:g+"px"}),a.centerEl.css({left:g+"px",width:h+"px"}),a.header&&(a.el.select(".fancy-grid-left .fancy-grid-header").css({width:g+"px"}),a.el.select(".fancy-grid-center .fancy-grid-header").css({width:h+"px"})),a.el.select(".fancy-grid-center .fancy-grid-body").css({width:h+"px"}),a.width>g+h+i?a.rightEl.css({right:"0px"}):a.rightEl.css({left:"",right:"0px"}),a.rightEl.css({width:i}),a.header&&a.el.select(".fancy-grid-right .fancy-grid-header").css({width:i+"px"})},setColumnsPosition:function(){var a=this;a.body.setColumnsPosition(),a.leftBody.setColumnsPosition(),a.rightBody.setColumnsPosition()},setSidesHeight:function(){var a=this,b=a.store,c=1;a.header!==!1&&(c+=a.cellHeaderHeight,a.filter&&a.filter.header&&(c+=a.cellHeaderHeight),a.groupheader&&(c+=a.cellHeaderHeight)),a.grouping&&(c+=a.grouping.groups.length*a.groupRowHeight),c+=b.getLength()*a.cellHeight-1,a.leftEl.css({height:c+"px"}),a.centerEl.css({height:c+"px"}),a.rightEl.css({height:c+"px"})},preRender:function(){var a=this;(a.title||a.subTitle||a.tbar||a.bbar||a.buttons||a.panel)&&a.renderPanel()},renderPanel:function(){var a=this,b={renderTo:a.renderTo,title:a.title,subTitle:a.subTitle,width:a.width,height:a.height,titleHeight:a.titleHeight,subTitleHeight:a.subTitleHeight,barHeight:a.barHeight,theme:a.theme,shadow:a.shadow,style:a.style||{},window:a.window,modal:a.modal,frame:a.frame,items:[a]},c=a.panelBodyBorders;a.bbar&&(b.bbar=a.bbar,a.height-=a.barHeight),a.tbar&&(b.tbar=a.tbar,a.height-=a.barHeight),a.buttons&&(b.buttons=a.buttons,a.height-=a.barHeight),a.footer&&(b.footer=a.footer,a.height-=a.barHeight),a.panel=new Fancy.Panel(b),a.bbar=a.panel.bbar,a.tbar=a.panel.tbar,a.buttons=a.panel.buttons,a.panel.el.addClass("fancy-panel-grid-inside"),a.title&&(a.height-=a.titleHeight),a.subTitle&&(a.height-=a.subTitleHeight,a.height+=c[2]),a.height-=c[0]+c[2],0===a.panelBorderWidth,a.renderTo=a.panel.el.select(".fancy-panel-body-inner").dom},getBodyHeight:function(){var a=this,b=a.height,c=1,d=a.gridBorders,e=a.gridWithoutPanelBorders;return a.groupheader&&(c=2),a.filter&&a.filter.header&&c++,a.header!==!1&&(b-=a.cellHeaderHeight*c),b-=a.panel?d[0]+d[2]:e[0]+e[2]},ons:function(){var a=this,b=a.store,c=Fancy.get(document);b.on("change",a.onChangeStore,a),b.on("set",a.onSetStore,a),b.on("remove",a.onRemoveStore,a),b.on("sort",a.onSortStore,a),b.on("beforeload",a.onBeforeLoadStore,a),b.on("load",a.onLoadStore,a),c.on("mouseup",a.onDocMouseUp,a),c.on("click",a.onDocClick,a),c.on("mousemove",a.onDocMove,a),a.responsive&&Fancy.$(window).bind("resize",function(){a.onWindowResize()})},onChangeStore:function(){var a=this;a.update()},onBeforeLoadStore:function(a){var b=this;b.fire("beforeload")},onRemoveStore:function(a,b,c){var d=this;d.fire("remove",b,c)},onLoadStore:function(a){var b=this;b.fire("load")},onSetStore:function(a,b){var c=this;c.fire("set",b)},onSortStore:function(a,b){var c=this;c.fire("sort",b)},getCellsViewHeight:function(){var a=this,b=a.store,c=0,d=0;return a.grouping&&(c=a.grouping.plusScroll),a.scroller.scrollBottomEl.hasClass("fancy-display-none")||(d=a.scroller.cornerSize),a.cellHeight*b.dataView.length+d+c},onDocMouseUp:function(){var a=this;a.fire("docmouseup")},onDocClick:function(a){var b=this;b.fire("docclick",a)},onDocMove:function(a){var b=this;b.fire("docmove",a)},getCenterViewWidth:function(){for(var a=this,b=a.centerEl.width(),c=0,d=a.columns,e=0,f=d.length;f>e;e++)c+=d[e].width;return 0===b?c:b},getCenterFullWidth:function(){for(var a=this,b=0,c=a.columns,d=0,e=c.length;e>d;d++)b+=c[d].width;return b},getColumns:function(a){var b,c=this;switch(a){case"left":b=c.leftColumns;break;case"center":b=c.columns;break;case"right":b=c.rightColumns}return b},getBody:function(a){var b,c=this;switch(a){case"left":b=c.leftBody;break;case"center":b=c.body;break;case"right":b=c.rightBody}return b},getDomRow:function(a){for(var b=this,c=b.leftBody,d=b.body,e=b.rightBody,f=b.leftColumns,g=b.columns,h=b.rightColumns,i=0,j=f.length,k=[];j>i;i++)k.push(c.getDomCell(a,i));for(i=0,j=g.length;j>i;i++)k.push(d.getDomCell(a,i));for(i=0,j=h.length;j>i;i++)k.push(e.getDomCell(a,i));return k},selectColumn:function(){},initTextSelection:function(){var a=this,b=a.body,c=a.leftBody,d=a.rightBody;a.textSelection===!1&&(a.el.addClass("fancy-grid-unselectable"),b.el.on("mousedown",function(a){a.preventDefault()}),c.el.on("mousedown",function(a){a.preventDefault()}),d.el.on("mousedown",function(a){a.preventDefault()}))},setTrackOver:function(a,b){var c=this;switch(a){case"cell":c.cellTrackOver=b;break;case"column":c.columnTrackOver=b;break;case"row":c.trackOver=b}},setSelModel:function(a){var b=this,c=b.selection;c.cell=!1,c.cells=!1,c.row=!1,c.rows=!1,c.column=!1,c.columns=!1,c[a]=!0,c.clearSelection()},getSelection:function(){var a=this;return a.selection.getSelection()},clearSelection:function(){var a=this,b=a.selection;b.clearSelection()},destroy:function(){var a=this,b=Fancy.get(document);b.un("mouseup",a.onDocMouseUp,a),b.un("click",a.onDocClick,a),b.un("mousemove",a.onDocMove,a),a.body.destroy(),a.leftBody.destroy(),a.rightBody.destroy(),a.header.destroy(),a.leftHeader.destroy(),a.rightHeader.destroy(),a.scroller.destroy(),a.el.destroy(),a.panel&&a.panel.el.destroy()},showAt:function(){var a=this;a.panel&&a.panel.showAt.apply(a.panel,arguments)},show:function(){var a=this;a.panel?a.panel.show.apply(a.panel,arguments):a.el.show()},hide:function(){var a=this;a.panel?a.panel.hide.apply(a.panel,arguments):a.el.hide()},initDateColumn:function(){var a=this,b=function(b){for(var c=0,d=b.length;d>c;c++){var e=b[c];if("date"===e.type){e.format=e.format||{};var f={type:"date"};Fancy.applyIf(f,a.lang.date),Fancy.applyIf(e.format,f)}}return b};a.columns=b(a.columns),a.leftColumns=b(a.leftColumns),a.rightColumns=b(a.rightColumns)},stopEditor:function(){var a=this;a.edit.stopEditor()},getById:function(a){var b=this;return b.store.getById(a)},get:function(a,b){var c=this,d=c.store;return void 0!==b?d.get(a,b):void 0===a?d.get():d.getItem(a)},getTotal:function(){return this.store.getTotal()},getDataView:function(){return this.store.getDataView()},getData:function(){return this.store.getData()},selectRow:function(a){var b=this;b.selection.selectRow(a)},load:function(){var a=this;a.store.loadData()},save:function(){var a=this;a.store.save()},onWindowResize:function(){var a,b=this,c=b.renderTo;b.panel&&(c=b.panel.renderTo,a=Fancy.get(c),b.setWidth(parseInt(a.width())))},setWidth:function(a){var b=this,c=b.el,d=b.gridBorders,e=b.body,f=(b.leftBody,b.rightBody,b.header),g=(b.leftHeader,b.rightHeader,function(a){for(var b=0,c=a.length,d=0;c>b;b++)d+=a[b].width;return d}),h=(g(b.columns),g(b.leftColumns)),i=g(b.rightColumns),j=a-h-i;b.panel?(c=b.panel.el,b.panel.el.width(a),c=b.el,j-=d[1]+d[3]):j-=2*b.panelBorderWidth,100>j&&(j=100),c.width(a-d[1]-d[3]),c.select(".fancy-grid-center").css("width",j),f.el.css("width",j),e.el.css("width",j),b.scroller.setScrollBars()},find:function(a,b){return this.store.find(a,b)},findItem:function(a,b){return this.store.findItem(a,b)},each:function(a,b){this.store.each(a,b)}}),Fancy.define("Fancy.grid.plugin.Updater",{extend:Fancy.Plugin,ptype:"grid.updater",inWidgetName:"updater",constructor:function(a){var b=this;Fancy.applyConfig(b,a),b.Super("const",arguments)},init:function(){},update:function(){var a=this,b=a.widget;b.leftBody.update(),b.body.update(),b.rightBody.update()},updateRow:function(a){var b=this,c=b.widget;c.leftBody.updateRows(a),c.body.updateRows(a),c.rightBody.updateRows(a)}}),Fancy.define("Fancy.grid.plugin.Scroller",{extend:Fancy.Plugin,ptype:"grid.scroller",inWidgetName:"scroller",rightScrollCls:"fancy-scroll-right",bottomScrollCls:"fancy-scroll-bottom",rightKnobDown:!1,bottomKnobDown:!1,minRightKnobHeight:35,minBottomKnobWidth:35,cornerSize:12,constructor:function(a){var b=this;b.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.ons()},ons:function(){var a=this,b=a.widget,c=Fancy.getMouseWheelEventName();b.once("render",function(){a.render(),b.leftBody.el.on(c,a.onMouseWheel,a),b.body.el.on(c,a.onMouseWheel,a),b.rightBody.el.on(c,a.onMouseWheel,a),b.once("init",a.onGridInit,a)}),a.on("render",a.onRender,a),b.store.on("change",a.onChangeStore,a)},destroy:function(){var a=this,b=a.widget,c=b.leftBody,d=b.body,e=b.rightBody,f=Fancy.get(document),g=Fancy.getMouseWheelEventName();f.un("mouseup",a.onMouseUpDoc,a),f.un("mousemove",a.onMouseMoveDoc,a),c.el.un(g,a.onMouseWheel,a),d.el.un(g,a.onMouseWheel,a),e.el.un(g,a.onMouseWheel,a),a.scrollBottomEl.un("mousedown",a.onMouseDownBottomSpin,a),a.scrollRightEl.un("mousedown",a.onMouseDownRightSpin,a),Fancy.isTouch&&(c.el.un("touchstart",a.onBodyTouchStart,a),c.el.un("touchmove",a.onBodyTouchMove,a),d.el.un("touchstart",a.onBodyTouchStart,a),d.el.un("touchmove",a.onBodyTouchMove,a),e.el.un("touchstart",a.onBodyTouchStart,a),e.el.un("touchmove",a.onBodyTouchMove,a),f.un("touchend",a.onMouseUpDoc,a))},onGridInit:function(){var a=this,b=a.widget,c=Fancy.get(document);a.setScrollBars(),c.on("mouseup",a.onMouseUpDoc,a),c.on("mousemove",a.onMouseMoveDoc,a),b.on("columnresize",a.onColumnResize,a)},render:function(){var a=this,b=a.widget,c=b.body,d=Fancy.get(document.createElement("div")),e=Fancy.get(document.createElement("div"));d.addClass(a.rightScrollCls),e.addClass(a.bottomScrollCls),e.addClass("fancy-display-none"),d.update(['<div class="fancy-scroll-right-inner"></div>'].join(" ")),d.select(".fancy-scroll-right-inner").css("margin-top",b.knobOffSet),e.update(['<div class="fancy-scroll-bottom-inner"></div>'].join(" ")),b.panel&&0===b.panelBorderWidth,Fancy.get(c.el.append(d.dom)),a.scrollRightEl=c.el.select(".fancy-scroll-right"),Fancy.get(c.el.append(e.dom)),a.scrollBottomEl=c.el.select(".fancy-scroll-bottom"),a.fire("render")},onMouseWheel:function(a){var b=this,c=(b.widget,Fancy.getWheelDelta(a.originalEvent||a));a.preventDefault(),0!=b.isRightScrollable()&&(b.scrollDelta(c),b.scrollRightKnob())},onRender:function(){var a=this;a.scrollRightEl.hover(function(){a.bottomKnobDown!==!0&&a.scrollRightEl.addClass("fancy-scroll-right-hover")},function(){a.scrollRightEl.removeClass("fancy-scroll-right-hover")}),a.scrollBottomEl.hover(function(){a.rightKnobDown!==!0&&a.scrollBottomEl.addClass("fancy-scroll-bottom-hover")},function(){a.scrollBottomEl.removeClass("fancy-scroll-bottom-hover")}),a.initRightScroll(),a.initBottomScroll(),Fancy.isTouch&&a.initTouch()},initTouch:function(){var a=this,b=a.widget,c=b.leftBody,d=b.body,e=b.rightBody,f=Fancy.get(document);c.el.on("touchstart",a.onBodyTouchStart,a),c.el.on("touchmove",a.onBodyTouchMove,a),d.el.on("touchstart",a.onBodyTouchStart,a),d.el.on("touchmove",a.onBodyTouchMove,a),e.el.on("touchstart",a.onBodyTouchStart,a),e.el.on("touchmove",a.onBodyTouchMove,a),f.on("touchend",a.onMouseUpDoc,a)},onBodyTouchStart:function(a){var b=this,a=a.originalEvent,c=a.changedTouches[0];b.rightKnobDown=!0,b.bottomKnobDown=!0,b.mouseDownXY={x:c.pageX,y:c.pageY},b.rightKnobTop=parseInt(b.rightKnob.css("margin-top")),b.scrollRightEl.addClass("fancy-scroll-right-active"),b.bottomKnobLeft=parseInt(b.bottomKnob.css("margin-left")),b.scrollBottomEl.addClass("fancy-scroll-bottom-active")},onBodyTouchEnd:function(){var a=this;a.onMouseUpDoc()},onBodyTouchMove:function(a){var b=this,a=a.originalEvent,c=a.changedTouches[0];b.rightKnobDown===!0&&a.preventDefault(),b.bottomKnobDown===!0&&a.preventDefault(),b.onMouseMoveDoc({pageX:c.pageX,pageY:c.pageY})},initRightScroll:function(){var a=this;a.widget,Fancy.get(document);a.rightKnob=a.scrollRightEl.select(".fancy-scroll-right-inner"),a.scrollRightEl.on("mousedown",a.onMouseDownRightSpin,a)},initBottomScroll:function(){var a=this;a.widget,Fancy.get(document);a.bottomKnob=a.scrollBottomEl.select(".fancy-scroll-bottom-inner"),a.scrollBottomEl.on("mousedown",a.onMouseDownBottomSpin,a)},onMouseDownRightSpin:function(a){var b=this;Fancy.isTouch||(a.preventDefault(),b.rightKnobDown=!0,b.mouseDownXY={x:a.pageX,y:a.pageY},b.rightKnobTop=parseInt(b.rightKnob.css("margin-top")),b.scrollRightEl.addClass("fancy-scroll-right-active"))},onMouseDownBottomSpin:function(a){var b=this;a.preventDefault(),b.bottomKnobDown=!0,b.mouseDownXY={x:a.pageX,y:a.pageY},b.bottomKnobLeft=parseInt(b.bottomKnob.css("margin-left")),b.scrollBottomEl.addClass("fancy-scroll-bottom-active")},onMouseUpDoc:function(){var a=this;(a.rightKnobDown!==!1||a.bottomKnobDown!==!1)&&(a.scrollRightEl.removeClass("fancy-scroll-right-active"),a.scrollBottomEl.removeClass("fancy-scroll-bottom-active"),a.rightKnobDown=!1,a.bottomKnobDown=!1)},onMouseMoveDoc:function(a){var b,c,d,e,f=this,g=f.widget,h=!1,i=!1,j=g.knobOffSet,k=a.pageX,l=a.pageY;f.rightKnobDown&&(Fancy.isTouch?(c=f.mouseDownXY.y-l,d=c+f.rightKnobTop):(c=l-f.mouseDownXY.y,d=c+f.rightKnobTop),d<f.knobOffSet&&(d=f.knobOffSet),f.bodyViewHeight<d+f.rightKnobHeight&&(d=f.bodyViewHeight-f.rightKnobHeight),d<f.rightScrollScale&&(d=0),f.rightKnob.css("margin-top",d+j+"px"),h=f.rightScrollScale*d,f.scroll(h)),f.bottomKnobDown&&(Fancy.isTouch?(b=f.mouseDownXY.x-k,c=f.mouseDownXY.y-l,e=b+f.bottomKnobLeft):(b=k-f.mouseDownXY.x,c=l-f.mouseDownXY.y,e=b+f.bottomKnobLeft),1>e&&(e=1),f.bodyViewWidth-2<e+f.bottomKnobWidth&&(e=f.bodyViewWidth-f.bottomKnobWidth-2),f.bottomScrollScale<0&&0>e&&(e=0,f.bottomScrollScale=0),f.bottomKnob.css("margin-left",e+"px"),i=f.bottomScrollScale*(e-1),f.scroll(!1,i))},setScrollBars:function(){var a=this;a.checkRightScroll(),a.checkBottomScroll(),a.checkCorner(),a.setRightKnobSize(),a.setBottomKnobSize()},checkRightScroll:function(){var a=this,b=a.widget,c=b.gridBorders,d=b.getBodyHeight(),e=b.getCellsViewHeight()-c[0]-c[2];d>e?a.scrollRightEl.addClass("fancy-display-none"):a.scrollRightEl.removeClass("fancy-display-none")},isRightScrollable:function(){var a=this;return!a.scrollRightEl.hasClass("fancy-display-none")},setRightKnobSize:function(){var a=this,b=a.widget,c=b.getBodyHeight()-(a.corner?a.cornerSize:0)-2,d=b.getCellsViewHeight()-(a.corner?a.cornerSize:0),e=d-c,f=100-e/(c/100),g=c*(f/100),h=b.knobOffSet,i=0;g<a.minRightKnobHeight&&(g=a.minRightKnobHeight),a.corner===!1&&(i=h,c-=h),a.rightKnob.css("height",g+"px"),a.rightKnobHeight=g,a.bodyViewHeight=c,a.rightScrollScale=(d-c)/(c-g)},checkBottomScroll:function(){var a=this,b=a.widget,c=b.getCenterViewWidth(),d=b.getCenterFullWidth()-2;c>d?a.scrollBottomEl.addClass("fancy-display-none"):a.scrollBottomEl.removeClass("fancy-display-none")},checkCorner:function(){var a=this;a.corner=!a.scrollRightEl.hasClass("fancy-display-none")&&!a.scrollBottomEl.hasClass("fancy-display-none")},setBottomKnobSize:function(){var a=this,b=a.widget,c=b.getCenterViewWidth()-(a.corner?a.cornerSize:0),d=b.getCenterFullWidth()-(a.corner?a.cornerSize:0),e=d-c,f=100-e/(d/100),g=c*(f/100)-2;g<a.minBottomKnobWidth&&(g=a.minBottomKnobWidth),a.bottomKnob.css("width",g+"px"),a.bottomKnobWidth=g,a.bodyViewWidth=c,a.bottomScrollScale=(c-d)/(c-g-2-1)},scroll:function(a,b){var c,d=this,e=d.widget;e.leftBody.scroll(a,b),c=e.body.scroll(a,b),e.rightBody.scroll(a,b),void 0!==c.scrollTop&&(d.scrollTop=Math.abs(c.scrollTop)),e.fire("scroll")},scrollDelta:function(a){var b,c=this,d=c.widget;d.leftBody.wheelScroll(a),b=d.body.wheelScroll(a),d.rightBody.wheelScroll(a),c.scrollTop=Math.abs(b.newScroll),d.fire("scroll")},scrollRightKnob:function(){var a=this,b=a.widget,c=a.getScroll(),d=c/a.rightScrollScale+b.knobOffSet;a.rightKnob.css("margin-top",d+"px")},scrollBottomKnob:function(){var a=this,b=a.widget,c=a.getBottomScroll(),d=c/a.bottomScrollScale+b.knobOffSet;0===c&&(d=-1),a.bottomKnob.css("margin-left",-d+"px")},getScroll:function(){var a=this,b=a.widget;return Math.abs(parseInt(b.body.el.select(".fancy-grid-column").item(0).css("top")))},getBottomScroll:function(){var a=this,b=a.widget;return Math.abs(parseInt(b.body.el.select(".fancy-grid-column").item(0).css("left")))},update:function(){var a=this;a.setScrollBars(),a.checkScroll()},onChangeStore:function(){var a=this;a.setScrollBars(),a.checkScroll()},onColumnResize:function(){var a=this;a.setScrollBars()},checkScroll:function(){var a=this,b=a.widget,c=a.getScroll(),d=b.getBodyHeight()-(a.corner?a.cornerSize:0),e=b.getCellsViewHeight()-(a.corner?a.cornerSize:0);c&&d>e&&(a.scroll(0),a.scrollRightKnob())},scrollToCell:function(a){var b=this,c=b.widget,d=c.cellHeight,e=Fancy.get(a),f=e.parent(),g=Number(e.attr("index")),h=Number(f.attr("index")),i=b.getScroll(),j=d*(g+1),k=c.getBodyHeight(),l=b.getBottomScroll(),m=parseInt(c.body.el.css("width")),n=0,o=f.parent().parent().hasClass("fancy-grid-center");if(0===g&&0===h)return b.scroll(0,0),b.scrollBottomKnob(),void b.scrollRightKnob();if(j-i>k&&(i+=d,b.scroll(i)),o){var p=c.columns,q=0;for(p.length;h>=q;q++)n+=p[q].width;n-l>m?b.scroll(i,-(l+p[q-1].width)):0!==l&&b.scroll(i,0),b.scrollBottomKnob()}b.scrollRightKnob()}}),Fancy.define("Fancy.grid.plugin.LoadMask",{extend:Fancy.Plugin,ptype:"grid.loadmask",inWidgetName:"loadmask",cls:"fancy-loadmask",constructor:function(a){var b=this;b.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.ons()},ons:function(){var a=this,b=a.widget;b.store;b.once("render",function(){a.render(),b.on("beforeload",a.onBeforeLoad,a),b.on("load",a.onLoad,a)})},render:function(){var a,b,c=this,d=c.widget,e=d.el,f=e,g=Fancy.get(document.createElement("div")),h=d.lang;d.panel&&(f=d.panel.el),a=f.width(),b=f.height(),g.addClass(c.cls),"default"!==d.theme&&g.addClass("fancy-theme-"+d.theme),g.css({width:a,height:b,opacity:0}),g.update(['<div class="fancy-loadmask-inner"><div class="fancy-loadmask-image"></div><div class="fancy-loadmask-text">'+h.loadingText+"</div></div>"].join(" ")),c.el=Fancy.get(f.dom.appendChild(g.dom)),c.innerEl=c.el.select(".fancy-loadmask-inner");var i=c.innerEl.width(),j=c.innerEl.height();c.innerEl.css({left:a/2-i/2,top:b/2-j/2}),d.store.loading!==!0?g.css("display","none"):(g.css("display","none"),c.showLoadMask()),g.css("opacity",1)},onBeforeLoad:function(){var a=this;a.showLoadMask()},onLoad:function(){var a=this;a.loaded=!0,a.el.css("display","none")},showLoadMask:function(){var a=this;a.loaded=!1,setTimeout(function(){a.loaded!==!0&&a.el.css("display","block")},50)}}),Fancy.define("Fancy.grid.plugin.ColumnResizer",{extend:Fancy.Plugin,ptype:"grid.columnresizer",inWidgetName:"columnresizer",constructor:function(a){var b=this;b.Super("const",arguments)},init:function(){var a=this,b=a.widget;a.Super("init",arguments),b.on("render",function(){a.render(),a.ons()})},ons:function(){var a=this,b=a.widget;b.on("headercellmousemove",a.onCellMouseMove,a),b.on("headercellmousedown",a.onHeaderCellMouseDown,a),b.on("docclick",a.onDocClick,a),b.on("docmove",a.onDocMove,a),b.on("docmouseup",a.onDocMouseUp,a)},onCellMouseMove:function(a,b){var c=this,d=c.widget,e=b.e,f=Fancy.get(b.cell),g=e.offsetX,h=f.width();d.startResizing||(7>g&&0!==b.index?c.isColumnResizable(b,!0)&&Fancy.get(e.target).closest(".fancy-field").hasClass("fancy-field")===!1&&c.addCellResizeCls(b.cell):7>h-g?c.isColumnResizable(b)&&c.addCellResizeCls(b.cell):c.removeCellResizeCls(b.cell))},addCellResizeCls:function(a){
Fancy.get(a).addClass("fancy-grid-column-resizer")},removeCellResizeCls:function(a){Fancy.get(a).removeClass("fancy-grid-column-resizer")},onHeaderCellMouseDown:function(a,b){var c=this,d=c.widget,a=b.e,e=a.target,f=Fancy.get(b.cell),g=a.offsetX,h=f.width(),i=f.select(".fancy-field");i.length>0&&i.item(0).within(e)||(7>g&&0!==b.index?(d.startResizing=!0,c.cell=c.getPrevCell(b),c.activeSide=b.side,c.clientX=a.clientX,c.columnIndex=b.index-1):7>h-g&&(d.startResizing=!0,c.cell=b.cell,c.activeSide=b.side,c.clientX=a.clientX,c.columnIndex=b.index),d.startResizing&&c.isColumnResizable())},isColumnResizable:function(a,b){var c,d,e,f=this,g=f.widget;if(a){if(c=g.getColumns(a.side),e=a.index,b&&e--,isNaN(e))return;return d=c[e],d.resizable===!0}c=g.getColumns(f.activeSide),c[f.columnIndex].resizable!==!0&&(g.startResizing=!1,delete f.cell,delete f.activeSide,delete f.clientX,delete f.columnIndex)},onDocClick:function(){var a=this,b=a.widget;b.startResizing=!1},onDocMove:function(a,b){var c=this,d=c.widget;d.startResizing&&c.moveResizeEls(b)},render:function(){var a=this,b=a.widget,c=Fancy.get(document.createElement("div")),d=Fancy.get(document.createElement("div"));c.addClass("fancy-grid-resizer-left"),d.addClass("fancy-grid-resizer-right"),a.leftEl=Fancy.get(b.el.dom.appendChild(c.dom)),a.rightEl=Fancy.get(b.el.dom.appendChild(d.dom))},moveResizeEls:function(a){var b=this,c=b.widget,d=Fancy.get(b.cell),e=parseInt(d.css("left"));switch(b.activeSide){case"left":break;case"center":e+=parseInt(c.leftEl.css("width"));break;case"right":e+=parseInt(c.leftEl.css("width")),e+=parseInt(c.centerEl.css("width"))}b.leftEl.css({display:"block",left:e+"px"});var f=a.clientX,g=f-b.clientX,h=d.width()+g;h<c.minCellWidth&&(h=c.minCellWidth),b.deltaWidth=d.width()-h,b.rightEl.css({display:"block",left:e+h+"px"}),b.cellWidth=h},onDocMouseUp:function(){var a=this,b=a.widget;b.startResizing!==!1&&(a.leftEl.css({display:"none"}),a.rightEl.css({display:"none"}),a.resizeColumn(),b.startResizing=!1,delete a.cellWidth)},resizeColumn:function(){var a,b,c,d=this,e=d.widget,f=d.cellWidth,g=d.columnIndex,h=d.deltaWidth,i=e.leftEl,j=e.centerEl,k=e.rightEl,l=e.leftHeader.el,m=e.header.el,n=e.rightHeader.el,o=e.body.el,p={};if(void 0!==f){var q=1;switch(Fancy.nojQuery&&(q=0),d.activeSide){case"left":var r=parseInt(j.css("width"))+h+q;if(r<e.minCenterWidth)return;c=e.leftColumns[g],e.leftColumns[d.columnIndex].width=f,a=e.leftBody.el.select(".fancy-grid-column"),b=e.leftHeader.el.select(".fancy-grid-header-cell"),a.item(g).css("width",f+"px");for(var s=d.columnIndex+1,t=e.leftColumns.length;t>s;s++){var u=a.item(s),v=b.item(s);u.css("left",parseInt(u.css("left"))-h-q),v.css("left",parseInt(v.css("left"))-h-q)}i.css("width",parseInt(i.css("width"))-h-q),l.css("width",parseInt(l.css("width"))-h-q+"px"),e.columns.length&&(j.css("left",parseInt(j.css("left"))-h-q),j.css("width",r),m.css("width",parseInt(m.css("width"))+h+q),o.css("width",parseInt(o.css("width"))+h+q)),e.rightColumns;break;case"center":c=e.columns[g],e.columns[d.columnIndex].width=f,a=e.body.el.select(".fancy-grid-column"),b=e.header.el.select(".fancy-grid-header-cell"),a.item(g).css("width",f+"px");for(var s=d.columnIndex+1,t=e.columns.length;t>s;s++){var u=a.item(s),v=b.item(s),w=parseInt(u.css("left"))-h-q;v.attr("group-index")&&(p[v.attr("group-index")]={delta:h}),u.css("left",w),v.css("left",w)}e.rightColumns.length;break;case"right":var r=parseInt(j.css("width"))+h+q;if(r<e.minCenterWidth)return;c=e.rightColumns[g],e.rightColumns[d.columnIndex].width=f,a=e.rightBody.el.select(".fancy-grid-column"),b=e.rightHeader.el.select(".fancy-grid-header-cell"),a.item(g).css("width",f+"px");for(var s=d.columnIndex+1,t=e.rightColumns.length;t>s;s++){var u=a.item(s),v=b.item(s);u.css("left",parseInt(u.css("left"))-h-q),v.css("left",parseInt(v.css("left"))-h-q)}k.css("width",parseInt(k.css("width"))-h-q),n.css("width",parseInt(n.css("width"))-h-q+"px"),e.columns.length&&(j.css("width",r),m.css("width",parseInt(m.css("width"))+h+q),o.css("width",parseInt(o.css("width"))+h+q))}var x,y=Fancy.get(d.cell),z=y.attr("group-index");if(y.css("width",f+"px"),z)x=e.el.select("[index='"+z+"']"),x.css("width",parseInt(x.css("width"))-h-q);else for(var A in p)x=e.el.select("[index='"+A+"']"),x.css("left",parseInt(x.css("left"))-p[A].delta-q);if(e.fire("columnresize",{cell:y.dom,width:f}),/sparkline/.test(c.type))switch(d.activeSide){case"left":e.leftBody.updateRows(void 0,g);break;case"center":e.body.updateRows(void 0,g);break;case"right":e.rightBody.updateRows(void 0,g)}}},getPrevCell:function(a){var b,c=this,d=c.widget;switch(a.side){case"left":b=d.leftHeader;break;case"center":b=d.header;break;case"right":b=d.rightHeader}return b.el.select(".fancy-grid-header-cell").item(a.index-1).dom}}),Fancy.define("Fancy.grid.plugin.Licence",{extend:Fancy.Plugin,ptype:"grid.licence",inWidgetName:"licence",constructor:function(a){var b=this;b.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.ons()},ons:function(){var a=this,b=a.widget;b.once("render",function(){a.render()})},render:function(){var a=this,b=a.widget,c=b.body,d=Fancy.get(document.createElement("div"));location.host.replace(/^www\./,"");(!/fancygrid/.test(location.host)||b.watermark)&&(a.checkLicence()!==!0||b.watermark)&&(d.css({position:"absolute",right:"4px",bottom:"0px","z-index":2,width:"30px",height:"30px"}),d.update('<a href="http://www.fancygrid.com" title="JavaScript Grid - FancyGrid" style="background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAPklEQVR42mNgGLGAo+/4f1IwTN+i8y/+k4JHLR61eNTiUYuHgcUjD5AbZORG0ajFoxaPWjxq8RC2eBQMWwAAuxzh7E9tdUsAAAAASUVORK5CYII=);color: #60B3E2;font-size: 25px;line-height: 30px;text-decoration: none;">&nbsp;&nbsp;&nbsp;&nbsp;</a>'),Fancy.get(c.el.append(d.dom)),a.licenceEl=d,b.watermark&&a.configWatermark())},configWatermark:function(){var a=this,b=a.widget,c=b.watermark;if(c.text){var d=a.licenceEl.firstChild();d.css("background-image","none"),d.css("font-size","11px"),d.update(c.text),a.licenceEl.css("width","initial")}c.style&&a.licenceEl.css(c.style)},checkLicence:function(){var a=this,b="FancyGrid";if(!Fancy.LICENSE&&!FancyGrid.LICENSE)return!1;var c,d,e,f=String(a.md5(location.host.replace(/^www\./,""),b)),g=Fancy.LICENSE||FancyGrid.LICENSE||[],h=a.md5("UNIVERSAL",b),i=a.md5("SAAS",b),j=a.md5("INTERNAL",b),k=a.md5("OEM",b),l=a.md5("ENTERPRISE",b);for(c=0,d=g.length;d>c;c++)switch(e=String(g[c])){case f:case h:case i:case j:case k:case l:return!0}return!1},md5:function(a,b,c){var d=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c},e=function(a,b){return a<<b|a>>>32-b},f=function(a,b,c,f,g,h){return d(e(d(d(b,a),d(f,h)),g),c)},g=function(a,b,c,d,e,g,h){return f(b&c|~b&d,a,b,e,g,h)},h=function(a,b,c,d,e,g,h){return f(b&d|c&~d,a,b,e,g,h)},i=function(a,b,c,d,e,g,h){return f(b^c^d,a,b,e,g,h)},j=function(a,b,c,d,e,g,h){return f(c^(b|~d),a,b,e,g,h)},k=function(a,b){a[b>>5]|=128<<b%32,a[(b+64>>>9<<4)+14]=b;var c,e,f,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(c=0;c<a.length;c+=16)e=m,f=n,k=o,l=p,m=g(m,n,o,p,a[c],7,-680876936),p=g(p,m,n,o,a[c+1],12,-389564586),o=g(o,p,m,n,a[c+2],17,606105819),n=g(n,o,p,m,a[c+3],22,-1044525330),m=g(m,n,o,p,a[c+4],7,-176418897),p=g(p,m,n,o,a[c+5],12,1200080426),o=g(o,p,m,n,a[c+6],17,-1473231341),n=g(n,o,p,m,a[c+7],22,-45705983),m=g(m,n,o,p,a[c+8],7,1770035416),p=g(p,m,n,o,a[c+9],12,-1958414417),o=g(o,p,m,n,a[c+10],17,-42063),n=g(n,o,p,m,a[c+11],22,-1990404162),m=g(m,n,o,p,a[c+12],7,1804603682),p=g(p,m,n,o,a[c+13],12,-40341101),o=g(o,p,m,n,a[c+14],17,-1502002290),n=g(n,o,p,m,a[c+15],22,1236535329),m=h(m,n,o,p,a[c+1],5,-165796510),p=h(p,m,n,o,a[c+6],9,-1069501632),o=h(o,p,m,n,a[c+11],14,643717713),n=h(n,o,p,m,a[c],20,-373897302),m=h(m,n,o,p,a[c+5],5,-701558691),p=h(p,m,n,o,a[c+10],9,38016083),o=h(o,p,m,n,a[c+15],14,-660478335),n=h(n,o,p,m,a[c+4],20,-405537848),m=h(m,n,o,p,a[c+9],5,568446438),p=h(p,m,n,o,a[c+14],9,-1019803690),o=h(o,p,m,n,a[c+3],14,-187363961),n=h(n,o,p,m,a[c+8],20,1163531501),m=h(m,n,o,p,a[c+13],5,-1444681467),p=h(p,m,n,o,a[c+2],9,-51403784),o=h(o,p,m,n,a[c+7],14,1735328473),n=h(n,o,p,m,a[c+12],20,-1926607734),m=i(m,n,o,p,a[c+5],4,-378558),p=i(p,m,n,o,a[c+8],11,-2022574463),o=i(o,p,m,n,a[c+11],16,1839030562),n=i(n,o,p,m,a[c+14],23,-35309556),m=i(m,n,o,p,a[c+1],4,-1530992060),p=i(p,m,n,o,a[c+4],11,1272893353),o=i(o,p,m,n,a[c+7],16,-155497632),n=i(n,o,p,m,a[c+10],23,-1094730640),m=i(m,n,o,p,a[c+13],4,681279174),p=i(p,m,n,o,a[c],11,-358537222),o=i(o,p,m,n,a[c+3],16,-722521979),n=i(n,o,p,m,a[c+6],23,76029189),m=i(m,n,o,p,a[c+9],4,-640364487),p=i(p,m,n,o,a[c+12],11,-421815835),o=i(o,p,m,n,a[c+15],16,530742520),n=i(n,o,p,m,a[c+2],23,-995338651),m=j(m,n,o,p,a[c],6,-198630844),p=j(p,m,n,o,a[c+7],10,1126891415),o=j(o,p,m,n,a[c+14],15,-1416354905),n=j(n,o,p,m,a[c+5],21,-57434055),m=j(m,n,o,p,a[c+12],6,1700485571),p=j(p,m,n,o,a[c+3],10,-1894986606),o=j(o,p,m,n,a[c+10],15,-1051523),n=j(n,o,p,m,a[c+1],21,-2054922799),m=j(m,n,o,p,a[c+8],6,1873313359),p=j(p,m,n,o,a[c+15],10,-30611744),o=j(o,p,m,n,a[c+6],15,-1560198380),n=j(n,o,p,m,a[c+13],21,1309151649),m=j(m,n,o,p,a[c+4],6,-145523070),p=j(p,m,n,o,a[c+11],10,-1120210379),o=j(o,p,m,n,a[c+2],15,718787259),n=j(n,o,p,m,a[c+9],21,-343485551),m=d(m,e),n=d(n,f),o=d(o,k),p=d(p,l);return[m,n,o,p]},l=function(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c},m=function(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c},n=function(a){return l(k(m(a),8*a.length))},o=function(a,b){var c,d,e=m(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=k(e,8*a.length)),c=0;16>c;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=k(f.concat(m(b)),512+8*b.length),l(k(g.concat(d),640))},p=function(a){var b,c,d="0123456789abcdef",e="";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(b>>>4&15)+d.charAt(15&b);return e},q=function(a){return unescape(encodeURIComponent(a))},r=function(a){return n(q(a))},s=function(a){return p(r(a))},t=function(a,b){return o(q(a),q(b))},u=function(a,b){return p(t(a,b))},v=function(a,b,c){return b?c?t(b,a):u(b,a):c?r(a):s(a)};return v(a,b,c)}}),Fancy.ns("Fancy.grid.body.mixin"),Fancy.grid.body.mixin.Updater=function(){},Fancy.grid.body.mixin.Updater.prototype={update:function(){var a=this,b=a.widget,c=b.store;a.checkDomColumns(),c.loading||(a.checkDomCells(),a.updateRows())},checkDomColumns:function(){var a=this,b=(a.widget,a.el.select(".fancy-grid-column").length),c=a.getColumns(),d=0,e=c.length;if(!(b>=e)){for(;e>d;d++){var f=c[d],g=f.width,h=Fancy.get(document.createElement("div"));if(h.addClass("fancy-grid-column"),f.cls&&h.addClass(f.cls),"text"===f.type&&h.addClass("fancy-grid-column-text"),h.css({width:g+"px"}),h.attr("index",d),f.cellAlign&&h.css("text-align",f.cellAlign),f.ellipsis===!0)switch(f.type){case"string":case"text":case"number":h.addClass("fancy-grid-column-ellipsis")}a.el.dom.appendChild(h.dom)}a.fire("adddomcolumns")}},checkDomCells:function(){var a,b,c=this,d=c.widget,e=d.store,f=0,g=e.dataView.length,h=0;switch(c.side){case"left":b=d.leftColumns;break;case"center":b=d.columns,bodyCls="fancy-grid-body";break;case"right":b=d.rightColumns}a=b.length;var i=c.el.select(".fancy-grid-column"),j=e.getLength(),k=c.cellTpl;for(d.cellWrapper&&(k=c.cellWrapperTpl);a>h;h++){column=b[h];var l=i.item(h);f=0;var m=j-l.select(".fancy-grid-cell").length;for(f=g-m;g>f;f++){var n=k.getHTML({}),o=Fancy.get(document.createElement("div"));o.css({height:d.cellHeight+"px"}),o.addClass(c.cellCls),o.attr("index",f),f%2!==0&&d.striped&&o.addClass(d.cellEvenCls),o.update(n),l.dom.appendChild(o.dom)}}},updateRows:function(a,b){var c,d,e=this,f=e.widget,g=(f.store,0);switch(void 0===a?e.clearDirty():e.clearDirty(a),e.side){case"left":c=f.leftColumns;break;case"center":c=f.columns;break;case"right":c=f.rightColumns}for(d=c.length,void 0!==b&&(g=b,d=b+1);d>g;g++){var h=c[g];switch(h.type){case"string":case"number":case"combo":case"action":case"text":case"date":case"currency":e.renderUniversal(g,a);break;case"color":e.renderColor(g,a);break;case"checkbox":e.renderCheckbox(g,a);break;case"image":e.renderImage(g,a);break;case"sparklineline":e.renderSparkLine(g,a,"line");break;case"sparklinebar":e.renderSparkLine(g,a,"bar");break;case"sparklinetristate":e.renderSparkLine(g,a,"tristate");break;case"sparklinediscrete":e.renderSparkLine(g,a,"discrete");break;case"sparklinebullet":e.renderSparkLine(g,a,"bullet");break;case"sparklinepie":e.renderSparkLine(g,a,"pie");break;case"sparklinebox":e.renderSparkLine(g,a,"box");break;case"circle":e.renderCircle(g,a);break;case"progressdonut":e.renderProgressDonut(g,a);break;case"progressbar":e.renderProgressBar(g,a);break;case"grossloss":e.renderGrossLoss(g,a);break;default:throw new Error("[FancyGrid error] - not existed column type "+h.type)}}e.removeNotUsedCells()},renderUniversal:function(a,b){var c,d,e=this,f=e.widget,g=f.lang,h=f.emptyValue,i=f.store,j=e.getColumns(),k=j[a],l=k.key||k.index||("action"===k.type?"none":void 0),m=e.el.select(".fancy-grid-column"),n=m.item(a),o=n.select("."+f.cellCls),p=n.select("."+f.cellCls+" ."+f.cellInnerCls),q=g.currencySign;for(void 0!==b?(c=b,d=b+1):(c=0,d=i.getLength());d>c;c++){var r,s=i.get(c),t=i.getId(c),u={rowIndex:c,data:s,style:{},column:k,id:t,item:i.getItem(c)},v=!1;switch(i.changed[u.id]&&i.changed[u.id][k.index]&&(v=!0),r=k.smartIndexFn?k.smartIndexFn(s):i.get(c,l),u.value=r,k.format&&(u.value=e.format(u.value,k.format),r=u.value),k.type){case"currency":r=q+r,u.value=r}switch(k.render&&(u=k.render(u),r=u.value),r){case"":case void 0:r=h}var w=o.item(c);f.cellStylingCls&&e.clearCls(w),u.cls&&w.addClass(u.cls),v&&e.enableCellDirty(w),w.css(u.style),p.item(c).update(r)}},clearCls:function(a){for(var b=this,c=b.widget,d=c.cellStylingCls,e=0,f=d.length;f>e;e++)a.removeClass(d[e])},renderColor:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=e.getColumns(),i=h[a],j=i.key||i.index,k=e.el.select(".fancy-grid-column"),l=k.item(a),m=l.select("."+f.cellCls),n=l.select("."+f.cellCls+" ."+f.cellInnerCls);for(void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());d>c;c++){var o,p=g.get(c),q={rowIndex:c,data:p,style:{},column:i};o=i.smartIndexFn?i.smartIndexFn(p):g.get(c,j),i.render&&(q=i.render(q),o=q.value),q.value=o,m.item(c).css(q.style);n.item(c).update('<div style="background-color:'+o+';" class="fancy-grid-color-cell"></div>')}},renderCombo:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=e.getColumns(),i=h[a],j=i.key||i.index,k=e.el.select(".fancy-grid-column"),l=k.item(a),m=l.select("."+f.cellCls),n=l.select("."+f.cellCls+" ."+f.cellInnerCls);for(void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());d>c;c++){var o=g.get(c,j),p={rowIndex:c,value:o,style:{}};i.render&&(p=i.render(p),o=p.value),m.item(c).css(p.style),n.item(c).update(o)}},renderCheckbox:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=e.getColumns(),i=h[a],j=i.key||i.index,k=e.el.select(".fancy-grid-column"),l=k.item(a),m=l.select("."+f.cellCls),n=l.select("."+f.cellCls+" ."+f.cellInnerCls);for(void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());d>c;c++){var o,p=g.get(c,j),q=n.item(c),r=q.select(".fancy-field-checkbox"),s=0!==r.length,t=!1,u=g.getId(c),v={rowIndex:c,data:data,style:{},column:i,id:u,item:g.getItem(c)};if(g.changed[v.id]&&g.changed[v.id][i.index]&&(t=!0),s===!1?new Fancy.CheckBox({renderTo:n.item(c).dom,renderId:!0,value:p,label:!1,style:{padding:"0px",display:"inline-block"},events:[{beforechange:function(a){i.editable!==!0&&(a.canceledChange=!0)}},{change:function(a,b){f.celledit.checkBoxChangedValue=b}}]}):(o=r.dom.id,r=Fancy.getWidget(o),r.set(p,!1)),t){var w=m.item(c);e.enableCellDirty(w)}}},renderImage:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=e.getColumns(),i=h[a],j=i.key||i.index||("action"===i.type?"none":void 0),k=e.el.select(".fancy-grid-column"),l=k.item(a),m=l.select("."+f.cellCls),n=l.select("."+f.cellCls+" ."+f.cellInnerCls);for(void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());d>c;c++){var o=g.get(c,j),p=g.get(c),q={rowIndex:c,value:o,data:p,style:{}},r="";if(i.render&&(q=i.render(q),o=q.value),q.attr)for(var s in q.attr)r+=s+'="'+q.attr[s]+'"';o="<img "+r+' src="'+q.value+'">',m.item(c).css(q.style),n.item(c).update(o)}},renderSparkLine:function(a,b,c){var d,e,f=this,g=f.widget,h=g.cellHeight,i=g.store,j=f.getColumns(),k=j[a],l=k.width,m=k.key||k.index||("action"===k.type?"none":void 0),n=f.el.select(".fancy-grid-column"),o=n.item(a),p=o.select("."+g.cellCls),q=o.select("."+g.cellCls+" ."+g.cellInnerCls),r=k.sparkConfig||{};o.addClass(g.clsSparkColumn),void 0!==b?(d=b,e=b+1):(d=0,e=i.getLength());var s,t=h-1,u=l-20;switch(c){case"line":case"pie":case"box":s="width";break;case"bullet":s="width",t-=11,o.addClass(g.clsSparkColumnBullet);break;case"discrete":s="width",u=l,t-=2;break;case"bar":case"tristate":s="barWidth"}for(;e>d;d++){var v=i.get(d,m),w=i.get(d),x={rowIndex:d,value:v,data:w,style:{}};if(k.render&&(x=k.render(x),v=x.value),Fancy.isArray(k.values)){var y=0,z=k.values.length;for(v=[];z>y;y++)v.push(i.get(d,k.values[y]))}p.item(d).css(x.style);var A=q.item(d).dom,B={type:c,fillColor:"transparent",height:t};if(Fancy.apply(B,r),("bar"===c||"tristate"===c)&&(u=l-20,u/=v.length),B[s]=u,Fancy.nojQuery)throw new Error("SparkLine is 3-rd party jQuery based library. Include jQuery.");var C=window.jQuery||window.$;C(A).sparkline(v,B)}},renderProgressDonut:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=e.getColumns(),i=h[a],j=i.key||i.index,k=e.el.select(".fancy-grid-column"),l=k.item(a),m=l.select("."+f.cellCls),n=l.select("."+f.cellCls+" ."+f.cellInnerCls);for(l.addClass(f.clsSparkColumnDonutProgress),void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());d>c;c++){var o,p=g.get(c),q={rowIndex:c,data:p,style:{},column:i};o=i.smartIndexFn?i.smartIndexFn(p):g.get(c,j),q.value=o,i.format&&(q.value=e.format(q.value,i.format),o=q.value),i.render&&(q=i.render(q),o=q.value),m.item(c).css(q.style);var r=i.sparkConfig||{},s=n.item(c).dom;Fancy.apply(r,{renderTo:s,value:o}),r.size||r.height||r.width||(r.size=f.cellHeaderHeight-6),Fancy.get(s).update(""),new Fancy.spark.ProgressDonut(r)}},renderGrossLoss:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=e.getColumns(),i=h[a],j=i.key||i.index,k=e.el.select(".fancy-grid-column"),l=k.item(a),m=l.select("."+f.cellCls),n=l.select("."+f.cellCls+" ."+f.cellInnerCls);l.addClass(f.clsColumnGrossLoss),void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());var o=i.sparkConfig||{};for(o.showOnMax&&(o.maxValue=Math.max.apply(Math,g.getColumnData(j,i.smartIndexFn)));d>c;c++){var p,q=g.get(c),r={rowIndex:c,data:q,style:{},column:i};p=i.smartIndexFn?i.smartIndexFn(q):g.get(c,j),r.value=p,i.format&&(r.value=e.format(r.value,i.format),p=r.value),i.render&&(r=i.render(r),p=r.value),m.item(c).css(r.style),Fancy.apply(o,{renderTo:n.item(c).dom,value:p,column:i}),new Fancy.spark.GrossLoss(o)}},renderProgressBar:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=e.getColumns(),i=h[a],j=i.key||i.index,k=e.el.select(".fancy-grid-column"),l=k.item(a),m=l.select("."+f.cellCls),n=l.select("."+f.cellCls+" ."+f.cellInnerCls),o=100;l.addClass(f.clsColumnGrossLoss),void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());var p=i.sparkConfig||{};for(p.percents===!1&&(o=Math.max.apply(Math,g.getColumnData(j)));d>c;c++){var q,r=g.get(c),s={rowIndex:c,data:r,style:{},column:i};q=i.smartIndexFn?i.smartIndexFn(r):g.get(c,j),s.value=q,i.format&&(s.value=e.format(s.value,i.format),q=s.value),i.render&&(s=i.render(s),q=s.value),m.item(c).css(s.style),Fancy.apply(p,{renderTo:n.item(c).dom,value:q,column:i,maxValue:o}),new Fancy.spark.ProgressBar(p)}},renderCircle:function(a,b){function c(a,b){var c="http://www.w3.org/2000/svg",d=document.createElementNS(c,"svg:svg");d.setAttribute("width",b),d.setAttribute("height",b),d.setAttribute("viewBox","0 0 "+b+" "+b);var e=document.createElementNS(c,"circle");e.setAttributeNS(null,"cx",b/2),e.setAttributeNS(null,"cy",b/2),e.setAttributeNS(null,"r",b/2);var f="#F0F0F0";b>50&&(f="F0F0F0"),0>a&&(f="#F9DDE0"),e.setAttributeNS(null,"fill",f),d.appendChild(e);var g=document.createElementNS(c,"path"),h=2*Math.PI/100,i=0,j=a*h-.001,k=b/2+b/2*Math.sin(i),l=b/2-b/2*Math.cos(i),m=b/2+b/2*Math.sin(j),n=b/2-b/2*Math.cos(j),o=0;j-i>Math.PI&&(o=1);var p="M "+b/2+","+b/2+" L "+k+","+l+" A "+b/2+","+b/2+" 0 "+o+" 1 "+m+","+n+" Z";g.setAttribute("d",p),0>a?g.setAttribute("fill","#EA7369"):g.setAttribute("fill","#44A4D3"),d.appendChild(g);var q=document.createElementNS(c,"circle");return q.setAttributeNS(null,"cx",b/2),q.setAttributeNS(null,"cy",b/2),q.setAttributeNS(null,"r",.25*b),q.setAttributeNS(null,"fill","#fff"),d.appendChild(q),d}var d,e,f=this,g=f.widget,h=g.store,i=f.getColumns(),j=i[a],k=j.key||j.index||("action"===j.type?"none":void 0),l=f.el.select(".fancy-grid-column"),m=l.item(a),n=(m.select("."+g.cellCls),m.select("."+g.cellCls+" ."+g.cellInnerCls)),o=g.cellHeight-4;j.width;for(m.addClass(g.clsSparkColumnCircle),void 0!==b?(d=b,e=b+1):(d=0,e=h.getLength());e>d;d++){var p,q=h.get(d),r={rowIndex:d,data:q,style:{}};p=j.smartIndexFn?j.smartIndexFn(q):h.get(d,k),r.value=p,j.render&&(r=j.render(r),p=r.value);var s=n.item(d).dom;""===s.innerHTML&&s.appendChild(c(p,o))}},removeNotUsedCells:function(){for(var a=this,b=a.widget,c=b.store,d=a.el.select(".fancy-grid-column"),e=0,f=d.length;f>e;e++)for(var g=d.item(e),h=g.select(".fancy-grid-cell"),i=c.getLength(),j=h.length;j>i;i++)h.item(i).remove()},getFormat:function(a){var b=this,c=b.widget,d=c.lang;switch(a){case"number":return function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,d.thousandSeparator)};case"date":return function(a){var b=Fancy.Date.parse(a,d.date.read);return a=Fancy.Date.format(b,d.date.write)}}switch(a.type){case"date":return function(b){if(0===b.length)return"";var c=Fancy.Date.parse(b,a.read);return b=Fancy.Date.format(c,a.write)}}},format:function(a,b){return a=this.getFormat(b)(a)},enableCellDirty:function(a){a.hasClass("fancy-grid-cell-dirty")||(a.addClass("fancy-grid-cell-dirty"),a.append('<div class="fancy-grid-cell-dirty-el"></div>'))},clearDirty:function(a){var b=this;return void 0!==a?(b.el.select('.fancy-grid-cell[index="'+a+'"] .fancy-grid-cell-dirty-el').destroy(),void b.el.select('.fancy-grid-cell-dirty[index="'+a+'"]').removeClass("fancy-grid-cell-dirty")):(b.el.select(".fancy-grid-cell-dirty-el").destroy(),void b.el.select(".fancy-grid-cell-dirty").removeClass("fancy-grid-cell-dirty"))}},Fancy.define("Fancy.grid.Body",{extend:Fancy.Widget,mixins:[Fancy.grid.body.mixin.Updater],cls:"fancy-grid-body",cellCls:"fancy-grid-cell",cellTpl:['<div class="fancy-grid-cell-inner">{cellValue}</div>'],cellWrapperTpl:['<div class="fancy-grid-cell-wrapper">','<div class="fancy-grid-cell-inner">{cellValue}</div>',"</div>"],constructor:function(a){var b=this;b.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.addEvents("adddomcolumns"),a.initTpl(),a.render(),a.ons()},initTpl:function(){var a=this;a.cellTpl=new Fancy.Template(a.cellTpl),a.cellWrapperTpl=new Fancy.Template(a.cellWrapperTpl)},ons:function(){var a=this,b=a.widget;b.on("afterrender",a.onAfterRender,a),a.el.on("click",a.onCellClick,a,"div.fancy-grid-cell"),a.el.on("dblclick",a.onCellDblClick,a,"div.fancy-grid-cell"),a.el.on("mouseenter",a.onCellMouseEnter,a,"div.fancy-grid-cell"),a.el.on("mouseleave",a.onCellMouseLeave,a,"div.fancy-grid-cell"),a.el.on("mousedown",a.onCellMouseDown,a,"div.fancy-grid-cell"),a.el.on("mouseenter",a.onColumnMouseEnter,a,"div.fancy-grid-column"),a.el.on("mouseleave",a.onColumnMouseLeave,a,"div.fancy-grid-column")},render:function(){var a,b=this,c=b.widget,d=Fancy.get(document.createElement("div"));d.addClass(b.cls),a=c.el.select(".fancy-grid-"+b.side).dom,b.el=Fancy.get(a.appendChild(d.dom))},onAfterRender:function(){var a=this,b=a.widget;b.store;a.update(),a.setHeight()},setColumnsPosition:function(a){var b=this,c=b.getColumns(),d=0,e=c.length,f=0,g=b.el.select(".fancy-grid-column"),a=a||b.scrollLeft||0;for(f+=a;e>d;d++){var h=c[d],i=g.item(d);i.css({left:f+"px"}),f+=h.width}},wheelScroll:function(a){var b=this,c=b.widget,d=c.knobOffSet,e=b.el.select(".fancy-grid-column");if(0!==e.length){for(var f=0,g=e.length,h=c.getBodyHeight(),i=c.getCellsViewHeight(),j=i-h+d,k={oldScroll:parseInt(e.item(0).css("top")),newScroll:parseInt(e.item(0).css("top"))+30*a,deltaScroll:30*a};g>f;f++){var l=e.item(f),m=parseInt(l.css("top"))+30*a;m>0?(m=0,k.newScroll=0):Math.abs(m)>j&&(m=-j-d,k.newScroll=m),l.css("top",m+"px")}return k}},scroll:function(a,b){var c=this,d=c.widget,e=c.el.select(".fancy-grid-column"),f=0,g=e.length,h={};if(a!==!1)for(h.scrollTop=a;g>f;f++){var i=e.item(f);i.css("top",-a+"px")}return void 0!==b&&(h.scrollLeft=b,d.header&&d.header.scroll(b),c.scrollLeft=b,d.body.setColumnsPosition(b)),h},setHeight:function(){var a=this,b=a.widget,c=b.getBodyHeight();a.el.css("height",c+"px")},onCellClick:function(a){var b=this,c=b.widget;c.fire("cellclick",b.getEventParams(a)),c.fire("rowclick",b.getEventParams(a)),c.fire("columnclick",b.getColumnEventParams(a))},onCellDblClick:function(a){var b=this,c=b.widget;c.fire("celldblclick",b.getEventParams(a)),c.fire("rowdblclick",b.getEventParams(a)),c.fire("columndblclick",b.getColumnEventParams(a))},getEventParams:function(a){var b=this,c=b.widget,d=c.store,e=b.getColumns(),f=a.currentTarget,g=Fancy.get(a.currentTarget),h=g.parent();if(void 0===g.parent().dom)return!1;var i=parseInt(h.attr("index")),j=parseInt(g.attr("index")),k=e[i],l=k.index||k.key,m=d.get(j,l),n=d.getId(j),o=d.get(j),p=d.getById(n);return k.smartIndexFn&&(m=k.smartIndexFn(o)),{e:a,id:n,side:b.side,cell:f,column:k,rowIndex:j,columnIndex:i,value:m,data:o,item:p}},getColumnEventParams:function(a){var b=this,c=b.widget,d=c.store,e=(a.currentTarget,Fancy.get(a.currentTarget)),f=e.parent(),g=parseInt(f.attr("index")),h=b.getColumns(),i=h[g],j={e:a,side:b.side,columnIndex:g,column:i,columnDom:f.dom};return c.columnClickData&&(j.data=d.getColumnData(i.index,i.smartIndexFn)),j},getColumnHoverEventParams:function(a){var b=this,c=b.widget,d=(c.store,Fancy.get(a.currentTarget)),e=parseInt(d.attr("index")),f=b.getColumns(),g=f[e];return{e:a,side:b.side,columnIndex:e,column:g,columnDom:d.dom}},getColumns:function(){var a=this,b=a.widget;return b.getColumns(a.side)},onCellMouseEnter:function(a){var b=this,c=b.widget,d=b.getEventParams(a),e=b.prevCellOver;e?d.rowIndex!==b.prevCellOver.rowIndex&&c.fire("rowenter",d):c.fire("rowenter",d),c.fire("cellenter",d),b.prevCellOver=d},onCellMouseDown:function(a){var b=this,c=b.widget,d=b.getEventParams(a),e={e:d.e,side:d.side,columnDom:Fancy.get(d.cell).parent().dom,column:d.column,columnIndex:d.columnIndex};c.fire("cellmousedown",d),c.fire("columnmousedown",e)},onCellMouseLeave:function(){var a=this,b=a.widget;b.fire("rowleave",a.prevCellOver),b.fire("cellleave",a.prevCellOver),delete a.prevCellOver},onColumnMouseEnter:function(a){var b=this,c=b.widget,d=b.getColumnHoverEventParams(a),e=b.prevColumnOver;e?d.rowIndex!==b.prevCellOver.rowIndex&&c.fire("rowenter",d):c.fire("columnenter",d),b.prevColumnOver=d},onColumnMouseLeave:function(){var a=this,b=a.widget;b.fire("columnleave",a.prevColumnOver),delete a.prevColumnOver},getCell:function(a,b){var c=this;return c.el.select('.fancy-grid-column[index="'+b+'"] .fancy-grid-cell[index="'+a+'"]')},getDomCell:function(a,b){var c=this;return c.el.select('.fancy-grid-column[index="'+b+'"] .fancy-grid-cell[index="'+a+'"]').dom},getDomColumn:function(a){var b=this;return b.el.select('.fancy-grid-column[index="'+a+'"]').dom},destroy:function(){var a=this;a.el.un("click",a.onCellClick,a,"div.fancy-grid-cell"),a.el.un("dblclick",a.onCellDblClick,a,"div.fancy-grid-cell"),a.el.un("mouseenter",a.onCellMouseEnter,a,"div.fancy-grid-cell"),a.el.un("mouseleave",a.onCellMouseLeave,a,"div.fancy-grid-cell"),a.el.un("mousedown",a.onCellMouseDown,a,"div.fancy-grid-cell"),a.el.un("mouseenter",a.onColumnMouseEnter,a,"div.fancy-grid-column"),a.el.un("mouseleave",a.onColumnMouseLeave,a,"div.fancy-grid-column")}}),Fancy.define("Fancy.grid.Header",{extend:Fancy.Widget,cls:"fancy-grid-header",cellTpl:['<div class="fancy-grid-header-cell {cls}" style="width:{columnWidth}px;height: {height};left: {left};" {groupIndex} index="{index}">','<div class="fancy-grid-header-cell-container">','<span class="fancy-grid-header-cell-text">{columnName}</span>','<span class="fancy-grid-header-cell-trigger"></span>',"</div>","</div>"],constructor:function(a){var b=this;b.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.initTpl(),a.render(),a.setAlign(),a.setCellsPosition(),a.ons()},initTpl:function(){var a=this;a.cellTpl=new Fancy.Template(a.cellTpl)},ons:function(){var a=this,b=a.widget;b.on("render",a.onAfterRender,a),a.el.on("click",a.onCellClick,a,"div.fancy-grid-header-cell"),a.el.on("mousemove",a.onCellMouseMove,a,"div.fancy-grid-header-cell"),a.el.on("mousedown",a.onCellMouseDown,a,"div.fancy-grid-header-cell"),a.el.on("mousedown",a.onMouseDown,a)},render:function(){var a,b=this,c=b.widget,d=b.getColumns(),e=Fancy.get(document.createElement("div")),f="",g=0,h=d.length,i=1,j={},k=0;for(c.groupheader&&(i=2),c.filter&&c.filter.header&&i++;h>g;g++){var l=d[g],m=(l.key||l.index,l.title||l.header),n="initial",o="",p="";1!==i&&(l.grouping?(j[l.grouping]||(j[l.grouping]={width:0,text:l.grouping,left:k}),j[l.grouping].width+=l.width,p='group-index="'+l.grouping+'"',o="fancy-grid-header-cell-group-level-1"):n=i*c.cellHeaderHeight+"px"),k+=l.width;var q=b.cellTpl.getHTML({cls:o,columnName:m,columnWidth:l.width,index:g,height:n,left:"initial",groupIndex:p});f+=q}e.css({height:c.cellHeaderHeight*i+"px",width:b.getColumnsWidth()}),e.addClass(b.cls),c.groupheader&&(e.addClass("fancy-grid-header-grouped"),f+=b.getGroupingCellsHTML(j)),e.update(f),a=c.el.select(".fancy-grid-"+b.side).dom,b.el=Fancy.get(a.appendChild(e.dom))},setAlign:function(){for(var a=this,b=(a.widget,a.getColumns()),c=0,d=b.length;d>c;c++){var e=b[c];e.align&&a.getDomCell(c).css("text-align",e.align)}},onAfterRender:function(){},setCellsPosition:function(){var a=this,b=a.widget,c=a.getColumns(),d=0,e=0,f=c.length,g=a.el.select(".fancy-grid-header-cell"),h=1;for(d+=a.scrollLeft||0,e=0;f>e;e++){var i=c[e],j=g.item(e),k="0px";i.grouping&&(k=b.cellHeaderHeight+"px"),j.css({top:k,left:d+"px"}),d+=i.width}if(b.groupheader){h=2;var l=a.el.select(".fancy-grid-header-cell-group-level-2"),m=0,n=l.length;if(void 0!==a.scrollLeft)for(;n>m;m++){var o=l.item(m),p=o.attr("index"),q=a.el.select('[group-index="'+p+'"]').item(0).css("left");o.css("left",q)}}},getColumnsWidth:function(){for(var a=this,b=(a.widget,a.getColumns()),c=0,d=0,e=b.length;e>d;d++){var f=b[d];c+=f.width}return c},getColumns:function(){var a,b=this,c=b.widget;switch(b.side){case"left":a=c.leftColumns;break;case"center":a=c.columns;break;case"right":a=c.rightColumns}return a},getDomCell:function(a){var b=this;return b.el.select(".fancy-grid-header-cell").item(a)},onCellClick:function(a){var b=this,c=b.widget,d=a.currentTarget,e=parseInt(Fancy.get(d).attr("index"));c.fire("headercellclick",{e:a,side:b.side,cell:d,index:e})},onCellMouseMove:function(a){var b=this,c=b.widget,d=a.currentTarget,e=parseInt(Fancy.get(d).attr("index"));c.fire("headercellmousemove",{e:a,side:b.side,cell:d,index:e})},onMouseDown:function(a){var b=Fancy.get(a.target);"INPUT"===b.prop("tagName")||a.preventDefault()},onCellMouseDown:function(a){var b=this,c=b.widget,d=a.currentTarget,e=parseInt(Fancy.get(d).attr("index"));c.fire("headercellmousedown",{e:a,side:b.side,cell:d,index:e})},scroll:function(a){var b=this;b.scrollLeft=a,b.setCellsPosition()},getGroupingCellsHTML:function(a){var b=this,c=b.widget,d="";for(var e in a){var f=a[e];d+=b.cellTpl.getHTML({cls:"fancy-grid-header-cell-group-level-2",columnName:f.text,columnWidth:f.width,index:e,height:c.cellHeaderHeight+"px",left:f.left+"px",groupIndex:""})}return d},destroy:function(){var a=this;a.el.un("click",a.onCellClick,a,"div.fancy-grid-header-cell"),
a.el.un("mousemove",a.onCellMouseMove,a,"div.fancy-grid-header-cell"),a.el.un("mousedown",a.onCellMouseDown,a,"div.fancy-grid-header-cell"),a.el.un("mousedown",a.onMouseDown,a)},getCell:function(a){var b=this;return b.el.select('.fancy-grid-header-cell[index="'+a+'"]')}});