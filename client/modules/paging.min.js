Fancy.modules.paging=!0,Fancy.Mixin("Fancy.store.mixin.Paging",{initPaging:function(){var a=this;void 0!==a.paging&&(Fancy.isObject(a.paging)&&Fancy.apply(a,a.paging),a.calcPages())},firstPage:function(){var a=this;a.calcPages(),a.showPage=0,"server"===a.pageType?a.loadPage():a.changeDataView({stoppedFilter:!0})},prevPage:function(){var a=this;a.calcPages(),a.showPage--,a.showPage<0&&(a.showPage=0),"server"===a.pageType?a.loadPage():a.changeDataView({stoppedFilter:!0})},nextPage:function(){var a=this;a.calcPages(),a.showPage++,a.showPage===a.pages&&a.showPage--,a.showPage<0&&(a.showPage=0),"server"===a.pageType?a.loadPage():a.changeDataView({stoppedFilter:!0})},lastPage:function(){var a=this;a.calcPages(),a.showPage=a.pages-1,a.showPage<0&&(a.showPage=0),"server"===a.pageType?a.loadPage():a.changeDataView({stoppedFilter:!0})},calcPages:function(){var a,b=this,c=b.widget;switch(c.paging.pageOverFlowType){case void 0:case"last":a="last";break;case"first":a="first"}if("server"===b.pageType){if(b.pages=Math.ceil(b.getTotal()/b.pageSize),!isNaN(b.showPage)&&b.showPage>b.pages)return"last"===a?(b.showPage=Math.floor(b.getTotal()/b.pageSize)-1,b.showPage<0&&(b.showPage=0)):b.showPage=0,"needs reload"}else b.pages=Math.ceil(b.getTotal()/b.pageSize);b.showPage>=b.pages&&(b.showPage="last"===a?b.pages-1:0),b.showPage<0&&(b.showPage=0),b.fire("changepages",b.showPage)},setPage:function(a,b){var c=this;c.showPage=a,c.showPage===c.pages&&c.showPage--,c.showPage<0&&(c.showPage=0),"server"===c.pageType?c.loadPage():!1!==b&&c.changeDataView({stoppedFilter:!0})},refresh:function(){var a=this;"server"===a.pageType?a.loadPage():a.changeDataView({stoppedFilter:!0})},processPagingData:function(a){var b=this,c=b.widget;void 0!==a.totalCount&&(b.totalCount=a.totalCount),b.checkPagingType(a),!1===b.proxy.wrapper||void 0===a[b.readerRootProperty]?b.setData(a):b.setData(a[b.readerRootProperty]),c.stateIsWaiting?b.calcPages():(b.changeDataView({stoppedFilter:!0}),"needs reload"===b.calcPages()&&b.loadPage())},checkPagingType:function(a){var b=this;void 0!==a.totalCount&&a.totalCount!==a[b.readerRootProperty].length&&(b.totalCount=a.totalCount,b.pageType="server",void 0===b.remoteSort&&(b.remoteSort=!0))},loadPage:function(){this.loadData()},setPageSize:function(a){var b=this,c=b.widget;b.pageSize=a,b.calcPages(),"server"===b.pageType?b.loadPage():b.changeDataView({stoppedFilter:!0}),c.fire("changepagesize",a)}}),function(){var a=Fancy,b=a.PANEL_TBAR_CLS,c=a.PANEL_BBAR_CLS,d=a.PANEL_BAR_PAGING_CLS;Fancy.define("Fancy.grid.plugin.Paging",{extend:Fancy.Plugin,ptype:"grid.paging",inWidgetName:"paging",barType:"bbar",constructor:function(){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.ons()},ons:function(){var a=this,b=a.widget,c=b.store;c.on("change",a.onChangeStore,a),c.on("remove",a.onChangeStore,a),c.on("filter",a.onChangeStore,a),b.on("render",a.onRenderGrid,a),b.on("docmove",a.onDocMouseMove,a),b.on("render",function(){a.setCls()})},setPageSize:function(a){this.widget.store.setPageSize(a),this.widget.update()},nextPage:function(){this.widget.store.nextPage(),this.widget.update()},lastPage:function(){this.widget.store.lastPage(),this.widget.update()},prevPage:function(){this.widget.store.prevPage(),this.widget.update()},firstPage:function(){this.widget.store.firstPage(),this.widget.update()},onChangeStore:function(a){var b,c=this,d=c.widget,e=d.store,f=d.panel;switch(c.barType){case"both":b=f._bbar.roles.pagenumber,b.setValue(e.showPage+1),b=f._tbar.roles.pagenumber,b.setValue(e.showPage+1),c.updateBar("tbar"),c.updateBar("bbar");break;case"none":case!1:break;default:b=f["_"+c.barType].roles.pagenumber,b.setValue(e.showPage+1),c.updateBar()}d.setSidesHeight(),void 0===c.$prevPage?d.fire("changepage",a.showPage):c.$prevPage!==a.showPage&&d.fire("changepage",a.showPage),c.$prevPage=a.showPage},setPage:function(a,b){var c=this,d=c.widget,e=d.store;return a<0?a=0:a>e.pages&&(a=e.pages),e.setPage(a,b),a},refresh:function(){var a=this,b=a.widget,c=b.store;b.showLoadMask(),setTimeout(function(){c.refresh(),"server"!==c.pageType&&b.hideLoadMask()},200)},updateBar:function(a){a=a||this.barType;var b=this,c=b.widget,d=c.store,e=d.showPage,f=d.pageSize,g=d.pages,h=c.panel,i=h["_"+a],j=i.roles,k=j.pagenumber,l=j.ofText,m=j.info,n=j.first,o=j.prev,p=j.next,q=j.last,r=e*f+1,s=r+f-1,t=d.getTotal()||0,u=c.lang;s>t&&(s=t),0===s&&(r=0),r>s&&(s=r),k.setValue(d.showPage+1),l.el.update(Fancy.String.format(u.paging.of,[g||1])),m.el.update(Fancy.String.format(u.paging.info,[r,s,t])),0===e?(n.disable(),o.disable()):(n.enable(),o.enable()),g-1===e||0===g?(q.disable(),p.disable()):(q.enable(),p.enable()),parseInt(c.el.css("width"))<350&&(m.hide(),i.checkScroll())},onRenderGrid:function(){var a=this;switch(a.barType){case"both":a.updateBar("tbar"),a.updateBar("bbar");break;case"none":case!1:break;default:a.updateBar()}},onDocMouseMove:function(){var a=this,b=a.widget;"none"===b.el.css("display")||b.panel&&b.panel.el&&"none"===b.panel.el.css("display")?a.wasHidden||(Fancy.combo.Manager.hideLists(),a.wasHidden=!0):a.wasHidden=!1},update:function(){var a=this,b=a.widget,c=b.store;c.calcPages(),a.onChangeStore(c)},setCls:function(){var a=this,e=a.widget;switch(a.barType){case"bbar":e.panel.el.select("."+c).addCls(d);break;case"tbar":e.panel.el.select("."+b).addCls(d);break;case"both":e.panel.el.select("."+c).addCls(d),e.panel.el.select("."+b).addCls(d)}}})}();