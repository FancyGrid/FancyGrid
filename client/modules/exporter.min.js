Fancy.modules.exporter=!0,Fancy.define("Fancy.grid.plugin.Exporter",{extend:Fancy.Plugin,ptype:"grid.exporter",inWidgetName:"exporter",csvSeparator:",",csvHeader:!1,csvFileName:"export",excelFileName:"export",constructor:function(){this.Super("const",arguments),Fancy.fullBuilt&&Fancy.loadModule("excel")},init(){},exportToExcel(e={}){const t=this,a=t.widget,n=t.getColumnsData(e),r=t.getData(e),s=!1===e.header?r:[n].concat(r),o=function(){if(!(this instanceof o))return new o;this.SheetNames=[],this.Sheets={}},c=new o,i=t.sheet_from_array_of_arrays(s);i["!cols"]=[],Fancy.each(t.widths,e=>{i["!cols"].push({wch:e})});var l=a.title;e.fileName?l=e.fileName:Fancy.isObject(l)&&(l=l.text);const d=l||t.excelFileName;c.SheetNames.push(d),c.Sheets[d]=i;const h=window.XLSX.write(c,{bookType:"xlsx",bookSST:!0,type:"binary"});window.saveAs(new Blob([function(e){for(var t=new ArrayBuffer(e.length),a=new Uint8Array(t),n=0;n!=e.length;++n)a[n]=255&e.charCodeAt(n);return t}(h)],{type:"application/octet-stream"}),d+".xlsx")},getColumnsData(e){var t,a=this,n=a.widget.getColumns(),r=[];return a.widths=[],e&&e.indexes&&(t={},Fancy.each(e.indexes,e=>{t[e]=!0})),Fancy.each(n,e=>{t&&!0!==t[e.index]||a.isColumnExportable(e)&&(a.widths.push(e.width),r.push(e.title||""))}),r},getData(e={}){if(e&&e.data)return e.data;const t=this.widget,a=[],n=e.all?t.getDisplayedData(!0,e.ignoreRender,e.rowIds,!0,e.selection):t.getDisplayedData(null,e.ingoreRender,e.rowIds,!0,e.selection);return Fancy.each(n,e=>{var t=[];Fancy.each(e,function(e){t.push(e)}),a.push(t)}),a},sheet_from_array_of_arrays(e){var t={},a={s:{c:1e7,r:1e7},e:{c:0,r:0}},n=0,r=e.length;for(;n!=r;++n)for(var s=0;s!=e[n].length;++s){a.s.r>n&&(a.s.r=n),a.s.c>s&&(a.s.c=s),a.e.r<n&&(a.e.r=n),a.e.c<s&&(a.e.c=s);var o={v:e[n][s]};if(null==o.v)continue;const r=window.XLSX.utils.encode_cell({c:s,r:n});"number"==typeof o.v?o.t="n":"boolean"==typeof o.v?o.t="b":o.v instanceof Date?(o.t="n",o.z=window.XLSX.SSF._table[14],o.v=(c=o.v,void 0&&(c+=1462),(Date.parse(c)-new Date(Date.UTC(1899,11,30)))/864e5)):o.t="s",t[r]=o}var c;return a.s.c<1e7&&(t["!ref"]=window.XLSX.utils.encode_range(a)),t},getDataAsCsv(e={}){var t,a=this,n=a.widget,r=a.getData(e),s="",o=e.separator||a.csvSeparator,c=e.header||a.csvHeader;if(e&&e.indexes&&(t={},Fancy.each(e.indexes,e=>{t[e]=!0})),c){const e=function(e){t&&!0!==t[e.index]||a.isColumnExportable(e)&&(s+='"'+(e.title||"")+'"'+o)};Fancy.each(n.leftColumns,e),Fancy.each(n.columns,e),Fancy.each(n.rightColumns,e),s=s.substring(0,s.length-1),s+="\r\n"}return Fancy.each(r,e=>{Fancy.each(e,e=>{Fancy.isString(e)&&(e='"'+e+'"'),s+=e+o}),s=s.substring(0,s.length-1),s+="\r\n"}),s},exportToCSV(e={}){const t=this.getDataAsCsv(e),a=e.fileName||this.csvFileName,n=new Blob([t],{type:"text/csv;charset=utf-8;"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(n,a);else{const e=document.createElement("a");e.href=window.URL.createObjectURL(n),e.download=a+".csv",document.body.appendChild(e),e.click(),document.body.removeChild(e)}},isColumnExportable(e){if(/spark/.test(e.type))return!1;switch(e.type){case"select":case"action":case"expand":case"grossloss":case"hbar":case"rowdrag":return!1}return!e.hidden&&!1!==e.exportable}});