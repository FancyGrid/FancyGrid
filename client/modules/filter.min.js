Fancy.modules.filter=!0,Fancy.Mixin("Fancy.store.mixin.Filter",{filterCheckItem(e){var t=this,r=t.widget,i=r.filterCaseSensitive,a=Fancy.Object.copy(t.filters),l=!0,s=!1,n=!1;if(void 0===e.data&&(e=new Fancy.Model(e)),t.isTree){const r=e.get("child");if(r){const i=[];if(Fancy.each(r,e=>{const r=e.data?e:new t.model(e);t.filterCheckItem(r)&&i.push(e)}),e.set("filteredChild",i),i.length)return!0}}for(var o in a){var d=r.getColumnByIndex(o),c=a[o],u=e.data[o];if(d&&d.filter&&d.filter.fn)return d.filter.fn(u,a,e);if(t.smartIndexes&&t.smartIndexes[o])u=t.smartIndexes[o](e.data);else if(/\./.test(o)){var h=o.split(".");u=e.data[h[0]][h[1]]}for(var g in"date"===c.type&&(u=null===u?Number.NEGATIVE_INFINITY:Number(Fancy.Date.parse(u,c.format.read,c.format.mode))),!i&&Fancy.isString(u)&&(u=u.toLocaleLowerCase()),c){switch(g){case"type":case"format":continue}var m=c[g];switch(!i&&Fancy.isString(m)&&(m=m.toLocaleLowerCase()),g){case"<":l=Number(u)<Number(m);break;case">":l=Number(u)>Number(m);break;case"<=":l=Number(u)<=Number(m);break;case">=":l=Number(u)>=Number(m);break;case"<>":var f=!1;for(var p in m){var F=m[p];switch(p){case"<":Number(u)<Number(F)&&(f=!0);break;case">":Number(u)>Number(F)&&(f=!0);break;case"<=":Number(u)<=Number(F)&&(f=!0);break;case">=":Number(u)>=Number(F)&&(f=!0)}}l=f;break;case"=":case"==":Fancy.isArray(m)?(Fancy.each(m,function(e,t){m[t]=String(e)}),u=String(u),l=-1!==m.indexOf(u)):l=u==m;break;case"===":Fancy.isArray(m)?(u=String(u),l=-1!==m.indexOf(u)):l=u===m;break;case"!==":l=u!==m;break;case"!=":Fancy.isArray(m)?(Fancy.each(m,function(e,t){m[t]=String(e)}),u=String(u),l=-1===m.indexOf(u)):l=u!=m;break;case"":var b=function(e,r){return e=String(e).toLocaleLowerCase(),r=String(r).toLocaleLowerCase(),e=t.replaceSpecialSigns(e),new RegExp(e).test(r)};if(Fancy.isArray(m))for(var y=0,C=m.length;y<C&&!1!==(l=b(m[y],u));y++);else l=b(m,u);break;case"*":m=String(m).toLocaleLowerCase(),m=t.replaceSpecialSigns(m),(l=new RegExp(m).test(String(u).toLocaleLowerCase()))&&(n=!0),s=!0;break;case"|":l=!0===m[String(u).toLocaleLowerCase()];break;case"fn":l=!0===m(u,e);break;default:throw new Error("[FancyGrid Error 5]: Unknown filter "+g)}if("*"!==g&&!1===l)return!1}}return(!0!==s||!1!==n)&&(!0!==s||!0!==l||!1!==n)},filterData(e){var t=this,r=t.widget,i=t.data,a=[],l=0,s=i.length,n=[],o=[];if(t.remoteFilter)r.UPDATING_AFTER_LOAD||t.serverFilter(!0!==r.stateIsWaiting);else{for(t.filteredDataMap={};l<s;l++)t.order?(n.push(t.order[l]),o=i[t.order[l]]):(n.push(l),o=i[l]),t.filterCheckItem(o)&&(a.push(o),t.filteredDataMap[o.id]=o);t.filterOrder=n,t.filteredData=a,t.paging&&t.calcPages(),!1!==e&&t.fire("filter")}},serverFilter(e){var t=this,r="[",i=t.filters||{};for(var a in i){var l=i[a];for(var s in l){switch(s){case"type":case"format":continue}const e=t.filterOperators[s];if("or"===e){var n=[];for(var o in l[s])n.push(o);r+='{"operator":"'+e+'","value":"'+n.join(", ")+'","property":"'+a+'"},'}else r+='{"operator":"'+e+'","value":"'+l[s]+'","property":"'+a+'"},'}}r=r.replace(/\,$/,""),r+="]",t.params=t.params||{},"[]"===r?(r="",delete t.params[t.filterParam]):t.params[t.filterParam]=r,!1!==e&&t.loadData()},hasFilters(){const e=this;if(!e.filters)return!1;for(const t in e.filters)return!0;return!1},"combineÐ¡omparisonSigns"(e){for(const t in e){const r=Fancy.Object.copy(e[t]);for(const e in r)switch(e){case"<":case">":case"<=":case">=":r["<>"]=r["<>"]||{},r["<>"][e]=r[e],delete r[e]}e[t]=r}return e},replaceSpecialSigns:e=>e=(e=(e=(e=(e=(e=(e=e.replace(/\\/g,"\\\\")).replace(/\(/g,"\\(")).replace(/\)/g,"\\)")).replace(/\[/g,"\\[")).replace(/\]/g,"\\]")).replace(/\+/g,"\\+")).replace(/\-/g,"\\-")}),Fancy.modules.filter=!0,function(){const e=Fancy,t=e.FIELD_CLS,r=e.FIELD_CHECKBOX_CLS,i=e.GRID_HEADER_CELL_DOUBLE_CLS,a=e.GRID_HEADER_CELL_TRIPLE_CLS,l=e.GRID_HEADER_CELL_FILTER_CLS,s=e.GRID_HEADER_CELL_FILTER_FULL_CLS,n=e.GRID_HEADER_CELL_FILTER_SMALL_CLS,o=e.GRID_HEADER_CELL_FILTERED_CLS,d=e.GRID_HEADER_CELL_CLS,c=e.GRID_SUB_HEADER_FILTER_CLS,u=e.GRID_SUB_HEADER_FILTER_CONTAINER_CLS;e.define("Fancy.grid.plugin.Filter",{extend:e.Plugin,ptype:"grid.filter",inWidgetName:"filter",autoEnterDelay:500,constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){const e=this,t=e.widget;t.once("render",()=>{e.render(),e.waitForComboData&&t.on("load",e.onLoadData,e)}),t.on("columnresize",e.onColumnResize,e),t.on("filter",e.onFilter,e),t.on("lockcolumn",e.onLockColumn,e),t.on("rightlockcolumn",e.onRightLockColumn,e),t.on("unlockcolumn",e.onUnLockColumn,e),t.on("columndrag",e.onColumnDrag,e),t.subHeaderFilter&&(t.on("columnhide",e.onColumnHide,e),t.on("columnshow",e.onColumnShow,e))},render(){const e=this,t=e.widget;t.header&&(t.subHeaderFilter?(e._renderSubHeaderFieldsContainer("left"),e._renderSubHeaderFieldsContainer("center"),e._renderSubHeaderFieldsContainer("right"),e.renderedContainers=!0):(e._renderSideFields(t.header,t.columns),e._renderSideFields(t.leftHeader,t.leftColumns),e._renderSideFields(t.rightHeader,t.rightColumns)))},_renderSubHeaderFieldsContainer(e){var t,r=this,i=r.widget,a=i.getHeader(e),l=i.cellHeight;if(!r.renderedContainers){switch((t=r.generateFilterRow(e)).css("height",l),t.firstChild().css("height",l),e){case"left":r.filterElLeft=t;break;case"center":r.filterElCenter=t;break;case"right":r.filterElRight=t}a.el.after(t.dom)}r._renderSubHeaderFields(e)},addSubHeaderFilterCellContainer(e){const t=this.widget,r=t.cellHeight,i=t.getSideEl(e).select(`.${c}`),a=document.createElement("div");a.className=d,a.style.height=r+"px",i.append(a)},generateFilterRow(t){var r=this.widget,i=r.cellHeight,a=r.getColumnsWidth(t),l=e.get(document.createElement("div")),s="";e.each(r.getColumns(t),(e,t)=>{var r="";e.hidden&&(r="display: none"),s+=['<div index="'+t+'" style="width:'+e.width+"px;height:"+i+"px;"+r+'" class="'+d+'">',"</div>"].join("")});var n=['<div style="position: relative;" class="'+c+'">',s,"</div>"].join("");return l.update(n),l.select(`.${c}`).css("width",a+"px"),l.addCls(u),l},_renderSideFields(e,t){for(var r,s,n=this,o=0,d=t.length;o<d;o++)s=t[o],r=e.getCell(o),s.filter&&s.filter.header?(n.renderFilter(s.type,s,r),n.groupHeader&&!s.grouping&&r.addCls(a),r.addCls(l)):n.header&&(n.groupHeader&&!s.grouping?r.addCls(a):s.grouping&&n.groupHeader?r.addCls(i):s.grouping||r.addCls(i))},_renderSubHeaderFields(r){var i,a,s=this.widget.getColumns(r),n=this.getSubHeaderFilterEl(r).select(`.${d}`),o=0,c=s.length;if(0!==n.length)for(;o<c;o++)a=s[o],i=n.item(o),a.filter&&a.filter.header&&(i.select(`.${t}`).each(t=>{e.getWidget(t.id).destroy()}),i.update(""),this.renderFilter(a.type,a,i),i.addCls(l))},_clearColumnsFields(r,i,a,l){var s,n,o=this.widget,c=0,u=r.length;o.subHeaderFilter&&(n=this.getSubHeaderFilterEl(i.side).select("."+d));for(;c<u;c++)if((s=r[c]).filter&&s.filter.header){if(a&&s.index!==a)continue;switch(s.type){case"date":var h,g,m;h=o.subHeaderFilter?n.item(c).select("."+t):i.getCell(c).select("."+t),g=e.getWidget(h.item(0).attr("id")),m=e.getWidget(h.item(1).attr("id")),g.clear(),m.clear();break;default:var f=(o.subHeaderFilter?n.item(c):i.getCell(c)).select("."+t).attr("id"),p=e.getWidget(f);if(l){var F=p.get().split(",");if(F.length<2&&!l)p.clear();else{for(var b=0,y=F.length,C="";b<y;b++){var v=F[b];new RegExp(l).test(v)||(C+=v+",")}","===C[C.length-1]&&(C=C.substring(0,C.length-1)),p.set(C)}}else p.clear()}}},clearColumnsFields(e,t){const r=this.widget;this._clearColumnsFields(r.columns,r.header,e,t),this._clearColumnsFields(r.leftColumns,r.leftHeader,e,t),this._clearColumnsFields(r.rightColumns,r.rightHeader,e,t)},_addValuesInColumnFields(r,i,a,l,s){var n,o,c=this.widget,u=0,h=r.length;if(c.subHeaderFilter){o=this.getSubHeaderFilterEl(i.side).select("."+d)}for(;u<h;u++)if((n=r[u]).index===a&&n.filter&&n.filter.header)switch(n.type){case"date":var g;g=c.subHeaderFilter?o.item(u).select("."+t):i.getCell(u).select("."+t);const r=e.getWidget(g.item(0).attr("id")),d=e.getWidget(g.item(1).attr("id"));switch(s){case">":case">=":r.set(new Date(l));break;case"<":case"<=":d.set(new Date(l))}break;case"combo":var m=(c.subHeaderFilter?o.item(u):i.getCell(u)).select("."+t).attr("id"),f=e.getWidget(m);e.isArray(l),f.set(l);break;default:var p=c.getFilter(a),F="";for(var b in p){var y=p[b];F+=b,e.isArray(y)?e.each(y,(e,t)=>{F+=e,y.length-1!==t&&(F+=",")}):F+=y,F+="&"}"&"===F[F.length-1]&&(F=F.substring(0,F.length-1));m=(c.subHeaderFilter?o.item(u):i.getCell(u)).select("."+t).attr("id");(f=e.getWidget(m)).set(F)}},addValuesInColumnFields(t,r,i){const a=this.widget;void 0!==r&&null!==r&&0!==r.length&&(e.isFunction(r)||(this._addValuesInColumnFields(a.columns,a.header,t,r,i),this._addValuesInColumnFields(a.leftColumns,a.leftHeader,t,r,i),this._addValuesInColumnFields(a.rightColumns,a.rightHeader,t,r,i)))},renderFilter(t,r,i){var a,l=this,s=l.widget,n=s.store,o={position:"absolute",bottom:"3px"},d=r.filter,c=s.theme,u=d.tip,h="",g=n.filters[r.index];if(g)if("date"===g.type)h=[g[">="],g["<="]];else for(const e in g){const t=g[e];switch(e){case"":h+=t;break;default:if("combo"===r.type)if(h=h||[],Fancy.isObject(t))for(const e in t)h.push(e);else h.push(t);else h+=e+t+","}}if(","===h[h.length-1]&&(h=h.substring(0,h.length-1)),Fancy.isObject(d.header)){const t=d.header;e.apply(t,{renderTo:i.dom,label:!1,style:o,theme:c,widget:s,tip:u,value:h,padding:!1});const l={combo:"Combo"};"combo"===t.type&&e.apply(t,{width:r.width-8,height:28,multiSelect:r.multiSelect,itemCheckBox:r.itemCheckBox,minListWidth:r.minListWidth,listItemTpl:r.listItemTpl});const n=l[t.type];a=new e[n](t)}else switch(t){case"date":(m=[]).push({change:l.onDateChange,scope:l}),a=new e.DateRangeField({renderTo:i.dom,format:r.format,label:!1,padding:!1,style:o,events:m,width:r.width-8,emptyText:d.emptyText,dateImage:!1,value:h,theme:c});break;case"string":var m=[{enter:l.onEnter,scope:l}];!1!==l.autoEnterDelay&&m.push({key:l.onKey,scope:l}),a=new e.StringField({renderTo:i.dom,label:!1,padding:!1,style:o,events:m,emptyText:d.emptyText,tip:u,value:h,widget:s});break;case"number":case"grossloss":case"progressbar":case"progressdonut":m=[{enter:l.onEnter,scope:l}];!1!==l.autoEnterDelay&&m.push({key:l.onKey,scope:l}),a=new e.NumberField({renderTo:i.dom,label:!1,padding:!1,style:o,emptyText:d.emptyText,events:m,widget:s,value:h,tip:u});break;case"combo":var f,p,F="text",b="text";void 0!==r.displayKey&&(F=r.displayKey,b=r.valueKey||F),e.isObject(r.data)||e.isObject(r.data[0])?f=r.data:0===(f=l.configComboData(r.data)).length&&(r.waitForComboData=!0),r.filter&&r.filter.selectAll&&(p=r.filter.selectAll),a=new e.Combo({renderTo:i.dom,label:!1,padding:!1,style:o,width:r.width-8,displayKey:F,valueKey:b,value:h,height:28,emptyText:d.emptyText,theme:c,widget:s,tip:u,multiSelect:r.multiSelect,itemCheckBox:r.itemCheckBox,minListWidth:r.minListWidth,listItemTpl:r.listItemTpl,selectAllText:p,subSearch:r.subSearch,events:[{change:l.onEnter,scope:l},{empty(){this.set(-1)}}],data:f});break;case"select":s.selection&&/row/.test(s.selection.selModel)&&(a=new e.Combo({renderTo:i.dom,label:!1,padding:!1,style:o,displayKey:"text",valueKey:"value",width:r.width-8,emptyText:d.emptyText,value:h,editable:!1,subSearch:!1,events:[{change:l.onEnterSelect,scope:l}],data:[{value:"",text:""},{value:"false",text:s.lang.no},{value:"true",text:s.lang.yes}]}));break;case"checkbox":case"switcher":a=new e.Combo({theme:c,renderTo:i.dom,label:!1,padding:!1,style:o,displayKey:"text",valueKey:"value",width:r.width-8,emptyText:d.emptyText,value:h,editable:!1,subSearch:!1,events:[{change:l.onEnter,scope:l}],data:[{value:"",text:""},{value:"false",text:s.lang.no},{value:"true",text:s.lang.yes}]});break;default:m=[{enter:l.onEnter,scope:l}];!1!==l.autoEnterDelay&&m.push({key:l.onKey,scope:l}),a=new e.StringField({renderTo:i.dom,label:!1,style:o,padding:!1,value:h,emptyText:d.emptyText,events:m})}switch(a.filterIndex=r.index,a.column=r,"date"!==t&&(a.el.css("padding-left","4px"),a.el.css("padding-top","0px")),t){case"checkbox":case"combo":case"date":break;default:a.setInputSize({width:r.width-8})}r.filterField=a},onEnter(t,r){const i=this.widget;if(clearInterval(this.intervalAutoEnter),delete this.intervalAutoEnter,i.isRequiredChangeAllMemorySelection()&&(i.selection.memory.selectAllFiltered(),setTimeout(()=>{i.selection.updateHeaderCheckBox()},1)),0===r.length)return void i.clearFilter(t.filterIndex);const a=this.processFilterValue(r,t.column.type);if(i.clearFilter(t.filterIndex,null,!1),1===a.length)i.addFilter(t.filterIndex,a[0].value,a[0].operator,!1);else{const r=[];e.each(a,function(e){switch(e.operator){case"":case"=":r.push(e.value);break;default:i.addFilter(t.filterIndex,e.value,e.operator,!1)}}),r.length&&i.addFilter(t.filterIndex,r,"=",!1)}},onEnterOld(t,r,i){const a=this,l=a.widget,s=l.store,n=t.filterIndex;if(i=i||{},clearInterval(a.intervalAutoEnter),delete a.intervalAutoEnter,0===r.length)return s.filters[t.filterIndex]={},a.clearFilter(t.filterIndex,void 0,!1),a.updateStoreFilters(),void(l.grouping&&l.grouping.by&&l.grouping.reGroup());var o=a.processFilterValue(r,t.column.type),d=0,c=o.length;for(s.filters[n]={};d<c;d++){const r=o[d];""===r.operator&&t.column.filter&&t.column.filter.operator&&(r.operator=t.column.filter.operator),"&"===r.separator?e.isArray(s.filters[n][r.operator])?s.filters[n][r.operator].push(r.value):s.filters[n][r.operator]=[r.value]:s.filters[n][r.operator]=r.value,r.operator,"date"===t.column.type&&e.apply(s.filters[n],i)}s.remoteFilter?(s.once("serversuccess",()=>{l.fire("filter",s.filters)}),s.serverFilter()):a.updateStoreFilters(),l.grouping&&l.grouping.by&&(s.remoteSort?s.once("load",()=>{l.grouping.reGroup(),l.fire("filter",s.filters)}):l.grouping.reGroup()),l.setSidesHeight()},onEnterSelect(e,t){const r=this.widget,i=r.getSelection(),a=[];this.isRequiredChangeAllMemorySelection()&&(r.selection.memory.selectAllFiltered(),setTimeout(()=>{r.selection.updateHeaderCheckBox()},1)),Fancy.each(i,e=>{a.push(e.id)}),t===String(!0)?a.length?r.addFilter("id",a,"="):(r.clearFilter("id","="),r.clearFilter("id","!=")):t===String(!1)?(r.clearFilter("id","="),r.addFilter("id",a,"!=")):r.clearFilter("id")},processFilterValue(t,r){var i,a,l,s,n,o={"<":!0,">":!0,"!":!0,"=":!0,"|":!0},d=0,c=[];if(e.isArray(t))return a={},e.Array.each(t,e=>{a[String(e).toLocaleLowerCase()]=!0}),c.push({operator:"|",value:a}),c;var u=",";for(/\&/.test(t)&&(u="&"),s=0,n=(l=t.split(u)).length;s<n;s++){for(d=0,i="",a=l[s];d<3;d++)o[a[d]]&&(i+=a[d]);if(!((a=a.replace(new RegExp("^"+i),"")).length<1)){switch(r){case"number":a=Number(a);break;case"combo":i="=";break;case"date":isNaN(Number(a))||(a=new Date(Number(a)))}c.push({operator:i,value:a,separator:u})}}return c},updateStoreFilters(e){var t=this.widget,r=t.store,i=!1;t.filtering=!0;for(const e in r.filters){if(r.filters[e]){i=!0;break}}i||delete r.filteredData,!1!==e?(r.grouping&&r.grouping.by?(r.isFiltered()&&r.filterData(),this.reGroupAccordingToFilters(),r.changeDataView()):r.changeDataView(),!0===t.waitingForFilters||!t.inited&&t.state&&t.state.startState&&t.state.startState.filters||(t.update(),t.fire("filter",r.filters),t.setSidesHeight())):r.changeDataView(),i||(delete r.filteredData,delete r.filteredDataMap,delete r.filterOrder),delete t.filtering},forceUpdateStoreFilters(){const e=this.widget,t=e.store;t.changeDataView(),e.update(),e.fire("filter",t.filters),e.setSidesHeight()},onColumnResize(i,a){var l,s=this.widget,n=e.get(a.cell),o=a.width,c=n.select(`:not(.${r}).${t}`);if(s.subHeaderFilter){const e=n.attr("index");c=(n=this.getSubHeaderFilterEl(a.side).select(`.${d}`).item(e)).select(`:not(.${r}).${t}`)}c.length,0===c.length||(2===c.length?((l=e.getWidget(c.item(0).dom.id)).setWidth((o-8)/2),(l=e.getWidget(c.item(1).dom.id)).setWidth((o-8)/2)):(l=e.getWidget(c.dom.id))&&("field.combo"===l.wtype?(l.size({width:o-8}),l.el.css("width",o-8+5)):l.setInputSize({width:o-8}))),s.subHeaderFilter&&this.updateSubHeaderFilterSizes(a.side)},updateSubHeaderFilterSizes(t){const r=this,i=r.widget;if(!t)return r.updateSubHeaderFilterSizes("center"),i.leftColumns.length&&r.updateSubHeaderFilterSizes("left"),void(i.rightColumns.length&&r.updateSubHeaderFilterSizes("right"));var a=r.getSubHeaderFilterEl(t),l=a.select(`.${d}`),s=0,n=i.getColumns(t),o=e.ANIMATE_DURATION;e.each(n,(e,t)=>{s+=e.width;const r=l.item(t);e.hidden?r.css("display","none"):r.css("display",""),r.animate({width:e.width},o)}),a.firstChild().css({width:s})},removeSubHeaderCell(e,t){this.getSubHeaderFilterEl(e).select(`.${d}`).item(t).destroy()},getSubHeaderFilterEl(e){switch(e){case"left":return this.filterElLeft;case"center":return this.filterElCenter;case"right":return this.filterElRight}},onKey(t,r,i){const a=this;i.keyCode!==e.key.ENTER&&(a.autoEnterTime=+new Date,a.intervalAutoEnter||(a.intervalAutoEnter=setInterval(()=>{const e=new Date;a.intervalAutoEnter&&e-a.autoEnterTime>a.autoEnterDelay&&(clearInterval(a.intervalAutoEnter),delete a.intervalAutoEnter,r=t.getValue(),a.onEnter(t,r))},200)))},onDateChange(t){var r,i,a,l=this,s=l.widget,n=t.format,o=s.store,d=t.dateField1.getDate(),c=t.dateField2.getDate(),u="Invalid Date"!==d.toString()&&e.isDate(d),h="Invalid Date"!==c.toString()&&e.isDate(c),g=o.remoteFilter;u&&(d=new Date(d.getFullYear(),d.getMonth(),d.getDate())),h&&(c=new Date(c.getFullYear(),c.getMonth(),c.getDate())),u&&h?(!0!==g?(i=Number(d),a=Number(c)):(i=e.Date.format(d,n.edit,n.mode),a=e.Date.format(c,n.edit,n.mode)),r=">="+i+",<="+a):u?(r=!0!==g?">="+Number(d):">="+e.Date.format(d,n.edit,n.mode),l.clearFilter(t.filterIndex,"<=",!1)):h?(r=!0!==g?"<="+Number(c):"<="+e.Date.format(c,n.edit,n.mode),l.clearFilter(t.filterIndex,">=",!1)):l.clearFilter(t.filterIndex),r&&l.onEnter(t,r,{type:"date",format:t.format})},clearFilter(e,t,r){const i=this,a=i.widget.store;a._clearedFilter=!0,setTimeout(()=>{delete a._clearedFilter},1),void 0===t?delete a.filters[e]:a.filters[e]&&delete a.filters[e][t],!1!==r&&i.updateStoreFilters()},onFilter(e,t){const r=this.widget;if(r.scroll(0),r.header&&t){r.el.select(`.${o}`).removeCls(o);for(const e in t){const t=r.getHeaderCell(e);t&&t.addCls(o)}}},configComboData(t){var r=0,i=t.length,a=[];if(e.isObject(t))return t;for(;r<i;r++)a.push({value:r,text:t[r]});return 0===a.length&&(this.waitForComboData=!0),a},destroyFields(){const t=this.widget;e.each(t.columns,e=>{e.filterField&&(e.filterField.destroy(),delete e.filterField)}),e.each(t.leftColumns,e=>{e.filterField&&(e.filterField.destroy(),delete e.filterField)}),e.each(t.rightColumns,e=>{e.filterField&&(e.filterField.destroy(),delete e.filterField)}),t.el.select(`.${l}`).removeCls(l),t.el.select(`.${s}`).removeCls(s),t.el.select(`.${n}`).removeCls(n),t.el.select(`.${i}`).removeCls(i),t.el.select(`.${a}`).removeCls(a)},onLockColumn(){},onUnLockColumn(){},onRightLockColumn(){},onColumnDrag(){const e=this,t=e.widget;e.updateFields(),t.subHeaderFilter&&e.updateSubHeaderFilterSizes()},updateFields(){this.destroyFields(),this.render()},reGroupAccordingToFilters(){const e=this.widget.grouping;e.initGroups("filteredData"),e.initOrder(),e.reFreshExpanded(),e.updateGroupRows(),e.setCellsPosition(),e.reFreshGroupTexts()},scrollLeft(e){this.filterElCenter&&this.filterElCenter.firstChild().css("left",e)},onColumnHide(){this.updateSubHeaderFilterSizes()},onColumnShow(){this.updateSubHeaderFilterSizes()},onLoadData(){this.updateFilterComboData()},updateFilterComboData(){const e=this.widget,t=e.store;e.getColumns().forEach(r=>{if("combo"===r.type&&r.index&&r.waitForComboData){const i=t.getColumnUniqueData(r.index);e.setColumnComboData(r.index,i)}})}})}(),Fancy.define("Fancy.grid.plugin.Search",{extend:Fancy.Plugin,ptype:"grid.search",inWidgetName:"searching",autoEnterDelay:500,constructor:function(){this.searches={},this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){const e=this;e.widget.once("init",()=>e.generateKeys())},search(e,t){const r=this,i=r.widget,a=i.store,l=i.selection;if(i.isRequiredChangeAllMemorySelection()&&(l.memory.clearAll(),l.memory.selectAllFiltered(),setTimeout(()=>{l.updateHeaderCheckBox()},1)),r.searches={},!e&&!t)return r.clear(),r.updateStoreSearches(),void(i.isGroupable()&&i.grouping.reGroup());!1!==Fancy.isArray(e)||t||(r.searches=e),r.setFilters(),a.remoteSort?a.serverFilter():(r.updateStoreSearches(),setTimeout(()=>{i.fire("filter",a.filters)},1)),i.isGroupable()&&(a.remoteSort?a.once("load",()=>i.grouping.reGroup()):i.grouping.reGroup())},updateStoreSearches(){const e=this.widget;e.store.changeDataView(),e.update()},setKeys(e){this.keys=e,this.setFilters(),this.updateStoreSearches()},generateKeys(){const e=this,t=e.widget;if(e.items)e.keys={},Fancy.each(e.items,t=>{e.keys[t.index]=!0});else if(!e.keys){e.keys={};var r=[];t.columns&&(r=r.concat(t.columns)),t.leftColumns&&(r=r.concat(t.leftColumns)),t.rightColumns&&(r=r.concat(t.rightColumns));var i=[];Fancy.each(r,e=>{const t=e.index;if(!1!==e.searchable){switch(e.type){case"color":case"combo":case"date":case"number":case"string":case"text":case"currency":break;default:return}t&&i.push(t)}}),Fancy.each(i,t=>{"$selected"!==t&&(e.keys[t]=!0)})}return e.keys},setFilters(){const e=this,t=e.widget.store,r=t.filters||{};if(void 0===e.searches||Fancy.isObject(e.searches))e.clear();else{for(const t in e.keys)!1!==e.keys[t]?(r[t]=r[t]||{},r[t]["*"]=e.searches):r[t]&&delete r[t]["*"];t.filters=r}},clear(){var e=this.widget,t=e.store,r=t.filters||{};for(const e in this.keys)void 0!==r[e]&&delete r[e]["*"];t.filters=r,delete this.searches,e.state&&e.state.onFilter()},clearBarField(){var e=this.getSearchField("tbar");e&&e.clear(),(e=this.getSearchField("subTBar"))&&e.clear()},setValueInField(e){var t=this.getSearchField("tbar");t&&t.set(e,!1),(t=this.getSearchField("subTBar"))&&t.set(e,!1)},getSearchField(e){for(var t,r=this.widget[e],i=0,a=(r||[]).length;i<a;i++)if("search"===(t=r[i]).type)return t;return t}});