Fancy.modules.selection=!0,function(){var a=Fancy,b=a.GRID_CELL_CLS,c=a.GRID_CELL_OVER_CLS,d=a.GRID_CELL_SELECTED_CLS,e=a.GRID_CELL_ACTIVE_CLS,f=a.GRID_COLUMN_CLS,g=a.GRID_COLUMN_OVER_CLS,h=a.GRID_COLUMN_SELECT_CLS,i=a.GRID_COLUMN_SELECTED_CLS,j=a.GRID_ROW_OVER_CLS,k=(a.GRID_HEADER_CLS,a.GRID_HEADER_CELL_SELECT_CLS),l=a.GRID_HEADER_CELL_TEXT_CLS,m=a.GRID_COLUMN_TREE_EXPANDER_CLS,n=a.GRID_ACTIVE_CELL_ENABLED,o=a.FIELD_CHECKBOX_CLS,p=a.FIELD_CHECKBOX_ON_CLS,q=a.FIELD_CHECKBOX_INPUT_CLS,r=a.GRID_COPY_TEXTAREA,s=a.FIELD_CHECKBOX_MIDDLE_CLS;a.define("Fancy.grid.plugin.Selection",{extend:a.Plugin,ptype:"grid.selection",inWidgetName:"selection",mixins:["Fancy.grid.selection.mixin.Navigation"],enabled:!0,checkboxRow:!1,checkOnly:!1,memory:!1,disabled:!1,selectLeafsOnly:!1,keyNavigation:!0,allowDeselect:!1,constructor:function(){this.Super("const",arguments)},init:function(){var a=this,b=a.widget;a.Super("init",arguments),a.memory&&a.initMemory(),a.ons(),a.activeCell&&b.once("init",function(){b.el.addCls(n)})},ons:function(){var b=this,c=b.widget;c.once("render",function(){b.initTrackOver(),b.initColumnTrackOver(),b.initCellTrackOver(),b.initCellSelection(),b.initRowSelection(),b.initColumnSelection(),b.keyNavigation&&b.initNavigation(),b.initCopyKeys(),c.on("changepage",b.onChangePage,b),c.on("load",b.onLoad,b),a.nojQuery&&b.initFixTrackOver(),b.initCopyEl()}),c.on("sort",b.onSort,b),c.on("columndrag",b.onColumnDrag,b),c.on("lockcolumn",b.onColumnLock,b),c.on("rightlockcolumn",b.onColumnRightLock,b),c.on("unlockcolumn",b.onUnColumnLock,b),c.on("filter",b.onFilter,b),c.on("expand",b.onExpand,b),c.on("collapse",b.onCollapse,b),c.on("dragrows",b.onDragRows,b),c.on("remove",b.onRemoveRows,b),c.on("treeexpand",b.onTreeExpand,b),c.on("treecollapse",b.onTreeCollapse,b)},initMemory:function(){var b=this,c=b.widget;b.memory={all:!1,exceptedLength:0,selectedLength:0,excepted:{},selected:{},tree:{selected:{},allSelected:{},selectedLength:{}},addDirtyParent:function(d,e,f){if("rows"===b.selModel){var g=c.getById(d),h=g.get("child");if(h)!1!==f?(delete b.memory.tree.selected[d],e&&(b.memory.tree.allSelected[d]||b.memory.tree.selected[d]||b.memory.tree.selectedLength[e]++),b.memory.tree.allSelected[d]=!0,b.memory.tree.selectedLength[d]=h.length,b.memory.clearChild(h)):(h&&(b.memory.tree.selected[d]=!0),b.memory.tree.selectedLength[d]||(b.memory.tree.selectedLength[d]=1));else if(e){b.memory.tree.selected[e]=!0,b.memory.tree.selectedLength[e]=b.memory.tree.selectedLength[e]||0,b.memory.tree.selectedLength[e]++;var i=c.getById(e),j=i.get("child");j.length===b.memory.tree.selectedLength[e]&&(b.memory.tree.allSelected[e]=!0,delete b.memory.tree.selected[e])}if(e){var i=c.getById(e);i.data.parentId&&b.memory.addDirtyParent(e,i.data.parentId,!1),h.length&&b.memory.addDirtyParent(e,i.data.parentId,!1)}if(h){var k=0;a.each(h,function(a){var c=a.id;if(!c)return!0;b.memory.tree.allSelected[c]&&k++}),h.length===k&&(delete b.memory.tree.selected[d],b.memory.tree.allSelected[d]=!0)}}},removeDirtyParent:function(a,d){if("rows"===b.selModel){var e,f=c.getById(d);if(f&&(e=f.get("child")),b.memory.tree.allSelected[a]&&(delete b.memory.tree.allSelected[a],delete b.memory.tree.selectedLength[a]),b.memory.selected[a]&&(delete b.memory.selected[a],b.memory.selectedLength--),delete b.memory.tree.selected[a],b.memory.tree.allSelected[d]&&(delete b.memory.tree.allSelected[d],b.memory.tree.selectedLength[d]=e.length,1!==e.length?b.memory.tree.selected[d]=!0:delete b.memory.tree.selected[d]),b.memory.tree.selectedLength[d]&&b.memory.tree.selectedLength[d]--,0===b.memory.tree.selectedLength[d]){delete b.memory.tree.selected[d],delete b.memory.tree.selectedLength[d];var g=f.get("parentId");g&&b.memory.removeDirtyParent(d,g)}}},clearChild:function(c){a.Array.each(c,function(a){var c=a.id;if(b.memory.tree.selectedLength[c]){b.memory.selected[c]=!0,delete b.memory.tree.allSelected[c],delete b.memory.tree.selected[c],delete b.memory.tree.selectedLength[c];var d=a.get("child");d&&b.memory.clearChild(d)}})},setAll:function(){var d=c.store.filteredDataMap;if(d){b.memory.selectedLength=0;for(var e in d)b.memory.add(e);b.memory.excepted={},b.memory.all=!0,b.memory.exceptedLength=0}else a.apply(b.memory,{all:!0,exceptedLength:0,selectedLength:0,excepted:{},selected:{}})},clearAll:function(){a.apply(b.memory,{all:!1,exceptedLength:0,selectedLength:0,excepted:{},selected:{}})},add:function(a){var d=c.getById(a);d&&d.set("$selected",!0),b.row&&b.memory.clearAll(),b.memory.selected[a]||(b.memory.selected[a]=d.data,b.memory.selectedLength++),!0===b.memory.excepted[a]&&(delete b.memory.excepted[a],b.memory.exceptedLength--)},remove:function(a){var d=c.getById(a);d&&d.set("$selected",!1),b.memory.selected[a]&&(delete b.memory.selected[a],b.memory.selectedLength--),!0===b.memory.all&&(b.memory.excepted[a]||(b.memory.excepted[a]=!0,b.memory.exceptedLength++));var e=c.getTotal();b.memory.exceptedLength===e&&b.memory.clearAll()},has:function(a){return!!b.memory.selected[a]&&!b.memory.excepted[a]}}},initTrackOver:function(){var a=this,b=a.widget;b.on("rowenter",a.onRowEnter,a),b.on("rowleave",a.onRowLeave,a)},initCellTrackOver:function(){var a=this,b=a.widget;b.on("cellenter",a.onCellEnter,a),b.on("cellleave",a.onCellLeave,a)},initColumnTrackOver:function(){var a=this,b=a.widget;b.on("columnenter",a.onColumnEnter,a),b.on("columnleave",a.onColumnLeave,a)},onCellEnter:function(b,d){var e=this.widget;!e.cellTrackOver||e.startResizing||a.isTouch||a.get(d.cell).addCls(c)},onCellLeave:function(b,d){var e=this.widget;e.cellTrackOver&&!e.startResizing&&a.get(d.cell).removeCls(c)},onColumnEnter:function(b,c){var d=this,e=d.widget,f=e.columndrag,h=e.scroller;f&&"dragging"===f.status||a.isTouch||e.startResizing||!e.columnTrackOver||h.bottomKnobDown||h.rightKnobDown||!1===c.column.trackOver||d.keyNavigating||a.get(c.columnDom).addCls(g)},onColumnLeave:function(b,c){var d=this.widget;d.startResizing||d.columnTrackOver&&a.get(c.columnDom).removeCls(g)},onRowEnter:function(b,c){var d=this,e=d.widget,f=e.columndrag,g=e.scroller;if((!f||"dragging"!==f.status)&&!a.isTouch&&!e.startResizing&&!1!==this.enabled&&e.trackOver&&!g.bottomKnobDown&&!g.rightKnobDown&&!d.keyNavigating){var h=e.getDomRow(c.rowIndex);a.each(h,function(b){a.get(b).addCls(j)}),e.fire("rowtrackenter",c)}},onRowLeave:function(b,c){var d=this.widget;if(!d.startResizing&&!1!==this.enabled&&d.trackOver){var e=d.getDomRow(c.rowIndex);a.each(e,function(b){a.get(b).removeCls(j)}),d.fire("rowtrackleave",c)}},onChangePage:function(){this.memory||this.clearSelection()},onLoad:function(){var a=this;a.memory||a.clearSelection()},initCellSelection:function(){var a=this,b=a.widget;b.on("cellclick",a.onCellClick,a),b.on("cellmousedown",a.onCellMouseDownCells,a),b.on("cellenter",a.onCellEnterSelection,a)},initRowSelection:function(){var a=this,b=a.widget;b.checkboxRowSelection&&(a.checkboxRow=!0,setTimeout(function(){"rows"===a.selModel&&a.renderHeaderCheckBox()},1)),b.on("rowclick",a.onRowClick,a),b.on("cellmousedown",a.onCellMouseDownRows,a),b.on("cellclick",a.onCellClickRows,a),b.on("rowenter",a.onRowEnterSelection,a),b.on("columndrag",a.onColumnDrag,a)},onCellMouseDownRows:function(b,c){var f=this,g=f.widget,h=g.store,i=a.get(c.e.target),j=c.column,k=h.isTree&&f.memory,l=a.get(document.body);if(g._preventTouchDown)return void delete g._preventTouchDown;if(f.stopOneTick&&delete f.stopOneTick,f.checkOnly&&!a.get(c.e.target).hasClass(q))return void(f.activeCell&&(f.clearActiveCell(),a.get(c.cell).addCls(e)));if(!f.disabled){if(f.selectLeafsOnly&&!c.data.leaf)return void(f.stopOneTick=!0);if(f.rows&&f.enabled&&(!f.checkOnly||"$selected"===c.column.index||c.column.select)&&("tree"!==j.type||!i.hasCls(m))){if(!f.selectLeafsOnly&&!c.data.leaf&&i.hasClass(q)){var n=a.getWidget(i.parent().parent().attr("id")),p=!n.get();f.selectNodesChilds(c.id,p)}document.activeElement&&document.activeElement.blur();var r=c.e,s=r.target,t=r.ctrlKey,u=c.rowIndex,v=g.getDomRow(u);if((t||f.allowDeselect)&&g.multiSelect)a.get(v[0]).hasCls(d)?(f.domDeSelectRow(u),f.checkboxRow&&f.deSelectCheckBox(u),k&&(f.memory.removeDirtyParent(c.id,c.data.parentId),l.once("mouseup",function(){setTimeout(function(){f.updateSelectCheckBoxes()},100)}))):(f.domSelectRow(u),f.checkboxRow&&f.selectCheckBox(u),k&&f.memory.addDirtyParent(c.id,c.data.parentId));else if("$selected"===c.column.index||c.column.select){var w=a.getWidget(a.get(c.cell).select("."+o).attr("id"));w.el.within(s)?!0===w.get()?(f.domDeSelectRow(u),k&&(f.memory.removeDirtyParent(c.id,c.data.parentId),l.once("mouseup",function(){setTimeout(function(){f.updateSelectCheckBoxes()},100)}))):(f.domSelectRow(u),k&&f.memory.addDirtyParent(c.id,c.data.parentId)):(f.clearSelection(),f.domSelectRow(u),f.checkboxRow&&f.selectCheckBox(u),k&&f.memory.addDirtyParent(c.id,c.data.parentId))}else f.clearSelection(),f.domSelectRow(u),f.checkboxRow&&f.selectCheckBox(u),k&&f.memory.addDirtyParent(c.id,c.data.parentId);f.isMouseDown=!0,f.startRowSelection=u,a.$(document).one("mouseup",function(){delete f.isMouseDown,delete f.startCellSelection}),f.clearActiveCell(),a.get(c.cell).addCls(e),g.fire("select",f.getSelection()),k&&f.updateTreeSelection()}}},selectCheckBox:function(c){var d=this,e=d.widget;e.el.select("."+h+" ."+b+'[index="'+c+'"] .'+o).each(function(b){a.getWidget(b.attr("id")).set(!0)}),"rows"===e.selModel&&d.updateHeaderCheckBox()},deSelectCheckBox:function(c){var d=this,e=d.widget,f=e.store,g=e.el.select("."+h+" ."+b+'[index="'+c+'"] .'+o),i=f.get(c,"id");i&&(d.memory&&d.memory.remove(i),g.each(function(b){a.getWidget(b.attr("id")).set(!1)}),d.updateHeaderCheckBox())},domSelectRow:function(b){if(this.widget.inited){var c,e=this,f=e.widget,g=f.store,h=g.get(b,"id"),i=!1;f.startResizing||(e.memory&&(f.sorting||f.filtering||e.deselectingAll||f.draggingRows||e.memory.add(h)),c=f.getDomRow(b),a.each(c,function(b){b=a.get(b),b.hasClass(d)?i=!0:b.addCls(d)}),!1===i&&f.fire("selectrow",b,f.get(b)))}},domDeSelectRow:function(b){if(this.widget.inited){var c,e=this,f=e.widget,g=f.store,h=g.get(b,"id"),i=!0;e.memory&&(f.filtering||e.deselectingAll||f.draggingRows||f.sorting||e.memory.remove(h)),c=f.getDomRow(b),a.each(c,function(b){b=a.get(b),b.hasClass(d)?b.removeCls(d):i=!1}),i&&f.fire("deselectrow",b,f.get(b))}},onColumnEnterSelection:function(a,b){var c=this,d=c.widget;if(c.columns&&!0===c.isMouseDown){var e={columnIndex:c.startColumnColumnIndex,side:c.startColumnSide},f={columnIndex:b.columnIndex,side:b.side};if(e.side===f.side){switch(e.side){case"center":c.clearSelection("right"),c.clearSelection("left");break;case"left":c.clearSelection("center"),c.clearSelection("right");break;case"right":c.clearSelection("center"),c.clearSelection("left")}c.selectColumns(e.columnIndex,f.columnIndex,e.side)}else"center"===e.side&&"right"===f.side?(c.selectColumns(e.columnIndex,d.columns.length,"center"),c.selectColumns(0,f.columnIndex,"right")):"center"===e.side&&"left"===f.side?(c.selectColumns(0,e.columnIndex,"center"),c.selectColumns(f.columnIndex,d.leftColumns.length,"left")):"left"===e.side&&"center"===f.side?(c.clearSelection("right"),c.selectColumns(e.columnIndex,d.leftColumns.length,"left"),c.selectColumns(0,f.columnIndex,"center")):"left"===e.side&&"right"===f.side?(c.selectColumns(e.columnIndex,d.leftColumns.length,"left"),c.selectColumns(0,d.columns.length,"center"),c.selectColumns(0,f.columnIndex,"right")):"right"===e.side&&"center"===f.side?(c.clearSelection("left"),c.selectColumns(0,e.columnIndex,"right"),c.selectColumns(f.columnIndex,d.columns.length,"center")):"right"===e.side&&"left"===f.side&&(c.selectColumns(0,e.columnIndex,"right"),c.selectColumns(0,d.columns.length,"center"),c.selectColumns(f.columnIndex,d.leftColumns.length,"left"));c.clearActiveCell()}},onRowEnterSelection:function(b,c){var d=this,f=d.widget;if(!1!==c&&!f.startResizing&&!1!==d.enabled&&d.rows&&!0===d.isMouseDown&&d.mouseMoveSelection){var g=d.startRowSelection,h=c.rowIndex,i={};g>h&&(g=c.rowIndex,h=d.startRowSelection);for(var j=g,k=h+1;j<k;j++)i[j]=!0;var l=d.getSelectedRowByColumn(c.columnIndex,c.side),m={},n={};for(var o in i)!0!==l[o]&&(m[o]=!0);for(var o in l)!0!==i[o]&&(n[o]=!0);for(var o in m)d.domSelectRow(o),d.checkboxRow&&d.selectCheckBox(o);for(var o in n)d.domDeSelectRow(o),d.checkboxRow&&d.deSelectCheckBox(o);d.clearActiveCell(),a.get(c.cell).addCls(e),f.fire("select",d.getSelection())}},getSelectedRowByColumn:function(a,b){var c,e=this.widget;switch(b){case"left":c=e.leftBody;break;case"center":c=e.body;break;case"right":c=e.rightBody}var g=c.el.select("."+f+'[index="'+a+'"][grid="'+e.id+'"]'),h=g.select("."+d),i={};return h.each(function(a){i[Number(a.attr("index"))]=!0}),i},getSelectedRow:function(){var a=this.widget,b=a.body,c=b.el.select("."+d);return 0===c.length?-1:Number(c.item(0).attr("index"))},getSelectedRows:function(){var a=this.widget,b=a.body,c=b.el.select("."+f+'[index="0"][grid="'+a.id+'"]'),e=c.select("."+d),g=[];return e.each(function(a){g.push(Number(a.attr("index")))}),g},initColumnSelection:function(){var a=this,b=a.widget;a.selectedColumns=[],b.on("columnclick",a.onColumnClick,a),b.on("columnmousedown",a.onColumnMouseDown,a),b.on("columnenter",a.onColumnEnterSelection,a)},onColumnClick:function(b,c){var d=this;if(d.column&&!1!==c.column.selectable){var f=a.get(c.columnDom);d.column&&(d.selectedColumns[0]=c),d.clearSelection(),f.addCls(i),a.get(c.cell).addCls(e)}},onRowClick:function(b,c){var f=this,g=f.widget,h=c.rowIndex,i=a.get(c.e.target);if(!f.disabled&&f.row&&!1!==c&&(!f.checkOnly||"$selected"===c.column.index||c.column.select)&&(!f.selectLeafsOnly||c.data.leaf)){var j=c.column,k=!0;if("tree"!==j.type||!i.hasCls(m)){"action"===j.type&&j.items&&a.each(j.items,function(a){"remove"===a.action&&(k=!1)});var l=a.get(c.cell).hasClass(d);if("$selected"===c.column.index||c.column.select){var n=a.getWidget(a.get(c.cell).select("."+o).attr("id")),p=n.get();if(n.el.within(i))f.clearSelection(),!0===p?(f.selectCheckBox(h),f.domSelectRow(h)):f.deSelectCheckBox(h);else{if(f.checkOnly)return;f.clearSelection(),!0!==p?(f.selectCheckBox(h),f.domSelectRow(h)):f.deSelectCheckBox(h)}g.fire("select",f.getSelection())}else k&&(f.clearSelection(),f.allowDeselect&&l||(f.domSelectRow(h),f.selectCheckBox(h)),g.fire("select",f.getSelection()));a.get(c.cell).addCls(e)}}},onCellClickRows:function(b,c){var d=this,e=d.widget;if(!d.disabled&&d.rows&&d.enabled&&(!d.checkOnly||"$selected"===c.column.index||c.column.select)){var f=c.e,g=f.ctrlKey,h=c.rowIndex;if((g||d.allowDeselect)&&e.multiSelect);else if("$selected"===c.column.index||c.column.select){var i=a.getWidget(a.get(c.cell).select("."+o).attr("id"));!0!==i.middle&&(!0===i.get()?d.selectCheckBox(h):d.deSelectCheckBox(h))}}},selectRow:function(c,d,e){var g=this,h=g.widget,i=h.leftBody,j=h.body,k=h.rightBody;if(void 0===d&&(d=!0),e=e||!1,!h.startResizing){if(!g.row&&!g.rows)throw new Error("[FancyGrid Error] - row selection was not enabled");e||g.clearSelection(),d?g.domSelectRow(c):g.domDeSelectRow(c),a.each(h.columns,function(a,e){if("select"===a.type||a.select){var g=j.el.select("."+f+'[index="'+e+'"] .'+b+'[index="'+c+'"] .'+o),h=Fancy.getWidget(g.attr("id"));h&&h.set(d)}}),a.each(h.leftColumns,function(a,e){if("select"===a.type||a.select){var g=i.el.select("."+f+'[index="'+e+'"] .'+b+'[index="'+c+'"] .'+o),h=Fancy.getWidget(g.attr("id"));h&&h.set(d)}}),a.each(h.rightColumns,function(a,e){if("select"===a.type||a.select){var g=k.el.select("."+f+'[index="'+e+'"] .'+b+'[index="'+c+'"] .'+o),h=Fancy.getWidget(g.attr("id"));h&&h.set(d)}}),h.fire("select",g.getSelection())}},selectById:function(a,b,c){var d=this,e=d.widget,f=e.find("id",String(a))[0];void 0!==f?d.selectRow(f,b,c):(f=e.find("id",Number(a))[0],void 0!==f?d.selectRow(f,b,c):d.memory&&(!0===b||void 0===b?d.memory.add(a):d.memory.remove(a)))},onCellClick:function(b,c){var f=this,g=f.widget;f.cell&&(f.clearSelection(),a.get(c.cell).addCls(d,e),g.fire("select",f.getSelection()))},clearSelection:function(a){var e=this,f=e.widget;if(e.checkboxRow){var g=f.el.select("."+h+" ."+p),j={};g.each(function(a){var c=a.closest("."+b).attr("index");j[c]||(j[c]=!0,e.deSelectCheckBox(c))})}if(e.memory&&e.memory.clearAll(),a)switch(a){case"left":f.leftBody.el.select("."+d).removeCls(d),f.leftBody.el.select("."+i).removeCls(i),f.leftBody.el.select("."+c).removeCls(c);break;case"center":f.body.el.select("."+d).removeCls(d),f.body.el.select("."+i).removeCls(i),f.body.el.select("."+c).removeCls(c);break;case"right":f.rightBody.el.select("."+d).removeCls(d),f.rightBody.el.select("."+i).removeCls(i),f.rightBody.el.select("."+c).removeCls(c)}else f.el.select("."+d).removeCls(d),f.el.select("."+i).removeCls(i),f.el.select("."+c).removeCls(c);e.clearActiveCell(),f.fire("clearselect"),f.fire("select",f.getSelection())},onSort:function(){var a=this;if(a.clearActiveCell(),a.memory)return void a.updateSelection();a.clearSelection()},onCellEnterSelection:function(b,c){var d=this,f=d.widget,g=f.columndrag,h=0;if((!g||"dragging"!==g.status)&&d.cells&&!0===d.isMouseDown){d.prevCellsSelection=c.cell,d.prevCellRowIndex=c.rowIndex,d.prevCellColumnIndex=c.columnIndex,d.prevCellSide=c.side;var i={rowIndex:d.startCellRowIndex,columnIndex:d.startCellColumnIndex,side:d.startCellSide},j={rowIndex:c.rowIndex,columnIndex:c.columnIndex,side:c.side};c.rowIndex<d.startCellRowIndex&&(i.rowIndex=c.rowIndex,j.rowIndex=d.startCellRowIndex),d.startCellSide===c.side?(c.columnIndex<d.startCellColumnIndex&&(i.columnIndex=c.columnIndex,j.columnIndex=d.startCellColumnIndex),h=d.selectCells(i,j,i.side),"left"===d.startCellSide?(d.clearSelection("center"),d.clearSelection("right")):"center"===d.startCellSide?(d.clearSelection("left"),d.clearSelection("right")):"right"===d.startCellSide&&(d.clearSelection("left"),d.clearSelection("center"))):"left"===d.startCellSide?(h=d.selectCells(i,{rowIndex:c.rowIndex,columnIndex:f.leftColumns.length-1},"left"),"center"===c.side?(h+=d.selectCells({columnIndex:0,rowIndex:i.rowIndex},j,"center"),d.clearSelection("right")):"right"===c.side&&(h+=d.selectCells({columnIndex:0,rowIndex:i.rowIndex},{columnIndex:f.columns.length-1,rowIndex:j.rowIndex},"center"),h+=d.selectCells({columnIndex:0,rowIndex:i.rowIndex},j,"right"))):"center"===d.startCellSide?"left"===c.side?(h+=d.selectCells({columnIndex:0,rowIndex:i.rowIndex},{rowIndex:j.rowIndex,columnIndex:i.columnIndex},"center"),h+=d.selectCells({columnIndex:j.columnIndex,rowIndex:i.rowIndex},{rowIndex:j.rowIndex,columnIndex:f.leftColumns.length-1},"left")):"right"===c.side&&(h+=d.selectCells({columnIndex:i.columnIndex,rowIndex:i.rowIndex},{columnIndex:f.columns.length-1,rowIndex:j.rowIndex},"center"),h+=d.selectCells({columnIndex:0,rowIndex:i.rowIndex},{columnIndex:j.columnIndex,rowIndex:j.rowIndex},"right")):"right"===d.startCellSide&&(h+=d.selectCells({columnIndex:0,rowIndex:i.rowIndex},{columnIndex:i.columnIndex,rowIndex:j.rowIndex},"right"),"center"===c.side?(h+=d.selectCells({columnIndex:j.columnIndex,rowIndex:i.rowIndex},{columnIndex:f.columns.length-1,rowIndex:j.rowIndex},"center"),d.clearSelection("left")):"left"===c.side&&(h+=d.selectCells({columnIndex:0,rowIndex:i.rowIndex},{columnIndex:f.columns.length-1,rowIndex:j.rowIndex},"center"),h+=d.selectCells({columnIndex:j.columnIndex,rowIndex:i.rowIndex},{columnIndex:f.leftColumns.length-1,rowIndex:j.rowIndex},"left"))),d.endCellRowIndex=j.rowIndex,d.clearActiveCell(),a.get(c.cell).addCls(e),f.fire("select",d.getSelection())}},onColumnMouseDown:function(b,c){var d=this,f=d.widget;if(d.columns&&!1!==c.column.selectable&&d.enabled){document.activeElement&&document.activeElement.blur();var g=a.get(c.columnDom);d.isMouseDown=!0,d.startColumnColumnIndex=c.columnIndex,d.startColumnSide=c.side,d.clearSelection(),g.addCls(i),a.$(document).one("mouseup",function(){delete d.isMouseDown}),a.get(c.cell).addCls(e),f.fire("select",d.getSelection())}},onCellMouseDownCells:function(b,c){var f=this,g=f.widget;if(g.celledit&&g.celledit.hideEditor(),f.cells&&f.enabled){document.activeElement&&document.activeElement.blur();var h=a.get(c.cell);f.clearSelection(),g.el.select("."+e).removeCls(e),h.addCls(d,e),f.isMouseDown=!0,f.startCellSelection=c.cell,f.startCellRowIndex=c.rowIndex,f.startCellColumnIndex=c.columnIndex,f.startCellSide=c.side,a.$(document).one("mouseup",function(){delete f.isMouseDown,delete f.startCellSelection}),g.fire("select",f.getSelection())}},selectCell:function(b){var c=this,f=c.widget,g=b.id,h=b.index,i=f.getRowById(g),j=f.getColumnOrderByKey(h),k=j.order,l=f.getBody(j.side),m=l.getCell(i,k);f.clearSelection(),c.clearActiveCell(),a.get(b.cell).addCls(e),m.addCls(d),f.scroller.scrollToCell(m.dom,!0,b.firstRow)},selectCells:function(a,b,c){var e,f,g,h=this,i=h.widget,j=i.body,k=i.leftBody,l=i.rightBody,m=a.rowIndex,n=b.rowIndex+1,o=h.getSelectedCells(c||"center"),p={},q={},r={};for(m=a.rowIndex,n=b.rowIndex+1;m<n;m++)for(p[m]=p[m]||{},f=a.columnIndex,g=b.columnIndex+1;f<g;f++)p[m][f]=!0;for(var s in p)if(void 0===o[s])q[s]=p[s];else for(var t in p[s])!0!==o[s][t]&&(q[s]=q[s]||{},q[s][t]=!0);for(var s in o)if(void 0===p[s])r[s]=o[s];else for(var t in o[s])!0!==p[s][t]&&(r[s]=r[s]||{},r[s][t]=!0);switch(c){case"left":e=k;break;case"center":e=j;break;case"right":e=l;break;default:e=j}for(var s in q)for(var t in q[s]){var u=e.getCell(s,t);u.addCls(d)}for(var s in r)for(var t in r[s]){var u=e.getCell(s,t);u.removeCls(d)}},getSelectedCells:function(a){for(var b=this,c=b.widget,e=c.getBody(a||"center"),f=e.el.select("."+d),g={},h=0,i=f.length;h<i;h++){var j=f.item(h),k=Number(j.parent().attr("index")),l=Number(j.attr("index"));g[l]=g[l]||{},g[l][k]=!0}return g},getNumberSelectedCells:function(){return this.widget.el.select("."+d).length},getSelectedColumns:function(a){for(var b=this.widget,c=b.getBody(a),d={},e=c.el.select("."+i),f=0,g=e.length;f<g;f++)d[e.item(f).attr("index")]=!0;return d},selectColumns:function(a,b,c){var d=this,e=d.getSelectedColumns(c||"center"),f={},g={},h={},i=a,j=b;for(j<i&&(i=b,j=a),j++;i<j;i++)f[i]=!0;for(var k in f)!0!==e[k]&&(g[k]=!0);for(var k in e)!0!==f[k]&&(h[k]=!0);for(var k in g)d.selectColumn(k,c);for(var k in h)d.deselectColumn(k,c)},selectColumn:function(b,c){var d=this.widget,e=d.getBody(c||"center");a.get(e.getDomColumn(b)).addCls(i)},deselectColumn:function(b,c){var d=this.widget,e=d.getBody(c||"center");a.get(e.getDomColumn(b)).removeCls(i)},getSelection:function(b){var c,e=this,f=e.widget,g=f.store,h={};switch(e.selModel){case"row":h.row=e.getSelectedRow(),-1!==h.row?(h.items=[g.get(h.row)],h.rows=[h.row]):(h.items=[],h.rows=[]);break;case"rows":if(h.rows=e.getSelectedRows(),e.memory&&e.memory.all)c=e.memory.excepted,g.filteredDataMap?h.items=Fancy.Array.copy(g.filteredData):h.items=Fancy.Array.copy(g.data);else if(h.items=[],e.memory&&!Fancy.Object.isEmpty(e.memory.selected)){var i=e.memory.selected;if(g.filteredDataMap)for(var j in i)g.filteredDataMap[j]&&h.items.push(g.getById(j));else for(var j in i){var k=g.getById(j);k?h.items.push(k):h.items.push(e.memory.selected[j])}}else for(var l=0,m=h.rows.length;l<m;l++)h.items.push(g.get(h.rows[l]));break;case"cells":if(h.items=e.getSelectedData(),b){var n=f.el.select("."+d);n.length>1?(h.nodes=[],a.each(n.dom,function(b){h.nodes.push(e.getNodeInfo(new a.Element(b)))})):1===n.length?h.nodes=[this.getNodeInfo(n)]:h.nodes=[]}break;case"cell":if(h.items=e.getSelectedData(),b){var o=f.el.select("."+d);o.length?h.nodes=[this.getNodeInfo(o)]:h.nodes=[]}}if(c){var p=[];a.each(h.items,function(b,d){a.isObject(b.data)&&(h.items[d]=b.data);var e=h.items[d].id;c[e]||p.push(h.items[d])}),h.items=p}else a.each(h.items,function(b,c){b&&a.isObject(b.data)&&(h.items[c]=b.data)});return b?h:h.items||[]},renderHeaderCheckBox:function(){var a=this,b=this.widget;b.header&&(a._renderHeaderCheckBox(b.leftHeader,b.leftColumns),a._renderHeaderCheckBox(b.header,b.columns),a._renderHeaderCheckBox(b.rightHeader,b.rightColumns))},_renderHeaderCheckBox:function(b,c){var d=this,e=d.widget,f=d.memory,g=e.getSelection();a.each(c,function(c,h){if(("$selected"===c.index||c.select)&&!1!==c.headerCheckBox){var i=b.getCell(h);i.addCls(k);var j=i.firstChild(),m=!d.disabled,n=i.select("."+l);if(c.select?n.update(c.title||""):n.update(""),j.select("."+o).length){a.getWidget(j.select("."+o).item(0).attr("id")).destroy()}var p=!1;d.memory?f.all&&(p=!0):g.length===e.getViewTotal()&&0!==g.length&&(p=!0),c.headerCheckBox=new a.CheckBox({renderTo:j.dom,renderBefore:c.select?n:void 0,renderId:!0,value:p,label:!1,editable:m,disabled:d.disabled,style:{padding:"0px",display:"inline-block"},events:[{change:function(a,b){b?(f&&f.setAll(),d.selectAll()):(f&&f.clearAll(),d.deSelectAll()),d.updateHeaderCheckBox()}}]})}})},selectAll:function(){var c=this,d=c.widget,e=d.store,f=d.el.select("."+k+" ."+o),g=0,i=d.getViewTotal();for(c.memory&&e.isTree&&(c.memory.tree.selected={},c.memory.tree.allSelected={},c.memory.tree.selectedLength={},c.updateTreeSelection()),c.selectingAll=!0;g<i;g++){for(var j=d.el.select("."+h+" ."+b+'[index="'+g+'"] .'+o),l=0,m=j.length;l<m;l++){a.getWidget(j.item(l).attr("id")).setValue(!0)}c.domSelectRow(g)}f.each(function(b){a.getWidget(b.attr("id")).setValue(!0,!1)}),d.fire("select",d.getSelection()),setTimeout(function(){delete c.selectingAll},1)},deSelectAll:function(){var c=this,d=c.widget,e=d.store,f=0,g=d.getViewTotal();for(c.memory&&e.isTree&&(c.memory.tree.selected={},c.memory.tree.allSelected={},c.memory.tree.selectedLength={},c.updateTreeSelection()),c.deselectingAll=!0;f<g;f++){d.el.select("."+h+" ."+b+'[index="'+f+'"] .'+o).each(function(b){a.getWidget(b.attr("id")).setValue(!1)}),c.domDeSelectRow(f)}c.updateHeaderCheckBox(),d.fire("clearselect"),d.fire("select",d.getSelection()),delete c.deselectingAll},updateHeaderCheckBox:function(){var b=this,c=b.widget,d=c.getTotal();c.el.select("."+k+" ."+o).each(function(c){var e=a.getWidget(c.attr("id"));b.memory?b.memory.selectedLength>0||b.memory.all?b.memory.selectedLength===d?(e.setValue(!0,!1),e.setMiddle(!1)):b.memory.all&&0===b.memory.exceptedLength?(e.setValue(!0,!1),e.setMiddle(!1)):(e.setMiddle(!0),e.setValue(!1,!1)):(e.setMiddle(!1),e.setValue(!1,!1)):b.selectingAll?e.setValue(!0,!1):e.setValue(!1,!1)})},stopSelection:function(){this.enabled=!1},enableSelection:function(a){var b=this;if(!0===b.disabled&&b.enableHeaderCheckBoxes(),b.disabled=!1,b.disabled=!1,void 0!==a)return void(this.enabled=a);this.enabled=!0},initFixTrackOver:function(){var a=this,b=a.widget;b.columns&&(b.body.el.on("mouseleave",a.onBodyMouseLeave,a),b.body.el.on("mouseenter",a.onBodyMouseEnter,a)),b.leftColumns&&(b.leftBody.el.on("mouseleave",a.onLeftBodyMouseLeave,a),b.leftBody.el.on("mouseenter",a.onLeftBodyMouseEnter,a)),b.rightColumns&&(b.rightBody.el.on("mouseleave",a.onRightBodyMouseLeave,a),b.rightBody.el.on("mouseenter",a.onRightBodyMouseEnter,a))},onBodyMouseLeave:function(){var a=this,b=a.widget;a.clearBodyTrackCls(b.body)},onBodyMouseEnter:function(){var a=this;a.rowTrackFixInBody=!0,setTimeout(function(){a.rowTrackFixInBody=!1},30)},onLeftBodyMouseLeave:function(){var a=this,b=a.widget;a.clearBodyTrackCls(b.leftBody)},onLeftBodyMouseEnter:function(){var a=this;a.rowTrackFixInBody=!0,setTimeout(function(){a.rowTrackFixInBody=!1},30)},onRightBodyMouseLeave:function(){var a=this,b=a.widget;a.clearBodyTrackCls(b.rightBody)},onRightBodyMouseEnter:function(){var a=this;a.rowTrackFixInBody=!0,setTimeout(function(){a.rowTrackFixInBody=!1},30)},clearBodyTrackCls:function(a){var b=this,d=b.widget;d.cellTrackOver&&a.el.select("."+c).removeCls(c),d.trackOver&&(delete a.prevCellOver,clearInterval(b.rowTrackFixInterval),delete b.rowTrackFixInterval,b.rowTrackFixInterval=setTimeout(function(){b.rowTrackFixInBody||d.el.select("."+j).removeCls(j)},20))},onColumnLock:function(){var b,c=this,d=c.widget;if(c.cells||c.cell||c.column||c.columns)return void c.clearSelection();b=c.getSelection(!0),a.each(b.rows,function(a){d.selectRow(a,!0,"rows"===d.selModel)},100),setTimeout(function(){c.renderHeaderCheckBox()},100)},onColumnRightLock:function(){var b,c=this,d=c.widget;if(c.cells||c.cell||c.column||c.columns)return void c.clearSelection();setTimeout(function(){b=c.getSelection(!0),a.each(b.rows,function(a){d.selectRow(a,!0,"rows"===d.selModel)})},100),setTimeout(function(){c.renderHeaderCheckBox()},100)},onUnColumnLock:function(){var b,c=this,d=c.widget;if(c.cells||c.cell||c.column||c.columns)return void c.clearSelection();setTimeout(function(){b=c.getSelection(!0),a.each(b.rows,function(a){d.selectRow(a,!0,"rows"===d.selModel)})},100),setTimeout(function(){c.renderHeaderCheckBox()},100)},disableSelection:function(){var a=this;a.disabled=!0,a.enableHeaderCheckBoxes(!1)},enableHeaderCheckBoxes:function(b){var c=this,d=c.widget,e=d.body,g=d.leftBody,h=d.rightBody,i="enable";!1===b&&(i="disable"),a.each(d.columns,function(b,c){"select"===b.type&&b.headerCheckBox&&(b.headerCheckBox[i](),e.el.select("."+f+'[index="'+c+'"] .'+o).each(function(b){a.getWidget(b.attr("id"))[i]()}))}),a.each(d.leftColumns,function(b,c){"select"===b.type&&b.headerCheckBox&&(b.headerCheckBox[i](),g.el.select("."+f+'[index="'+c+'"] .'+o).each(function(b){a.getWidget(b.attr("id"))[i]()}))}),a.each(d.rightColumns,function(b,c){"select"===b.type&&b.headerCheckBox&&(b.headerCheckBox[i](),h.el.select("."+f+'[index="'+c+'"] .'+o).each(function(b){a.getWidget(b.attr("id"))[i]()}))})},onFilter:function(){var b=this,c=b.widget;b.clearActiveCell(),b.memory||b.clearSelection(),"rows"===b.selModel&&(a.each(c.leftColumns,function(d,e){if("select"===d.type){var f=c.leftHeader.getCell(e),g=a.getWidget(f.select("."+o).attr("id"));g&&(b.memory&&b.memory.all||g.set(!1,!1))}}),a.each(c.columns,function(d,e){if("select"===d.type){var f=c.header.getCell(e),g=a.getWidget(f.select("."+o).attr("id"));g&&(b.memory&&b.memory.all||g.set(!1,!1))}}),a.each(c.rightColumns,function(d,e){if("select"===d.type){var f=c.rightHeader.getCell(e),g=a.getWidget(f.select("."+o).attr("id"));g&&(b.memory&&b.memory.all||g.set(!1,!1))}}))},onExpand:function(){var a=this;a.clearActiveCell(),a.memory||a.clearSelection()},onCollapse:function(){var a=this;a.clearActiveCell(),a.memory||a.clearSelection()},getActiveCell:function(){var a=this,b=a.widget,c=b.el.select("."+e);return c.dom||(c=b.el.select("."+d),c=c.dom?c.item(0):b.body.getCell(0,0)),c},getActiveCellInfo:function(a){var b=this,c=b.widget,a=a||b.getActiveCell();return{side:c.getSideByCell(a),rowIndex:Number(a.attr("index")),columnIndex:Number(a.parent().attr("index"))}},clearActiveCell:function(){this.widget.el.select("."+e).removeCls(e)},initCopyEl:function(){var b=this,c=b.widget,d=a.get(document.createElement("textarea"));d.addCls(r),d.attr("aria-hidden","true"),b.copyEl=a.get(c.el.dom.appendChild(d.dom))},copy:function(b){var c,d=this,e=d.widget,f=d.copyEl;switch(d.selModel){case"cells":case"cell":var g=d.getSelectedData(b),h="";a.each(g,function(a){h+=a.join("\t")+"\n"}),f.dom.value=h;break;case"rows":case"row":c=d.getSelection();var i=[].concat(e.leftColumns).concat(e.columns).concat(e.rightColumns),h="";if(b){var j=[];a.each(i,function(a){switch(a.index){case"$selected":case"$rowdrag":return}j.push(a.index||"")}),h+=j.join("\t")+"\n"}a.each(c,function(b){var c=[];a.each(i,function(a){switch(a.index){case"$selected":case"$rowdrag":return}a.index&&c.push(b[a.index])}),h+=c.join("\t")+"\n"}),f.dom.value=h;break;case"columns":case"column":var g=[],k=e.getDataView(),l=function(c){var f=e.getColumns(c),h=d.getSelectedColumns(c);for(var i in h){var j=f[i];b&&(g.push([]),g[0].push(j.title||"")),j.index&&a.each(k,function(a,c){b&&c++,void 0===g[c]&&(g[c]=[]),g[c].push(a[j.index])})}};e.leftColumns&&l("left"),e.columns&&l("center"),e.rightColumns&&l("right");var h="";a.each(g,function(a){h+=a.join("\t")+"\n"}),f.dom.value=h}f.dom.select(),f.dom.focus(),document.execCommand("copy")},initCopyKeys:function(){var a=this;Fancy.get(document).on("keydown",a.onKeyDownCopy,a)},onKeyDownCopy:function(a){var b=this,c=b.widget,d=a.keyCode,e=Fancy.key;if(!1!==c.activated&&a.ctrlKey)switch(d){case e.C:if(c.celledit&&c.celledit.activeEditor)return;if(c.textSelection)return;b.copy();break;case e.V:b.copyEl.dom.value="",b.copyEl.dom.focus(),setTimeout(function(){b.insertDataFromBuffer()},1)}},insertDataFromBuffer:function(){var b=this,c=b.widget,d=b.getDataFromCopyEl(),e=b.getColumnIdToInsert(d),f=b.getRowIdToInsert(d);a.each(f,function(b,f){a.each(e,function(a,e){var g=c.getColumnById(a),h=g.index,i=d[f][e];void 0!==h&&!g.smartIndexFn&&g.editable&&c.setById(b,h,i)})})},getRowIdToInsert:function(a){var b=this,c=b.widget,d=[];if(0===a.length)return[];var e;if(b.activeCell)e=b.getActiveCellInfo();else{var f=c.el.select("."+Fancy.GRID_CELL_SELECTED_CLS).item(0);e=b.getActiveCellInfo(f)}for(var g=e.rowIndex,h=g+a.length;g<h;g++){var i=c.get(g);if(!i)break;d.push(i.id)}return d},getColumnIdToInsert:function(a){var b=this,c=b.widget,d=[];if(0===a.length)return[];var e;if(b.activeCell)e=b.getActiveCellInfo();else{var f=c.el.select("."+Fancy.GRID_CELL_SELECTED_CLS).item(0);e=b.getActiveCellInfo(f)}for(var g=c.getColumns(e.side),h=e.columnIndex,i=h+a[0].length;h<i;h++){var j=g[h];if(void 0===j)break;j.hidden?i++:d.push(j.id)}return d},getDataFromCopyEl:function(){var b=this,c=[],d=b.copyEl.dom.value,e=d.split("\n");return a.each(e,function(b){var d=[],e=b.split("\t");1===e.length&&(e=b.split("    ")),a.each(e,function(a){d.push(a)}),c.push(d)}),c},onColumnDrag:function(){var a=this;setTimeout(function(){a.renderHeaderCheckBox()},100)},disableSelectionMove:function(){this.mouseMoveSelection=!1},getSelectedData:function(a){var b=this,c=b.widget,d=[],e=function(e){var f=c.getColumns(e),g=b.getSelectedCells(e),h=0,i=!1;for(var j in g){var k=c.get(j),l=g[j];if(!i&&a){d.push([]);for(var m in l){var n=f[m];n.index,d[0].push(n.title||"")}h++,i=!0}for(var m in l){var n=f[m];d[h]||(d[h]=[]),n.index&&d[h].push(k.get(n.index))}h++}};return e("left"),e("center"),e("right"),d},selectNodesChilds:function(b,c){var d=this,e=d.widget,f=e.getById(b);!1===c&&d.memory&&d.memory.remove(b),f.set("$selected",c);var g=function(f){a.each(f,function(a){if(a.$selected=c,!a.id)return!0;var f=e.getRowById(a.id);void 0!==f&&e.selectRow(f,c,!0),!1===c&&d.memory&&d.memory.remove(b),a.data&&a.data.child&&g(a.data.child)})};g(f.data.child)},clearOverCells:function(){this.widget.el.select("."+c).removeCls(c)},onDragRows:function(){this.clearActiveCell()},onRemoveRows:function(){var a=this;a.rows&&(clearInterval(a._interval),a._interval=setTimeout(function(){a.updateHeaderCheckBox(),delete a._interval},1))},onTreeExpand:function(){var a=this,b=a.widget;a.memory?(a.updateSelection(),a.updateTreeSelection()):b.clearSelection()},onTreeCollapse:function(){var a=this,b=a.widget;a.memory?(a.updateSelection(),a.updateTreeSelection()):b.clearSelection()},updateSelection:function(){var a=this,b=a.widget,c=b.store,e=b.body;if(a.memory){e.el.select("."+f+'[index="0"] .'+d).each(function(d){var e=d.attr("index"),f=b.get(e),g=f.id;if(!(f=b.infinite?b.get(e+c.infiniteScrolledToRow):b.get(e)))return void a.domDeSelectRow(0);g=f.id,a.memory.has(g)||a.domDeSelectRow(e)});for(var g in a.memory.selected){var h=b.getRowById(g);void 0!==h&&a.domSelectRow(h)}}else if(b.infinite)switch(a.selModel){case"row":case"rows":var i=e.el.select("."+f+'[index="0"] .'+d);i.each(function(b){var c=b.attr("index");a.domDeSelectRow(c)})}},updateSelectCheckBoxes:function(){var c=this,d=c.widget;if(c.memory){d.el.select("."+h+" ."+p).each(function(e){var f=e.closest("."+b).attr("index"),g=d.get(f),h=g.id;if(!c.memory.has(h)){a.getWidget(e.attr("id")).set(!1,!1),c.domDeSelectRow(f)}})}},updateTreeSelection:function(){var c=this,e=c.widget;for(var g in c.memory.tree.selected){var i=e.getRowById(g),j=e.el.select("."+h+" ."+b+'[index="'+i+'"] .'+o);c.memory.tree.allSelected[g]?j.each(function(b){var d=b.attr("id"),e=a.getWidget(d);setTimeout(function(){e.set(!0,!1),e.setMiddle(!1),c.memory.add(g),c.domSelectRow(i)},200)}):j.each(function(b){var c=b.attr("id");a.getWidget(c).setMiddle(!0)})}e.el.select("."+f+"."+h+" ."+s).each(function(f){var g=f.closest("."+b),h=g.attr("index"),i=e.get(h,"id"),j=a.getWidget(f.attr("id"));c.memory.tree.selected[i]||(j.setMiddle(!1),c.memory.tree.allSelected[i]?j.setMiddle(!1):j.set(!1,!1)),c.memory.tree.allSelected[i]&&setTimeout(function(){j.set(!0,!1),j.setMiddle(!1),c.memory.add(i),c.domSelectRow(h)},200),j.hasCls(p)&&(j.removeCls(s),c.domSelectRow(h),c.memory.add(i),c.memory.removeDirtyParent(i)),g.hasCls(d)&&!j.hasCls(p)&&j.set(!0,!1)})},getNodeInfo:function(a){var b=this,c=b.widget,d=a.parent(),e=d.parent(),f=e.parent(),g="";f.hasCls("fancy-grid-center")?g="center":f.hasCls("fancy-grid-left")?g="left":f.hasCls("fancy-grid-right")&&(g="right");var h=c.getColumns(g);return{side:g,columnIndex:Number(d.attr("index")),index:h[Number(d.attr("index"))].index,column:h[Number(d.attr("index"))],rowIndex:Number(a.attr("index")),cell:a,value:a.select(".fancy-grid-cell-inner").dom.innerHTML}}})}(),function(){var a=Fancy,b=a.GRID_CELL_ACTIVE_CLS,c=a.GRID_CELL_SELECTED_CLS;a.Mixin("Fancy.grid.selection.mixin.Navigation",{initNavigation:function(){this.addEvents("up","down","left","right"),this.onsNav()},onsNav:function(){var a=this;Fancy.get(document).on("keydown",a.onKeyDown,a)},onKeyDown:function(b){var c=this,d=c.widget,e=b.keyCode,f=Fancy.key;if(!1!==d.activated){if(!c.keyNavigating){a.get(document).once("keyup",function(){delete c.keyNavigating})}if(!(d.celledit&&d.celledit.activeEditor||d.rowedit&&d.rowedit.el&&d.rowedit.isVisible()))switch(e){case f.TAB:break;case f.UP:c.keyNavigating=!0,b.preventDefault(),clearInterval(c.intervalUp),c.intervalUp=setTimeout(function(){c.moveUp(),delete c.intervalUp},1);break;case f.DOWN:c.keyNavigating=!0,b.preventDefault(),clearInterval(c.intervalDown),c.intervalDown=setTimeout(function(){c.moveDown(),delete c.intervalDown},1);break;case f.LEFT:c.keyNavigating=!0,b.preventDefault(),c.moveLeft();break;case f.RIGHT:c.keyNavigating=!0,b.preventDefault(),c.moveRight();break;case f.PAGE_UP:b.preventDefault(),c.scrollPageUP();break;case f.PAGE_DOWN:b.preventDefault(),c.scrollPageDOWN();break;case f.HOME:b.preventDefault(),c.scrollHome();break;case f.END:b.preventDefault(),c.scrollEnd();break;case f.SPACE:if(d.celledit&&!d.celledit.activeEditor&&(d.selection&&"cell"===d.selection.selModel||"cells"===d.selection.selModel)){var g=d.selection.getActiveCell();if(g){var h=d.selection.getActiveCellInfo(),i=d.getColumns(h.side);if(h.column=i[h.columnIndex],!0!==h.column.editable)return;switch(h.column.type){case"checkbox":case"switcher":h.cell=g.dom;var j=d.get(h.rowIndex);h.item=j,h.data=j.data,h.column.smartIndexFn?h.value=h.column.smartIndexFn(h.data):h.value=d.store.get(h.rowIndex,h.column.index),d.celledit.edit(h)}}}break;case f.ENTER:if(d.celledit&&!d.celledit.activeEditor&&(d.selection&&"cell"===d.selection.selModel||"cells"===d.selection.selModel||d.selection.activeCell)){var g=d.selection.getActiveCell();if(g){var h=d.selection.getActiveCellInfo(),i=d.getColumns(h.side);if(h.column=i[h.columnIndex],!0!==h.column.editable)return;switch(h.column.type){case"switcher":case"checkbox":return}h.cell=g.dom;var j=d.get(h.rowIndex);h.item=j,h.data=j.data,h.column.smartIndexFn?h.value=h.column.smartIndexFn(h.data):h.value=d.store.get(h.rowIndex,h.column.index),d.celledit.edit(h)}}break;case f.BACKSPACE:case f.DELETE:if(d.selection&&("cell"===d.selection.selModel||d.selection.activeCell)){var g=d.selection.getActiveCell();if(g){var h=d.selection.getActiveCellInfo(),i=d.getColumns(h.side);if(h.column=i[h.columnIndex],!0!==h.column.editable)return;h.cell=g.dom;var j=d.get(h.rowIndex);h.item=j,h.data=j.data,h.value="",d.celledit.edit(h)}}break;case f.ESC:case f.ALT:case f.CTRL:case f.SHIFT:case f.CAPS_LOCK:case f.F1:case f.F2:case f.F3:case f.F4:case f.F5:case f.F6:case f.F7:case f.F8:case f.F9:case f.F10:case f.F11:case f.F12:break;default:if(d.startEditByTyping&&d.celledit&&!d.celledit.activeEditor&&(d.selection&&"cell"===d.selection.selModel||"cells"===d.selection.selModel||d.selection.activeCell)){var g=d.selection.getActiveCell();if(g){var h=d.selection.getActiveCellInfo(),i=d.getColumns(h.side);if(h.column=i[h.columnIndex],!0!==h.column.editable)return;h.cell=g.dom;var j=d.get(h.rowIndex);h.item=j,h.data=j.data,h.value="",d.celledit.edit(h)}}}}},moveRight:function(){var d,e=this,f=e.widget,g=e.getActiveCellInfo(),h=f.getBody(g.side);if(g.columnIndex++,d=h.getCell(g.rowIndex,g.columnIndex),!d.dom)switch(g.side){case"left":f.columns&&(g.columnIndex=0,h=f.getBody("center"),g.side="center",d=h.getCell(g.rowIndex,g.columnIndex));break;case"center":f.rightColumns&&f.rightColumns.length&&(a.each(f.rightColumns,function(a,b){if(!a.hidden)return g.columnIndex=b,h=f.getBody("right"),g.side="right",!0}),d=h.getCell(g.rowIndex,g.columnIndex));break;case"right":return}if(d.dom){switch(g.side){case"left":var i=f.leftColumns[g.columnIndex];if(i.hidden){for(var j=g.columnIndex,k=f.leftColumns.length,l=!1;j<k;j++)if(i=f.leftColumns[j],!i.hidden){l=!0,g.columnIndex=j;break}if(!l){g.columnIndex--;for(var j=g.columnIndex,k=f.columns.length,l=!1;j<k;j++)if(i=f.columns[j],!i.hidden){l=!0,g.columnIndex=j;break}l&&(g.side="center",h=f.getBody(g.side))}d=h.getCell(g.rowIndex,g.columnIndex)}break;case"center":var i=f.columns[g.columnIndex];if(i.hidden){for(var j=g.columnIndex,k=f.columns.length,l=!1;j<k;j++)if(i=f.columns[j],!i.hidden){l=!0,g.columnIndex=j;break}if(!l){var l=!1;a.each(f.rightColumns,function(a,b){if(!a.hidden)return l=!0,g.columnIndex=b,g.side="right",!0}),l?h=f.getBody(g.side):g.columnIndex--}d=h.getCell(g.rowIndex,g.columnIndex)}break;case"right":var i=f.rightColumns[g.columnIndex];if(i.hidden){for(var j=g.columnIndex,k=f.rightColumns.length,l=!1;j<k;j++)if(i=f.rightColumns[j],!i.hidden){l=!0,g.columnIndex=j;break}l||g.columnIndex--,d=h.getCell(g.rowIndex,g.columnIndex)}}switch(e.selModel){case"cell":case"cells":e.clearSelection(),d.addCls(b,c),f.scroller.scrollToCell(d.dom,!0);break;case"column":case"columns":f.selection&&f.selection.activeCell?(f.selection.clearActiveCell(),d.addCls(b),f.scroller.scrollToCell(d.dom,!0)):(e.clearSelection(),e.selectColumn(g.columnIndex,g.side),d.addCls(b,c),f.scroller.scrollToCell(d.dom,!0));break;case"row":case"rows":f.selection&&f.selection.activeCell&&(f.selection.clearActiveCell(),d.addCls(b),f.scroller.scrollToCell(d.dom,!0))}return d}},moveLeft:function(){var a,d,e=this,f=e.widget,g=e.getActiveCellInfo(),h=f.getBody(g.side);if(--g.columnIndex<0)switch(g.side){case"left":return;case"center":if(!f.leftColumns||!f.leftColumns.length)return;g.columnIndex=f.leftColumns.length-1,h=f.getBody("left"),g.side="left",a=h.getCell(g.rowIndex,g.columnIndex);var i=f.leftColumns[g.columnIndex];if(i.hidden)for(var j=g.columnIndex-1,k=!1;j>=0;j--)if(i=f.leftColumns[j],!i.hidden){k=!0,g.columnIndex=j;break}a=h.getCell(g.rowIndex,g.columnIndex);break;case"right":if(f.columns&&f.columns.length){for(var j=f.columns.length,k=!1;j--;){var i=f.columns[j];if(!i.hidden){g.columnIndex=j,h=f.getBody("center"),g.side="center",k=!0;break}}if(!k&&f.leftColumns.length)for(var j=f.leftColumns.length;j--;){var i=f.leftColumns[j];if(!i.hidden){g.columnIndex=j,h=f.getBody("left"),g.side="left",k=!0;break}}a=h.getCell(g.rowIndex,g.columnIndex)}}else{switch(g.side){case"left":var i=f.leftColumns[g.columnIndex];if(i.hidden){for(var j=g.columnIndex-1,k=!1;j>=0;j--)if(i=f.leftColumns[j],!i.hidden){k=!0,g.columnIndex=j;break}k||g.columnIndex++}break;case"center":var i=f.columns[g.columnIndex];if(i.hidden){for(var j=g.columnIndex-1,k=!1;j>=0;j--)if(i=f.columns[j],!i.hidden){k=!0,g.columnIndex=j;break}if(!k&&(g.columnIndex++,f.leftColumns)){for(var j=f.leftColumns.length-1,k=!1;j>=0;j--)if(i=f.leftColumns[j],!i.hidden){k=!0,g.columnIndex=j;break}k&&(d="left",h=f.getBody(d))}}break;case"right":var i=f.rightColumns[g.columnIndex];if(i.hidden){for(var j=g.columnIndex-1,k=!1;j>=0;j--)if(i=f.rightColumns[j],!i.hidden){k=!0,g.columnIndex=j;break}if(!k){g.columnIndex++;var j=f.columns.length-1,k=!1;for(d="center",h=f.getBody(d);j>=0;j--)if(i=f.columns[j],!i.hidden){k=!0,g.columnIndex=j;break}}}}a=h.getCell(g.rowIndex,g.columnIndex)}if(a.dom)switch(e.selModel){case"cell":case"cells":e.clearSelection(),a.addCls(b,c),f.scroller.scrollToCell(a.dom,!0);break;case"column":case"columns":f.selection&&f.selection.activeCell?(f.selection.clearActiveCell(),a.addCls(b),f.scroller.scrollToCell(a.dom,!0)):(e.clearSelection(),e.selectColumn(g.columnIndex,g.side),a.addCls(b,c),f.scroller.scrollToCell(a.dom,!0));break;case"row":case"rows":f.selection.clearActiveCell(),a.addCls(b),f.scroller.scrollToCell(a.dom,!0)}},moveUp:function(){var a,d=this,e=d.widget,f=e.store,g=d.getActiveCellInfo(),h=e.getBody(g.side);if(e.infinite&&0===g.rowIndex){var i=f.infiniteScrolledToRow-1;i<0&&(i=0),f.infiniteScrolledToRow=i,e.update(),e.selection&&e.selection.updateSelection()}if(!(--g.rowIndex<0)&&(a=h.getCell(g.rowIndex,g.columnIndex),a.dom)){switch(d.selModel){case"cell":case"cells":d.clearSelection(),a.addCls(b,c),e.infinite||e.scroller.scrollToCell(a.dom,!0);break;case"row":case"rows":e.selection&&e.selection.activeCell?(e.selection.clearActiveCell(),a.addCls(b),e.infinite||e.scroller.scrollToCell(a.dom,!0)):(d.clearSelection(),d.selectRow(g.rowIndex),a.addCls(b,c),e.infinite||e.scroller.scrollToCell(a.dom,!0),"rows"===d.selModel&&d.updateHeaderCheckBox());break;case"column":case"columns":e.selection&&e.selection.activeCell&&(e.selection.clearActiveCell(),a.addCls(b),e.infinite||e.scroller.scrollToCell(a.dom,!0))}return a}},moveDown:function(){var a,d=this,e=d.widget,f=e.store,g=d.getActiveCellInfo(),h=e.getBody(g.side);if(e.infinite&&g.rowIndex>e.numOfVisibleCells-3){var i=f.infiniteScrolledToRow+1;return i>f.getNumOfInfiniteRows()-(e.numOfVisibleCells-1)&&(i=f.getNumOfInfiniteRows()-(e.numOfVisibleCells-1)),f.infiniteScrolledToRow=i,e.update(),void(e.selection&&e.selection.updateSelection())}if(g.rowIndex++,a=h.getCell(g.rowIndex,g.columnIndex),a.dom){switch(d.selModel){case"cell":case"cells":d.clearSelection(),a.addCls(b,c),e.infinite||e.scroller.scrollToCell(a.dom,!0);break;case"row":case"rows":e.selection&&e.selection.activeCell?(e.selection.clearActiveCell(),a.addCls(b),e.infinite||e.scroller.scrollToCell(a.dom,!0)):(d.clearSelection(),d.selectRow(g.rowIndex),a.addCls(b,c),e.infinite||e.scroller.scrollToCell(a.dom,!0),"rows"===d.selModel&&d.updateHeaderCheckBox());break;case"column":case"columns":e.selection&&e.selection.activeCell&&(e.selection.clearActiveCell(),a.addCls(b),e.scroller.scrollToCell(a.dom,!0))}return a}},scrollPageUP:function(){var a,b=this,c=b.widget,d=parseInt(c.body.el.height()),e=c.scroller;a=c.nativeScroller?c.body.el.dom.scrollTop-d:e.scrollTop-d,a<0&&(a=0),c.scroll(a)},scrollPageDOWN:function(){var a,b=this,c=b.widget,d=c.gridBorders,e=c.getBodyHeight()-d[0]-d[2],f=c.getCellsViewHeight()-d[0]-d[2],g=c.scroller;a=c.nativeScroller?c.body.el.dom.scrollTop+e:g.scrollTop+e,a>f-e&&(a=f-e),a<0&&(a=0),c.scroll(a)},scrollHome:function(){this.widget.scroll(0)},scrollEnd:function(){this.widget.scroll(1e6)}})}();