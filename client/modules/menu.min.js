Fancy.modules.menu=!0,function(){const e=Fancy,t=e.MENU_CLS,i=e.MENU_ITEM_CLS,n=e.MENU_ITEM_IMAGE_CLS,s=e.MENU_ITEM_TEXT_CLS,a=e.MENU_ITEM_SIDE_TEXT_CLS,c=e.MENU_ITEM_ACTIVE_CLS,l=e.MENU_ITEM_RIGHT_IMAGE_CLS,d=e.MENU_ITEM_EXPAND_CLS,o=e.MENU_ITEM_DISABLED_CLS,h=e.MENU_ITEM_SEP_CLS,r=e.MENU_ITEM_NO_IMAGE_CLS;Fancy.define("Fancy.Menu",{extend:Fancy.Widget,constructor:function(e){Fancy.applyConfig(this,e),this.theme&&(this.itemHeight=Fancy.themes[this.theme].config.menuItemHeight),this.Super("const",arguments)},init(){const e=this;e.addEvents("hide"),e.Super("init",arguments),e.width<e.minWidth&&(e.width=e.minWidth),e.applyDefaults(),e.render(),e.ons()},ons(){const e=this,t=e.el;t.on("mousedown",e.onItemMouseDown,e,`.${i}`),t.on("click",e.onItemClick,e,`.${i}`),t.on("mouseenter",e.onItemEnter,e,`.${i}`),t.on("mouseleave",e.onItemLeave,e,`.${i}`)},widgetCls:t,itemCls:i,itemImageCls:n,cls:"",extraCls:"",width:142,minWidth:50,itemHeight:30,maxHeight:200,rendered:!1,theme:"default",render(){const e=this,t=Fancy.get(document.createElement("div"));let i;e.fire("beforerender"),"default"!==e.theme&&t.addCls(Fancy.getThemeCSSCls(e.theme)),t.addClass(Fancy.cls,e.widgetCls,e.cls,e.extraCls),e.width<e.minWidth&&(e.width=e.minWidth),t.css({width:e.width,height:e.getItemsHeight()}),e.height&&t.css({height:e.height,"overflow-y":"scroll"}),i=Fancy.get(e.renderTo||document.body),e.el=i.dom.appendChild(t.dom),e.el=Fancy.get(e.el),e.renderItems(),e.items.length||e.el.css("border","0px"),e.fire("afterrender"),e.fire("render"),e.rendered=!0,e.checkHeight()},checkHeight(){const e=this;parseInt(e.el.css("height"))>e.maxHeight&&e.el.css({height:e.maxHeight,"overflow-y":"scroll"})},getItemsHeight(){for(var e=this.items,t=this.itemHeight,i=0,n=0,s=e.length;n<s;n++){var a=e[n];"sep"===a.type||"-"===a.type||"-"===a?i+=2:i+=t}return i},renderItems(){for(var e,t=this,i=0,c=t.items.length;i<c;i++){"-"===(e=t.items[i])&&(e={type:"sep"});const c=Fancy.get(document.createElement("div"));c.attr("index",i),c.addCls(t.itemCls),"sep"===e.type?c.addCls(h):c.css("height",t.itemHeight),t.el.dom.appendChild(c.dom),e.el=c;var u=e.imageCls||"";if(e.cls&&c.addCls(e.cls),"sep"!==e.type&&"-"!==e.type){var m=[!1===e.image?"":'<div class="'+n+" "+u+'"></div>','<div class="'+s+'"></div>'];e.sideText&&m.push('<div class="'+a+'">'+e.sideText+"</div>"),m.push('<div class="'+l+" "+(e.items?d:"")+'"></div>'),c.update(m.join(""))}switch(!1===e.image&&c.addCls(r),!0===e.disabled&&c.addCls(o),e.type){case"":case"-":case"sep":break;case"number":t.items[i].field=new Fancy.NumberField({label:!1,theme:t.theme,padding:"1px 0px 0px",width:90,renderAfter:c.select("."+n).item(0).dom,events:t.items[i].events,value:e.value||""});break;case"string":t.items[i].field=new Fancy.StringField({label:!1,theme:t.theme,padding:"1px 0px 0px",width:90,renderAfter:c.select("."+n).item(0).dom,events:t.items[i].events,value:e.value||""});break;default:c.select("."+s).item(0).update(e.text||"")}void 0!==e.checked&&(t.items[i].checkbox=new Fancy.CheckBox({label:!1,theme:t.theme,padding:"1px 8px 0px",renderTo:c.select("."+n).item(0).dom,value:e.checked}))}},applyDefaults(){var e=0,t=this.items.length;if(this.defaults)for(;e<t;e++)Fancy.applyIf(this.items[e],this.defaults)},onItemClick(e){var t=Fancy.get(e.currentTarget).attr("index"),i=this.items[t],n=[this,i];i.handler&&!i.disabled&&(i.scope?i.handler.apply(i.scope,n):i.handler(this,i))},onItemEnter(e){var t=this,i=Fancy.get(e.currentTarget),n=i.attr("index"),s=t.items[n],a=i.offset();if(t.shownSubMenu&&t.shownSubMenu.hide(),t.deActivateItem(),t.activateItem(n),s.items){if(!s.menu){const e=t.items[n];Fancy.apply(e,{parentItem:s,parentMenu:t,defaults:s.defaults,items:s.items,theme:t.theme}),t.items[n].menu=new Fancy.Menu(e)}s.menu.showAt(a.left+parseInt(i.width()),a.top),t.shownSubMenu=s.menu}},onItemLeave(){},showAt(t,i,n){const s=this;s.css("position","absolute"),s.css("left",t),s.css("top",i),s.css("z-index",1e3+e.zIndex++),s.el.show(),!1!==n&&(!s.parentMenu&&Fancy.MenuManager.activeMenu&&Fancy.MenuManager.activeMenu.id!==s.id&&Fancy.MenuManager.remove(),s.checkPosition()),s.parentMenu||Fancy.MenuManager.add(s)},hide(){const e=this;e.el.hide(),e.deActivateItem(),e.shownSubMenu&&e.shownSubMenu.hide(),e.fire("hide")},hideAll(){const e=this.parentMenu;e&&"none"!==e.el.css("display")&&e.hide(),this.hide()},activateItem(e){const t=this.items[e];"sep"===t.type||"-"===t||t.disabled||(this.activeItem=t,t.el.addCls(c))},deActivateItem(){const e=this.activeItem;e&&(e.el.removeClass(c),delete this.activeItem)},onItemMouseDown(e){"input"===e.target.tagName.toLocaleLowerCase()||e.preventDefault()},enableItem(e){const t=this.items[e];t.el.removeCls(o),t.disabled=!1},disableItem(e){const t=this.items[e];t.el.addCls(o),t.disabled=!0},checkPosition(){var t=this.el,i=t.offset(),n=parseInt(t.css("height")),s=parseInt(t.css("width")),a=e.getViewSize(),c=e.getScroll(),l=i.top+n,d=i.left+s,o=i.top,h=i.left;(l>a[0]+c[0]-20&&(o=i.top-(l-(a[0]+c[0]))-20),d>a[1]+c[1]-20)&&(h=this.parentMenu?parseInt(this.parentMenu.el.css("left"))-s:i.left-(d-(a[1]+c[1]))-20);this.showAt(h,o,!1)},setChecked(t,i){const n=this;i&&n.clearChecked();const s=n.el.select(".fancy-menu-item").item(t);e.getWidget(s.select(".fancy-field-checkbox").attr("id")).set(!0)},clearChecked(){this.el.select(".fancy-checkbox-on").each(t=>{const i=t.attr("id");e.getWidget(i).set(!1)})}}),Fancy.define("Fancy.MenuManager",{singleton:!0,inited:!1,constructor:function(){},init(){Fancy.get(document).on("click",this.onDocClick,this)},add(e){const t=this;t.inited||t.init(),t.activeMenu=e},remove(){this.activeMenu&&(this.activeMenu.hide(),delete this.activeMenu)},onDocClick(e){var i=10,n=Fancy.get(e.target);if(this.activeMenu){for(;i>0&&n.dom;){if(n.hasCls(t))return;n=n.parent(),i--}this.remove()}}})}(),function(){const e=Fancy,t=e.MENU_ITEM_IMG_COPY_CLS,i=e.MENU_ITEM_IMG_DELETE_CLS,n=e.MENU_ITEM_IMG_DUPLICATE_CLS,s=e.MENU_ITEM_IMG_EDIT_CLS;e.define("Fancy.grid.plugin.ContextMenu",{extend:e.Plugin,ptype:"grid.contextmenu",inWidgetName:"contextmenu",defaultItems:["copy","copy+","delete","-","export"],width:200,constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){this.widget.on("contextmenu",this.onContextMenu,this)},onContextMenu(e,t){const i=this,n=t.e;i.activeItem=t,n.preventDefault(),i.menu||i.initMenu(),setTimeout(()=>{i.showMenu(n,!0)},50)},initMenu(){const a=this,c=a.widget,l=[],d=a.items||e.Array.copy(a.defaultItems);e.each(d,(d,o)=>{var h=d,r={};switch(d.type&&(h=d.type,e.apply(r,d)),h){case"copy":e.applyIf(r,{text:"Copy",sideText:"CTRL+C",imageCls:t,handler(){c.copy()}}),l.push(r);break;case"copyWidthHeader":case"copy+":e.applyIf(r,{text:"Copy with Headers",imageCls:t,handler(){c.copy(!0)}}),l.push(r);break;case"delete":e.applyIf(r,{text:"Delete",imageCls:i,handler(){switch(c.selection.selModel){case"rows":case"row":var e=c.getSelection();0===e.length&&a.activeItem&&(e=a.activeItem.data),c.remove(e),c.clearSelection()}}}),l.push(r);break;case"edit":a.editItemIndex=o,e.applyIf(r,{text:"Edit",imageCls:s,disabled:!0,handler(){if(c.rowEdit){const e=c.selection.getActiveCell(),t=c.getSideByCell(e),i=c.getBody(t).getEventParams({currentTarget:e.dom});c.rowedit.edit(i)}}}),l.push(r);break;case"export":e.applyIf(r,{text:"Export",items:[{text:"CSV Export",handler:function(){c.exportToCSV({header:!0})}},{text:"Excel Export",handler(){c.exportToExcel({header:!0})}}]}),l.push(r);break;case"duplicate":e.applyIf(r,{text:"Duplicate",imageCls:n,handler(){switch(c.selection.selModel){case"rows":case"row":var t,i=c.getSelection(),n=[];if(i.length)t=c.getRowById(i[i.length-1].id)+1,e.each(i,t=>{const i=e.Object.copy(t);i.id=e.id(null,"TEMP-"),n.push(i)});else{if(!a.activeItem)return;t=c.getRowById(a.activeItem.data.id)+1,(n=e.Object.copy(a.activeItem.data)).id=e.id(null,"TEMP-")}c.insert(t,n),e.each(n,e=>{const t=c.getRowById(e.id);c.flashRow(t)})}}}),l.push(r);break;default:l.push(d)}}),a.menu=new Fancy.Menu({width:a.width,theme:c.theme,items:l})},showMenu(t,i){var n=this,s=n.widget,a=s.selection,c=n.menu.el,l=Fancy.get(t.target).offset(),d=l.top+40,o=l.left;if(i&&(d=t.pageY+40,o=t.pageX),e.isTouch&&(d=t.targetTouches[0].clientY+20,o=t.targetTouches[0].clientX),c.css({position:"absolute",top:d,left:o}),n.menu.css("z-index",1e3+e.zIndex++),n.menu.show(),c.animate({duration:200,top:d-20}),a&&n.editItemIndex)switch(a.selModel){case"rows":case"row":var h=s.getSelection();0===h.length||h.length>1?n.menu.disableItem(n.editItemIndex):n.menu.enableItem(n.editItemIndex)}setTimeout(()=>{Fancy.get(document).once("click",()=>n.hideMenu())},50)},hideMenu(){const e=this;setTimeout(()=>e.menu.hide(),50),delete e.activeItem}})}(),function(){const e=Fancy,t=e.GRID_HEADER_COLUMN_TRIGGERED_CLS,i=e.GRID_HEADER_CELL_TRIGGER_UP_CLS,n=e.GRID_HEADER_CELL_TRIGGER_DOWN_CLS;e.Mixin("Fancy.grid.header.mixin.Menu",{triggeredColumnCls:t,triggerUpCls:i,triggerDownCls:n,showMenu(i,n,s,a){const c=this,l=c.widget,d=i.offset();s.menu&&s.menu.rendered&&"block"===s.menu.el.css("display")?c.hideMenu():(c.hideMenu(),i.addCls(t),s.menu.rendered?!1!==s.menuColumns&&c.updateColumnsMenu(s,a):(s._menu=s.menu,s.menu=c.generateMenu(s,a),s.menu=new e.Menu({column:s,items:s.menu,theme:l.theme,events:[{hide:c.onMenuHide,scope:c}]})),s.menu.showAt(d.left+parseInt(i.css("width"))-26,d.top+parseInt(i.css("height"))-1),c.activeMenu=s.menu,c.activeCell=i)},hideMenu(){const e=this,i=e.widget,n=i.header,s=i.rightHeader,a=i.leftHeader;switch(e.side){case"left":n.activeMenu&&(n.activeMenu.hide(),n.activeCell.removeCls(t),delete n.activeMenu,delete n.activeCell),s.activeMenu&&(s.activeMenu.hide(),s.activeCell.removeCls(t),delete s.activeMenu,delete s.activeCell);break;case"center":a.activeMenu&&(a.activeMenu.hide(),a.activeCell.removeCls(t),delete a.activeMenu,delete a.activeCell),s.activeMenu&&(s.activeMenu.hide(),s.activeCell.removeCls(t),delete s.activeMenu,delete s.activeCell);break;case"right":a.activeMenu&&(a.activeMenu.hide(),a.activeCell.removeCls(t),delete a.activeMenu,delete a.activeCell),n.activeMenu&&(n.activeMenu.hide(),n.activeCell.removeCls(t),delete n.activeMenu,delete n.activeCell)}e.activeMenu&&(e.activeMenu.hide(),e.activeCell.removeCls(t)),delete e.activeMenu,delete e.activeCell},generateMenu(t,s){for(var a,c=this,l=c.widget,d=l.lang,o=[],h=!1===t.sortable?"fancy-menu-item-disabled":"",r=t.sortable&&!1!==t.menuSortable,u=!1!==t.lockable&&!1!==t.menuLockable,m=!1!==t.menuColumns,p=0,g=s.length,v={text:d.sortAsc,cls:h,imageCls:i,handler(){l.sorter.sort("asc",t.index,c.side),t.menu.hide()}},C={text:d.sortDesc,cls:h,imageCls:n,handler(){l.sorter.sort("desc",t.index,c.side),t.menu.hide()}},M={text:d.columns,index:"columns",items:c.prepareColumns(s)},f={text:d.autoSizeColumn,cls:h,handler(){l.autoSizeColumn(t.index,c.side,t),t.menu.hide()}},I={text:d.autoSizeColumns,cls:h,handler(){l.autoSizeColumns(),t.menu.hide()}};p<g;p++)if(t.index===s[p].index){a=p;break}if("columns"===t.menu)return o=M.items;if("size"===t.menu)return o.push(f),o.push(I),o;if(Fancy.isArray(t.menu))e.each(t.menu,function(e){switch(e){case"|":o.push("-");break;case"sort":o.push(v),o.push(C);break;case"columns":o.push(M);break;case"size":o.push(f),o.push(I);break;case"lock":switch(c.side){case"left":case"right":o.push({text:d.unlock,handler(){t.menu.hide(),l.unLockColumn(a,c.side)}});break;case"center":o.push({text:d.lock,handler(){t.menu.hide(),l.lockColumn(a,c.side)}}),o.push({text:d.rightLock,handler(){t.menu.hide(),l.rightLockColumn(a,c.side)}})}break;default:o.push(e)}});else if(r&&(o.push(v),o.push(C),o.push("-")),m&&o.push(M),u)switch(c.side){case"left":case"right":!1!==t.menuColumns&&o.push("-"),o.push({text:d.unlock,handler(){t.menu.hide(),l.unLockColumn(a,c.side)}});break;case"center":!1!==t.menuColumns&&o.push("-"),o.push({text:d.lock,handler(){t.menu.hide(),l.lockColumn(a,c.side)}}),o.push({text:d.rightLock,handler(){t.menu.hide(),l.rightLockColumn(a,c.side)}})}return o},prepareColumns(t){var i,n=this,s=n.widget,a=[],c=[];return e.each(t,e=>{let t=!0;if(!1===e.columnMenu)return;e.hidden&&(t=!1);const l={text:e.title,checked:t,index:e.index,column:e,handler(t,i){!0!==i.checked||i.checkbox.get()||i.checkbox.set(!0),i.checked&&1===t.el.select(".fancy-checkbox-on").length?i.checkbox.set(!0):(i.checked=!i.checked,i.checkbox.set(i.checked),i.checked?s.showColumn(n.side,i.index,e):s.hideColumn(n.side,i.index,e),s.responsive&&s.onWindowResize())}};if(e.grouping)return(c=c||[]).push(l),void(i=e.grouping);c.length&&(a.push({text:i,items:c}),i=void 0,c=[]),a.push(l)}),c.length&&a.push({text:i,items:c}),a},onMenuHide(){this.el.select(`.${t}`).removeCls(t)},updateColumnsMenu(e,t,i){for(var n,s,a=e.menu,c=0,l=a.items.length;c<l;c++)if("columns"===(s=a.items[c]).index){n=s;break}if(!n)return;c=0,l=n.items.length;let d=!1;for(;c<l;c++){s=n.items[c];const e=t[c];s.checkbox&&(s.checkbox.set(!e.hidden,!1),d=!0)}d||i||(n.items=this.prepareColumns(t))},destroyMenus(){for(var t,i=this.widget.getColumns(this.side),n=0,s=i.length;n<s;n++)t=i[n],e.isObject(t.menu)&&t.menu.destroy()}})}();