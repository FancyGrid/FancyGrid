Fancy.modules.grid=!0,Fancy.Mixin("Fancy.grid.mixin.PrepareConfig",{prepareConfig:function(a,b){var c=this;return a._plugins=a._plugins||[],a.renderOuter&&(a.renderTo=a.renderOuter),a=c.generateColumnsFromData(a,b),a=c.copyColumns(a,b),a=c.prepareConfigScroll(a,b),a=c.prepareConfigData(a,b),a=c.prepareConfigTheme(a,b),a=c.prepareConfigLang(a,b),a=c.prepareConfigSpark(a,b),a=c.prepareConfigPaging(a,b),a=c.prepareConfigInfinite(a,b),a=c.prepareConfigBars(a),a=c.prepareConfigTBar(a),a=c.prepareConfigSubTBar(a),a=c.prepareConfigExpander(a),a=c.prepareConfigColumnMinMaxWidth(a),a=c.prepareConfigGrouping(a),a=c.prepareConfigGroupHeader(a),a=c.prepareConfigSorting(a),a=c.prepareConfigEdit(a),a=c.prepareConfigSelection(a),a=c.prepareConfigLoadMask(a,b),a=c.prepareConfigDefaults(a),a=c.prepareConfigFilter(a,b),a=c.prepareConfigSearch(a),a=c.prepareConfigSummary(a),a=c.prepareConfigState(a,b),a=c.prepareConfigExporter(a),a=c.prepareConfigSmartIndex(a),a=c.prepareConfigActionColumn(a),a=c.prepareConfigWidgetColumn(a),a=c.prepareConfigChart(a,b),a=c.prepareConfigCellTip(a),a=c.prepareConfigHeaderCellTip(a),a=c.prepareConfigColumnsWidth(a),a=c.prepareConfigSize(a,b),a=c.prepareConfigContextMenu(a,b),a=c.prepareConfigColumns(a),a=c.prepareConfigColumnsResizer(a),a=c.prepareConfigFooter(a),a=c.prepareConfigDD(a)},copyColumns:function(a,b){return a.columns&&(a.columns=Fancy.Array.copy(a.columns,!0)),b.columns&&(b.columns=Fancy.Array.copy(b.columns)),a},generateColumnsFromData:function(a,b){if(!a.columns&&a.data&&a.data.length&&Fancy.isArray(a.data[0])){var c=a.data[0]||a.data[0],d=[],e=[];Fancy.each(c,function(a,b){d.push({index:"autoIndex"+b}),e.push("autoIndex"+b)}),a.columns=d,a.data={items:a.data,fields:e},b.data=a.data}return a},prepareConfigScroll:function(a,b){return Fancy.isIE&&!1!==b.nativeScroller&&(a.nativeScroller=!0),a},prepareConfigSpark:function(a){var b=this;return Fancy.each(a.columns,function(c){var d=c.sparkConfig;if(d&&d.legend)switch(d.legend.type){case"tbar":case"bbar":case"buttons":var e=d.legend.type,f=c.index;a[e]=a[e]||[],a[e]=a[e].concat(b._generateLegendBar(d.title,f,d.legend.style,c))}}),a},_generateLegendBar:function(a,b,c,d){for(var e=0,f=a.length,g=[],h=this,i={length:0},j=function(b){var c,d=h;Fancy.each(h.columns,function(a,b){a.index===h.columns[b].index&&(c=b)}),(b.hasCls("fancy-legend-item-disabled")||a.length-1!==i.length)&&(b.toggleCls("fancy-legend-item-disabled"),b.hasCls("fancy-legend-item-disabled")?(i[b.index]=!0,d.disableLegend(c,b.index),i.length++):(d.enableLegend(c,b.index),delete i[b.index],i.length--))};e<f;e++){var k=b[e];Fancy.isString(d.index)&&(k=d.index+"."+e);var l={handler:j,index:k,imageColor:Fancy.COLORS[e],text:a[e]};0===e&&c&&(l.style=c),g.push(l)}return g},prepareConfigData:function(a){if(a.data||(a.data=[]),Fancy.isArray(a.data)&&0===a.data.length&&a.columns){var b=[],c={};Fancy.each(a.columns,function(a){if(a.index)if(/\./.test(a.index)){var d=a.index.split(".");c[d[0]]||(b.push(d[0]),c[d[0]]=!0)}else b.push(a.index||a.key);a.columns&&Fancy.each(a.columns,function(a){a.index&&b.push(a.index||a.key)})}),a.data={fields:b,items:[]}}return a},prepareConfigLoadMask:function(a){var b,c=!1!==a.loadMask;return Fancy.isString(a.loadMask)&&(b=a.loadMask),a._plugins.push({type:"grid.loadmask",showOnWaitingServer:c,loadText:b}),a},reConfigStore:function(a){var b=this,c=b.store,d=b.getFieldsFromData(a),e="Fancy.model."+Fancy.id();Fancy.define(e,{extend:Fancy.Model,fields:d}),b.model=e,c.model=e,b.fields=d,c.fields=d,c.setModel()},prepareConfigDefaults:function(a){return a.defaults=a.defaults||{},void 0===a.defaults.type&&(a.defaults.type="string"),Fancy.each(a.defaults,function(b,c){Fancy.each(a.columns,function(b){switch(b.type){case"select":case"order":case"expand":case"rowdrag":return}void 0===b[c]&&(b[c]=a.defaults[c]),"width"===c&&b.flex&&delete b.width})}),a},prepareConfigColumnMinMaxWidth:function(a){return Fancy.each(a.columns,function(a){void 0===a.width&&!a.flex&&a.minWidth&&(a.width=a.minWidth)}),a},prepareConfigCellTip:function(a){return Fancy.each(a.columns,function(b){if(b.cellTip)return a._plugins.push({type:"grid.celltip"}),!0}),a},prepareConfigHeaderCellTip:function(a){return Fancy.each(a.columns,function(b){if(b.headerCellTip)return a._plugins.push({type:"grid.headercelltip"}),!0}),a},prepareConfigDD:function(a){if(a.gridToGrid){var b={type:"grid.dragdrop"};Fancy.apply(b,a.gridToGrid),a._plugins.push(b)}if(a.rowDragDrop){var b={type:"grid.rowdragdrop"};Fancy.apply(b,a.rowDragDrop),a._plugins.push(b)}return a},prepareConfigColumns:function(a,b){for(var c=a.columns,d=[],e=[],f=0,g=c.length,h=!1,i=!1,j=!1,k=0,l=0,m=0;f<g;f++){var n=c[f];if(n.draggable&&(h=!0),"tree"===n.type&&(i=!0),"rowdrag"!==n.type&&!n.rowdrag||a.rowDragDrop||(a.rowDragDrop=!0),n.headerCheckBox&&(n.sortable=!1),n.autoHeight&&(j=!0),n.select&&(this.checkboxRowSelection=!0,this.multiSelect=!0,k++),!1!==b&&void 0===n.id&&(n.index?n.id=this.getColumnId(n.index):n.id=Fancy.id(null,"col-id-")),!n.title&&n.index&&!Fancy.isArray(n.index))switch(n.type){case"string":case"number":case"currency":case"date":case"combo":case"checkbox":case"text":n.title=Fancy.String.upFirstChar(n.index)}switch(n.type){case"select":this.checkboxRowSelection=!0,this.multiSelect=!0,c[f].index="$selected",c[f].editable=!0,k++;break;case"order":c[f].editable=!1,c[f].sortable=!1,c[f].index="$order",c[f].cellAlign="right",l++;break;case"rowdrag":c[f].editable=!1,c[f].sortable=!1,c[f].resizable=!1,c[f].width=30,c[f].index="$rowdrag",m++;break;case"checkbox":void 0===n.cellAlign&&(n.cellAlign="center");break;case"currency":void 0===n.format&&(n.format="number"),!1!==n.ellipsis&&(n.ellipsis=!0),n.editFormat||(n.editFormat="currency"),n.beforeSaveFormat||(n.beforeSaveFormat="currency");break;case"string":case"number":case"text":case"date":case"combo":case"tree":!1!==n.ellipsis&&(n.ellipsis=!0)}!1!==b&&(n.locked?(d.push(n),c.splice(f,1),f--,g--):n.rightLocked&&(e.push(n),c.splice(f,1),f--,g--))}if(!1===b)return a;if(j&&a._plugins.push({type:"grid.rowheight"}),h&&a._plugins.push({type:"grid.columndrag"}),i){var o={type:"grid.tree"};a.singleExpand&&(o.singleExpand=a.singleExpand),a._plugins.push(o),a.isTreeData=!0}return a.leftColumns=d,a.rightColumns=e,a},prepareConfigColumnsWidth:function(a){var b,c=this,d=a.columns,e=a.width,f=[],g=[],h=100,i=50,j=h,k=0,l=!1,m=!1,n=!1,o=Fancy.get(a.renderTo||document.body);if((a.width<1||void 0===a.width)&&"body"!==o.prop("tagName").toLocaleLowerCase()&&(n=o.closest(".tab-pane"))&&n.css({display:"block",visibility:"hidden"}),void 0!==e&&"fit"!==e||(e=Fancy.get(a.renderTo||document.body).width()),e-=2*a.panelBorderWidth,!1!==a.flexScrollSensitive)e-=a.bottomScrollHeight;else{var p=this.theme;Fancy.isString(a.theme)?p=a.theme:Fancy.isObject(a.theme)&&a.theme.name&&(p=a.theme.name),"bootstrap-no-borders"!==p&&(e-=1)}Fancy.each(d,function(b,d){switch(b.autoWidth&&(a.autoColumnWidth=!0),b.flex&&(a.hasFlexColumns=!0),b.type){case"select":void 0===b.width&&(b.width=35);break;case"order":void 0===b.width&&(b.width=40);break;case"rowdrag":void 0===b.width&&(b.width=30);break;case"expand":void 0===b.width&&(b.width=38);break;case"combo":b.data||(b.data=[],setTimeout(function(){c.on("init",function(){var a=c.store.getColumnUniqueData(b.index);c.setColumnComboData(b.index,a)})},1))}if(b.locked&&(l=!0),b.rightLocked&&(m=!0),b.hidden)return void(void 0===b.width&&(b.width=100));void 0===b.width?(b.flex&&(k+=b.flex,g.push(d)),f.push(d)):Fancy.isNumber(b.width)&&(e-=b.width)}),a.hasFlexColumns&&a._plugins.push({type:"grid.columnresizer"}),l&&m&&(e-=2);var q=parseInt(e/f.length);q<i&&(q=i),q>h&&(j=h),q<i&&(j=i);var r=!1,s=e;if(Fancy.each(f,function(a){b=d[a],void 0===b.flex&&(s-=j)}),k){var t=parseInt(s/k);Fancy.each(g,function(a){s-=t*d[a].flex})}return s<0&&(r=!0),Fancy.each(f,function(a){b=d[a],void 0===b.flex&&(b.width=j,e-=j)}),k&&(Fancy.each(g,function(a){b=d[a],b.width=r?j*b.flex:e/k*b.flex,b.width=parseInt(b.width),b.minWidth&&b.width<b.minWidth&&(b.width=b.minWidth)}),s>=1&&Fancy.each(g,function(a){if(s<1)return!0;b=d[a],b.width+=1,s-=1})),n&&n.css({display:"",visibility:""}),a},prepareConfigActionRender:function(a){return function(b){return Fancy.each(a.items,function(a){var c=a.text||"",d=Fancy.styleToString(a.style),e=a.cls||"";b.value+=['<div class="fancy-grid-column-action-item '+e+'" style="'+d+'">',c,"</div>"].join(" "),a.render&&(b=a.render(b))}),b}},prepareConfigSmartIndex:function(a){return Fancy.each(a.columns,function(a){if(/\+|\-|\/|\*|\[|\./.test(a.index)){var b=a.index;switch(b){case"xAxis.categories":case"yAxis.categories":case"zAxis.categories":return}b=b.replace(/(\w+)/g,function(a,b,c,d){return"."===d[c-1]?b:isNaN(Number(b))?"data."+b:b}),b="return "+b+";",a.smartIndexFn=new Function("data",b)}}),a},prepareConfigActionColumn:function(a){for(var b=this,c=a.columns,d=0,e=c.length;d<e;d++){var f=c[d];if("action"===f.type){f.sortable=!1,f.editable=!1,f.render=b.prepareConfigActionRender(f);var g=f.items;if(void 0!==g&&0!==g.length)for(var h,i=0,j=g.length;i<j;i++)switch(h=g[i],h.action){case"remove":void 0===h.handler&&(h.handler=function(a,b){a.remove(b)});break;case"dialog":!function(a){if(void 0===a.handler){for(var d=[],e=0,f=c.length,g=87;e<f;e++){var h=c[e];switch(h.type){case"action":continue}d.push({label:h.title||"",type:h.type,name:h.index}),g+=38}a.handler=function(c,e){a.dialog?(a.dialog.show(),a.dialog.set(e.data)):a.dialog=new FancyForm({window:!0,draggable:!0,modal:!0,title:{text:"Edit",tools:[{text:"Close",handler:function(){this.hide()}}]},width:300,height:g,items:d,buttons:["side",{text:"Clear",handler:function(){this.clear()}},{text:"Save",handler:function(){var a=this.get();a.id&&(b.getById(a.id).set(a),b.update())}}],events:[{init:function(){this.show(),this.set(e.data)}}]})}}}(h)}}}return a},prepareConfigWidgetColumn:function(a){for(var b=this,c=a.columns,d=0,e=c.length;d<e;d++){var f=c[d];f.widget&&(f.render=function(a){var c,d=a.cell.select("."+Fancy.FIELD_CLS),e=a.cell.dom,f=a.column,g={vtype:f.vtype,style:{padding:"0px","margin-top":"-10px","margin-left":"-1px"},label:!1,renderTo:e,value:a.value,emptyText:f.emptyText};if(d.length)c=Fancy.getWidget(d.dom.id),c.get()!=a.value&&c.set(a.value);else{var h=a.column.width,f=a.column,i=f.index;switch(a.column.type){case"number":case"currency":Fancy.apply(g,{spin:f.spin,min:f.min,max:f.max,events:[{change:function(c,d){b.set(a.rowIndex,i,d),b.updater.updateRow()}}]}),c=new Fancy.NumberField(g);break;case"string":case"image":Fancy.apply(g,{events:[{change:function(c,d){b.set(a.rowIndex,i,d),b.updater.updateRow()}}]}),c=new Fancy.StringField(g);break;case"combo":Fancy.apply(g,{displayKey:a.column.displayKey,valueKey:a.column.displayKey,padding:!1,checkValidOnTyping:!0,data:a.column.data,events:[{change:function(c,d){b.set(a.rowIndex,i,d),b.updater.updateRow()}}]}),c=new Fancy.Combo(g)}switch(a.column.type){case"number":case"string":case"currency":case"image":c.setInputSize({width:h+1,height:33});break;case"combo":c.size({width:h+1,height:33})}}return a})}return a},prepareConfigSorting:function(a){return(a.defaults||{}).sortable?(a._plugins.push({type:"grid.sorter"}),a):(Fancy.each(a.columns,function(b){b.sortable&&a._plugins.push({type:"grid.sorter"})}),a)},prepareConfigSelection:function(a){var b=!1,c={type:"grid.selection"},d=!1;if((a.trackOver||a.columnTrackOver||a.cellTrackOver)&&(b=!0),a.selModel){b=!0;var e=!1,f=!1,g=!0,h=!1,i=!0,j=!1,k=!0,l=!1,m=!1,n=!1,o=!1,p=!1,q=!1,r=!1;if(Fancy.isObject(a.selModel)){e=!!a.selModel.checkOnly,r=!!a.selModel.activeCell,("cell"===a.selModel.type||"cells"===a.selModel.type||r)&&(a.selModel.selectBottomCellAfterEdit&&(l=!0),a.selModel.selectRightCellOnEnd&&(m=!0),a.selModel.selectLeftCellOnLeftEnd&&(n=!0),a.selModel.selectUpCellOnUp&&(o=!0),a.selModel.selectBottomCellOnDown&&(p=!0),a.selModel.continueEditOnEnter&&(q=a.selModel.continueEditOnEnter));var s=!1,t=!1;if(Fancy.each(a.columns,function(a){"tree"===a.type&&(s=!0),a.select&&(t=!0),"select"===a.type&&(t=!0)}),s&&t&&(e=!0),!a.selModel.type)throw new Error("[FancyGrid Error 5]: Type for selection is not set");void 0!==a.selModel.mouseMoveSelection&&(k=a.selModel.mouseMoveSelection),f=!0===a.selModel.memory,a.selModel.disabled&&(d=!0),a.selModel.selectLeafsOnly&&(h=!0),void 0!==a.selModel.allowDeselect&&(j=!0),void 0!==a.selModel.keyNavigation&&(i=a.selModel.keyNavigation),a.selModel=a.selModel.type}"rows"===a.selModel&&(a.multiSelect=!0),a.selection=a.selection||{},a.selection.selModel=a.selModel,a.selection[a.selModel]=!0,a.selection.checkOnly=e,a.selection.memory=f,a.selection.memoryPerformance=g,a.selection.disabled=d,a.selection.selectLeafsOnly=h,a.selection.keyNavigation=i,a.selection.allowDeselect=j,a.selection.mouseMoveSelection=k,a.selection.selectBottomCellAfterEdit=l,a.selection.selectRightCellOnEnd=m,a.selection.selectLeftCellOnLeftEnd=n,a.selection.selectUpCellOnUp=o,a.selection.selectBottomCellOnDown=p,a.selection.continueEditOnEnter=q,a.selection.activeCell=r}return a.selection&&(b=!0,Fancy.isObject(a.selection)&&Fancy.apply(c,a.selection)),!0===b&&a._plugins.push(c),a},prepareConfigEdit:function(a){var b=a.defaults||{},c={type:"grid.edit"},d=!1,e=b.editable;return void 0!==a.clicksToEdit&&(c.clicksToEdit=a.clicksToEdit),e&&(d||a._plugins.push(c),a._plugins.push({type:"grid.celledit"}),d=!0),a.rowEdit&&a._plugins.push({type:"grid.rowedit"}),Fancy.each(a.columns,function(b){switch(void 0===b.index&&void 0===b.key&&(b.editable=!1),b.type){case"image":b.sortable=!1;break;case"sparklineline":case"sparklinebar":case"sparklinetristate":case"sparklinediscrete":case"sparklinebullet":case"sparklinepie":case"sparklinebox":b.editable=!1,b.sortable=!1}b.editable&&!1===d&&(a._plugins.push(c),a._plugins.push({type:"grid.celledit"}))}),a},prepareConfigExpander:function(a){if(a.expander){var b=a.expander;Fancy.apply(b,{type:"grid.expander"}),a.expanded={},a.grouping&&(b.expanded=!1),a._plugins.push(b)}return a},prepareConfigGrouping:function(a){if(a.grouping){var b=a.grouping;!0===b&&(b={}),Fancy.apply(b,{type:"grid.grouping"}),a.expanded={},a._plugins.push(b)}return a},prepareConfigSummary:function(a){if(a.summary){var b=a.summary;!0===b&&(b={}),Fancy.apply(b,{type:"grid.summary"}),a._plugins.push(b)}return a},prepareConfigContextMenu:function(a){if(a.contextmenu){var b=a.contextmenu;Fancy.isArray(a.contextmenu)&&Fancy.each(a.contextmenu,function(b){"export"===b&&(a.exporter=!0)}),!0===b&&(b={}),Fancy.isArray(b)&&(b={items:b}),Fancy.apply(b,{type:"grid.contextmenu"}),a._plugins.push(b)}return a},prepareConfigExporter:function(a){if(a.exporter){var b=a.exporter;!0===b&&(b={}),Fancy.apply(b,{type:"grid.exporter"}),a._plugins.push(b)}return a},prepareConfigFilter:function(a){var b=a.columns,c=!1,d=!1,e=!1,f={type:"grid.filter"};return a.filter&&(!0===a.filter&&(c=!0,a.filter={}),Fancy.apply(f,a.filter)),Fancy.each(b,function(a){a.filter&&(c=!0,a.filter.header&&(d=!0,a.grouping&&(e=!0)))}),f.header=d,f.groupHeader=e,c&&(a._plugins.push(f),a.filterable=!0),a},prepareConfigSearch:function(a){var b={type:"grid.search"},c=!1;return a.searching&&(c=!0,Fancy.apply(b,a.searching)),c&&a._plugins.push(b),a},prepareConfigGroupHeader:function(a){var b=a.columns,c=0,d=b.length,e=[],f=!1,g=[];if(Fancy.each(b,function(a){a.columns&&(f=!0,e.push(a))}),f){for(c=0;c<d;c++){var h=b[c];if(h.columns){for(var i=0,j=h.columns.length,k=h.text||h.title||"  ";i<j;i++)h.locked&&(h.columns[i].locked=!0),h.rightLocked&&(h.columns[i].rightLocked=!0),h.columns[i].grouping=k,h.defaults&&(Fancy.applyIf(h.columns[i],h.defaults),h.defaults.width&&h.columns[i].flex&&delete h.columns[i].width);g=g.concat(h.columns)}else g=g.concat(b.slice(c,c+1))}var l={};Fancy.each(e,function(a){l[a.title||a.text||""]=a}),a.columns=g,a._plugins.push({type:"grid.groupheader",groups:e,groupsMap:l}),a.isGroupedHeader=!0}return a},prepareConfigPaging:function(a,b){var c=this,d=a.lang,e=a.paging,f="bbar",g="last";if(!e)return a;if(void 0!==e.barType)switch(e.barType){case"bbar":case"tbar":case"both":f=e.barType;break;case!1:case"none":f="none";break;default:throw new Error("[FancyGrid Error]: - not supported bar type for paging")}return e.pageOverFlowType&&(g=e.pageOverFlowType),a._plugins.push({i18n:b.i18n,type:"grid.paging",barType:f,pageOverFlowType:g}),"both"===f?(a.tbar=c.generatePagingBar(e,d),a.bbar=c.generatePagingBar(e,d)):"none"===f||(a[f]=c.generatePagingBar(e,d)),a},prepareConfigInfinite:function(a){return a.infinite?(a.nativeScroller=!1,a._plugins.push({type:"grid.infinite"}),a):a},generatePagingBar:function(a,b){var c=this,d=[],e="fancy-bar-button-disabled",f="material"===c.theme?8:3,g={float:"left","margin-right":"5px","margin-top":f+"px"};if(d.push({imageCls:"fancy-paging-first",disabledCls:e,role:"first",handler:function(){c.paging.firstPage()},style:{float:"left","margin-left":"5px","margin-right":"5px","margin-top":f+"px"}}),d.push({imageCls:"fancy-paging-prev",disabledCls:e,role:"prev",handler:function(){c.paging.prevPage()},style:g}),d.push("|"),d.push({type:"text",text:b.paging.page}),d.push({type:"number",label:!1,padding:!1,style:{float:"left","margin-left":"-1px","margin-right":"8px","margin-top":f+1+"px"},role:"pagenumber",min:1,width:a.inputWidth||30,listeners:[{enter:function(a){0===parseInt(a.getValue())&&a.set(1);var b=parseInt(a.getValue())-1,d=c.paging.setPage(b);b!==d&&a.set(d)}},{up:function(a,b){var d=c.store.pages;Number(b)>d&&a.set(d)}}]}),d.push({type:"text",text:"",role:"ofText"}),d.push("|"),d.push({imageCls:"fancy-paging-next",disabledCls:e,role:"next",style:g,handler:function(){c.paging.nextPage()}}),d.push({imageCls:"fancy-paging-last",disabledCls:e,role:"last",style:g,handler:function(){c.paging.lastPage()}}),Fancy.isObject(a)&&!0===a.refreshButton&&(d.push("|"),d.push({imageCls:"fancy-paging-refresh",disabledCls:e,role:"refresh",style:g,handler:function(){c.paging.refresh()}})),a&&Fancy.isArray(a.pageSizeData)){for(var h=a.pageSizeData,i=[],j=0,k=h.length,l=0;j<k;j++)i.push({index:j,value:h[j]}),a.pageSize===h[j]&&(l=j);var m=Fancy.Object.copy(g);m["margin-top"]=f+1+"px",d.push({editable:!1,width:50,type:"combo",role:"size",style:m,data:i,displayKey:"value",valueKey:"index",value:l,subSearch:!1,events:[{change:function(a,b){c.scroll(0,0),c.paging.setPageSize(h[b])}},{render:function(a){c.store.on("changepages",function(){if(c.store.pageSize!==Number(a.input.dom.value)){var b;Fancy.each(a.data,function(a){if(a.value===c.store.pageSize)return b=a.index,!0}),void 0!==b&&a.setValue(b,!1)}})}}]})}return d.push("side"),d.push({type:"text",role:"info",text:""}),d},prepareConfigState:function(a){var b=this;if(a.stateful){var c={};Fancy.isObject(a.stateful)&&(c=a.stateful);var d=a.state||{},e=a.stateId||this.getStateName(),f=localStorage.getItem(e);if(f||(b.memoryInitialColumns(e,a.columns),a.defaults&&b.memoryInitialDefaults(e,a.defaults)),f&&(b.wasColumnsCodeChanged(e,a.columns)||b.wasDefaultChanged(e,a.defaults))&&(localStorage.clear(e),localStorage.clear(e+"memory-columns"),f=null,b.memoryInitialColumns(e,a.columns),a.defaults&&b.memoryInitialDefaults(e,a.defaults)),f){f=JSON.parse(f);for(var g in f)Fancy.isString(f[g])&&(f[g]=JSON.parse(f[g]));var h=f.columns;h&&(Fancy.each(h,function(b){Fancy.each(b,function(c,d){if("FUNCTION"===c||"OBJECT"===c||"ARRAY"===c){var e=b.index;Fancy.each(a.columns,function(a){if(a.index===e)return b[d]=a[d],!0})}})}),a.columns=h);for(var g in f)"columns"!==g&&void 0===d[g]&&(d[g]=f[g])}a._plugins.push({type:"grid.state",stateful:!0,startState:d,log:c})}else a.state&&a._plugins.push({type:"grid.state",startState:a.state});return a},prepareConfigColumnsResizer:function(a){if((a.defaults||{}).resizable)return a._plugins.push({type:"grid.columnresizer"}),a;var b=[].concat(a.columns).concat(a.leftColumns).concat(a.rightColumns);return Fancy.each(b,function(b){if(b.resizable||b.autoWidth)return a._plugins.push({type:"grid.columnresizer"}),!0}),a},prepareConfigBars:function(a){var b=function(b){for(var c=0,d=b.length;c<d;c++)switch(b[c].type){case"date":if(!b[c].format){var e=a.lang.date;b[c].format={read:e.read,write:e.write,edit:e.edit}}a.i18n&&(b[c].i18n=a.i18n)}};return b(a.tbar||[]),b(a.subTBar||[]),b(a.bbar||[]),b(a.buttons||[]),a},prepareConfigTBar:function(a){var b=this,c=a.tbar;if(c)for(var d=0,e=c.length;d<e;d++){switch(c[d].type){case"search":a.searching=a.searching||{},a.filter=a.filter||!0;break;case"date":a.i18n&&(c[d].i18n=a.i18n)}switch(c[d].action){case"add":void 0===c[d].handler&&(c[d].handler=function(){b.insert(0,{}),b.scroll(0)});break;case"undo":void 0===c[d].handler&&(c[d].handler=function(){b.undo()});break;case"undoall":void 0===c[d].handler&&(c[d].handler=function(){b.undoAll()});break;case"redo":void 0===c[d].handler&&(c[d].handler=function(){b.redo()});break;case"remove":void 0===c[d].handler&&(c[d].disabled=!0,c[d].handler=function(){Fancy.each(b.getSelection(),function(a){b.remove(a)}),b.selection.clearSelection()},c[d].events=[{render:function(){var a=this;setTimeout(function(){var b=Fancy.getWidget(a.el.parent().parent().parent().select("."+Fancy.GRID_CLS).dom.id);b.on("select",function(){0===b.getSelection().length?a.disable():a.enable()}),b.on("clearselect",function(){a.disable()})},10)}}])}}return a},prepareConfigSubTBar:function(a){var b=a.subTBar;if(b)for(var c=0,d=b.length;c<d;c++)switch(b[c].type){case"search":a.searching=a.searching||{},a.filter=a.filter||!0}return a},prepareConfigChart:function(a){var b=a.data,c=b.chart;return Fancy.isObject(c)&&(c=[c]),b&&b.chart&&(a._plugins.push({type:"grid.chartintegration",chart:c,toChart:!!b.items||!!b.proxy}),Fancy.each(c,function(b){var c=b.type;switch(c){case"highchart":case"highcharts":a._plugins.push({type:"grid.highchart"});break;case void 0:throw new Error("[FancyGrid Error] - type of chart is undefined");default:throw new Error("[FancyGrid Error] - type of chart "+c+" does not exist")}})),a},prepareConfigSize:function(a){var b,c,d,e=this,f=a.renderTo,g=!!(a.title||a.subTitle||a.tbar||a.bbar||a.buttons||a.panel),h=a.panelBodyBorders,i=a.gridWithoutPanelBorders,j=a.gridBorders;if(void 0===a.width){if(f){if(a.responsive=!0,a.responsiveWidth=!0,d=Fancy.get(f),a.width=parseInt(d.width()),a.width<1&&"body"!==d.prop("tagName").toLocaleLowerCase()){var k=d.closest(".tab-pane");k?(k.css({display:"block",visibility:"hidden"}),a.width=parseInt(d.width()),k.css({display:"",visibility:""})):a.width=d.parent().width()}0===a.width&&(a.width=parseInt(d.parent().width()))}}else if("fit"===a.width){var l=0,m=!1;this.fitWidth=!0,Fancy.each(a.columns,function(a){a.hidden||(l+=a.width),a.locked&&(m=!0)}),a.title||a.subTitle?l+=h[1]+h[3]+j[1]+j[3]:l+=i[1]+i[3]+j[1]+j[3],m&&l--,a.width=l}if(void 0===a.height){if(f){a.responsiveHeight=!0;var c=parseInt(d.height());c<50&&(c=parseInt(d.parent().css("height"))),a.height=c}}else if("fit"===a.height){var n=1;b=0,Fancy.each(a.columns,function(a){a.grouping&&(n<2&&(n=2),a.filter&&a.filter.header&&n<3&&(n=3)),a.filter&&a.filter.header&&n<2&&(n=2)}),Fancy.isArray(a.data)?b=a.data.length:a.data&&Fancy.isArray(a.data.items)&&(b=a.data.items.length),c=b*a.cellHeight,a.title&&(c+=a.titleHeight),a.tbar&&(c+=a.tbarHeight||a.barHeight),a.tabs&&(c+=a.barHeight),a.bbar&&(c+=e.bbarHeight||a.barHeight),a.buttons&&(c+=a.buttonsHeight||a.barHeight),a.subTBar&&(c+=a.subTBarHeight||a.barHeight),a.footer&&(c+=a.barHeight),!1!==a.header&&(c+=a.cellHeaderHeight*n),c+=g?h[0]+h[2]+j[0]+j[2]:i[0]+i[2]+j[0]+j[2],a.minHeight&&c<a.minHeight&&(c=a.minHeight),a.heightFit=!0,a.height=c}return g&&!a.title&&(a.panelBodyBorders=[0,0,0,0],setTimeout(function(){e.panel&&e.panel.css("border-bottom-width",0)},1)),a},wasDefaultChanged:function(a,b){a+="-memory-defaults";var c=JSON.parse(localStorage.getItem(a));if(!c||!b)return!1;for(var d in c){switch(Fancy.typeOf(c[d])){case"number":case"string":case"boolean":break;default:continue}if(b[d]!==c[d])return!0}for(var d in b){switch(Fancy.typeOf(b[d])){case"number":case"string":case"boolean":break;default:continue}if(void 0===c[d])return!0}return!1},wasColumnsCodeChanged:function(a,b){a+="-memory-columns";var c=JSON.parse(localStorage.getItem(a));if(!c)return!1;if(b.length!==c.length)return!0;var d=!1;return Fancy.each(c,function(a,c){for(var e in a)if(a[e]!==b[c][e]){if("width"===e&&a.autoWidth)continue;return d=!0,!0}}),Fancy.each(b,function(a,b){for(var e in a)switch(Fancy.typeOf(a[e])){case"number":case"string":case"boolean":if(void 0===c[b][e])return d=!0,!0}}),d},memoryInitialDefaults:function(a,b){a+="-memory-defaults";var c={};for(var d in b)switch(Fancy.typeOf(b[d])){case"string":case"number":case"boolean":c[d]=b[d]}localStorage.setItem(a,JSON.stringify(c))},memoryInitialColumns:function(a,b){a+="-memory-columns";var c=[];Fancy.each(b,function(a){var b={};for(var d in a)switch(Fancy.typeOf(a[d])){case"string":case"number":case"boolean":b[d]=a[d]}c.push(b)}),localStorage.setItem(a,JSON.stringify(c))}}),Fancy.Mixin("Fancy.grid.mixin.ActionColumn",{initActionColumnHandler:function(){var a=this;a.on("cellclick",a.onCellClickColumnAction,a)},onCellClickColumnAction:function(a,b){var c,d,e=this,f=b.column,g=f.items;"action"===f.type&&(c=e.getActiveActionColumnItem(b),g&&void 0!==c&&(d=g[c],d.handler&&d.handler(e,b)))},getActiveActionColumnItem:function(a){for(var b=Fancy.get(a.cell),c=a.e.target,d=b.select("."+Fancy.GRID_COLUMN_ACTION_ITEM_CLS),e=0,f=d.length;e<f;e++)if(d.item(e).within(c))return e}}),function(){var a,b=Fancy,c=b.TOUCH_CLS,d=b.HIDDEN_CLS,e=b.GRID_CLS,f=b.GRID_STATE_SORTED_CLS,g=b.GRID_STATE_FILTERED_CLS,h=b.GRID_CENTER_CLS,i=b.GRID_LEFT_CLS,j=b.GRID_RIGHT_CLS,k=b.GRID_HEADER_CLS,l=b.GRID_BODY_CLS,m=b.PANEL_BODY_INNER_CLS,n=b.GRID_UNSELECTABLE_CLS,o=b.GRID_LEFT_EMPTY_CLS,p=b.GRID_RIGHT_EMPTY_CLS,q=b.GRID_COLUMN_SORT_ASC,r=b.GRID_COLUMN_SORT_DESC,s=b.GRID_ROW_GROUP_CLS,t=b.GRID_ROW_GROUP_COLLAPSED_CLS,u=b.PANEL_CLS,v=b.PANEL_TBAR_CLS,w=b.PANEL_SUB_TBAR_CLS,x=b.PANEL_BBAR_CLS,y=b.PANEL_BUTTONS_CLS,z=b.PANEL_GRID_INSIDE_CLS,A=b.ANIMATE_DURATION;b.Mixin("Fancy.grid.mixin.Grid",{tabScrollStep:80,waitingForFilters:!1,tpl:['<div class="'+i+" "+o+'"></div>','<div class="'+h+'"></div>','<div class="'+j+" "+p+'"></div>','<div class="fancy-grid-editors"></div>'],initStore:function(){var a,c,d,e=this,f=e.getFieldsFromData(e.data),g="Fancy.model."+b.id(),h=e.data,i=!1,j=e.state;e.data.items&&(h=e.data.items),a=e.data.remoteSort,c=e.data.remoteFilter,d=e.data.remotePage,d&&(d="server"),b.define(g,{extend:b.Model,fields:f}),e.isGroupable()&&void 0!==e.grouping.collapsed&&(i=e.grouping.collapsed);var k={widget:e,model:g,data:h,paging:e.paging,remoteSort:a,remoteFilter:c,pageType:d,collapsed:i,multiSort:e.multiSort};e.multiSortLimit&&(k.multiSortLimit=e.multiSortLimit),e.infinite&&(k.infinite=!0),j&&j.filters&&(k.filters=j.filters),!0!==e.filterable||k.filters||(k.filters={}),h.pageSize&&(k.pageSize=h.pageSize),e.store=new b.Store(k),e.model=g,e.fields=f},initDebug:function(){var a=this;b.DEBUG&&(a.panel?a.panel.addCls("fancy-debug"):a.addCls("fancy-debug"))},initTouch:function(){var a=this;b.isTouch&&window.FastClick&&(a.panel?(FastClick.attach(a.panel.el.dom),a.panel.addCls(c)):(FastClick.attach(a.el.dom),a.addCls(c)))},initElements:function(){var a=this;!1!==a.header&&(a.leftHeader=new b.grid.Header({widget:a,side:"left"}),a.header=new b.grid.Header({widget:a,side:"center"}),a.rightHeader=new b.grid.Header({widget:a,side:"right"})),a.leftBody=new b.grid.Body({widget:a,side:"left"}),a.body=new b.grid.Body({widget:a,side:"center"}),a.rightBody=new b.grid.Body({widget:a,side:"right"}),a.leftEl=a.el.select("."+i),a.centerEl=a.el.select("."+h),a.rightEl=a.el.select("."+j)},getFieldsFromData:function(a){var c=this,d=a.items||a;if(a.fields)return c.isTreeData&&(a.fields.push("$deep"),a.fields.push("leaf"),a.fields.push("parentId"),a.fields.push("expanded"),a.fields.push("child"),a.fields.push("filteredChild")),a.fields;d||b.error("Data is empty and not set fields of data to build model",4);var e=d[0],f=[];for(var g in e)f.push(g);return c.isTreeData&&(f.push("$deep"),f.push("leaf"),f.push("parentId"),f.push("expanded"),f.push("child")),f},render:function(){var a=this,c=Fancy.get(a.renderTo||document.body),d=b.get(document.createElement("div")),e=a.panelBodyBorders;a.renderOuter&&(d=c),c.dom||b.error("Could not find renderTo element: "+a.renderTo,1),d.addCls(b.cls,a.widgetCls,a.cls),Fancy.loadingStyle&&(a.panel?(a.panel.el.css("opacity",0),a.intervalStyleLoad=setInterval(function(){Fancy.loadingStyle||(clearInterval(a.intervalStyleLoad),a.panel.el.animate({opacity:1,force:!0}))},100)):(d.css("opacity",0),a.intervalStyleLoad=setInterval(function(){Fancy.loadingStyle||(clearInterval(a.intervalStyleLoad),a.el.animate({opacity:1,force:!0}))},100))),d.attr("role","grid"),d.attr("id",a.id),void 0===a.panel&&a.shadow&&d.addCls("fancy-panel-shadow"),!1===a.columnLines&&d.addCls("fancy-grid-disable-column-lines"),!1===a.rowLines&&d.addCls("fancy-grid-disable-row-lines"),"default"===a.theme||a.panel||d.addCls(Fancy.getThemeCSSCls(a.theme)),a.treeFolder&&d.addCls("fancy-grid-tree-folder");var f=0;a.panel&&(f=e[1]+e[3]),d.css({width:a.width-f+"px",height:a.height-0+"px"}),a.initTpl(),d.update(a.tpl.getHTML({})),a.renderOuter?a.el=d:a.el=b.get(c.dom.appendChild(d.dom)),a.setHardBordersWidth(),setTimeout(function(){Fancy.nojQuery&&a.el.addCls(Fancy.GRID_ANIMATION_CLS)},100),a.rendered=!0},setHardBordersWidth:function(){var a=this,b=a.panel?a.gridBorders:a.gridWithoutPanelBorders;a.wrapped&&(b=a.gridBorders),a.css({"border-top-width":b[0],"border-right-width":b[1],"border-bottom-width":b[2],"border-left-width":b[3]})},update:function(a){var b=this;if(!b.store.loading){b.expander&&b.expander.reSet();var c="default";if(a&&a.type&&(c=a.type),b.updater.update(c),b.fire("update"),b.heightFit&&b.fitHeight(),b.setBodysHeight(),b.paging&&b.paging.update(),a&&a.flash){var d=b.store.changed;for(var e in d){var f=d[e],g=b.getRowById(e);if(void 0!==g)for(var h in f)switch(h){case"length":break;default:var i=b.getColumnOrderByKey(h);switch(a.flash){case!0:b.flashCell(g,i.order,i.side);break;case"plusminus":b.flashCell(g,i.order,i.side,{type:"plusminus",delta:f[h].value-f[h].originValue})}}}b.clearDirty()}else b.scroller.update();b._setColumnsAutoWidth()}},lightStartUpdate:function(){var a=this;a.rowheight&&a.rowheight.onUpdate(),a.bugFixReFreshChartColumns("left"),a.bugFixReFreshChartColumns("center"),a.bugFixReFreshChartColumns("right")},bugFixReFreshChartColumns:function(a){var c=this,d=c.getBody(a),e=c.getColumns(a);b.each(e,function(a,b){switch(a.type){case"grossloss":d.renderGrossLoss(b);break;case"hbar":d.renderHBar(b)}})},getColumnsWidth:function(a){var b=this;switch(a){case"center":case void 0:return b.getCenterFullWidth();case"left":return b.getLeftFullWidth();case"right":return b.getRightFullWidth()}},setSides:function(){var a=this,b=a.leftColumns,c=a.rightColumns,d=a.getLeftFullWidth(),e=a.getCenterFullWidth(),f=a.getRightFullWidth(),g=a.gridBorders,m=a.panelBodyBorders,n=a.gridWithoutPanelBorders;b.length>0&&a.leftEl.removeCls(o),c.length>0&&a.rightEl.removeCls(p),e=a.wrapped?a.width-g[1]-g[3]:a.panel?a.width-g[1]-g[3]-m[1]-m[3]:a.width-n[1]-n[3],0===d&&0===f||(0===f?e-=d:0===d?e-=f:a.width>d+e+f?e-=d:e-=d+f),a.leftEl.css({width:d+"px"}),a.centerEl.css({left:d+"px",width:e+"px"}),a.header&&(a.el.select("."+i+" ."+k).css({width:d+"px"}),a.el.select("."+h+" ."+k).css({width:e+"px"})),a.el.select("."+h+" ."+l).css({width:e+"px"}),a.width>d+e+f?a.rightEl.css({right:"0px"}):a.rightEl.css({left:"",right:"0px"}),a.rightEl.css({width:f}),a.header&&a.el.select("."+j+" ."+k).css({width:f+"px"}),a.startWidths={center:e,left:d,right:f}},setColumnsPosition:function(){var a=this;a.body.setColumnsPosition(),a.leftBody.setColumnsPosition(),a.rightBody.setColumnsPosition()},setSidesHeight:function(a){var b=this,c=b.store,d=1,e=b.cellHeaderHeight;!1!==b.header&&(d+=e,b.filter&&b.filter.header&&(b.groupheader?b.filter.groupHeader&&(d+=e):d+=e),b.groupheader&&(b.filter&&b.filter.header,d+=e)),b.isGroupable()&&(d+=b.grouping.groups.length*b.groupRowHeight),b.expander&&(d+=b.expander.plusHeight),b.summary&&(d+=b.summary.topOffSet),b.rowheight&&b.rowheight.totalHeight&&(a=b.rowheight.totalHeight),d+=a||c.getLength()*b.cellHeight-1,b.paging&&b.summary&&"bottom"===b.summary.position&&(d=b.height),b.leftEl.css({height:d+"px"}),b.centerEl.css({height:d+"px"}),b.rightEl.css({height:d+"px"})},setBodysHeight:function(){var a=this;a.body.setHeight(),a.leftBody.setHeight(),a.rightBody.setHeight()},preRender:function(){var a=this;(a.title||a.subTitle||a.tbar||a.bbar||a.buttons||a.panel)&&a.renderPanel()},renderPanel:function(){var a=this,c={renderTo:a.renderTo,renderOuter:a.renderOuter,title:a.title,subTitle:a.subTitle,width:a.width,height:a.height,titleHeight:a.titleHeight,subTitleHeight:a.subTitleHeight,barHeight:a.barHeight,subTBarHeight:a.subTBarHeight||a.barHeight,tbarHeight:a.tbarHeight||a.barHeight,bbarHeight:a.bbarHeight||a.barHeight,buttonsHeight:a.buttonsHeight||a.barHeight,theme:a.theme,shadow:a.shadow,style:a.style||{},window:a.window,modal:a.modal,frame:a.frame,items:[a],draggable:a.draggable,resizable:a.resizable,minWidth:a.minWidth,minHeight:a.minHeight,panelBodyBorders:a.panelBodyBorders,barContainer:a.barContainer,barScrollEnabled:a.barScrollEnabled,tabScrollStep:a.tabScrollStep},d=a.panelBodyBorders;a.bbar&&(c.bbar=a.bbar,a.bbarHidden?c.bbarHidden=!0:a.height-=a.bbarHeight||a.barHeight),a.tbar&&(c.tbar=a.tbar,a.tbarHidden?c.tbarHidden=!0:a.height-=a.tbarHeight||a.barHeight),a.subTBar&&(c.subTBar=a.subTBar,a.subTBarHidden?c.subTBarHidden=!0:a.height-=a.subTBarHeight||a.barHeight),a.buttons&&(c.buttons=a.buttons,a.buttonsHidden?c.buttonsHidden=!0:a.height-=a.buttonsHeight||a.barHeight),a.footer&&(c.footer=a.footer,a.height-=a.barHeight),a.panel=new b.Panel(c),a.bbar=a.panel.bbar,a.tbar=a.panel.tbar,a.subTBar=a.panel.subTBar,a.buttons=a.panel.buttons,a.wrapped||a.panel.addCls(z),a.title&&(a.height-=a.titleHeight),a.subTitle&&(a.height-=a.subTitleHeight,a.height+=d[2]),a.height-=d[0]+d[2],a.renderTo=a.panel.el.select("."+m).dom,a.resizable&&a.panel.on("resize",function(){a.setBodysHeight()})},getBodyHeight:function(){var a=this,b=a.height,c=1,d=a.gridBorders,e=a.gridWithoutPanelBorders;return a.groupheader&&(c=2),a.filter&&a.filter.header&&(a.groupheader?(a.filter.groupHeader&&!a.subHeaderFilter&&c++,a.subHeaderFilter&&(b-=a.cellHeight)):a.subHeaderFilter?b-=a.cellHeight:c++),!1!==a.header&&(b-=a.cellHeaderHeight*c),a.panel?b-=d[0]+d[2]:b-=e[0]+e[2],a.summary&&(b-=a.summary.topOffSet,b-=a.summary.bottomOffSet),b},ons:function(){var a=this,c=a.store,d=b.get(document);c.on("set",a.onSetStore,a),c.on("insert",a.onInsertStore,a),c.on("remove",a.onRemoveStore,a),c.on("beforesort",a.onBeforeSortStore,a),c.on("sort",a.onSortStore,a),c.on("beforeload",a.onBeforeLoadStore,a),c.on("load",a.onLoadStore,a),d.on("mouseup",a.onDocMouseUp,a),d.on("click",a.onDocClick,a),d.on("mousemove",a.onDocMove,a),c.on("servererror",a.onServerError,a),c.on("serversuccess",a.onServerSuccess,a),a.responsive&&a.once("render",a.initResponsiveness,a),a.on("activate",a.onActivate,a),a.on("deactivate",a.onDeActivate,a),a.on("filter",a.onFilter,a),a.on("sort",a.onSort,a)},onServerError:function(a,b,c,d){this.fire("servererror",b,c,d)},onServerSuccess:function(a,b,c){this.fire("serversuccess",b,c)},onBeforeLoadStore:function(){this.fire("beforeload")},onRemoveStore:function(a,b,c){this.fire("remove",b,c)},onInsertStore:function(a,b){this.fire("insert",b)},onLoadStore:function(){var a=this;setTimeout(function(){a.fire("load"),a.stateIsWaiting||(a.UPDATING_AFTER_LOAD=!0,a.store.changeDataView({reSort:!0}),a.update(),a.setSidesHeight(),delete a.UPDATING_AFTER_LOAD)},1)},onSetStore:function(a,b){var c=this;c.fire("set",b),c.fire("change",b)},onBeforeSortStore:function(a,b){this.fire("beforesort",b)},onSortStore:function(a,b){this.fire("sort",b)},getCellsViewHeight:function(){var a=this,b=a.store,c=0,e=0;return a.isGroupable()&&(a.grouping.calcPlusScroll(),c+=a.grouping.plusScroll),a.expander&&(c+=a.expander.plusScroll),!a.scroller.scrollBottomEl||a.scroller.scrollBottomEl.hasCls(d)||(e=a.scroller.cornerSize),(a.rowheight?a.rowheight.totalHeight:a.cellHeight*b.dataView.length)+e+c},onDocMouseUp:function(){this.fire("docmouseup")},onDocClick:function(a){this.fire("docclick",a)},onDocMove:function(a){this.fire("docmove",a)},getCenterViewWidth:function(){var a=this,b=a.centerEl.width();if(0===b){for(var c=0,d=a.columns,e=0,f=d.length;e<f;e++){var g=d[e];g.hidden||(c+=g.width)}return c}return b},getCenterFullWidth:function(){for(var a=this,b=0,c=a.columns,d=0,e=c.length;d<e;d++){var f=c[d];f.hidden||(b+=f.width)}return b},getLeftFullWidth:function(){for(var a=this,b=0,c=a.leftColumns,d=0,e=c.length;d<e;d++){var f=c[d];f.hidden||(b+=f.width)}return b},getRightFullWidth:function(){for(var a=this,b=0,c=a.rightColumns,d=0,e=c.length;d<e;d++){var f=c[d];f.hidden||(b+=f.width)}return b},getColumns:function(a){var b=this,c=[];switch(a){case"left":c=b.leftColumns;break;case"center":c=b.columns;break;case"right":c=b.rightColumns;break;case void 0:c=c.concat(b.leftColumns).concat(b.columns).concat(b.rightColumns)}return c},setColumnsLinksToSide:function(a,b){var c=this;switch(b){case"left":c.leftColumns=a;break;case"center":case void 0:c.columns=a;break;case"right":c.rightColumns=a}},getBody:function(a){var b,c=this;switch(a){case"left":b=c.leftBody;break;case"center":b=c.body;break;case"right":b=c.rightBody}return b},getHeader:function(a){var b,c=this;switch(a){case"left":b=c.leftHeader;break;case"center":b=c.header;break;case"right":b=c.rightHeader}return b},getHeaderCell:function(a,c){var d,e,f=this;if(b.isString(a)){var g=f.getColumnOrderByKey(a);if(!(e=f.getHeader(g.side)))return;d=e.getCell(g.order)}else{if(c=c||"center",!(e=f.getHeader(c)))return;d=e.getCell(a)}return d},getDomRow:function(a){for(var b=this,c=b.leftBody,d=b.body,e=b.rightBody,f=b.leftColumns,g=b.columns,h=b.rightColumns,i=0,j=f.length,k=[];i<j;i++)k.push(c.getDomCell(a,i));for(i=0,j=g.length;i<j;i++)k.push(d.getDomCell(a,i));for(i=0,j=h.length;i<j;i++)k.push(e.getDomCell(a,i));return k},initTextSelection:function(){var a=this;!1===a.textSelection&&a.addCls(n)},setTrackOver:function(a,b){var c=this;switch(a){case"cell":c.cellTrackOver=b;break;case"column":c.columnTrackOver=b;break;case"row":c.trackOver=b}},setSelModel:function(a){var b=this,c=b.selection;c.cell=!1,c.cells=!1,c.row=!1,c.rows=!1,c.column=!1,c.columns=!1,c[a]=!0,c.selModel=a,b.multiSelect="rows"===a,c.clearSelection()},getSelection:function(a){return this.selection.getSelection(a)},selectCell:function(a){return this.selection.selectCell(a)},selectCellLeft:function(){return this.selection.moveLeft()},selectCellRight:function(){return this.selection.moveRight()},selectCellDown:function(){return this.selection.moveDown()},selectCellUp:function(){return this.selection.moveUp()},clearSelection:function(){var a=this,b=a.selection;b&&b.clearSelection()},destroy:function(a){var c=this,d=c.store,e=b.get(document);e.un("mouseup",c.onDocMouseUp,c),e.un("click",c.onDocClick,c),e.un("mousemove",c.onDocMove,c),c.el&&c.el.dom&&(c.body.destroy(),c.leftBody.destroy(),c.rightBody.destroy(),c.header.destroy(),c.leftHeader.destroy(),c.rightHeader.destroy(),c.scroller.destroy(),!1===a?c.panel?Fancy.each(c.panel.el.child(),function(a){a.destroy()}):Fancy.each(c.el.child(),function(a){a.destroy()}):(c.el.destroy(),c.panel&&c.panel.el.destroy())),d.destroy(),c.responsiveOverver&&c.responsiveOverver.stop&&(c.responsiveOverver.stop(),delete c.responsiveOverver)},clearData:function(){var a=this;a.setData([]),a.update(),a.scroller.update()},showAt:function(){var a=this;a.panel&&a.panel.showAt.apply(a.panel,arguments)},show:function(){var a=this;setTimeout(function(){a.panel?a.panel.show.apply(a.panel,arguments):a.el.show()},30)},hide:function(){var a=this;if(a.panel?a.panel.hide.apply(a.panel,arguments):a.el.hide(),a.celledit){var b=a.celledit.activeEditor;b&&b.hide()}},initDateColumn:function(){var a=this,c=function(c){for(var d=0,e=c.length;d<e;d++){var f=c[d];if("date"===f.type){f.format=f.format||{};var g={type:"date"};b.applyIf(g,a.lang.date),b.applyIf(f.format,g)}}return c};a.columns=c(a.columns),a.leftColumns=c(a.leftColumns),a.rightColumns=c(a.rightColumns)},stopEditor:function(){this.edit.stopEditor()},getById:function(a){return this.store.getById(a)},get:function(a,b){var c=this,d=c.store;return void 0!==b?d.get(a,b):void 0===a?d.get():d.getItem(a)},getRowById:function(a){return this.store.getRow(a)},getTotal:function(){return this.store.getTotal()},getViewTotal:function(){return this.store.getLength()},getDataView:function(){return this.store.getDataView()},getData:function(){return this.store.getData()},selectRow:function(a,b,c){this.selection.selectRow(a,b,c)},deSelectRow:function(a){this.selection.selectRow(a,!1,!0)},selectById:function(a,b,c){this.selection.selectById(a,b,c)},selectColumn:function(a){var b,c,d=this,e=d.leftColumns||[],f=d.columns||[],g=d.rightColumns||[],h=function(b){for(var d=0,e=b.length;d<e;d++){if(b[d].index===a)return c=d,!0}return!1};h(e)?b="left":h(f)?b="center":h(g)&&(b="right"),b&&d.selection.selectColumn(c,b)},getColumnByIndex:function(a){for(var b=this,c=b.getColumns(),d=0,e=c.length;d<e;d++){var f=c[d];if(f.index===a)return f}},getColumn:function(a){return this.getColumnByIndex(a)},getColumnById:function(a){for(var b=this,c=b.getColumns(),d=0,e=c.length;d<e;d++){var f=c[d];if(f.id===a)return f}},getColumnOrderByKey:function(a){var c,d=this,e=d.leftColumns||[],f=d.columns||[],g=d.rightColumns||[],h="";return b.each(f,function(b,d){b.index===a&&(h="center",c=d)}),h||(b.each(e,function(b,d){b.index===a&&(h="left",c=d)}),h||b.each(g,function(b,d){b.index===a&&(h="right",c=d)})),{side:h,order:c}},getColumnOrderById:function(a){var c,d=this,e=d.leftColumns||[],f=d.columns||[],g=d.rightColumns||[],h="";return b.each(f,function(b,d){b.id===a&&(h="center",c=d)}),h||(b.each(e,function(b,d){b.id===a&&(h="left",c=d)}),h||b.each(g,function(b,d){b.id===a&&(h="right",c=d)})),{side:h,order:c}},load:function(a){this.store.loadData(a)},save:function(){this.store.save()},onWindowResize:function(){var a,c=this,d=c.renderTo;c.panel&&(d=c.panel.renderTo),a=c.responsive?b.get(d):c.panel?c.panel.el:b.get(d),(a.hasClass(u)||a.hasClass(e))&&(a=a.parent());var f=a.width();if(void 0!==a.dom){if(0===f&&(f=a.parent().width()),c.responsive?c.setWidth(f):c.fitWidth,c.responsiveHeight){var g=parseInt(a.height());0===g&&(g=parseInt(a.parent().height())),c.setHeight(g)}c.setBodysHeight(),c.updateColumnsWidth(),c.scroller.scrollDelta(0),c.scroller.update()}},updateColumnsWidth:function(){var a=this,b=function(a,b,c){Fancy.each(a,function(a,c){if(!a.hidden&&a.flex)b.getCell(c)})};b(a.columns,a.header,"center"),b(a.leftColumns,a.leftHeader,"left"),b(a.rightColumns,a.rightHeader,"right")},setWidth:function(a){var b,c=this,d=c.el,e=c.gridBorders,f=c.gridWithoutPanelBorders,g=c.panelBodyBorders,i=c.body,j=c.header,k=function(a){for(var b=0,c=a.length,d=0;b<c;b++){a[b].hidden||(d+=a[b].width)}return d},l=k(c.leftColumns),m=k(c.rightColumns),n=a-l-m-g[1]-g[3];c.wrapped?(b=a,n=a-l-m,n-=e[1]+e[3],c.css({width:b})):c.panel?(n=a-l-m-g[1]-g[3],c.panel.el.width(a),n-=e[1]+e[3],b=a-g[1]-g[3],c.css({width:b})):(n=a-l-m-f[1]-f[3],d.css("width",a)),n<100&&(n=100),d.select("."+h).css("width",n),j.css("width",n),i.css("width",n),c.hasFlexColumns&&(c.reCalcColumnsWidth(),c.columnresizer.updateColumnsWidth()),c.scroller.setScrollBars(),c.fire("changewidth",a)},getWidth:function(){var a=this;return a.panel?parseInt(a.panel.css("width")):parseInt(a.css("width"))},getHeight:function(){var a=this;return a.panel?parseInt(a.panel.css("height")):parseInt(a.css("height"))},setHeight:function(a,b){var c=this,d=a,e=c.gridBorders;c.panelBodyBorders;c.panel&&!1!==b&&c.panel.setHeight(a),c.title&&(a-=c.titleHeight),c.subTitle&&(a-=c.subTitleHeight),c.footer&&(a-=c.barHeight),c.bbar&&!c.bbarHidden&&(a-=c.bbarHeight||c.barHeight),c.tbar&&!c.tbarHidden&&(a-=c.tbarHeight||c.barHeight),c.subTBar&&!c.subTBarHidden&&(a-=c.subTBarHeight||c.barHeight),c.buttons&&!c.buttonsHidden&&(a-=c.buttonsHeight||c.barHeight);var f=a;c.header&&(f-=c.cellHeaderHeight,c.groupheader&&(f-=c.cellHeaderHeight)),c.panel?f-=2:f-=e[0]+e[2],c.summary&&(c.summary.el?f-=c.summary.el.dom.clientHeight:f-=c.cellHeight),c.body&&c.body.css("height",f),c.leftBody&&c.leftBody.css("height",f),c.rightBody&&c.rightBody.css("height",f),c.el.css("height",a),c.height=a,c.scroller.update(),c.fire("changeheight",d)},find:function(a,b,c){return this.store.find(a,b,c)},findItem:function(a,b){return this.store.findItem(a,b)},each:function(a,b){this.store.each(a,b)},onActivate:function(){var c=this,d=b.get(document);a&&a.id!==c.id&&a.fire("deactivate"),setTimeout(function(){d.on("click",c.onDeactivateClick,c)},100),a=c},onDeActivate:function(){var a=this,c=b.get(document);a.activated=!1,c.un("click",a.onDeactivateClick,a),a.selection&&a.selection.activeCell&&a.selection.clearActiveCell()},onDeactivateClick:function(a){for(var c=this,d=0,e=20,f=b.get(a.target);d<e;d++){if(!f.dom)return;if(!f.dom.tagName||"body"===f.dom.tagName.toLocaleLowerCase())return void c.fire("deactivate");if(void 0===f.hasCls)return void c.fire("deactivate");if(f.hasCls(l))return;f=f.parent()}},search:function(a,b){this.searching.search(a,b)},stopSelection:function(){var a=this;a.selection&&a.selection.stopSelection()},enableSelection:function(a){var b=this;b.selection&&b.selection.enableSelection(a)},hideColumn:function(a,c,d){var e=this;if(!(void 0!==c||b.isArray(c)||b.isArray(a)||(c=a,a=this.getSideByColumnIndex(c)))){var f=e.getColumnOrderById(c);f.side||b.error("Column does not exist"),d=e.getColumnById(c),a=f.side}if(void 0===c&&(c=a,a=void 0),b.isArray(c))return void b.each(c,function(b){a?e.hideColumn(a,b):e.hideColumn(b)});if(d){var f=e.getColumnOrderById(d.id);if(a=f.side,d.hidden)return}var g,h=e.getBody(a),i=e.getHeader(a),j=e.getColumns(a),k=0,l=j.length,m=e.centerEl,n=e.leftEl,o=e.leftHeader,p=e.rightEl,q=e.rightHeader;if(d)g=f.order,d.hidden=!0;else if(b.isNumber(c)){if(d=j[c],d.hidden)return;g=c,d.hidden=!0}else for(;k<l;k++)if(d=j[k],d.index===c){if(d.hidden)return;g=k,d.hidden=!0;break}if(i.hideCell(g),h.hideColumn(g),e.rowedit&&e.rowedit.hideField(g,a),e.leftColumns.length||e.rightColumns.length){var r=e.calcCurrentLeftWidth(),s=e.calcCurrentRightWidth(),t=parseInt(e.el.css("width"))-r-s;e.panel?t-=e.gridBorders[1]+e.gridBorders[3]:t-=e.gridWithoutPanelBorders[1]+e.gridWithoutPanelBorders[3],n.animate({width:r},A),o.el.animate({width:r},A),m.animate({left:r},A),m.animate({width:t},A),e.body.el.animate({width:t},A),e.header.el.animate({width:t},A),p.animate({width:s},A),q.el.animate({width:s},A),0===s&&setTimeout(function(){p.css("display","none")},A)}e.isGroupable()&&e.grouping.updateGroupRows(),"right"!==a&&"left"!==a||(e.intervalScrollUpdate&&clearInterval(e.intervalScrollUpdate),e.intervalScrollUpdate=setTimeout(function(){e.scroller.update(),delete e.intervalScrollUpdate},A)),e.onWindowResize(),e.fire("columnhide",{column:d,side:a,orderIndex:g})},showColumn:function(a,c,d){var e=this;if(!(void 0!==c||b.isArray(c)||b.isArray(a)||(c=a,a=this.getSideByColumnIndex(c)))){var f=e.getColumnOrderById(c);f.side||b.error("Column "+c+" does not exist"),d=e.getColumnById(c),a=f.side}if(void 0===c&&(c=a,a=void 0),b.isArray(c))return void b.each(c,function(b){a?e.showColumn(a,b):e.showColumn(b)});if(d){var f=e.getColumnOrderById(d.id);if(a=f.side,!d.hidden)return}var g,h=e.getBody(a),i=e.getHeader(a),j=e.getColumns(a),k=0,l=j.length,m=e.centerEl,n=e.leftEl,o=e.leftHeader,p=e.rightEl,q=e.rightHeader;if(d)g=f.order,d.hidden=!1;else if(b.isNumber(c)){if(d=j[c],!d.hidden)return;g=c,d.hidden=!1}else for(;k<l;k++)if(d=j[k],d.index===c){if(!d.hidden)return;g=k,delete d.hidden;break}if(i.showCell(g,d.width),h.showColumn(g,d.width),e.rowedit&&e.rowedit.showField(g,a),e.leftColumns.length||e.rightColumns.length){var r=e.calcCurrentLeftWidth(),s=e.calcCurrentRightWidth(),t=parseInt(e.el.css("width"))-r-s;e.panel?t-=e.gridBorders[1]+e.gridBorders[3]:t-=e.gridWithoutPanelBorders[1]+e.gridWithoutPanelBorders[3],"none"===p.css("display")&&p.show(),n.animate({width:r},A),o.el.animate({width:r},A),m.animate({left:r},A),m.animate({width:t},A),e.body.el.animate({width:t},A),e.header.el.animate({width:t},A),p.animate({width:s},A),q.el.animate({width:s},A)}e.isGroupable()&&e.grouping.updateGroupRows(),"right"!==a&&"left"!==a||(e.intervalScrollUpdate&&clearInterval(e.intervalScrollUpdate),e.intervalScrollUpdate=setTimeout(function(){e.scroller.update(),delete e.intervalScrollUpdate},A)),e.onWindowResize(),e.fire("columnshow",{column:d,side:a,orderIndex:g})},removeColumn:function(a,c){var d,e=this,f=e.leftEl,g=e.leftHeader,h=e.leftBody,i=e.centerEl,j=e.body,k=e.header,l=e.rightEl,m=e.rightBody,n=e.rightHeader;if(void 0===c&&(c="center"),b.isString(a)){var o=e.getColumnOrderById(a);if(o.side)a=o.order,c=o.side;else{var p=e.getColumns(c);b.each(p,function(b,c){if(b.index===a)return a=c,!0}),b.isString(a)&&"center"===c&&(p=e.getColumns("left"),b.each(p,function(b,d){if(b.index===a)return a=d,c="left",!0}),b.isString(a)&&(p=e.getColumns("right"),b.each(p,function(b,d){if(b.index===a)return a=d,c="right",!0}),b.isString(a)&&b.error("Column was not found for method removeColumn",7)))}}else if(b.isObject(a)){var o=e.getColumnOrderById(a.id);d=a,a=o.order,c=o.side}switch(c){case"left":d=e.leftColumns[a],e.leftColumns.splice(a,1),g.removeCell(a),g.reSetIndexes(),h.removeColumn(a),f.css("width",parseInt(f.css("width"))-d.width),i.css("left",parseInt(i.css("left"))-d.width),i.css("width",parseInt(i.css("width"))+d.width),j.css("width",parseInt(j.css("width"))+d.width),k.css("width",parseInt(k.css("width"))+d.width),0===e.leftColumns.length&&e.leftEl.addCls(Fancy.GRID_LEFT_EMPTY_CLS);break;case"center":d=e.columns[a],e.columns.splice(a,1),k.removeCell(a),k.reSetIndexes(),j.removeColumn(a);break;case"right":var q=0;d=e.rightColumns[a],e.rightColumns.splice(a,1),n.removeCell(a),n.reSetIndexes(),m.removeColumn(a),l.css("width",parseInt(l.css("width"))-d.width),i.css("width",parseInt(i.css("width"))+d.width),k.css("width",parseInt(k.css("width"))+d.width),0===e.rightColumns.length&&(e.rightEl.addCls(Fancy.GRID_RIGHT_EMPTY_CLS),b.nojQuery&&(q=2)),j.css("width",parseInt(j.css("width"))+d.width-q)}return d.grouping&&delete d.grouping,e.summary&&e.summary.removeColumn(a,c),e.fire("columnremove"),e.removeColumnScrollInt&&clearInterval(e.removeColumnScrollInt),e.removeColumnScrollInt=setTimeout(function(){delete e.removeColumnScrollInt,e.scroller.update()},Fancy.ANIMATE_DURATION),d.index===d.id?delete e.columnsIdsSeed[d.index]:new RegExp(d.index).test(d.id)&&(1===e.columnsIdsSeed[d.index]?delete e.columnsIdsSeed[d.index]:e.columnsIdsSeed[d.index]--),d},insertColumn:function(a,c,d,e){var f=this,g=f.store,h=f.leftEl,i=f.leftBody,j=f.leftHeader,k=f.centerEl,l=f.body,m=f.header,n=f.rightEl,q=f.rightBody,r=f.rightHeader,s=0;switch(a.index&&g.addField(a.index),d=d||"center"){case"center":delete a.rightLocked,delete a.locked,f.columns.splice(c,0,a),m.insertCell(c,a),m.reSetIndexes(),l.insertColumn(c,a);break;case"left":a.locked=!0,s=0;var t=0,u=0;0===f.leftColumns.length?(b.nojQuery||(s=1,u=2),f.leftEl.removeCls(o)):u=2,b.nojQuery||(t=0);var v=h.dom.clientWidth+a.width+u;v-parseInt(h.css("width"))-a.width<-10&&(v=parseInt(h.css("width"))+a.width),f.leftColumns.splice(c,0,a),j.insertCell(c,a),j.reSetIndexes(),j.css("width",parseInt(j.css("width"))+t),i.insertColumn(c,a),h.css("width",v),k.css("width",parseInt(k.css("width"))-a.width),k.css("left",parseInt(k.css("left"))+a.width+s),l.el.css("width",parseInt(l.el.css("width"))-a.width),m.el.css("width",parseInt(m.el.css("width"))-a.width);break;case"right":a.rightLocked=!0;var u=0;0===f.rightColumns.length&&(b.nojQuery||(s=1,u=2),f.rightEl.removeCls(p)),f.rightColumns.splice(c,0,a),r.insertCell(c,a),r.reSetIndexes(),q.insertColumn(c,a),n.css("width",parseInt(n.css("width"))+a.width),k.css("width",parseInt(k.css("width"))-a.width-s),l.css("width",parseInt(l.css("width"))-a.width-u),m.css("width",parseInt(m.css("width"))-a.width-u)}if(a.menu)if(a._menu)a.menu=a._menu;else{var w=!0;b.each(a.menu,function(a){b.isString(a)||b.isObject(a)&&a._isConfigApplied&&(w=!1)}),w||(a.menu=!0)}if(f.isGroupable()){switch(d){case"left":1===f.leftColumns.length&&f.grouping.softRenderGroupedRows("left");break;case"right":1===f.rightColumns.length&&f.grouping.softRenderGroupedRows("right")}f.grouping.updateGroupRows(),f.grouping.setCellsPosition(c,d)}a.rowEditor&&("left"===d&&c--,f.rowedit.moveEditor(a,c,d,e)),f.summary&&f.summary.insertColumn(c,d),f.header.destroyMenus(),f.leftHeader.destroyMenus(),f.rightHeader.destroyMenus(),f.sorter&&f.sorter.updateSortedHeader(),f.filter&&f.filter.updateFields()},addColumn:function(a,b,c,d){var e=this;if(!1===d)return void e._addColumn(a,b,c);setTimeout(function(){e._addColumn(a,b,c)},1)},_addColumn:function(a,c,d){var e=this;if(c=c||"center",a.type||(a.type="string"),a.width||(a.width=e.defaultColumnWidth),void 0===d){d=e.getColumns(c).length}var f={$selected:!0,$order:!0,$rowdrag:!0};void 0===a.id&&(a.index&&!f[a.index]?a.id=e.getColumnId(a.index):a.id=Fancy.id(null,"col-id-")),e.defaults&&b.applyIf(a,e.defaults),e.insertColumn(a,d,c),e.scroller.update(),e.fire("columnadd")},disableLegend:function(a,b){var c=this;c.columns[a].disabled=c.columns[a].disabled||{},c.columns[a].disabled[b]=!0,c.update()},enableLegend:function(a,b){var c=this;c.columns[a].disabled=c.columns[a].disabled||{},delete c.columns[a].disabled[b],c.update()},fitHeight:function(){var a=this,b=a.store,c=a.panelBodyBorders,d=a.gridBorders,e=b.getLength()*a.cellHeight,f=1,g=a.columns.concat(a.leftColumns||[]).concat(a.rightColumns||[]);Fancy.each(g,function(a){a.grouping&&(f<2&&(f=2),a.filter&&a.filter.header&&f<3&&(f=3)),a.filter&&a.filter.header&&f<2&&(f=2)}),a.getCenterFullWidth()>a.getCenterViewWidth()&&!a.nativeScroller&&!Fancy.isIE&&(e+=a.bottomScrollHeight),a.title&&(e+=a.titleHeight),a.tbar&&(e+=a.tbarHeight||a.barHeight),a.summary&&(e+=a.cellHeight),a.bbar&&(e+=a.bbarHeight||a.barHeight),a.buttons&&(e+=a.buttonsHeight||a.barHeight),a.subTBar&&(e+=a.subTBarHeight||a.barHeight),a.footer&&(e+=a.barHeight),!1!==a.header&&(e+=a.cellHeaderHeight*f),a.isGroupable()&&(e+=a.grouping.groups.length*a.groupRowHeight),a.panel?e+=c[0]+c[2]+d[0]+d[2]:e+=d[0]+d[2],a.setHeight(e)},addFilter:function(a,c,d,e){var f=this,g=f.store.filters[a],h=!1===f.waitingForFilters;if(b.isFunction(c)&&(d="fn"),d=d||"",void 0===g&&(g={}),b.isDate(c)){var i=this.getColumnByIndex(a).format;g.type="date",g.format=i,c=Number(c)}g[d]=c,f.store.filters[a]=g,h&&(f.intervalUpdatingFilter&&clearInterval(f.intervalUpdatingFilter),f.intervalUpdatingFilter=setTimeout(function(){f.WAIT_FOR_STATE_TO_LOAD?f.filter.updateStoreFilters(!1):f.filter.updateStoreFilters(),delete f.intervalUpdatingFilter},1)),!1!==e?f.filter.addValuesInColumnFields(a,c,d):f.searching},clearFilter:function(a,c,d){var e=this,f=e.store,g=!1===e.waitingForFilters;void 0===a||null===a?f.filters={}:void 0===c||null===c?f.filters&&f.filters[a]&&delete f.filters[a]:e.filter&&f.filters&&f.filters[a]&&void 0!==f.filters[a][c]&&(delete f.filters[a][c],b.Object.isEmpty(f.filters[a])&&delete f.filters[a]),b.Object.isEmpty(f.filter)&&(delete f.filteredData,delete f.filterOrder,delete f.filteredDataMap),e.searching&&void 0===a&&void 0===c&&(e.searching.clearBarField(),e.search(""),e.expander&&e.expander.reSet()),g&&(e.intervalUpdatingFilter&&clearInterval(e.intervalUpdatingFilter),e.intervalUpdatingFilter=setTimeout(function(){if(f.remoteFilter)return f.once("serversuccess",function(){e.fire("filter",f.filters),delete e.intervalUpdatingFilter}),void f.serverFilter();if(f.grouping&&f.grouping.by){var a=e.grouping;f.isFiltered()?(f.changeDataView(),a.initGroups("filteredData")):a.initGroups(),a.reFreshExpanded(),a.initOrder(),f.changeDataView(),a.updateGroupRows(),a.setCellsPosition(),a.setPositions(),a.reFreshGroupTexts()}else f.changeDataView();e.update(),e.setSidesHeight(),delete e.intervalUpdatingFilter},100)),e.filter&&!1!==d&&e.filter.clearColumnsFields(a,c),g&&(e.fire("filter",f.filters),e.setSidesHeight())},updateFilters:function(){var a=this;delete a.waitingForFilters,a.filter.updateStoreFilters()},updateFilter:function(){this.updateFilters()},showLoadMask:function(a){this.loadmask.show(a)},clearSorter:function(){this.sorter&&this.sorter.clearSort()},hideLoadMask:function(){this.loadmask.hide()},prevPage:function(){this.paging.prevPage()},nextPage:function(){this.paging.nextPage()},setPage:function(a,b){a--,a<0&&(a=0),this.paging.setPage(a,b)},firstPage:function(){this.paging.firstPage()},lastPage:function(){this.paging.lastPage()},setPageSize:function(a){this.paging.setPageSize(a)},getPage:function(){return this.store.showPage+1},getPages:function(){return this.store.pages},getPageSize:function(){return this.store.pageSize},refresh:function(){this.paging.refresh()},scroll:function(a,b,c){var d=this,e=d.scroller;void 0!==b&&b>0&&(b=-b);var f=e.getScrollHeight();a>f&&(a=f,d.nativeScroller&&e.isRightScrollable()&&(a+=17));var g=e.getScrollWidth();Math.abs(b)>g&&(b=-g),!1===e.isBottomScrollable()?b=0:d.nativeScroller&&e.isRightScrollable()&&(b-=17),e.scroll(a,b,c),e.scrollBottomKnob(),e.scrollRightKnob()},getDataFiltered:function(){return this.store.filteredData},reCalcColumnsWidth:function(){var a=this;if(a.hasFlexColumns){var b,c,d=a.scroller,e=a.getCenterViewWidth(),f=a.columns,g=0,h=0,i=f.length,j=e;for(!1!==a.flexScrollSensitive&&d.isRightScrollable()&&!d.nativeScroller&&(j-=a.bottomScrollHeight);h<i;h++)c=f[h],c.hidden||(c.flex?g+=c.flex:j-=c.width);if(0!==g)for(b=j/g,h=0;h<i;h++)c=f[h],c.hidden||c.flex&&(c.width=Math.floor(c.flex*b),c.minWidth&&c.width<c.minWidth&&(c.width=c.minWidth),c.minWidth&&c.width<c.minWidth?c.width=c.minWidth:c.width<a.minColumnWidth&&(c.width=a.minColumnWidth))}},getDisplayedData:function(a,c,d,e){var f=this,g=f.getViewTotal(),h=[],i=0,j=f.leftColumns,k=f.columns,l=f.rightColumns,m={};d&&b.each(d,function(a){m[a]=!0}),a&&(g=f.getTotal());for(var n=function(a){if(!(void 0===a.index||"$selected"===a.index||a.hidden||e&&!1===a.exportable)){if(/spark/.test(a.type))return!1;switch(a.type){case"select":case"action":case"expand":case"grossloss":case"hbar":case"rowdrag":break;case"order":o.push(i+1);break;default:var b=f.get(i),d=f.get(i,a.index);a.exportFn&&e?(b&&b.data&&(b=b.data),o.push(a.exportFn({value:d,data:b}).value)):a.render&&!0!==c?(b&&b.data&&(b=b.data),d=a.render({value:d,data:b}).value.replace(/<\/?[^>]+(>|$)/g,""),o.push(d)):o.push(f.get(i,a.index))}}};i<g;i++){var o=[];if(d){var p=f.get(i);if(!p||!m[p.id])continue}b.each(j,n),b.each(k,n),b.each(l,n),h.push(o)}return h},getAllDisplayedData:function(){for(var a=this,c=a.getViewTotal(),d=[],e=0,f=a.leftColumns,g=a.columns,h=a.rightColumns,i=function(b){if(void 0!==b.index&&"$selected"!==b.index&&!b.hidden)switch(b.type){case"order":j.push(e+1);break;default:if(b.render){var c=a.get(e),d=a.get(e,b.index);j.push(b.render({value:d,data:c}).value)}else j.push(a.get(e,b.index))}};e<c;e++){var j=[];b.each(f,i),b.each(g,i),b.each(h,i),d.push(j)}return d},setData:function(a){var b=this,c=b.store;c.isTree?c.initTreeData(a):c.setData(a),c.sorters&&c.reSort(),c.filterOrder&&b.filter.updateStoreFilters(!1),c.clearDirty(),(c.sorters||c.filterOrder)&&c.changeDataView({doNotFired:!0}),b.setSidesHeight(),b.filter&&b.filter.waitForComboData&&b.filter.updateFilterComboData()},exportToExcel:function(a){var b=this;b.exporter&&b.exporter.exportToExcel(a)},getDataAsCsv:function(a){var b=this;if(b.exporter)return b.exporter.getDataAsCsv(a)},getDataAsCSV:function(a){return this.getDataAsCsv(a)},exportToCSV:function(a){var b=this;if(b.exporter)return b.exporter.exportToCSV(a)},exportToCsv:function(a){return this.exportToCSV(a)},disableSelection:function(){this.selection.disableSelection()},setParams:function(a){var c=this,d=c.store;d.proxy&&(d.proxy.params=d.proxy.params||{},b.apply(d.proxy.params,a))},setUrl:function(a){var c=this,d=c.store;if(b.isString(a)){if(d.proxy&&d.proxy.api)if("rest"===d.proxy.type)for(var e in d.proxy.api)d.proxy.api[e]=a;else d.proxy.api.read=a}else d.proxy&&d.proxy.api&&b.apply(d.proxy.api,a)},getSideByCell:function(a){var b,c=this;return c.centerEl.within(a)?b="center":c.leftEl.within(a)?b="left":c.rightEl.within(a)&&(b="right"),b},addChild:function(a,c){var d=this,e=d.store;if(void 0===c)a.$deep=1,void 0===a.child&&(a.child=[]),d.add(a);else{b.isNumber(a)&&(a=d.getById(a));var f=!1;!0===a.get("leaf")&&(a.set("leaf",!1),a.set("expanded",!0),a.set("child",[]),f=!0);var g=a.get("$deep"),h=a.get("child"),i=d.getRowById(a.id)+h.length+1;if(c.$deep=g+1,c.parentId=a.id,f){var j=a.get("parentId");if(j){var k=d.getById(j);b.each(k.data.child,function(b){if(b.id===a.id)return b.leaf=!1,b.expanded=!0,b.child=[c],!0})}}h.push(new e.model(c)),a.set("child",h),!0===a.get("expanded")&&d.insert(i,c)}},expand:function(a,c){var d,e=this;switch(b.typeOf(a)){case"number":case"string":d=e.getById(a)}if(d){if(!0===d.get("expanded"))return void(c&&this.collapse(a));if(e.tree&&e.tree.expandRow(d),e.expander){if(c&&this.expander._expandedIds[a])return void this.collapse(a);var f=e.getRowById(a);e.expander.expand(f)}}},toggleExpand:function(a){this.expand(a,!0)},collapse:function(a,c){var d,e=this;switch(b.typeOf(a)){case"number":case"string":d=e.getById(a)}if(!1===d.get("expanded"))return void(c&&this.expand(a));if(e.tree&&e.tree.collapseRow(d),e.expander){var f=!this.expander._expandedIds[a];if(!f&&this.expander._expandedIds[a].hidden&&(f=!0),c&&f)return void this.expand(a);var g=e.getRowById(a);e.expander.collapse(g)}},toggleCollapse:function(a){this.collapse(a,!0)},collapseAll:function(){var a=this;if(a.tree){var c=a.findItem("$deep",1);b.each(c,function(b){a.collapse(b.id)})}else a.expander&&a.expander.collapseAll()},expandAll:function(){var a=this,c=a.findItem("expanded",!1);b.each(c,function(b){a.expand(b.id)}),c=a.findItem("expanded",!1),c.length&&a.expandAll()},copy:function(a){var b=this;b.selection&&b.selection.copy(a)},sort:function(a,c,d){var e,f,g=this,h=g.getColumnByIndex(a),i=g.getColumnOrderByKey(a);if(void 0===d&&(d=!0),i.side)if(e=g.getHeader(i.side),f=e.getCell(i.order),c){switch(c=c||"ASC",f=e.getCell(i.order),c=c.toLocaleLowerCase()){case"asc":f.removeCls(r),f.addCls(q);break;case"desc":f.removeCls(q),f.addCls(r);break;case"drop":f.removeCls(q),f.removeCls(r);break;default:b.error("sorting type is not right - "+c)}g.sorter.sort(c,a,i.side,h,f,d)}else f.dom.click()},flashRow:function(a){var c=this,d=c.getDomRow(a);b.each(d,function(a){a=b.get(a),a.addCls("fancy-grid-cell-flash")}),setTimeout(function(){b.each(d,function(a){a=b.get(a),a.addCls("fancy-grid-cell-animation")})},200),setTimeout(function(){b.each(d,function(a){a=b.get(a),a.removeCls("fancy-grid-cell-flash"),a.removeCls("fancy-grid-cell-animation")})},700)},flashCell:function(a,b,c,d){c=c||"center";var e=this,f=e.getBody(c),g=700,h=Fancy.isObject(a)?a:f.getCell(a,b);if(d)switch(d.duration&&(g=d.duration),d.type){case"plusminus":d.delta>0?(h.addCls("fancy-grid-cell-flash-plus"),setTimeout(function(){h.removeCls("fancy-grid-cell-flash-plus"),h.removeCls("fancy-grid-cell-animation")},g)):(h.addCls("fancy-grid-cell-flash-minus"),setTimeout(function(){h.removeCls("fancy-grid-cell-flash-minus"),h.removeCls("fancy-grid-cell-animation")},g))}else h.addCls("fancy-grid-cell-flash"),setTimeout(function(){h.removeCls("fancy-grid-cell-flash"),h.removeCls("fancy-grid-cell-animation")},700);setTimeout(function(){h.addCls("fancy-grid-cell-animation")},200)},scrollToRow:function(a){var b=this,c=b.body.getCell(a,0);b.scroller.scrollToCell(c.dom,!1,!0),b.scroller.update(),b.flashRow(a)},getStateSorters:function(){var a=this,c={},d=JSON.parse(localStorage.getItem(a.getStateName()));if(d){if(!d.sorters)return{};var e=JSON.parse(d.sorters);return b.each(e,function(a){c[a.key]=a}),c}},getStateName:function(){var a=this,b=a.id,c=location.host+"-"+location.pathname;return a.stateId?a.stateId:b+"-"+c},setWidthFit:function(){var a=this,b=a.panelBodyBorders,c=a.gridWithoutPanelBorders,d=a.gridBorders,e=0,f=!1,g=[].concat(a.leftColumns).concat(a.columns).concat(a.rightColumns);Fancy.each(g,function(a){a.hidden||(e+=a.width),a.locked&&(f=!0)}),a.panel?e+=b[1]+b[3]+d[1]+d[3]:e+=c[1]+c[3]+d[1]+d[3],f&&e--,a.setWidth(e)},setColumnTitle:function(a,b,c){c=c||"center";var d,e,f=this,g=f.getHeader(c),h=g.getColumns();Fancy.isString(a)&&(a=f.getColumnOrderByKey(a).order),e=h[a],e.title=b,d=g.getCell(a),d.select("."+Fancy.GRID_HEADER_CELL_TEXT_CLS).item(0).update(b),f.fire("columntitlechange",{orderIndex:a,index:e.index,value:b,side:c})},clearDirty:function(){var a=this;a.store.clearDirty(),a.body.clearDirty(),a.leftBody.clearDirty(),a.rightBody.clearDirty()},isDirty:function(){return this.store.isDirty()},hideBar:function(a){var c,d,e=this;e.barHeight;switch(a){case"tbar":c=v,e.tbarHidden=!0,e.tbarHeight&&e.tbarHeight;break;case"subtbar":c=w,e.subTBarHidden=!0,e.subTBarHeight&&e.subTBarHeight;break;case"bbar":c=x,e.bbarHidden=!0,e.bbarHeight&&e.bbarHeight;break;case"buttons":c=y,e.buttonsHidden=!0,e.buttonsHeight&&e.buttonsHeight;break;default:b.error("Bar does not exist")}if(d=e.panel.el.select("."+c),"none"!==d.css("display")){d.hide();var f=parseInt(e.panel.el.css("height"));e.setHeight(f)}},showBar:function(a){var c,d,e=this;e.barHeight;switch(a){case"tbar":c=v,delete e.tbarHidden,e.tbarHeight&&e.tbarHeight;break;case"subtbar":c=w,delete e.subTBarHidden,e.subTBarHeight&&e.subTBarHeight;break;case"bbar":c=x,delete e.bbarHidden,e.bbarHeight&&e.bbarHeight;break;case"buttons":c=y,delete e.buttonsHidden,e.buttonsHeight&&e.buttonsHeight;break;default:b.error("Bar does not exist")}if(d=e.panel.el.select("."+c),"none"==d.css("display")){d.show();var f=parseInt(e.panel.el.css("height"));e.setHeight(f)}},initResponsiveness:function(){var a=this,c=function(){a.onWindowResize(),a.intWindowResize&&clearInterval(a.intWindowResize),a.intWindowResize=setTimeout(function(){a.onWindowResize(),delete a.intWindowResize,setTimeout(function(){a.onWindowResize()},300)},30)};"ResizeObserver"in window?(setTimeout(function(){var d;a.nativeResizeObserver?d=new ResizeObserver(c):(d=new b.ResizeObserver(c),a.responsiveOverver=d);var e;(e=a.panel?a.panel.el.parent().dom:a.el.parent().dom)&&d.observe(e)},100),b.$(window).bind("resize",c)):(setTimeout(function(){var d=new b.ResizeObserver(c),e=a.el.parent().dom;e&&(a.responsiveOverver=d,d.observe(e))},100),b.$(window).bind("resize",c))},getNumOfVisibleCells:function(){var a=this;if(!a.numOfVisibleCells)try{a.numOfVisibleCells=Math.ceil(a.getBodyHeight()/a.cellHeaderHeight)}catch(b){a.numOfVisibleCells=0}return a.numOfVisibleCells},getSideByColumnIndex:function(a){var c,d=this;return b.each(d.columns,function(b){b.index===a&&(c="center")}),b.each(d.leftColumns,function(b){b.index===a&&(c="left")}),b.each(d.rightColumns,function(b){b.index===a&&(c="right")}),c},setColumnWidth:function(a,c,d){var e=this;if(d=d||"center",b.isArray(a))b.each(a,function(a){e.setColumnWidth(a.index,a.width,a.side)});else{var f=e.getColumns(d);b.isNumber(a)?f[a].width=c:e.getColumnByIndex(a).width=c}e.intervalUpdateColumnsWidth&&(clearInterval(e.intervalUpdateColumnsWidth),delete e.intervalUpdateColumnsWidth),e.intervalUpdateColumnsWidth=setTimeout(function(){e.columnresizer&&(e.columnresizer.updateColumnsWidth("all"),delete this.intervalUpdateColumnsWidth,setTimeout(function(){e.scroller.update()},Fancy.ANIMATE_DURATION))},100)},isLoading:function(){return this.store.loading},getChanges:function(){var a=this,b=a.store,c={};return c.changed=b.changed,c.removed=b.removed,c.inserted=b.inserted,c},autoSizeColumn:function(a,c,d){var e,f=this;if(b.isBoolean(c)?(e=f.getColumnOrderById(a),c=e.side):(e=f.getColumnOrderByKey(a))&&void 0!==e.order||(e=f.getColumnOrderById(a),c=e.side),!e||void 0===e.order)return void b.error("Column index was not found");c=c||e.side;var g,h=f.getBody(c),i=b.get(h.getDomColumn(e.order)),j=i.css("width");if(j>500&&(j=100),i.css("width",""),g=i.dom.offsetWidth+2,d&&d.maxWidth&&d.maxWidth<g?g=d.maxWidth:d&&d.maxAutoWidth&&d.maxAutoWidth<g&&(g=d.maxAutoWidth),i.css("width",j),f.header){var k=f.getHeaderCell(e.order,c);j=k.css("width"),k.css("width","");var l=k.dom.offsetWidth+25;k.css("width",j),l>g&&(g=l)}f.setColumnWidth(e.order,g,c)},autoSizeColumns:function(){var a=this,c=a.getColumns();b.each(c,function(b){a.isServiceColumn(b)||b.id&&a.autoSizeColumn(b.id,!0,b)})},onFilter:function(){var a=this;a.store.hasFilters()?a.addCls(g):a.removeCls(g)},onSort:function(){var a=this,b=a.store;b.sorters&&b.sorters.length?a.addCls(f):a.removeCls(f)},isServiceColumn:function(a){switch(a.type){case"order":case"select":case"expand":case"rowdrag":return!0}return!1},getFilter:function(a,b){var c=this;if(void 0===a&&void 0===b)return c.store.filters;var d=c.store.filters[a];return void 0===b?d||void 0:d&&d[b]?d[b]:void 0},getSorter:function(a){var c=this;if(void 0!==a){var d;return b.each(c.store.sorters,function(b){if(b.key===a)return d=b,!0}),d}return c.store.sorters},setColumnComboData:function(a,c){var d=this,e=d.getColumns();b.each(e,function(d){if(d.index===a||d.id===a){if(d.data=c,d.editor&&delete d.editor,d.filterField){var e=[];b.isObject(c[0])?e=c:b.each(c,function(a,b){e.push({value:b,text:a})}),d.filterField.setData(e)}if(d.rowEditor){var e=[];b.isObject(c[0])?e=c:b.each(c,function(a,b){e.push({value:b,text:a})}),d.rowEditor.setData(e)}}})},clearGroup:function(){var a=this,b=a.store;b.clearGroup(),a.grouping.clearGroup(),b.changeDataView(),a.update(),a.setSidesHeight(),a.scroller.update()},addGroup:function(a,b){var c=this,d=c.store,e=!c.grouping.by;d.addGroup(a),d.sorters&&d.reSort(),d.filterOrder,c.grouping.addGroup(e),c.setSidesHeight(),b&&c.expandGroup(),c.scroller.update(),c.scroll(0,0)},isGroupable:function(){var a=this;return a.grouping&&a.grouping.by},expandGroup:function(a){var c=this,d=c.store,e=c.grouping,f=e.groups;a?(c.el.select("."+s+'[group="'+a+'"]').removeCls(t),e.expand(e.by,a)):(b.each(f,function(a){c.el.select("."+s+'[group="'+a+'"]').removeCls(t)}),e.expand(e.by,f)),(d.sorters||d.filterOrder)&&d.changeDataView({doNotFired:!0}),d.filterOrder&&d.grouping&&d.grouping.by&&c.filter.reGroupAccordingToFilters(),e.update()},collapseGroup:function(a){var c=this,d=c.grouping,e=d.groups;a?(c.el.select("."+s+'[group="'+a+'"]').addCls(t),d.collapse(d.by,a)):b.each(e,function(a){c.el.select("."+s+'[group="'+a+'"]').addCls(t),d.collapse(d.by,a)}),d.update()},calcCurrentLeftWidth:function(){var a=this.getColumns("left"),c=0;return b.each(a,function(a){a.hidden||(c+=a.width)}),c},calcCurrentRightWidth:function(){var a=this.getColumns("right"),c=0;return b.each(a,function(a){a.hidden||(c+=a.width)}),c},setColumns:function(a){var b=this;a=Fancy.Array.copy(a,!0),a=b.prepareConfigColumnMinMaxWidth({columns:a}).columns,b.defaults&&(a=b.prepareConfigDefaults({defaults:b.defaults,columns:a}).columns),b.refreshcolumns.setColumns(a),b._setColumnsAutoWidth(),setTimeout(function(){Fancy.each(["left","center","right"],function(a){var c=b.getHeader(a),d=b.getBody(a);c.reSetColumnsAlign(),c.reSetColumnsCls(),d.reSetColumnsAlign(),d.reSetColumnsCls()})},1)}}),b.ResizeObserver=function(a){this.fn=a},b.ResizeObserver.prototype.observe=function(a){this.el=a,this.init()},b.ResizeObserver.prototype.init=function(){var a=this;a.width=a.el.clientWidth,a.height=a.el.clientHeight,a.interval=setInterval(function(){var b=a.el.clientWidth,c=a.el.clientHeight;b===a.width&&c===a.height||(a.fn(),a.width=a.el.clientWidth,a.height=a.el.clientHeight)},100)},b.ResizeObserver.prototype.stop=function(){clearInterval(this.interval),delete this.width,delete this.height}}(),Fancy.define("Fancy.grid.plugin.Updater",{extend:Fancy.Plugin,ptype:"grid.updater",inWidgetName:"updater",constructor:function(a){Fancy.applyConfig(this,a),this.Super("const",arguments)},init:function(){},update:function(a){var b=this.widget;a=a||"",b.leftColumns&&b.leftColumns.length&&b.leftBody.update(a),b.body.update(a),b.rightColumns&&b.rightColumns.length&&b.rightBody.update(a)},updateRow:function(a){var b=this.widget;b.leftBody.updateRows(a),b.body.updateRows(a),b.rightBody.updateRows(a)}}),function(){var a=Fancy,b="fancy-scroll-right-inner",c="fancy-scroll-bottom-inner",d="fancy-scroll-top-inner",e="fancy-scroll-right-hover",f="fancy-scroll-bottom-hover",g="fancy-scroll-top-hover",h="fancy-scroll-right-active",i="fancy-scroll-bottom-active",j="fancy-scroll-top-active",k=a.HIDDEN_CLS,l=a.GRID_COLUMN_CLS,m=a.GRID_CENTER_CLS;a.define("Fancy.grid.plugin.Scroller",{extend:a.Plugin,ptype:"grid.scroller",inWidgetName:"scroller",rightKnobDown:!1,bottomKnobDown:!1,minRightKnobHeight:35,minBottomKnobWidth:35,cornerSize:12,scrollLeft:0,scrollTop:0,constructor:function(){this.Super("const",arguments)},init:function(){this.Super("init",arguments),this.ons()},ons:function(){var b=this,c=b.widget,d=a.getMouseWheelEventName();c.once("render",function(){b.render(),c.leftBody.el.on(d,b.onMouseWheel,b),c.nativeScroller&&(c.leftBody.el.on(d,b.onMouseWheelLeft,b),c.rightBody.el.on(d,b.onMouseWheelRight,b)),c.body.el.on(d,b.onMouseWheel,b),c.rightBody.el.on(d,b.onMouseWheel,b),c.once("init",b.onGridInit,b),c.nativeScroller?(c.body.el.on("scroll",b.onNativeScrollBody,b),c.leftBody.el.on("scroll",b.onNativeScrollLeftBody,b),c.rightBody.el.on("scroll",b.onNativeScrollRightBody,b)):(c.panel&&c.panel.on("resize",b.onPanelResize,b),c.body.el.on("scroll",b.onScrollBodyBugFix,b))}),b.on("render",b.onRender,b),c.store.on("change",b.onChangeStore,b)},destroy:function(){var b=this,c=b.widget,d=c.leftBody,e=c.body,f=c.rightBody,g=a.get(document),h=a.getMouseWheelEventName();g.un("mouseup",b.onMouseUpDoc,b),g.un("mousemove",b.onMouseMoveDoc,b),d.el.un(h,b.onMouseWheel,b),e.el.un(h,b.onMouseWheel,b),f.el.un(h,b.onMouseWheel,b),c.nativeScroller||(b.scrollBottomEl.un("mousedown",b.onMouseDownBottomSpin,b),b.scrollRightEl.un("mousedown",b.onMouseDownRightSpin,b)),a.isTouch&&(d.el.un("touchstart",b.onBodyTouchStart,b),d.el.un("touchmove",b.onBodyTouchMove,b),e.el.un("touchstart",b.onBodyTouchStart,b),e.el.un("touchmove",b.onBodyTouchMove,b),f.el.un("touchstart",b.onBodyTouchStart,b),f.el.un("touchmove",b.onBodyTouchMove,b),g.un("touchend",b.onBodyTouchEnd,b))},onGridInit:function(){var b=this,c=b.widget,d=c.store,e=a.get(document);b.setScrollBars(),e.on("mouseup",b.onMouseUpDoc,b),e.on("mousemove",b.onMouseMoveDoc,b),c.on("columnresize",b.onColumnResize,b),c.on("lockcolumn",b.onLockColumn,b),c.on("rightlockcolumn",b.onRightLockColumn,b),c.on("unlockcolumn",b.onUnLockColumn,b),d.on("changepages",b.onChangePages,b),c.on("columndrag",b.onColumnDrag,b),setTimeout(function(){b.update()},1)},render:function(){var e=this,f=e.widget,g=f.body,h=a.get(document.createElement("div")),i=a.get(document.createElement("div")),j=a.get(document.createElement("div"));f.nativeScroller?f.el.addCls("fancy-grid-native-scroller"):(h.addCls("fancy-scroll-right"),i.addCls("fancy-scroll-bottom",k),h.update(['<div class="'+b+'"></div>'].join(" ")),h.select("."+b).css("margin-top",f.knobOffSet),i.update(['<div class="'+c+'"></div>'].join(" ")),a.get(g.el.append(h.dom)),e.scrollRightEl=g.el.select(".fancy-scroll-right"),a.get(g.el.append(i.dom)),e.scrollBottomEl=g.el.select(".fancy-scroll-bottom"),f.doubleHorizontalScroll&&(j.addCls("fancy-scroll-top",k),j.update(['<div class="'+d+'"></div>'].join(" ")),a.get(g.el.append(j.dom)),e.scrollTopEl=g.el.select(".fancy-scroll-top"))),e.fire("render")},onMouseWheel:function(b){var c=this,d=c.widget,e=d.store,f=a.getWheelDelta(b.originalEvent||b);if(d.infinite){b.preventDefault();var g;return g=f<0?e.infiniteScrolledToRow+1:e.infiniteScrolledToRow-1,g>e.getNumOfInfiniteRows()-(d.numOfVisibleCells-1)&&(g=e.getNumOfInfiniteRows()-(d.numOfVisibleCells-1)),g<0&&(g=0),e.infiniteScrolledToRow=g,d.update(),void(d.selection&&d.selection.updateSelection())}0!=c.isRightScrollable()&&(d.stopProp&&b.stopPropagation(),d.nativeScroller||(c.scrollDelta(f)&&b.preventDefault(),c.scrollRightKnob()))},onRender:function(){var b=this,c=b.widget;!0!==c.nativeScroller&&(b.scrollRightEl.hover(function(){!0!==b.bottomKnobDown&&b.scrollRightEl.addCls(e)},function(){b.scrollRightEl.removeCls(e)}),b.scrollBottomEl.hover(function(){!0!==b.rightKnobDown&&b.scrollBottomEl.addCls(f)},function(){b.scrollBottomEl.removeCls(f)}),c.doubleHorizontalScroll&&b.scrollTopEl.hover(function(){!0!==b.bottomKnobDown&&b.scrollTopEl.addCls(g)},function(){!0!==b.bottomKnobDown&&b.scrollTopEl.removeCls(g)}),b.initRightScroll(),b.initBottomScroll()),a.isTouch&&b.initTouch()},initTouch:function(){var b=this,c=b.widget,d=c.leftBody,e=c.body,f=c.rightBody,g=a.get(document);d.el.on("touchstart",b.onBodyTouchStart,b),d.el.on("touchmove",b.onBodyTouchMove,b),e.el.on("touchstart",b.onBodyTouchStart,b),e.el.on("touchmove",b.onBodyTouchMove,b),f.el.on("touchstart",b.onBodyTouchStart,b),f.el.on("touchmove",b.onBodyTouchMove,b),g.on("touchend",b.onBodyTouchEnd,b)},onBodyTouchStart:function(a){a=a.originalEvent||a;var b=this,c=b.widget,d=a.changedTouches[0];c.nativeScroller||(Fancy.nojQuery&&(c.panel?c.panel.el.select("."+Fancy.GRID_ANIMATION_CLS).removeCls(Fancy.GRID_ANIMATION_CLS):c.el.removeCls(Fancy.GRID_ANIMATION_CLS)),a.preventDefault(),b.rightKnobDown=!0,b.bottomKnobDown=!0,b.mouseDownXY={x:d.pageX,y:d.pageY},b.rightKnobTop=parseInt(b.rightKnob.css("margin-top")),b.scrollRightEl.addCls(h),b.bottomKnobLeft=parseInt(b.bottomKnob.css("margin-left")),b.scrollBottomEl.addCls(i),c.doubleHorizontalScroll&&b.scrollTopEl.addCls(j))},onBodyTouchEnd:function(){var a=this;a.onMouseUpDoc(),delete a.spyOnSwipe},onBodyTouchMove:function(b){var c=this,d=c.widget,b=b.originalEvent||b,e=b.changedTouches[0],f=!0;if(d.nativeScroller){if(a.isTouch)return;c.onMouseMoveDoc({pageX:e.pageX,pageY:e.pageY})}else{var g=c.scrollLeft,h=c.scrollTop;c.onMouseMoveDoc({pageX:e.pageX,pageY:e.pageY}),f=g!==c.scrollLeft||h!==c.scrollTop,b.preventDefault()}!0===c.rightKnobDown&&f&&b.preventDefault(),!0===c.bottomKnobDown&&f&&b.preventDefault()},initRightScroll:function(){var a=this;a.rightKnob=a.scrollRightEl.select("."+b),a.scrollRightEl.on("mousedown",a.onMouseDownRightSpin,a)},initBottomScroll:function(){var a=this,b=a.widget;a.bottomKnob=a.scrollBottomEl.select("."+c),a.scrollBottomEl.on("mousedown",a.onMouseDownBottomSpin,a),b.doubleHorizontalScroll&&(a.topKnob=a.scrollTopEl.select("."+d),a.scrollTopEl.on("mousedown",a.onMouseDownBottomSpin,a))},onMouseDownRightSpin:function(b){var c=this,d=c.widget;a.isTouch||(Fancy.nojQuery&&(d.panel?d.panel.el.select("."+Fancy.GRID_ANIMATION_CLS).removeCls(Fancy.GRID_ANIMATION_CLS):d.el.removeCls(Fancy.GRID_ANIMATION_CLS)),b.preventDefault(),c.rightKnobDown=!0,c.mouseDownXY={x:b.pageX,y:b.pageY},c.rightKnobTop=parseInt(c.rightKnob.css("margin-top")),c.scrollRightEl.addCls(h))},onMouseDownBottomSpin:function(b){var c=this,e=c.widget,f=a.get(b.target);b.preventDefault(),Fancy.nojQuery&&(e.panel?e.panel.el.select("."+Fancy.GRID_ANIMATION_CLS).removeCls(Fancy.GRID_ANIMATION_CLS):e.el.removeCls(Fancy.GRID_ANIMATION_CLS)),c.bottomKnobDown=!0,c.mouseDownXY={x:b.pageX,y:b.pageY},c.bottomKnobLeft=parseInt(c.bottomKnob.css("margin-left")),c.scrollBottomEl.addCls(i),f.hasClass()&&c.scrollTopEl.addCls(d)},onMouseUpDoc:function(){var a=this,b=a.widget;if(!1===a.rightKnobDown&&!1===a.bottomKnobDown)return void(b.nativeScroller&&Fancy.nojQuery&&b.addCls(Fancy.GRID_ANIMATION_CLS));Fancy.nojQuery&&b.addCls(Fancy.GRID_ANIMATION_CLS),a.scrollRightEl.removeCls(h),a.scrollBottomEl.removeCls(i),a.rightKnobDown=!1,a.bottomKnobDown=!1,b.doubleHorizontalScroll&&(a.scrollTopEl.removeCls(j),a.scrollTopEl.removeCls(g))},onMouseMoveDoc:function(b){var c,d,e,f,g=this,h=g.widget,i=!1,j=!1,k=h.knobOffSet,l=b.pageX,m=b.pageY;g.scrollInterval&&clearInterval(g.scrollInterval),g.spyOnSwipe?(Math.abs(g.spyOnSwipe.x-l)>1?g.spyOnSwipe.swipedX=g.spyOnSwipe.x-l:delete g.spyOnSwipe.swipedX,Math.abs(g.spyOnSwipe.y-m)>1?g.spyOnSwipe.swipedX=g.spyOnSwipe.y-m:delete g.spyOnSwipe.swipedY,g.spyOnSwipe.x=l,g.spyOnSwipe.y=m):g.spyOnSwipe={x:l,y:m},g.scrollInterval=setTimeout(function(){g.rightKnobDown&&(a.isTouch?(d=g.mouseDownXY.y-m,e=d+Math.ceil(g.rightKnobTop*g.rightScrollScale)):(d=m-g.mouseDownXY.y,e=d+g.rightKnobTop),a.isTouch?g.bodyViewHeight<e/g.rightScrollScale+g.rightKnobHeight&&(e=g.bodyFullViewHeight-g.bodyViewHeight):g.bodyViewHeight<e+g.rightKnobHeight&&(e=g.bodyViewHeight-g.rightKnobHeight),e<0&&(e=0),a.isTouch?(i=e,g.rightKnob.css("margin-top",e/g.rightScrollScale+k+"px")):(i=g.rightScrollScale*e,g.rightKnob.css("margin-top",e+k+"px")),h.doubleHorizontalScroll&&"none"!==g.scrollBottomEl.css("display")&&e<g.cornerSize&&(e=g.cornerSize),g.scroll(i),h.infinite&&h.selection&&(h.selection.updateSelection(),h.selection.clearActiveCell())),g.bottomKnobDown&&(a.isTouch?(c=g.mouseDownXY.x-l,d=g.mouseDownXY.y-m,f=c+Math.ceil(g.bottomKnobLeft*Math.abs(g.bottomScrollScale))):(c=l-g.mouseDownXY.x,d=m-g.mouseDownXY.y,f=c+g.bottomKnobLeft),f<1&&(f=1),a.isTouch?g.bodyViewWidth-2<Math.abs(f/g.bottomScrollScale)+g.bottomKnobWidth&&(f=g.bodyFullViewWidth-g.bodyViewWidth-2):g.bodyViewWidth-2<f+g.bottomKnobWidth&&(f=g.bodyViewWidth-g.bottomKnobWidth-2),g.bottomScrollScale<0&&f<0&&(f=0,g.bottomScrollScale=0),a.isTouch?(j=-f-1,g.bottomKnob.css("margin-left",Math.abs(f/g.bottomScrollScale)+"px")):(j=Math.ceil(g.bottomScrollScale*(f-1)),g.bottomKnob.css("margin-left",f+"px")),h.doubleHorizontalScroll&&g.topKnob.css("margin-left",f+"px"),g.scroll(!1,j))},1)},setScrollBars:function(a){var b=this,c=b.widget;c.rowheight&&void 0===a||(setTimeout(function(){b.checkRightScroll(a)},1),b.checkBottomScroll()||b.scrollTop&&!c.infinite&&c.scroll(!1,0),c.nativeScroller||setTimeout(function(){b.checkCorner(),b.setRightKnobSize(a),b.setBottomKnobSize()},1))},checkRightScroll:function(a){var b=this,c=b.widget,d=c.body,e=c.gridBorders,f=c.getBodyHeight(),g=(a||c.getCellsViewHeight())-e[0]-e[2];c.nativeScroller?f>=g?d.el.css("overflow-y","hidden"):d.el.css("overflow-y","scroll"):f>=g?b.scrollRightEl.addCls(k):b.scrollRightEl.removeCls(k)},isRightScrollable:function(){var a=this.widget;return a.nativeScroller?"scroll"===a.body.el.css("overflow-y"):!this.scrollRightEl.hasCls(k)},isBottomScrollable:function(){var a=this.widget;return a.nativeScroller?"scroll"===a.body.el.css("overflow-x"):!this.scrollBottomEl.hasCls(k)},setRightKnobSize:function(a){var b=this,c=b.widget;if(!c.nativeScroller){var d=c.getBodyHeight()-(b.corner?b.cornerSize:0)-2,e=(a||c.getCellsViewHeight())-(b.corner?b.cornerSize:0),f=e-d,g=100-f/(d/100),h=d*(g/100),i=c.knobOffSet;h<b.minRightKnobHeight&&(h=b.minRightKnobHeight,c.doubleHorizontalScroll&&(h+=b.minRightKnobHeight)),!1===b.corner&&(d-=i),b.rightKnob.css({height:h}),b.rightKnobHeight=h,b.bodyViewHeight=d,b.bodyFullViewHeight=e,b.rightScrollScale=(e-d)/(d-h)}},checkBottomScroll:function(){var a,b=this,c=b.widget,d=c.body,e=c.getCenterViewWidth(),f=c.getCenterFullWidth()-2;return c.nativeScroller?e>f?(a=!1,d.el.css("overflow-x","hidden")):(a=!0,d.el.css("overflow-x","scroll")):e>f?(a=!1,b.scrollBottomEl.addCls(k),c.doubleHorizontalScroll&&b.scrollTopEl.addCls(k)):(a=!0,b.scrollBottomEl.removeCls(k),c.doubleHorizontalScroll&&b.scrollTopEl.removeCls(k)),a},checkCorner:function(){var a=this;a.widget.nativeScroller||(a.corner=!a.scrollRightEl.hasCls(k)&&!a.scrollBottomEl.hasCls(k))},setBottomKnobSize:function(){var b=this,c=b.widget;if(!c.nativeScroller){var d=c.getCenterViewWidth()-(b.corner?b.cornerSize:0),e=c.getCenterFullWidth()-(b.corner?b.cornerSize:0),f=e-d,g=100-f/(e/100),h=d*(g/100)-2;h<b.minBottomKnobWidth&&(h=b.minBottomKnobWidth),b.bottomKnob.css({width:h}),c.doubleHorizontalScroll&&b.topKnob.css({width:h},a.ANIMATE_DURATION),b.bottomKnobWidth=h,b.bodyViewWidth=d,b.bottomScrollScale=(d-e)/(d-h-2-1),b.bodyFullViewWidth=e}},scroll:function(b,c,d){var e,f=this,g=f.widget;if(c>0&&(c=0),g.nativeScroller)return null!==b&&void 0!==b&&(g.body.el.dom.scrollTop=b),null!==c&&void 0!==c&&(g.body.el.dom.scrollLeft=Math.abs(c),g.header&&g.header.scroll(c,!0)),void g.fire("scroll");g.leftBody.scroll(b),e=g.body.scroll(b,c,d),g.rightBody.scroll(b),void 0!==e.scrollTop&&(f.scrollTop=Math.abs(e.scrollTop)),void 0!==e.scrollLeft&&(f.scrollLeft=Math.abs(e.scrollLeft)),g.fire("scroll"),a.isTouch&&(g._preventTouchDown=!0)},scrollDelta:function(a){var b,c=this,d=c.widget;if(d.leftBody.wheelScroll(a),b=d.body.wheelScroll(a),d.rightBody.wheelScroll(a),void 0!==b)return c.scrollTop=Math.abs(b.newScroll),d.fire("scroll"),b.scrolled},scrollRightKnob:function(){var a=this,b=a.widget,c=(b.store,a.getScroll()),d=c/a.rightScrollScale+b.knobOffSet;a.rightKnob&&(b.doubleHorizontalScroll&&(d+=a.cornerSize),b.infinite,a.rightKnob.css("margin-top",d+"px"))},scrollBottomKnob:function(){var a=this,b=a.widget,c=a.getBottomScroll(),d=c/a.bottomScrollScale+b.knobOffSet;0===c&&(d=-1),a.bottomKnob&&(a.bottomKnob.css("margin-left",-d+"px"),b.doubleHorizontalScroll&&a.topKnob.css("margin-left",-d+"px"))},getScroll:function(){var a=this,b=a.widget,c=b.store;if(b.nativeScroller)return b.body.el.dom.scrollTop;if(b.infinite)return Math.abs(c.infiniteScrolledToRow*b.cellHeight);if(0===b.columns.length){if(b.leftColumns.length)return Math.abs(parseInt(b.leftBody.el.select("."+l).item(0).css("top")));if(b.rightColumns.length)return Math.abs(parseInt(b.rightBody.el.select("."+l).item(0).css("top")))}var d=b.body.el.select("."+l);return 0===d.length?0:Math.abs(parseInt(d.item(0).css("top")))},getBottomScroll:function(){var a=this,b=a.widget;if(b.nativeScroller)return b.body.el.dom.scrollLeft;if(0===b.columns.length){if(b.leftColumns.length)return Math.abs(parseInt(b.leftBody.el.select("."+l).item(0).css("left")));if(b.rightColumns.length)return Math.abs(parseInt(b.rightBody.el.select("."+l).item(0).css("left")))}var c=b.body.el.select("."+l);return 0===c.length?0:Math.abs(parseInt(c.item(0).css("left")))},update:function(a){var b=this;b.setScrollBars(a),b.checkScroll(a),b.scrollRightKnob(),b.scrollBottomKnob()},onChangeStore:function(){this.update()},onColumnResize:function(){var a=this;a.setScrollBars(),setTimeout(function(){a.setScrollBars()},Fancy.ANIMATE_DURATION+20)},getScrollHeight:function(){var a=this,b=a.widget,c=b.getBodyHeight()-(a.corner?a.cornerSize:0),d=b.getCellsViewHeight()-(a.corner?a.cornerSize:0);return c>d?c:d-c},getScrollWidth:function(){var a=this,b=a.widget,c=b.getCenterViewWidth()-(a.corner?a.cornerSize:0),d=b.getCenterFullWidth()-(a.corner?a.cornerSize:0);return c>d?c:d-c},checkScroll:function(b){var c=this,d=c.widget,e=c.getScroll(),f=d.getBodyHeight()-(c.corner?c.cornerSize:0),g=(b||d.getCellsViewHeight())-(c.corner?c.cornerSize:0),h=d.getCenterFullWidth(),i=d.getCenterViewWidth();if(h<c.scrollLeft+i)return void setTimeout(function(){var a=h-(c.scrollLeft+i);c.scrollLeft+a<0?d.scroll(c.scrollTop,0,!0):d.scroll(c.scrollTop,c.scrollLeft+a,!0)},a.nojQuery?10:a.ANIMATE_DURATION);e&&g<f&&(c.scroll(0),d.nativeScroller||c.scrollRightKnob())},scrollToCell:function(b,c,d){if(void 0!==b){var e=this,f=e.widget,g=f.store,h=f.cellHeight,i=a.get(b),j=i.parent(),k=Number(i.attr("index")),l=Number(j.attr("index")),n=e.getScroll(),o=h*(k+1),p=f.getBodyHeight(),q=e.getBottomScroll(),r=f.getSideByCell(b),s=f.getColumnsWidth(r),t=parseInt(f.body.el.css("width")),u=0,v=j.parent().parent().hasCls(m);if(f.rowheight&&(o=f.rowheight.rowIndexesSum[k]),!f.nativeScroller||c){if(f.infinite&&(k+=g.infiniteScrolledToRow,o+=h*g.infiniteScrolledToRow),0===k&&0===l){if(0===e.scrollLeft||"row"!==f.selModel&&"rows"!==f.selModel||f.selection&&f.selection.activeCell)if(f.selection&&f.selection.activeCell){var w=f.selection.getActiveCellInfo();"center"!==w.side?e.scroll(0):e.scroll(0,0)}else e.scroll(0,0);else e.scroll(0);return e.scrollBottomKnob(),void e.scrollRightKnob()}if(0===k&&0!==e.scrollTop)return void e.scroll(0);if(f.isGroupable()&&(o+=f.grouping.getSpecialRowsAbove(k)*f.groupRowHeight),f.expander&&(o+=f.expander.getBeforeHeight(k)),d){var x=f.getCellsViewHeight();n=o-h,x-n<p&&(n-=Math.abs(x-n-p)),e.scroll(n)}else if(o-n>p){var y=5;f.nativeScroller&&(y=20),n=o-p+y,e.scroll(n)}else o-n<f.cellHeight&&(n=o-h-5,n<0&&(n=0),e.scroll(n));if(v){for(var z=f.columns,A=0;A<=l;A++)z[A].hidden||(u+=z[A].width);u-q>t?z[A]?e.scroll(n,-(q+(u-q)-t)):e.scroll(n,-(s-t)):u-q<z[l].width?(q=-(u-z[l].width),q>0&&(q=0),e.scroll(n,q)):0!==q&&0===l&&e.scroll(n,0),e.scrollBottomKnob()}e.scrollRightKnob()}}},onNativeScrollBody:function(){var b=this,c=b.widget,d=c.body.el.dom.scrollTop,e=c.body.el.dom.scrollLeft;c.header&&c.header.scroll(-e),c.leftBody&&(c.leftBody.el.dom.scrollTop=d),c.rightBody&&(c.rightBody.el.dom.scrollTop=d),c.leftColumns.length&&c.leftBody.el.dom.scrollTop!==c.body.el.dom.scrollTop?c.body.el.dom.scrollTop=c.leftBody.el.dom.scrollTop:c.rightColumns.length&&c.rightBody.el.dom.scrollTop!==c.body.el.dom.scrollTop&&(c.body.el.dom.scrollTop=c.rightBody.el.dom.scrollTop),Fancy.nojQuery&&(c.panel?c.panel.el.select("."+Fancy.GRID_ANIMATION_CLS).removeCls(Fancy.GRID_ANIMATION_CLS):c.el.removeCls(Fancy.GRID_ANIMATION_CLS)),c.summary&&c.summary.scrollLeft(-e),c.subHeaderFilter&&c.filter.scrollLeft(-e),c.fire("nativescroll"),a.isTouch&&(c._preventTouchDown=!0)},onNativeScrollLeftBody:function(){var a=this.widget;a.leftBody.el.dom.scrollTop!==a.body.el.dom.scrollTop&&this.onNativeScrollBody()},onNativeScrollRightBody:function(){var a=this.widget;a.rightBody.el.dom.scrollTop!==a.body.el.dom.scrollTop&&this.onNativeScrollBody()},onMouseWheelLeft:function(b){var c=this.widget,d=a.getWheelDelta(b.originalEvent||b),e=d*c.cellHeight;c.leftBody.el.dom.scrollTop-=e,c.body.el.dom.scrollTop-=e,c.rightBody.el.dom.scrollTop-=e},onMouseWheelRight:function(b){var c=this.widget,d=a.getWheelDelta(b.originalEvent||b),e=d*c.cellHeight;c.leftBody.el.dom.scrollTop-=e,c.body.el.dom.scrollTop-=e,c.rightBody.el.dom.scrollTop-=e},onLockColumn:function(){var b=this;b.update(),b.widget.setColumnsPosition(),setTimeout(function(){b.update(),b.widget.setColumnsPosition()},a.ANIMATE_DURATION)},onColumnDrag:function(){var b=this;a.nojQuery&&setTimeout(function(){b.update()},a.ANIMATE_DURATION)},onRightLockColumn:function(){var b=this;b.update(),b.widget.setColumnsPosition(),setTimeout(function(){b.update(),b.widget.setColumnsPosition()},a.ANIMATE_DURATION)},onUnLockColumn:function(){var b=this;b.update(),b.widget.setColumnsPosition(),setTimeout(function(){b.update(),b.widget.setColumnsPosition()},a.ANIMATE_DURATION+100)},onPanelResize:function(){this.widget.scroll(0,0)},onChangePages:function(){var a=this;!a.widget.nativeScroller&&a.scrollTop&&setTimeout(function(){a.scrollDelta(0)},1)},onScrollBodyBugFix:function(){var a=this,b=a.widget,c=b.body,d=c.el.dom.scrollLeft;c.el.dom.scrollLeft=a.scrollLeft,b.scroll(a.scrollTop,-a.scrollLeft-d)}})}(),function(){var a,b=Fancy,c={title:function(a,b,c,d){a.setColumnTitle(c,b,d)},width:function(a,b,c,d){a.setColumnWidth(c,b,d)},hidden:function(a,b,c,d,e){b?a.hideColumn(e):a.showColumn(e)},render:function(b,c,d,e,f){clearInterval(a),b.getColumnById(f).render=c,a=setTimeout(function(){b.update()},1)}};b.define("Fancy.grid.plugin.RefreshColumn",{extend:b.Plugin,ptype:"grid.refreshcolumns",inWidgetName:"refreshcolumns",constructor:function(){this.Super("const",arguments)},setColumns:function(a){var c=this,d=c.widget;c.applyChanges(a),a=d.prepareConfigColumnsWidth({columns:a,width:d.width}).columns,a=d.prepareConfigColumns({columns:a},!1).columns,c.setColumnsByOrder(a),d.filter&&(clearInterval(c.intFilter),c.intFilter=setTimeout(function(){delete c.intFilter,d.filter.updateFields()},b.ANIMATE_DURATION))},applyChanges:function(a){var c=this,d={},e=[];b.each(a,function(a){a.id?d[a.id]=a:a.index?d[a.index]=a:e.push(a)}),c.setChangesByIds(d),c.setChangesWithoutIds(e),c.setChangesToNotCheckedColumns(a)},setChangesByIds:function(a){var d=this,e=d.widget,f=e.getColumns();b.each(f,function(b){!b.id||/col-id-/.test(b.id)||a[b.id]||e.removeColumn(b.id)});for(var g in a){var h=e.getColumnById(g),i=e.getColumnOrderById(g),j=a[g];if(h){for(var k in c)void 0!==j[k]&&h[k]!==j[k]&&c[k](e,j[k],i.order,i.side,g);j.$checked=!0,h.$checked=!0}}},setChangesWithoutIds:function(a){var d=this,e=d.widget,f=e.getColumns();b.each(a,function(a){if(a.render){var d=[],g=a.render.toString();if(b.each(f,function(a){a.render&&g===a.render.toString()&&d.push(a)}),1===d.length){var h=d[0],i=e.getColumnOrderById(h.id);for(var j in c)void 0!==a[j]&&h[j]!==a[j]&&c[j](e,a[j],i.order,i.side,h.id);a.$checked=!0,h.$checked=!0}}})},setChangesToNotCheckedColumns:function(a){var c=this,d=c.widget,e=d.getColumns(),f=[],g={},h={};b.each(e,function(a){a.$checked||(f.push(a),g[a.type]=g[a.type]||[],g[a.type].push(a))}),b.each(a,function(a){a.$checked||(h[a.type]=h[a.type]||[],h[a.type].push(a))});for(var i in g){var j=g[i];b.each(j,function(a){var c=h[i];b.each(c,function(b){var d=!0;for(var e in b)if(b[e]!==a[e]){d=!1;break}d&&(c.$checked=!0,a.$checked=!0)})})}f=[],b.each(e,function(a){a.$checked||f.push(a)}),b.each(f,function(a){d.removeColumn(a.id)}),b.each(a,function(a){delete a.$checked}),b.each(e,function(a){delete a.$checked})},setColumnsByOrder:function(a){var c=this,d=[],e=[],f=[];b.each(a,function(a){a.locked?d.push(a):a.rightLocked?e.push(a):f.push(a)}),c.setColumnsByOrderInSide(f,"center"),c.setColumnsByOrderInSide(d,"left"),c.setColumnsByOrderInSide(e,"right")},setColumnsByOrderInSide:function(a,c){var d=this,e=d.widget,f=e.getColumns(c);b.each(a,function(a,b){var d=!0,g=f[b];if(void 0!==g)for(var h in a){if(void 0!==a.id&&a.id===g.id)break;switch(h){case"width":case"hidden":continue}if(a[h]!==g[h]){d=!1;break}}else d=!1;if(!d)if(g&&g.index===a.index)e.removeColumn(g.id),e.addColumn(a,c,b,!1);else if(!a.id){var i=e.getColumnByIndex(a.index);i&&e.removeColumn(i.id),e.addColumn(a,c,b,!1)}})}})}(),Fancy.define("Fancy.grid.plugin.LoadMask",{extend:Fancy.Plugin,ptype:"grid.loadmask",inWidgetName:"loadmask",cls:"fancy-loadmask",innerCls:"fancy-loadmask-inner",imageCls:"fancy-loadmask-image",textCls:"fancy-loadmask-text",constructor:function(){this.Super("const",arguments)},init:function(){this.Super("init",arguments),this.ons()},ons:function(){var a=this,b=a.widget,c=b.store;b.once("render",function(){a.render(),c.loading&&a.onBeforeLoad(),b.on("beforeload",a.onBeforeLoad,a),b.on("load",a.onLoad,a)})},render:function(){var a,b,c=this,d=c.widget,e=d.el,f=e,g=Fancy.get(document.createElement("div")),h=d.lang;d.panel&&(f=d.panel.el),a=f.width(),b=f.height(),g.addCls(c.cls),"default"!==d.theme&&g.addCls(Fancy.getThemeCSSCls(d.theme)),g.css({width:a,height:b,opacity:0}),c.loadText?g.update(['<div class="'+c.innerCls+'"><div class="'+c.textCls+'">'+c.loadText+"</div></div>"].join(" ")):g.update(['<div class="'+c.innerCls+'"><div class="'+c.imageCls+'"></div><div class="'+c.textCls+'">'+h.loadingText+"</div></div>"].join(" ")),c.el=Fancy.get(f.dom.appendChild(g.dom)),c.innerEl=c.el.select("."+c.innerCls),c.textEl=c.el.select("."+c.textCls);var i=c.innerEl.width(),j=c.innerEl.height(),k=a/2-i/2;k<10&&(c.intLeft=setInterval(function(){"none"===c.el.css("display")&&clearInterval(c.intLeft),i=c.innerEl.width(),j=c.innerEl.height(),(k=a/2-i/2)<10||(c.innerEl.css({left:k}),clearInterval(c.intLeft))},100)),c.innerEl.css({left:k,top:b/2-j/2}),!0!==d.store.loading?g.css("display","none"):!1===c.showOnWaitingServer?g.css("display","none"):g.css("display","block")},onBeforeLoad:function(){this.showOnWaitingServer&&this.show()},onLoad:function(){var a=this,b=a.widget;a.showOnWaitingServer&&b.once("update",function(){a.hide()})},show:function(a){var b=this,c=b.el,d=b.widget,e=d.lang;if(c.stop(),c.css("opacity",1),b.el.css("display","block"),b.updateSize(),a)return b.textEl.update(a),void b.el.css("display","block");b.loaded=!1,setTimeout(function(){!0!==b.loaded&&(b.textEl.update(b.loadText||e.loadingText),b.el.css("display","block"))},50)},hide:function(){var a=this,b=a.el;b.stop(),b.css("opacity",1),b.animate({opacity:0,force:!0},{complete:function(){a.loaded=!0,b.css("display","none")}})},updateSize:function(){var a=this,b=a.widget,c=b.getWidth(),d=b.getHeight();a.el.css({height:d,width:c});var e=Math.abs(a.innerEl.width()),f=Math.abs(a.innerEl.height()),g=c/2-e/2,h=d/2-f/2;a.innerEl.css({left:g,top:h})}}),function(){var a=Fancy,b=a.get,c=a.FIELD_CLS,d=a.GRID_RESIZER_LEFT_CLS,e=a.GRID_RESIZER_RIGHT_CLS,f=a.GRID_HEADER_CELL_TRIGGER_CLS,g=a.GRID_HEADER_CELL_TRIGGER_IMAGE_CLS,h=a.GRID_HEADER_CELL_CLS,i=a.GRID_COLUMN_RESIZER_CLS,j=a.GRID_COLUMN_CLS,k=a.GRID_HEADER_CELL_GROUP_LEVEL_2_CLS,l=a.GRID_STATE_RESIZE_COLUMN_CLS,m=a.ANIMATE_DURATION;a.define("Fancy.grid.plugin.ColumnResizer",{extend:a.Plugin,ptype:"grid.columnresizer",inWidgetName:"columnresizer",constructor:function(){this.Super("const",arguments)},init:function(){var a=this,b=a.widget;a.Super("init",arguments),b.header&&b.on("render",function(){a.render(),a.ons()})},ons:function(){var a=this,b=a.widget;b.on("headercellmousemove",a.onCellMouseMove,a),b.on("headercellmousedown",a.onHeaderCellMouseDown,a),b.on("docclick",a.onDocClick,a),b.on("docmove",a.onDocMove,a),b.on("docmouseup",a.onDocMouseUp,a)},onCellMouseMove:function(a,d){var e=this,h=e.widget,i=d.e,j=b(d.cell),k=i.offsetX,l=j.width(),m=b(i.target),n=m.hasCls(f),o=m.hasCls(g),p=j.select("."+f).item(0),q=j.select("."+g).item(0),r=b(i.target).closest("."+c).hasCls(c),s=parseInt(p.css("width")),t=parseInt(q.css("width")),u=l,v=7;if(n&&(u=s),o&&(u=t),!h.startResizing){if(o)return void e.removeCellResizeCls(d.cell);if("left"===d.side&&d.index===h.leftColumns.length-1&&u-k<v+2&&(v+=2),!n&&!o&&"right"===d.side&&0===d.index&&k<v)e.isColumnResizable(d)&&(r||e.addCellResizeCls(d.cell));else if(!n&&!o&&k<v&&"center"===d.side&&0===d.index&&h.leftColumns.length)d.side="left",d.index=h.leftColumns.length-1,e.isColumnResizable(d)&&(r||e.addCellResizeCls(d.cell));else if(n||o||!(u-k<v||k<v)||0===d.index)u-k<v?o?t-k>2?e.removeCellResizeCls(d.cell):e.addCellResizeCls(d.cell):e.isColumnResizable(d)&&e.addCellResizeCls(d.cell):e.removeCellResizeCls(d.cell);else{var w=k<v;e.isColumnResizable(d,w)&&(r||e.addCellResizeCls(d.cell))}}},addCellResizeCls:function(a){var c=this,d=c.widget,e=d.columndrag;e&&"dragging"===e.status||(b(a).addCls(i),b(a).select("."+f).addCls(i))},removeCellResizeCls:function(a){b(a).removeClass(i),b(a).select("."+f).item(0).removeClass(i)},onHeaderCellMouseDown:function(d,e){d=e.e;var h=this,i=h.widget,j=b(d.target),k=b(e.cell),l=d.offsetX,m=k.width(),n=k.select("."+c),o=j.hasCls(f),p=j.hasCls(g),q=k.select("."+f).item(0),r=k.select("."+g).item(0),s=parseInt(q.css("width")),t=parseInt(r.css("width")),u=m,v=7;if(o&&(u=s),p)return void(u=t);n.length>0&&n.item(0).within(j.dom)||("left"===e.side&&e.index===i.leftColumns.length-1&&u-l<v+2&&(v+=2),!o&&!p&&"right"===e.side&&0===e.index&&l<v?(i.startResizing=!0,a.apply(h,{cell:e.cell,activeSide:e.side,clientX:d.clientX,columnIndex:e.index,moveLeftResizer:!0})):l<7&&"center"===e.side&&0===e.index&&i.leftColumns.length?(i.startResizing=!0,e.side="left",e.index=i.leftColumns.length-1,a.apply(h,{cell:h.getCell(e),activeSide:e.side,clientX:d.clientX,columnIndex:e.index})):!o&&!p&&l<v&&0!==e.index?(i.startResizing=!0,a.apply(h,{cell:h.getPrevCell(e),activeSide:e.side,clientX:d.clientX,columnIndex:e.index-1})):u-l<v&&(i.startResizing=!0,a.apply(h,{cell:e.cell,activeSide:e.side,clientX:d.clientX,columnIndex:e.index})),i.startResizing&&h.isColumnResizable())},isColumnResizable:function(a,b){var c,d,e,f=this,g=f.widget;if(a){if(c=g.getColumns(a.side),e=a.index,b&&(e--,d=c[e],e>0&&c[e].hidden&&e--),isNaN(e))return;return d=c[e],!(0===e&&d.hidden&&("center"!==a.side||!g.leftColumns))&&(!d.hidden&&!0===d.resizable)}c=g.getColumns(f.activeSide),!0!==c[f.columnIndex].resizable&&(g.startResizing=!1,delete f.cell,delete f.activeSide,delete f.clientX,delete f.columnIndex)},getMinColumnWidth:function(){var a,b,c=this,d=c.widget,e=d.minCellWidth;return void 0===c.columnIndex?e:(a=d.getColumns(c.activeSide),b=a[c.columnIndex],b.minWidth?b.minWidth:e)},getMaxColumnWidth:function(){var a,b,c=this,d=c.widget;return void 0!==c.columnIndex&&(a=d.getColumns(c.activeSide),b=a[c.columnIndex],!!b.maxWidth&&b.maxWidth)},onDocClick:function(){this.widget.startResizing=!1},onDocMove:function(a,b){this.widget.startResizing&&this.moveResizeEls(b)},render:function(){var a=this,c=a.widget,f=b(document.createElement("div")),g=b(document.createElement("div"));f.addCls(d),g.addCls(e),a.leftEl=b(c.el.dom.appendChild(f.dom)),a.rightEl=b(c.el.dom.appendChild(g.dom))},moveResizeEls:function(c){var d=this,e=d.widget,f=b(d.cell),g=parseInt(f.css("left")),h=d.getMinColumnWidth(),i=d.getMaxColumnWidth();switch(e.header.hideMenu&&e.header.hideMenu(),e.el.addCls(l),a.get(document.body).addCls(l),d.activeSide){case"left":break;case"center":g+=parseInt(e.leftEl.css("width"));break;case"right":g+=parseInt(e.leftEl.css("width")),g+=parseInt(e.centerEl.css("width"))}var j=c.clientX,k=j-d.clientX,m=f.width()+k;m<h&&(m=h),i&&m>i&&(m=i),d.deltaWidth=f.width()-m,d.moveLeftResizer?(k=j-d.clientX,m=f.width()-k,m<h&&(m=h),d.deltaWidth=f.width()-m,d.leftEl.css({display:"block",left:g+k+"px"}),d.rightEl.css({display:"block",left:g+f.width()-1+"px"})):(d.leftEl.css({display:"block",left:g+"px"}),d.rightEl.css({display:"block",left:g+m+"px"})),d.cellWidth=m},onDocMouseUp:function(){var b=this,c=b.widget;!1!==c.startResizing&&(c.el.removeCls(l),a.get(document.body).removeCls(l),b.leftEl.css({display:"none"}),b.rightEl.css({display:"none"}),b.fixSidesWidth(),c.startResizing=!1,b.moveLeftResizer=!1,delete b.cellWidth,c.scroller.update())},fixSidesWidth:function(){var c,d,e,f,g=this,i=g.widget,l=g.cellWidth,n=g.columnIndex,o=g.deltaWidth,p=i.leftEl,q=i.centerEl,r=i.rightEl,s=i.leftHeader.el,t=i.header.el,u=i.rightHeader.el,v=i.body.el,w={},x={},y=g.minCenterWidth;if(void 0!==l){var z=1;switch(a.nojQuery&&(z=0),g.activeSide){case"left":if((f=parseInt(q.css("width"))+o+z)<y)return;e=i.leftColumns[n],i.leftColumns[g.columnIndex].width=l,c=i.leftBody.el.select("."+j),d=i.leftHeader.el.select("."+h);var A=c.item(n);A.animate({width:l},m),A.css("overflow","");for(var B=g.columnIndex+1,C=d.length,D=0,E=B;D<E;D++){var F=d.item(D),G=F.attr("group-index");G&&(x[G]=!0)}for(;B<C;B++){var H=c.item(B),F=d.item(B);H.animate({left:parseInt(H.css("left"))-o-z},m),F.hasCls(k)&&x[F.attr("index")]||F.animate({left:parseInt(F.css("left"))-o-z},m)}p.animate({width:parseInt(p.css("width"))-o-z},m),s.animate({width:parseInt(s.css("width"))-o-z+"px"},m),i.columns.length&&(q.animate({left:parseInt(q.css("left"))-o-z,width:f},m),t.animate({width:parseInt(t.css("width"))+o+z},m),v.animate({width:parseInt(v.css("width"))+o+z},m));break;case"center":e=i.columns[n],i.columns[g.columnIndex].width=l,c=i.body.el.select("."+j),d=i.header.el.select("."+h);var A=c.item(n);A.animate({width:l},m),A.css("overflow","");for(var B=g.columnIndex+1,C=d.length,D=0,E=B;D<E;D++){var F=d.item(D),G=F.attr("group-index");G&&(x[G]=!0)}for(;B<C;B++){var H=c.item(B),F=d.item(B),I=parseInt(H.css("left"))-o-z,J=parseInt(F.css("left"))-o-z;F.attr("group-index")&&(w[F.attr("group-index")]={}),H.animate({left:I},m),F.hasCls(k)&&x[F.attr("index")]||F.animate({left:J},m)}break;case"right":if((f=parseInt(q.css("width"))+o+z)<y)return;e=i.rightColumns[n],i.rightColumns[g.columnIndex].width=l,c=i.rightBody.el.select("."+j),d=i.rightHeader.el.select("."+h);var A=c.item(n);A.animate({width:l+"px"},m),A.css("overflow","");for(var B=g.columnIndex+1,C=d.length,D=0,E=B;D<E;D++){var F=d.item(D),G=F.attr("group-index");G&&(x[G]=!0)}for(;B<C;B++){var H=c.item(B),F=d.item(B);H.animate({left:parseInt(H.css("left"))-o-z},m),F.hasCls(k)&&x[F.attr("index")]||F.animate({left:parseInt(F.css("left"))-o-z},m)}r.animate({width:parseInt(r.css("width"))-o-z},m),u.animate({width:parseInt(u.css("width"))-o-z+"px"},m),i.columns.length&&(q.animate({width:f},m),t.animate({width:parseInt(t.css("width"))+o+z},m),v.animate({width:parseInt(v.css("width"))+o+z},m))}var K,L=b(g.cell),M=L.attr("group-index");if(L.animate({width:l+"px"},m),M)K=i.el.select("[index='"+M+"']"),K.animate({width:parseInt(K.css("width"))-o-z},m);else for(var N in w)K=i.el.select("[index='"+N+"']"),K.css("left",parseInt(K.css("left"))-(w[N].delta||0)-z);if(i.fire("columnresize",{cell:L.dom,width:l,column:e,side:g.activeSide}),/sparkline/.test(e.type))switch(g.activeSide){case"left":i.leftBody.updateRows(void 0,n);break;case"center":i.body.updateRows(void 0,n);break;case"right":i.rightBody.updateRows(void 0,n)}else switch(e.type){case"progressbar":case"hbar":i.update()}}},getPrevCell:function(b){var c,d=this,e=d.widget;switch(b.side){case"left":c=e.leftHeader;break;case"center":c=e.header;break;case"right":c=e.rightHeader}var f=c.el.select("."+h).item(b.index-1).dom;return"none"===a.get(f).css("display")&&0!==b.index?(b.cell=f,b.index--,d.getPrevCell(b)):f},getCell:function(a){var b,c=this,d=c.widget;switch(a.side){case"left":b=d.leftHeader;break;case"center":b=d.header;break;case"right":b=d.rightHeader}return b.el.select("."+h).item(a.index).dom},updateColumnsWidth:function(b){if("all"===b)return this.updateColumnsWidth("left"),this.updateColumnsWidth("right"),void this.updateColumnsWidth("center");var c=1;a.nojQuery&&(c=0);for(var d=this,e=d.widget,b=b||"center",f=e.getHeader(b),g=e.getBody(b),h=e.getColumns(b),i=0,j=h.length,k=0,l=e.leftEl,n=e.rightEl,o=e.leftHeader.el,p=e.rightHeader.el;i<j;i++){var q=h[i];q.hidden||(k+=q.width,d.setColumnWidth(i,q.width,b))}switch(e.header&&(f.setCellsPosition(),f.updateCellsSizes()),g.updateColumnsSizes(),b){case"center":break;case"left":var r=parseInt(l.css("width")),s=parseInt(o.css("width")),t=r-k;l.animate({width:r-t-c},m),o.animate({width:s-t-c},m),e.columns.length&&this.updateCenterSideWidth();break;case"right":var u=parseInt(l.css("width")),s=parseInt(o.css("width")),t=u-k;n.animate({width:u-t},m),p.animate({width:s-t},m),e.columns.length&&this.updateCenterSideWidth()}},updateCenterSideWidth:function(){var b=this,c=b.widget,d=c.centerEl,e=c.header.el,f=c.body.el,g=0,h=0,i=c.getColumns("left"),j=c.getColumns("right"),k=c.width;c.panel?(k-=c.panelBodyBorders[1],k-=c.panelBodyBorders[3],k-=c.gridBorders[1],k-=c.gridBorders[3]):(k-=c.gridWithoutPanelBorders[1],k-=c.gridWithoutPanelBorders[3]);var l=1;a.nojQuery&&(l=0),a.each(i,function(a){a.hidden||(g+=a.width)}),a.each(j,function(a){a.hidden||(h+=a.width)}),k-=g,k-=h,k+=l,d.animate({left:g-l,width:k},m),d.animate({width:k},m),e.animate({width:k},m),f.animate({width:k},m)},setColumnWidth:function(a,c,d){var e,f,g=this,h=g.widget,i=h.getColumns(d),j=h.getBody(d),k=b(j.getDomColumn(a));if(h.header&&(e=h.getHeader(d),f=e.getCell(a)),parseInt(k.css("width"))!==c){var l;h.header&&(l=f.dom),h.fire("columnresize",{cell:l,width:c,column:i[a],side:d})}},getNextVisibleIndex:function(a,b){for(var c=this,d=c.widget,e=d.getColumns(b),f=a+1,g=e.length;f<g;f++){if(!e[f].hidden)return f}}})}(),Fancy.define("Fancy.grid.plugin.Licence",{extend:Fancy.Plugin,ptype:"grid.licence",inWidgetName:"licence",constructor:function(){this.Super("const",arguments)},init:function(){this.Super("init",arguments),this.ons()},ons:function(){var a=this;a.widget.once("render",function(){a.render()})},render:function(){var a=this,b=a.widget,c=b.body,d=Fancy.get(document.createElement("div"));/fancygrid/.test(location.host)&&!b.watermark||(!0!==a.checkLicence()||b.watermark)&&(d.css({position:"absolute","z-index":2,width:"30px",height:"30px"}),b.nativeScroller?d.css({top:"2px",left:"2px"}):d.css({right:"4px",bottom:"0px"}),d.update('<a href="http://www.fancygrid.com" title="JavaScript Grid - FancyGrid" style="background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAPklEQVR42mNgGLGAo+/4f1IwTN+i8y/+k4JHLR61eNTiUYuHgcUjD5AbZORG0ajFoxaPWjxq8RC2eBQMWwAAuxzh7E9tdUsAAAAASUVORK5CYII=);color: #60B3E2;font-size: 25px;line-height: 30px;text-decoration: none;background-repeat: no-repeat;">&nbsp;&nbsp;&nbsp;&nbsp;</a>'),Fancy.get(c.el.append(d.dom)),a.licenceEl=d,b.watermark&&a.configWatermark(),a.showConsoleText())},showConsoleText:function(){window.console&&console.log&&Fancy.isChrome&&(console.log("%cFancy%cGrid%c %cTrial%c Version!","color:#A2CFE8;font-size: 14px;font-weight: bold;","color:#088EC7;font-size: 14px;font-weight: bold;","font-weight:bold;color: #515151;font-size: 12px;","color: red;font-weight: bold;font-size: 14px;","font-weight:bold;color: #515151;font-size: 12px;"),console.log("%cPurchase license for legal usage!\nSales email: sales@fancygrid.com","font-weight:bold;color: #515151;font-size: 12px;"))},configWatermark:function(){var a=this,b=a.widget,c=b.watermark;if(c.text){var d=a.licenceEl.firstChild();d.css("background-image","none"),d.css("font-size","11px"),d.update(c.text),a.licenceEl.css("width","initial")}c.style&&a.licenceEl.css(c.style)},checkLicence:function(){var a=this,b="FancyGrid";if(!Fancy.LICENSE&&!FancyGrid.LICENSE)return!1;var c,d,e=String(a.md5(location.host.replace(/^www\./,""),b)),f=Fancy.LICENSE||FancyGrid.LICENSE||[],g=a.md5("UNIVERSAL",b),h=a.md5("SAAS",b),i=a.md5("INTERNAL",b),j=a.md5("OEM",b),k=a.md5("ENTERPRISE",b);for(c=0,d=f.length;c<d;c++)switch(String(f[c])){case e:case g:case h:case i:case j:case k:return!0}return!1},md5:function(a,b,c){var d=function(a,b){var c=(65535&a)+(65535&b);return(a>>16)+(b>>16)+(c>>16)<<16|65535&c},e=function(a,b){return a<<b|a>>>32-b},f=function(a,b,c,f,g,h){return d(e(d(d(b,a),d(f,h)),g),c)},g=function(a,b,c,d,e,g,h){return f(b&c|~b&d,a,b,e,g,h)},h=function(a,b,c,d,e,g,h){return f(b&d|c&~d,a,b,e,g,h)},i=function(a,b,c,d,e,g,h){return f(b^c^d,a,b,e,g,h)},j=function(a,b,c,d,e,g,h){return f(c^(b|~d),a,b,e,g,h)},k=function(a,b){a[b>>5]|=128<<b%32,a[14+(b+64>>>9<<4)]=b;var c,e,f,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(c=0;c<a.length;c+=16)e=m,f=n,k=o,l=p,m=g(m,n,o,p,a[c],7,-680876936),p=g(p,m,n,o,a[c+1],12,-389564586),o=g(o,p,m,n,a[c+2],17,606105819),n=g(n,o,p,m,a[c+3],22,-1044525330),m=g(m,n,o,p,a[c+4],7,-176418897),p=g(p,m,n,o,a[c+5],12,1200080426),o=g(o,p,m,n,a[c+6],17,-1473231341),n=g(n,o,p,m,a[c+7],22,-45705983),m=g(m,n,o,p,a[c+8],7,1770035416),p=g(p,m,n,o,a[c+9],12,-1958414417),o=g(o,p,m,n,a[c+10],17,-42063),n=g(n,o,p,m,a[c+11],22,-1990404162),m=g(m,n,o,p,a[c+12],7,1804603682),p=g(p,m,n,o,a[c+13],12,-40341101),o=g(o,p,m,n,a[c+14],17,-1502002290),n=g(n,o,p,m,a[c+15],22,1236535329),m=h(m,n,o,p,a[c+1],5,-165796510),p=h(p,m,n,o,a[c+6],9,-1069501632),o=h(o,p,m,n,a[c+11],14,643717713),n=h(n,o,p,m,a[c],20,-373897302),m=h(m,n,o,p,a[c+5],5,-701558691),p=h(p,m,n,o,a[c+10],9,38016083),o=h(o,p,m,n,a[c+15],14,-660478335),n=h(n,o,p,m,a[c+4],20,-405537848),m=h(m,n,o,p,a[c+9],5,568446438),p=h(p,m,n,o,a[c+14],9,-1019803690),o=h(o,p,m,n,a[c+3],14,-187363961),n=h(n,o,p,m,a[c+8],20,1163531501),m=h(m,n,o,p,a[c+13],5,-1444681467),p=h(p,m,n,o,a[c+2],9,-51403784),o=h(o,p,m,n,a[c+7],14,1735328473),n=h(n,o,p,m,a[c+12],20,-1926607734),m=i(m,n,o,p,a[c+5],4,-378558),p=i(p,m,n,o,a[c+8],11,-2022574463),o=i(o,p,m,n,a[c+11],16,1839030562),n=i(n,o,p,m,a[c+14],23,-35309556),m=i(m,n,o,p,a[c+1],4,-1530992060),p=i(p,m,n,o,a[c+4],11,1272893353),o=i(o,p,m,n,a[c+7],16,-155497632),n=i(n,o,p,m,a[c+10],23,-1094730640),m=i(m,n,o,p,a[c+13],4,681279174),p=i(p,m,n,o,a[c],11,-358537222),o=i(o,p,m,n,a[c+3],16,-722521979),n=i(n,o,p,m,a[c+6],23,76029189),m=i(m,n,o,p,a[c+9],4,-640364487),p=i(p,m,n,o,a[c+12],11,-421815835),o=i(o,p,m,n,a[c+15],16,530742520),n=i(n,o,p,m,a[c+2],23,-995338651),m=j(m,n,o,p,a[c],6,-198630844),p=j(p,m,n,o,a[c+7],10,1126891415),o=j(o,p,m,n,a[c+14],15,-1416354905),n=j(n,o,p,m,a[c+5],21,-57434055),m=j(m,n,o,p,a[c+12],6,1700485571),p=j(p,m,n,o,a[c+3],10,-1894986606),o=j(o,p,m,n,a[c+10],15,-1051523),n=j(n,o,p,m,a[c+1],21,-2054922799),m=j(m,n,o,p,a[c+8],6,1873313359),p=j(p,m,n,o,a[c+15],10,-30611744),o=j(o,p,m,n,a[c+6],15,-1560198380),n=j(n,o,p,m,a[c+13],21,1309151649),m=j(m,n,o,p,a[c+4],6,-145523070),p=j(p,m,n,o,a[c+11],10,-1120210379),o=j(o,p,m,n,a[c+2],15,718787259),n=j(n,o,p,m,a[c+9],21,-343485551),m=d(m,e),n=d(n,f),o=d(o,k),p=d(p,l);return[m,n,o,p]},l=function(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c},m=function(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c},n=function(a){return l(k(m(a),8*a.length))},o=function(a,b){var c,d,e=m(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=k(e,8*a.length)),c=0;c<16;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=k(f.concat(m(b)),512+8*b.length),l(k(g.concat(d),640))},p=function(a){var b,c,d="0123456789abcdef",e="";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(b>>>4&15)+d.charAt(15&b);return e},q=function(a){return unescape(encodeURIComponent(a))},r=function(a){return n(q(a))},s=function(a){return p(r(a))},t=function(a,b){return o(q(a),q(b))},u=function(a,b){return p(t(a,b))};return function(a,b,c){return b?c?t(b,a):u(b,a):c?r(a):s(a)}(a,b,c)}}),function(){var a=Fancy,b=a.GRID_CELL_CLS,c=a.GRID_CELL_EVEN_CLS,d=a.GRID_CELL_SELECTED_CLS,e=a.GRID_COLUMN_CLS,f=a.GRID_COLUMN_TEXT_CLS,g=a.GRID_COLUMN_ELLIPSIS_CLS,h=a.GRID_COLUMN_ORDER_CLS,i=a.GRID_COLUMN_SELECT_CLS,j=a.GRID_COLUMN_TREE_CLS,k=a.GRID_CELL_INNER_CLS,l=a.GRID_CELL_DIRTY_CLS,m=a.GRID_CELL_DIRTY_EL_CLS,n=a.GRID_PSEUDO_CELL_CLS,o=a.GRID_EMPTY_CLS,p=a.GRID_COLUMN_SPARKLINE_CLS,q=a.GRID_COLUMN_SPARKLINE_BULLET_CLS,r=a.GRID_COLUMN_CHART_CIRCLE_CLS,s=a.GRID_COLUMN_SPARK_PROGRESS_DONUT_CLS,t=a.GRID_COLUMN_GROSSLOSS_CLS,u=a.GRID_COLUMN_PROGRESS_CLS,v=a.GRID_COLUMN_PROGRESS_BAR_CLS,w=a.GRID_COLUMN_H_BAR_CLS,x=a.GRID_COLUMN_ROW_DRAG_CLS,y=a.GRID_ROW_DRAG_EL_CLS;a.ns("Fancy.grid.body.mixin"),a.grid.body.mixin.Updater=function(){},a.grid.body.mixin.Updater.prototype={update:function(a){var b,c=this,d=c.widget,e=d.store;switch(a){case"cell":case"cells":break;case"waitstate":return void c.checkDomColumns();default:c.checkDomColumns()}if(!e.loading){switch(a){case"row":case"rows":b=e.changed;for(var f in b){var g=b[f],h=d.getRowById(f);for(var i in g)switch(i){case"length":break;default:c.updateRows(h)}}break;case"cell":case"cells":b=e.changed;for(var f in b){var g=b[f],h=d.getRowById(f);for(var i in g)switch(i){case"length":break;default:var j=d.getColumnOrderByKey(i);c.updateRows(h,j.order)}}break;default:c.checkDomCells(),c.updateRows()}c.showEmptyText()}},checkDomColumns:function(){var b=this,c=b.widget,d=b.el.select("."+e).length,k=b.getColumns(),l=0,m=k.length;if(!(m<=d)){for(;l<m;l++){var n=k[l],o=n.width,p=a.get(document.createElement("div"));if(n.hidden&&p.css("display","none"),p.addCls(e),p.attr("grid",c.id),p.attr("role","presentation"),"$selected"===n.index||n.select)p.addCls(i);else switch(n.type){case"order":p.addCls(h);break;case"rowdrag":p.addCls(x)}if("tree"===n.type&&(p.addCls(j),n.folder&&p.addCls("fancy-grid-tree-column-folder")),n.rowdrag&&p.addCls(x),n.cls&&p.addCls(n.cls),"text"===n.type&&p.addCls(f),p.css({width:o+"px"}),p.attr("index",l),n.cellAlign&&p.css("text-align",n.cellAlign),!0===n.ellipsis)switch(n.type){case"string":case"text":case"number":case"currency":case"date":case"combo":case"tree":p.addCls(g)}b.el.dom.appendChild(p.dom)}b.fire("adddomcolumns")}},checkDomCells:function(f){var g,h,i=this,j=i.widget,k=j.body,l=j.store,m=0,o=l.dataView.length,p=0;switch(l.infinite&&(o=l.infiniteDisplayedRows)>l.dataView.length&&(o=l.dataView.length),i.side){case"left":h=j.leftColumns;break;case"center":h=j.columns;break;case"right":h=j.rightColumns}g=h.length;var q=i.el.select("."+e),r=l.getLength(),s=i.cellTpl;for(j.cellWrapper&&(s=i.cellWrapperTpl),void 0!==f&&(p=f,g=f);p<g;p++){var t=q.item(p),u=0;for(u=r-t.select("."+b).length,m=o-u;m<o;m++){var v=s.getHTML({}),w=a.get(document.createElement("div"));w.attr("role","gridcell"),w.css({height:j.cellHeight+"px"}),w.addCls(b),w.attr("index",m),m%2!=0&&j.striped&&w.addCls(c),w.update(v),t.dom.appendChild(w.dom),k.el.select("."+b+"."+d+'[index="'+m+'"]').length&&w.addCls(d)}if(j.nativeScroller&&("left"===i.side||"right"===i.side)){t.select("."+n).destroy();var v=s.getHTML({cellValue:"&nbsp;"}),w=a.get(document.createElement("div"));w.attr("role","gridcell"),w.css({height:j.cellHeight+"px"}),w.addCls(n),w.update(v),t.dom.appendChild(w.dom)}}},updateRows:function(a,b){var c,d,e=this,f=e.widget,g=0;switch(void 0===a?e.clearDirty():e.clearDirty(a),e.side){case"left":c=f.leftColumns;break;case"center":c=f.columns;break;case"right":c=f.rightColumns}if(d=c.length,!(void 0!==b&&(g=b,(d=b+1)>c.length))){for(;g<d;g++){var h=c[g];switch(h.type){case"string":case"number":case"combo":case"action":case"text":case"date":case"currency":e.renderUniversal(g,a);break;case"tree":e.renderTree(g,a);break;case"order":e.renderOrder(g,a);break;case"expand":e.renderExpand(g,a);break;case"select":e.renderSelect(g,a);break;case"color":e.renderColor(g,a);break;case"checkbox":e.renderCheckbox(g,a);break;case"switcher":e.renderCheckbox(g,a,!0);break;case"image":e.renderImage(g,a);break;case"sparklineline":e.renderSparkLine(g,a,"line");break;case"sparklinebar":e.renderSparkLine(g,a,"bar");break;case"sparklinetristate":e.renderSparkLine(g,a,"tristate");break;case"sparklinediscrete":e.renderSparkLine(g,a,"discrete");break;case"sparklinebullet":e.renderSparkLine(g,a,"bullet");break;case"sparklinepie":e.renderSparkLine(g,a,"pie");break;case"sparklinebox":e.renderSparkLine(g,a,"box");break;case"circle":e.renderCircle(g,a);break;case"progressdonut":e.renderProgressDonut(g,a);break;case"progressbar":e.renderProgressBar(g,a);break;case"hbar":e.renderHBar(g,a);break;case"grossloss":e.renderGrossLoss(g,a);break;case"rowdrag":e.renderRowDrag(g,a);break;default:throw new Error("[FancyGrid error] - not existed column type "+h.type)}h.select&&e.renderSelect(g,a,!0),h.rowdrag&&e.renderRowDrag(g,a,!0)}e.removeNotUsedCells()}},renderUniversal:function(a,c){var d,f,g,h=this,i=h.widget,j=i.lang,l=i.emptyValue,m=i.store,n=h.getColumns(),o=n[a],p=h.el.select("."+e),q=p.item(a),r=q.select("."+b),s=q.select("."+b+" ."+k),t=o.currency||j.currencySign,u=!1;o.select&&(u=!0),o.rowdrag&&(u=!0),d=void 0!==o.index?o.index:"action"===o.type?"none":void 0,void 0!==c?(f=c,g=c+1):(f=0,g=m.getLength());var v=0;if(i.infinite){v=m.infiniteScrolledToRow;var w=i.getNumOfVisibleCells();g>w&&(g=w)}for(;f<g;f++){if(i.infinite){var x=m.dataView[f+v],y=r.item(f);if(void 0===x){i.el.select("."+b+'[index="'+f+'"]').css("visibility","hidden");break}if("hidden"===y.css("visibility")){i.el.select("."+b+'[index="'+f+'"]').css("visibility","");break}}var z,A=m.get(f+v),B=m.getId(f+v),C=s.item(f),y=r.item(f),D={rowIndex:f,data:A,style:{},column:o,id:B,item:m.getItem(f+v),inner:C,cell:y},E=!1;switch(m.changed[D.id]&&m.changed[D.id][o.index]&&(E=!0),z=o.smartIndexFn?o.smartIndexFn(A):void 0===d?"":m.get(f+v,d),D.value=z,o.format&&(D.value=h.format(D.value,o.format,o.precision),z=D.value),o.type){case"currency":""!==z&&(z=t+z),D.value=z}switch(o.render&&(D=o.render(D),z=D.value),z){case"":case null:case void 0:z=l}if(i.cellStylingCls&&h.clearCls(y),D.cls&&y.addCls(D.cls),E&&i.dirtyEnabled&&h.enableCellDirty(y),y.css(D.style),u){var F=[];o.rowdrag&&F.push('<div class="fancy-grid-cell-inner-rowdrag"></div>'),o.select?F.push('<div class="fancy-grid-cell-inner-select"></div>'):o.rowdrag&&F.push('<div class="fancy-grid-cell-inner-rowdrag-fix"></div>');var G=C.select(".fancy-grid-cell-inner-text");G.length?G.update(z):(F.push('<span class="fancy-grid-cell-inner-text">'+z+"</span>"),C.update(F.join(" ")))}else D.column.widget||C.update(z);if(D.column.autoHeight){y.css("height","");var H=parseInt(y.css("height"))+4;i.rowheight.waitToShow(),H<i.cellHeight&&(H=i.cellHeight),i.rowheight.add(B,H,D.rowIndex)}}},renderOrder:function(a){var c=this,d=c.widget,f=d.store,g=c.getColumns(),h=g[a],i=c.el.select("."+e),j=i.item(a),l=j.select("."+b),m=j.select("."+b+" ."+k),n=0,o=f.getLength(),p=0;if(d.paging&&(p+=f.showPage*f.pageSize),d.infinite){var q=d.getNumOfVisibleCells();o>q&&(o=q),p=f.infiniteScrolledToRow}for(;n<o;n++){var r=f.get(n),s=f.getId(n),t={rowIndex:n,data:r,style:{},column:h,id:s,item:f.getItem(n)},u=n+1+p;d.grouping&&(u+=d.grouping.getCollapsedRowsBefore(s)),t.value=u,h.render&&(t=h.render(t),u=t.value);var v=l.item(n);d.cellStylingCls&&c.clearCls(v),t.cls&&v.addCls(t.cls),v.css(t.style),m.item(n).update(u)}d.grouping&&delete d.grouping.collapsedRowsBefore},renderRowDrag:function(a,c,d){var f=this,g=f.widget,h=g.store,i=f.getColumns(),j=i[a],l=f.el.select("."+e),m=l.item(a),n=m.select("."+b),o=m.select("."+b+" ."+k),p=0,q=h.getLength();if(g.infinite){var r=g.getNumOfVisibleCells();q>r&&(q=r)}for(;p<q;p++){var s=h.get(p),t=h.getId(p),u={rowIndex:p,data:s,style:{},column:j,id:t,item:h.getItem(p)},v='<svg class="'+y+'" style="opacity: 0;" viewBox="0 0 6 14"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 2h2V0H0v2zm0 4h2V4H0v2zm0 3.999h2V8H0v1.999zM0 14h2v-2H0v2zM4 0v2h2V0H4zm0 6h2V4H4v2zm0 3.999h2V8H4v1.999zM4 14h2v-2H4v2z"></path></svg>';u.value=v;var w=n.item(p);if(g.cellStylingCls&&f.clearCls(w),u.cls&&w.addCls(u.cls),w.css(u.style),d){o.item(p).select(".fancy-grid-cell-inner-rowdrag").item(0).update(v)}else o.item(p).update(v)}},renderTree:function(a,c){var d,f,g=this,h=g.widget,i=h.store,j=g.getColumns(),l=j[a],m=g.el.select("."+e),n=m.item(a),o=n.select("."+b+" ."+k),p=l.index;if(void 0!==c?(d=c,f=c+1):(d=0,f=i.getLength()),h.infinite){var q=h.getNumOfVisibleCells();f>q&&(f=q)}for(;d<f;d++){var r=o.item(d),s=h.get(d),t=s.get(p),u=Number(s.get("$deep"))-1,v="fancy-grid-tree-expander";s.get("leaf")&&(v="fancy-grid-tree-expander-leaf"),s.get("expanded")&&(v+=" fancy-grid-tree-expander-expanded");var w=15*u,x="";if(l.render){var y=l.render({item:s,data:s.data,deep:u,leaf:s.get("leaf"),rowIndex:c,column:l,value:t});y.nodeImgCls&&(x='<span class="fancy-grid-tree-expander-node '+y.nodeImgCls+'"></span>'),void 0!==y.value&&(t=y.value)}if(l.folder){var z=s.get("leaf"),A=s.get("expanded");x=z?'<span class="fancy-grid-tree-folder-file"></span>':A?'<span class="fancy-grid-tree-folder-opened"></span>':'<span class="fancy-grid-tree-folder-closed"></span>'}s.get("leaf")&&(w-=8);var B=[];B.push('<span class="'+v+'" style="margin-left: '+w+'px;"></span>'),l.select&&B.push('<span class="fancy-grid-cell-inner-select" style="margin-left: 6px;"></span>'),B.push(x),B.push('<span class="fancy-grid-tree-expander-text">'+t+"</span>"),r.update(B.join(""))}},renderExpand:function(c,d){var f,g,h=this,i=h.widget,j=i.store,l=h.getColumns(),m=l[c],n=h.el.select("."+e),o=n.item(c),p=o.select("."+b+" ."+k);if(void 0!==d?(f=d,g=d+1):(f=0,g=j.getLength()),i.infinite){var q=i.getNumOfVisibleCells();g>q&&(g=q)}for(;f<g;f++){var r,s=p.item(f),t=s.select(".fancy-field-checkbox"),u=0!==t.length,v=i.get(f),w=v.id;!1===u?(p.item(f).update(""),t=new a.CheckBox({renderTo:p.item(f).dom,renderId:!0,value:!1,label:!1,expander:!0,style:{padding:"0px",display:"inline-block"},events:[{change:function(a,b){d=a.el.parent().parent().attr("index"),b?i.expander.expand(d):i.expander.collapse(d)}}]})):(r=t.dom.id,t=a.getWidget(r),i.expander._expandedIds[w]?t.set(!0,!1):t.set(!1,!1));var x=j.get(f),y=j.getId(f),z={rowIndex:f,data:x,style:{},column:m,id:y,item:j.getItem(f)};m.render&&(!0===m.render(z).hidden?t.hide():t.show())}},clearCls:function(b){var c=this.widget;a.each(c.cellStylingCls,function(a){b.removeCls(a)})},renderColor:function(a,c){var d,f,g=this,h=g.widget,i=h.store,j=g.getColumns(),l=j[a],m=l.index,n=g.el.select("."+e),o=n.item(a),p=o.select("."+b);if(void 0!==c?(d=c,f=c+1):(d=0,f=i.getLength()),h.infinite){var q=h.getNumOfVisibleCells();f>q&&(f=q)}for(;d<f;d++){var r,s=i.get(d),t={rowIndex:d,data:s,style:{},column:l};r=l.smartIndexFn?l.smartIndexFn(s):i.get(d,m),l.render&&(t=l.render(t),r=t.value),t.value=r;var u=p.item(d);u.css(t.style);u.select("."+k).update('<div class="fancy-grid-color-cell" style="background: '+r+';"></div>')}},renderCombo:function(a,c){var d,f,g=this,h=g.widget,i=h.store,j=g.getColumns(),l=j[a],m=l.index,n=g.el.select("."+e),o=n.item(a),p=o.select("."+b),q=o.select("."+b+" ."+k);for(void 0!==c?(d=c,f=c+1):(d=0,f=i.getLength());d<f;d++){var r=i.get(d,m),s={rowIndex:d,value:r,style:{}};l.render&&(s=l.render(s),r=s.value),p.item(d).css(s.style),q.item(d).update(r)}},renderCheckbox:function(c,d,f){var g,h,i=this,j=i.widget,l=j.store,m=i.getColumns(),n=m[c],o=n.index,p=i.el.select("."+e),q=p.item(c),r=q.select("."+b),s=q.select("."+b+" ."+k),t="CheckBox";if(f&&(t="Switcher"),void 0!==d?(g=d,h=d+1):(g=0,h=l.getLength()),j.infinite){var u=j.getNumOfVisibleCells();h>u&&(h=u)}for(;g<h;g++){var v,w=l.get(g),x=l.get(g,o),y=s.item(g),z=r.item(g),A=f?y.select(".fancy-field-switcher"):y.select(".fancy-field-checkbox"),B=0!==A.length,C=!1,D=l.getId(g),E={rowIndex:g,data:w,style:{},column:n,id:D,item:l.getItem(g),value:x};if(l.changed[E.id]&&l.changed[E.id][n.index]&&(C=!0),n.render&&(E=n.render(E),x=E.value),!1===B)if(E.stopped)s.item(g).update(x);else{var F=!0;j.rowEdit&&(F=!1),s.item(g).update(""),new a[t]({renderTo:s.item(g).dom,renderId:!0,value:x,label:!1,editable:F,style:{padding:"0px",display:"inline-block"},events:[{beforechange:function(a){"$selected"===n.index||n.select||!0!==n.editable&&(a.canceledChange=!0)}},{change:function(a,b){"$selected"===n.index||n.select||(j.celledit.checkBoxChangedValue=b)}}]})}else v=A.dom.id,A=a.getWidget(v),E.stopped?(A.destroy(),s.item(g).update(x)):A.set(x,!1);j.cellStylingCls&&i.clearCls(z),E.cls&&z.addCls(E.cls),z.css(E.style),C&&j.dirtyEnabled&&(z=r.item(g),i.enableCellDirty(z))}},renderSelect:function(c,f,g){var h,i,j=this,l=j.widget,m=l.store,n=j.getColumns(),o=n[c],p=j.el.select("."+e),q=p.item(c),r=q.select("."+b+" ."+k);if(void 0!==f?(h=f,i=f+1):(h=0,i=m.getLength()),l.infinite){var s=l.getNumOfVisibleCells();i>s&&(i=s)}for(;h<i;h++){var t,u,v=!1,w=m.get(h,"id"),x=r.item(h),y=x.select(".fancy-field-checkbox"),z=0!==y.length,A=!0;if(l.selection.memory){if(l.selection.memory.all&&!l.selection.memory.excepted[w]?(v=!0,l.selection.domSelectRow(h)):l.selection.memory.has(w)?(v=!0,l.selection.domSelectRow(h)):(v=!1,l.selection.domDeSelectRow(h)),m.isTree){t=m.getItem(h);var B=t.get("$selected");if(B){var C=function(b){a.each(b,function(a){if(a.fields){if(!1===a.get("$selected"))return void l.selection.memory.remove(a.id);t.set("$selected",void 0),a.set("$selected",!0),l.selection.memory.add(a.id),a.data.child&&a.data.child[0]&&a.data.child[0].fields&&C(a.data.child)}})};C(t.data.child)}}}else x.parent().hasClass(d)&&(v=!0);if("select"===o.type||o.select)if(l.selection.disabled&&(A=!1),!1===z){var D=r.item(h);g?(D=D.select(".fancy-grid-cell-inner-select").item(0).dom,Fancy.isBoolean(v)||(v=!1)):(r.item(h).update(""),D=D.dom);var E={renderTo:D,renderId:!0,value:v,label:!1,stopIfCTRL:!0,editable:A,disabled:!A,style:{padding:"0px",display:"inline-block"},events:[{beforechange:function(a){l.selection.stopOneTick&&(a.canceledChange=!0)}}]},y=new a.CheckBox(E);if(m.isTree&&l.selection.memory&&l.selection.memory.tree.selected[w]&&!l.selection.memory.tree.allSelected[w]&&t){var F=t.get("child");F&&F.length&&y.setMiddle(!0)}}else u=y.dom.id,y=a.getWidget(u),y.set(v,!1)}},renderImage:function(a,c){var d,f,g=this,h=g.widget,i=h.store,j=g.getColumns(),l=j[a],m=l.index,n=g.el.select("."+e),o=n.item(a),p=o.select("."+b),q=o.select("."+b+" ."+k);if(void 0!==c?(d=c,f=c+1):(d=0,f=i.getLength()),h.infinite){var r=h.getNumOfVisibleCells();f>r&&(f=r)}for(;d<f;d++){var s=i.get(d,m),t=i.get(d),u={rowIndex:d,value:s,data:t,style:{}},v="";if(l.render&&(u=l.render(u),s=u.value),u.attr)for(var w in u.attr)v+=w+'="'+u.attr[w]+'"';s="<img "+v+' src="'+u.value+'">',p.item(d).css(u.style),q.item(d).update(s)}},renderSparkLine:function(c,d,f){var g,h,i=this,j=i.widget,l=j.cellHeight,m=j.store,n=i.getColumns(),o=n[c],r=o.width,s=o.index,t=i.el.select("."+e),u=t.item(c),v=u.select("."+b),w=u.select("."+b+" ."+k),x=o.sparkConfig||{};u.addCls(p),void 0!==d?(g=d,h=d+1):(g=0,h=m.getLength());var y,z=l-1,A=r-20;switch(f){case"line":case"pie":case"box":y="width";break;case"bullet":y="width",z-=11,u.addCls(q);break;case"discrete":y="width",A=r,z-=2;break;case"bar":case"tristate":y="barWidth"}if(j.infinite){var B=j.getNumOfVisibleCells();h>B&&(h=B)}for(;g<h;g++){var C=m.get(g,s),D=m.get(g),E={rowIndex:g,value:C,data:D,style:{}};if(o.render&&(E=o.render(E),C=E.value),a.isArray(o.values)){var F=0,G=o.values.length;for(C=[];F<G;F++)C.push(m.get(g,o.values[F]))}v.item(g).css(E.style);var H=w.item(g).dom,I={type:f,fillColor:"transparent",height:z};a.apply(I,x),"bar"!==f&&"tristate"!==f||(A=r-20,A/=C.length),I[y]=A,a.$(H).sparkline(C,I)}},renderProgressDonut:function(c,d){var f,g,h=this,i=h.widget,j=i.store,l=h.getColumns(),m=l[c],n=m.index,o=h.el.select("."+e),p=o.item(c),q=p.select("."+b),r=p.select("."+b+" ."+k);if(p.addCls(s),void 0!==d?(f=d,g=d+1):(f=0,g=j.getLength()),i.infinite){var t=i.getNumOfVisibleCells();g>t&&(g=t)}for(;f<g;f++){var u,v=j.get(f),w={rowIndex:f,data:v,style:{},column:m};u=m.smartIndexFn?m.smartIndexFn(v):j.get(f,n),w.value=u,m.format&&(w.value=h.format(w.value,m.format),u=w.value),m.render&&(w=m.render(w),u=w.value),q.item(f).css(w.style);var x=m.sparkConfig||{},y=r.item(f).dom;a.apply(x,{renderTo:y,value:u}),x.size||x.height||x.width||(x.size=i.cellHeaderHeight-6),a.get(y).update(""),new a.spark.ProgressDonut(x)}},renderGrossLoss:function(c,d){var f,g,h=this,i=h.widget,j=i.store,l=h.getColumns(),m=l[c],n=m.index,o=h.el.select("."+e),p=o.item(c),q=p.select("."+b),r=p.select("."+b+" ."+k);p.addCls(t),void 0!==d?(f=d,g=d+1):(f=0,g=j.getLength());var s=m.sparkConfig||{};if(s.showOnMax&&(s.maxValue=Math.max.apply(Math,j.getColumnData(n,m.smartIndexFn))),i.infinite){var u=i.getNumOfVisibleCells();g>u&&(g=u)}for(;f<g;f++){var v,w=j.get(f),x={rowIndex:f,data:w,style:{},column:m};v=m.smartIndexFn?m.smartIndexFn(w):j.get(f,n),x.value=v,m.format&&(x.value=h.format(x.value,m.format),v=x.value),m.render&&(x=m.render(x),v=x.value),q.item(f).css(x.style),a.apply(s,{renderTo:r.item(f).dom,value:v,column:m}),new a.spark.GrossLoss(s)}},renderProgressBar:function(c,d){var f,g,h=this,i=h.widget,j=i.store,l=h.getColumns(),m=l[c],n=m.index,o=h.el.select("."+e),p=o.item(c),q=p.select("."+b),r=p.select("."+b+" ."+k),s=100;p.addCls(u),void 0!==d?(f=d,g=d+1):(f=0,g=j.getLength());var t=m.sparkConfig||{};if(!1===t.percents&&(s=Math.max.apply(Math,j.getColumnData(n))),i.infinite){var w=i.getNumOfVisibleCells();g>w&&(g=w)}for(;f<g;f++){var x,y=j.get(f),z={rowIndex:f,data:y,style:{},column:m},A=q.item(f);x=m.smartIndexFn?m.smartIndexFn(y):j.get(f,n),z.value=x,m.format&&(z.value=h.format(z.value,m.format),x=z.value),m.render&&(z=m.render(z),x=z.value),A.css(z.style),i.cellStylingCls&&h.clearCls(A),z.cls&&A.addCls(z.cls);var B=a.get(r.item(f).dom);if(B.select("."+v).length){var C=a.getWidget(B.select("."+v).item(0).attr("id"));C.value=x,C.maxValue=s,C.update()}else a.apply(t,{renderTo:r.item(f).dom,value:x,column:m,maxValue:s}),new a.spark.ProgressBar(t)}},renderHBar:function(c,d){var f,g,h=this,i=h.widget,j=i.store,l=h.getColumns(),m=l[c],n=m.index,o=h.el.select("."+e),p=o.item(c),q=p.select("."+b),r=p.select("."+b+" ."+k),s=m.sparkConfig||{},t=m.disabled||{};p.addCls(w);var u,v,x={},c=0,y=Number.MIN_VALUE;if(a.isArray(m.index))for(u=m.index.length;c<u;c++){var z=m.index[c];if(!t[z]){x[z]=j.getColumnData(z);var A=Math.max.apply(Math,x[z]);A>y&&(y=A),v=x[z].length}}else{var B=j.getColumnData(m.index),C=[];for(u=B.length;c<u;c++)for(var D=0,E=B[c].length;D<E;D++)t[D]||(x[D]=x[D]||[],x[D].push(B[c][D]));for(var F in x){var A=Math.max.apply(Math,x[F]);C.push(F),A>y&&(y=A),v=x[F].length}m.fields||(m.fields=C)}for(var G=[],H=0;H<v;H++){G[H]=0;for(var F in x)m.fields&&t[m.index+"."+F]||t[F]||(G[H]+=x[F][H])}var I=Math.max.apply(Math,G);if(s.maxItemValue=y,void 0!==d?(f=d,g=d+1):(f=0,g=j.getLength()),i.infinite){var J=i.getNumOfVisibleCells();g>J&&(g=J)}for(;f<g;f++){var K,B=j.get(f),L={rowIndex:f,data:B,style:{},column:m};K=m.smartIndexFn?m.smartIndexFn(B):j.get(f,n),L.value=K,m.format&&(L.value=h.format(L.value,m.format),K=L.value),m.render&&(L=m.render(L),K=L.value),q.item(f).css(L.style);var M=a.get(r.item(f).dom);if(M.select(".fancy-spark-hbar").length){var N=a.getWidget(M.select(".fancy-spark-hbar").item(0).attr("id"));N.maxValue=I,N.maxItemValue=y,N.update(B)}else a.apply(s,{renderTo:r.item(f).dom,value:K,data:B,column:m,maxValue:I,height:i.cellHeight-1}),new a.spark.HBar(s)}},renderCircle:function(a,c){function d(a,b){var c="http://www.w3.org/2000/svg",d=document.createElementNS(c,"svg:svg");d.setAttribute("width",b),d.setAttribute("height",b),d.setAttribute("viewBox","0 0 "+b+" "+b);var e=document.createElementNS(c,"circle");e.setAttributeNS(null,"cx",b/2),e.setAttributeNS(null,"cy",b/2),e.setAttributeNS(null,"r",b/2);var f="#F0F0F0";b>50&&(f="F0F0F0"),a<0&&(f="#F9DDE0"),e.setAttributeNS(null,"fill",f),d.appendChild(e);var g=document.createElementNS(c,"path"),h=2*Math.PI/100,i=0,j=a*h-.001,k=b/2+b/2*Math.sin(i),l=b/2-b/2*Math.cos(i),m=b/2+b/2*Math.sin(j),n=b/2-b/2*Math.cos(j),o=0;j-i>Math.PI&&(o=1);var p="M "+b/2+","+b/2+" L "+k+","+l+" A "+b/2+","+b/2+" 0 "+o+" 1 "+m+","+n+" Z";g.setAttribute("d",p),a<0?g.setAttribute("fill","#EA7369"):g.setAttribute("fill","#44A4D3"),d.appendChild(g);var q=document.createElementNS(c,"circle");return q.setAttributeNS(null,"cx",b/2),q.setAttributeNS(null,"cy",b/2),q.setAttributeNS(null,"r",.25*b),q.setAttributeNS(null,"fill","#fff"),d.appendChild(q),d}var f,g,h=this,i=h.widget,j=i.store,l=h.getColumns(),m=l[a],n=m.index,o=h.el.select("."+e),p=o.item(a),q=p.select("."+b+" ."+k),s=i.cellHeight-4;if(p.addCls(r),void 0!==c?(f=c,g=c+1):(f=0,g=j.getLength()),i.infinite){var t=i.getNumOfVisibleCells();g>t&&(g=t)}for(;f<g;f++){var u,v=j.get(f),w={rowIndex:f,data:v,style:{}};u=m.smartIndexFn?m.smartIndexFn(v):j.get(f,n),w.value=u,m.render&&(w=m.render(w),u=w.value);var x=q.item(f).dom;""===x.innerHTML&&x.appendChild(d(u,s))}},removeNotUsedCells:function(){for(var a=this,c=a.widget,d=c.store,f=a.el.select("."+e),g=0,h=f.length;g<h;g++)for(var i=f.item(g),j=i.select("."+b),k=d.getLength(),l=j.length;k<l;k++)j.item(k).remove()},getFormat:function(b){var c=this,d=c.widget,e=d.lang;switch(b){case"number":return function(a,b){var c=a.toString().split(e.decimalSeparator);if(b=b||0,c[0]=c[0].replace(/\B(?=(\d{3})+(?!\d))/g,e.thousandSeparator),c[1]){if(b>0){if(c[1].length<b){for(var d="",f=c[1].length;f<b;f++)d+="0";return c[0]+e.decimalSeparator+c[1]+d}return c[1]=String(c[1]).substring(0,b),c[0]+e.decimalSeparator+c[1]}return c[0]}if(b>0&&""!==c[0]){for(var d="",f=0;f<b;f++)d+="0";return c[0]+e.decimalSeparator+d}return c[0]};case"date":return function(c){var d=a.Date.parse(c,e.date.read,b.mode);return c=a.Date.format(d,e.date.write,b.mode)}}switch(b.type){case"date":return function(c){if(!c||0===c.length)return"";if(a.isDate(c))var d=c;else var d=a.Date.parse(c,b.read,b.mode);return c=a.Date.format(d,b.write,void 0,b.mode)}}},format:function(b,c,d){switch(a.typeOf(c)){case"string":b=this.getFormat(c)(b,d);break;case"function":b=c(b);break;case"object":var e=this.getFormat(c);e&&(b=e(b))}return b},enableCellDirty:function(a){a.hasCls(l)||(a.addCls(l),a.append('<div class="'+m+'"></div>'))},clearDirty:function(a){var c=this;if(void 0!==a)return c.el.select("."+b+'[index="'+a+'"] .'+m).destroy(),void c.el.select("."+l+'[index="'+a+'"]').removeCls(l);c.el.select("."+m).destroy(),c.el.select("."+l).removeCls(l)},showEmptyText:function(){var b=this,c=b.widget,d=c.store;if("center"===b.side&&(b.emptyTextEl&&(b.emptyTextEl.destroy(),delete b.emptyTextEl),0===d.dataView.length)){var e=a.get(document.createElement("div"));e.addCls(o),e.update(c.emptyText),b.emptyTextEl=a.get(b.el.dom.appendChild(e.dom))}}}}(),function(){var a=Fancy,b=a.GRID_CELL_CLS,c=a.GRID_CELL_INNER_CLS,d=a.GRID_COLUMN_CLS,e=a.GRID_BODY_CLS,f=a.GRID_CELL_WRAPPER_CLS,g=a.GRID_COLUMN_SELECT_CLS,h=a.GRID_COLUMN_ELLIPSIS_CLS,i=a.GRID_COLUMN_ORDER_CLS,j=a.GRID_COLUMN_TEXT_CLS,k=a.GRID_COLUMN_TREE_CLS,l=a.GRID_COLUMN_SPARKLINE_CLS,m=a.GRID_COLUMN_CHART_CIRCLE_CLS,n=a.GRID_COLUMN_SPARK_PROGRESS_DONUT_CLS,o=a.GRID_COLUMN_GROSSLOSS_CLS,p=a.GRID_COLUMN_PROGRESS_CLS,q=a.GRID_COLUMN_H_BAR_CLS,r=a.GRID_COLUMN_ROW_DRAG_CLS,s=a.GRID_ROW_EXPAND_CLS,t=a.ANIMATE_DURATION,u={sparklineline:l,sparklinebar:l,sparklinetristate:l,sparklinediscrete:l,sparklinebullet:l,sparklinepie:l,sparklinebox:l,circle:m,progressdonut:n,grossloss:o,progressbar:p,hbar:q};a.define("Fancy.grid.Body",{extend:a.Widget,mixins:[a.grid.body.mixin.Updater],cls:e,cellTpl:['<div class="'+c+'">{cellValue}</div>'],cellWrapperTpl:['<div class="'+f+'">','<div class="'+c+'">{cellValue}</div>',"</div>"],constructor:function(){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.addEvents("adddomcolumns"),a.initTpl(),a.render(),a.ons()},initTpl:function(){var b=this;b.cellTpl=new a.Template(b.cellTpl),b.cellWrapperTpl=new a.Template(b.cellWrapperTpl)},ons:function(){var c=this,e=c.widget,f=e.id;e.on("afterrender",c.onAfterRender,c);var g="."+d+'[grid="'+f+'"]',h=g+" div."+b;c.el.on("click",c.onCellClick,c,h),c.el.on("dblclick",c.onCellDblClick,c,h),c.el.on("mouseenter",c.onCellMouseEnter,c,h),c.el.on("mouseleave",c.onCellMouseLeave,c,h),a.isTouch?c.el.on("touchend",c.onCellMouseDown,c,h):c.el.on("mousedown",c.onCellMouseDown,c,h),c.el.on("mouseenter",c.onColumnMouseEnter,c,g),c.el.on("mouseleave",c.onColumnMouseLeave,c,g),c.el.on("contextmenu",c.onContextMenu,c,h),c.el.on("mouseleave",c.onBodyLeave,c)},render:function(){var b,c=this,d=c.widget,f=a.get(document.createElement("div"));f.addCls(e),f.attr("role","presentation"),b=d.el.select(".fancy-grid-"+c.side).dom,c.el=a.get(b.appendChild(f.dom))},onAfterRender:function(){var a=this,b=a.widget,c=b.store;("left"!==a.side||b.leftColumns.length)&&("right"!==a.side||b.rightColumns.length)&&(!b.grouping||b.grouping&&!b.grouping.by?b.state&&b.state.startState&&(b.state.startState.sorters||b.state.startState.filters||void 0!==b.state.startState.page)?a.update("waitstate"):a.update():b.grouping&&"server"===c.proxyType&&a.update(),a.setHeight())},setColumnsPosition:function(b,c){var e=this,f=e.widget,g=e.getColumns(),h=0,i=g.length,j=0,k=e.el.select("."+d+'[grid="'+f.id+'"]');for(b=b||e.scrollLeft||0,j+=b;h<i;h++){var l=g[h],m=k.item(h);c&&!a.nojQuery?m.animate({left:j+"px"},a.ANIMATE_DURATION):m.css({left:j+"px"}),l.hidden||(j+=l.width)}},wheelScroll:function(a){var b=this,c=b.widget,e=(c.store,c.knobOffSet),f=b.el.select("."+d+'[grid="'+c.id+'"]');if(0!==f.length){var g=parseInt(f.item(0).css("top")),h=0,i=f.length,j=c.getBodyHeight(),k=c.getCellsViewHeight(),l=k-j+e,m={oldScroll:parseInt(f.item(0).css("top")),newScroll:parseInt(f.item(0).css("top"))+30*a,deltaScroll:30*a};for(l<0&&(l=0);h<i;h++){var n=f.item(h),o=parseInt(n.css("top"))+30*a;o>0?(o=0,m.newScroll=0):Math.abs(o)>l&&(o=-l-e,m.newScroll=o),o>0&&(o=0),n.css("top",o+"px")}return m.scrolled=g!==parseInt(f.item(0).css("top")),m}},scroll:function(a,b,c){var e=this,f=e.widget,g=f.scroller,h=f.store,i=e.el.select("."+d+'[grid="'+f.id+'"]'),j=0,k=i.length,l={};if(!1!==a&&null!==a&&void 0!==a)if(l.scrollTop=a,f.infinite){if(g.scrollTop!==a){var m=Math.round(a/f.cellHeight);if(h.infiniteScrolledToRow!==m){if(h.infiniteScrolledToRow=m,e.infiniteTimeOut){var n=new Date-e.infiniteTimeOutDate;n<100&&clearInterval(e.infiniteTimeOut)}else e.infiniteTimeOutDate=new Date;e.infiniteTimeOut=setTimeout(function(){f.leftBody.update(),f.body.update(),f.rightBody.update(),clearInterval(e.infiniteTimeOut),delete e.infiniteTimeOut,delete e.infiniteTimeOutDate},1)}}}else for(;j<k;j++){var o=i.item(j);o.css("top",-a+"px")}return!1!==b&&null!==b&&void 0!==b&&(l.scrollLeft=b,f.header&&f.header.scroll(b,c),e.scrollLeft=b,f.body.setColumnsPosition(b,c),"center"===e.side&&(f.grouping&&f.grouping.by&&f.grouping.scrollLeft(b),f.summary&&f.summary.scrollLeft(b),f.subHeaderFilter&&f.filter.scrollLeft(b))),l},setHeight:function(){var a=this,b=a.widget.getBodyHeight();a.css("height",b+"px")},onCellClick:function(a){var b=this,c=b.widget;c.fire("cellclick",b.getEventParams(a)),c.fire("rowclick",b.getEventParams(a)),c.fire("columnclick",b.getColumnEventParams(a)),!1===c.activated&&(c.activated=!0,c.fire("activate"))},onCellDblClick:function(a){var b=this,c=b.widget;c.fire("celldblclick",b.getEventParams(a)),c.fire("rowdblclick",b.getEventParams(a)),c.fire("columndblclick",b.getColumnEventParams(a))},getEventParams:function(b){var c=this,d=c.widget,e=d.store,f=c.getColumns(),g=b.currentTarget,h=a.get(b.currentTarget),i=h.parent();if(void 0===h.parent().dom)return!1;if(0===e.getLength())return!1;if(void 0===i.attr("index"))return!1;var j=e.infiniteScrolledToRow||0,k=parseInt(i.attr("index")),l=parseInt(h.attr("index")),m=f[k],n=m.index,o=e.get(l+j,n),p=e.getId(l+j),q=e.get(l+j),r=e.getById(p);return m.smartIndexFn&&(o=m.smartIndexFn(q)),{e:b,id:p,side:c.side,cell:g,column:m,rowIndex:l,infiniteRowIndex:l+j,columnIndex:k,value:o,data:q,item:r}},getColumnEventParams:function(b){var c=this,d=c.widget,e=d.store,f=a.get(b.currentTarget),g=f.parent(),h=parseInt(g.attr("index")),i=c.getColumns(),j=i[h],k={e:b,side:c.side,columnIndex:h,column:j,columnDom:g.dom,cell:f.dom};return d.columnClickData&&(k.data=e.getColumnData(j.index,j.smartIndexFn)),k},getColumnHoverEventParams:function(c){var d=this,e=a.get(c.currentTarget),f=parseInt(e.attr("index")),g=d.getColumns(),h=g[f],i=c.target;return a.get(i).hasCls(b)||(i=a.get(i).parent("."+b).dom),{e:c,side:d.side,columnIndex:f,column:h,columnDom:e.dom,cell:i}},getColumns:function(){return this.widget.getColumns(this.side)},onCellMouseEnter:function(b){var c=this,d=c.widget,e=c.getEventParams(b),f=c.prevCellOver;a.nojQuery&&f&&c.fixZeptoBug&&(e.rowIndex===f.rowIndex&&e.columnIndex===f.columnIndex&&e.side===f.side||(d.fire("cellleave",f),e.rowIndex!==f.rowIndex&&d.fire("rowleave",f))),f?e.rowIndex!==c.prevCellOver.rowIndex&&d.fire("rowenter",e):d.fire("rowenter",e),d.fire("cellenter",e),c.prevCellOver=e},onCellMouseDown:function(b){var c=this,d=c.widget,e=c.getEventParams(b),f={e:e.e,side:e.side,columnDom:a.get(e.cell).parent().dom,column:e.column,columnIndex:e.columnIndex,cell:e.cell};2===b.button&&2===b.buttons||3===b.which||(d.fire("beforecellmousedown",e),d.fire("cellmousedown",e),d.fire("columnmousedown",f),!1===d.activated&&(d.activated=!0,d.fire("activate")))},onCellMouseLeave:function(b){var c=this,d=c.widget,e=c.getEventParams(b),f=c.prevCellOver;if(a.nojQuery){if(void 0===f)return;return void(c.fixZeptoBug=e)}d.fire("rowleave",f),d.fire("cellleave",f),delete c.prevCellOver},onColumnMouseEnter:function(a){var b=this,c=b.widget,d=b.getColumnHoverEventParams(a);b.prevColumnOver?b.prevCellOver&&d.rowIndex!==b.prevCellOver.rowIndex&&c.fire("rowenter",d):c.fire("columnenter",d),b.prevColumnOver=d},onColumnMouseLeave:function(){var a=this;a.widget.fire("columnleave",a.prevColumnOver),delete a.prevColumnOver},getCell:function(a,c){var e=this,f=e.widget;return this.el.select("."+d+'[index="'+c+'"][grid="'+f.id+'"] .'+b+'[index="'+a+'"]')},getDomCell:function(a,c){var e=this,f=e.widget;return e.el.select("."+d+'[index="'+c+'"][grid="'+f.id+'"] .'+b+'[index="'+a+'"]').dom},getDomColumn:function(a){var b=this,c=b.widget;return b.el.select("."+d+'[index="'+a+'"][grid="'+c.id+'"]').dom},destroy:function(){var c=this,e=c.el,f="div."+b,g="div."+d;e.un("click",c.onCellClick,c,f),e.un("dblclick",c.onCellDblClick,c,f),e.un("mouseenter",c.onCellMouseEnter,c,f),e.un("mouseleave",c.onCellMouseLeave,c,f),a.isTouch?e.un("touchend",c.onCellMouseDown,c,f):e.un("mousedown",c.onCellMouseDown,c,f),e.un("mouseenter",c.onColumnMouseEnter,c,g),e.un("mouseleave",c.onColumnMouseLeave,c,g)},hideColumn:function(a){var b=this,c=b.widget,e=b.getColumns(),f=b.el.select("."+d),g=f.item(a),h=0,i=e.length,j=0,k=0;for("center"===b.side&&(k=c.scroller.scrollLeft,j-=k),g.hide();h<i;h++){g=f.item(h);var l=e[h],m=parseInt(g.css("left"));l.hidden||(m!==j&&(g.stop(),g.animate({left:j},t)),j+=l.width)}},showColumn:function(b,c){var e=this,f=e.widget,g=e.getColumns(),h=e.el.select("."+d),i=h.item(b),j=0,k=0,l=g.length,m=0;for("center"===e.side&&(m=f.scroller.scrollLeft,j-=m),a.isNumber(c)&&i.css("width",c+"px"),i.show();k<l;k++){i=h.item(k);var n=(parseInt(i.css("left")),g[k]);n.hidden||(i.stop(),i.animate({left:j},t),j+=n.width)}},removeColumn:function(a){var b=this,c=b.el.select("."+d),e=c.item(a),f=parseInt(e.css("width")),g=a+1,h=c.length;for(e.destroy();g<h;g++){var i=c.item(g),j=parseInt(i.css("left"))-f;i.attr("index",g-1),i.css("left",j)}},insertColumn:function(b,c){var e,f=this,l=f.widget,m=f.getColumns(),n=f.el.select("."+d),o=c.width,p=a.get(document.createElement("div")),q=b,s=n.length,t=0,u=0,v=b;for("center"===f.side&&(t=-l.scroller.scrollLeft);u<v;u++)m[u].hidden||(t+=m[u].width);for(e=t;q<s;q++)if(!m[q].hidden){var w=n.item(q);t=parseInt(w.css("left"))+c.width,w.css("left",t),w.attr("index",q+1)}if(p.attr("role","presentation"),p.addCls(d),p.attr("grid",l.id),"$selected"===c.index||c.select)p.addCls(g);else switch(c.type){case"order":p.addCls(i);break;case"rowdrag":p.addCls(r)}if(c.cls&&p.addCls(c.cls),"tree"===c.type&&(p.addCls(k),c.folder&&p.addCls("fancy-grid-tree-column-folder")),"text"===c.type&&p.addCls(j),p.css({width:o+"px"}),p.attr("index",b),c.cellAlign&&p.css("text-align",c.cellAlign),!0===c.ellipsis)switch(c.type){case"string":case"text":case"number":case"date":case"combo":case"tree":p.addCls(h)}var x=l.scroller.getScroll();p.css("top",-x),0===b&&n.length?(p.css("left","0px"),f.el.dom.insertBefore(p.dom,n.item(b).dom)):0!==b&&n.length?b===n.length?(p.css("left",t+"px"),f.el.dom.appendChild(p.dom)):(p.css("left",e+"px"),f.el.dom.insertBefore(p.dom,n.item(b).dom)):(p.css("left",t+"px"),f.el.dom.appendChild(p.dom)),f.checkDomCells(),f.updateRows(void 0,b)},reSetIndexes:function(){this.el.select("."+d).each(function(a,b){a.attr("index",b)})},clearColumnsStyles:function(){this.el.select("div."+b).each(function(a){a.css("color",""),a.css("background-color","")})},updateColumnsSizes:function(){var b=this,c=b.widget,e=b.getColumns(),f=0;"center"===b.side&&(f=-c.scroller.scrollLeft),a.each(e,function(a,c){if(!a.hidden){var e=b.el.select("."+d+'[index="'+c+'"]');Fancy.nojQuery?e.css({width:a.width,left:f}):(e.$dom.stop(),e.animate({width:a.width,left:f},t,void 0,function(){e.css("overflow","")})),f+=a.width}})},reSetColumnsAlign:function(){var a=this,b=a.getColumns();this.el.select("."+d).each(function(a,c){var d=b[c];a.css("text-align",d.cellAlign||"")})},reSetColumnsCls:function(){var b=this,c=b.getColumns();b.el.select("."+d).each(function(b,e){var f=c[e],j=b.attr("class").split(" ");if(a.each(j,function(a){switch(a){case d:case f.cls:case u[f.type]:break;default:b.removeCls(a)}}),f.cls&&b.addCls(f.cls),f.ellipsis)switch(f.type){case"checkbox":break;default:b.addCls(h)}switch(f.type){case"order":b.addCls(i);break;case"select":b.addCls(g);break;case"rowdrag":b.addCls(r);break;case"tree":b.addCls(k),f.folder&&b.addCls("fancy-grid-tree-column-folder")}f.select&&b.addCls(g),f.rowdrag&&b.addCls(r)})},onContextMenu:function(a){var b=this;b.widget.fire("contextmenu",b.getEventParams(a))},updateColumnsVisibility:function(){var a=this,b=a.getColumns();a.el.parent().select(":not(."+s+") ."+d).each(function(a,c){b[c].hidden?a.hide():"none"===a.css("display")&&a.show()})},onBodyLeave:function(){delete this.prevCellOver}})}(),function(){var a=Fancy,b=a.GRID_HEADER_CLS,c=a.GRID_HEADER_CELL_CLS,d=a.GRID_HEADER_CELL_CONTAINER_CLS,e=a.GRID_HEADER_CELL_TEXT_CLS,f=a.GRID_HEADER_CELL_LEFT_IMAGE_CLS,g=a.GRID_HEADER_CELL_CONTAINS_LI,h=a.GRID_HEADER_CELL_TRIGGER_CLS,i=a.GRID_HEADER_CELL_TRIGGER_IMAGE_CLS,j=a.GRID_HEADER_CELL_TRIGGER_DISABLED_CLS,k=a.GRID_HEADER_CELL_GROUP_LEVEL_1_CLS,l=a.GRID_HEADER_CELL_GROUP_LEVEL_2_CLS,m=a.GRID_HEADER_CELL_SELECT_CLS,n=a.GRID_HEADER_CELL_FILTER_FULL_CLS,o=a.GRID_HEADER_CELL_FILTER_SMALL_CLS,p=a.GRID_HEADER_CELL_TRIPLE_CLS,q=a.GRID_HEADER_CELL_CHECKBOX_CLS,r=a.GRID_HEADER_CELL_SORTABLE_CLS,s=a.GRID_HEADER_CELL_NOT_SORTABLE_CLS,t=a.FIELD_CHECKBOX_CLS,u=a.ANIMATE_DURATION;a.define("Fancy.grid.Header",{extend:a.Widget,cls:b,mixins:["Fancy.grid.header.mixin.Menu"],cellTpl:['<div role="columnheader" col-id="{id}" class="'+c+' {cls}" style="display:{display};width:{columnWidth}px;height: {height};left: {left};" {groupIndex} index="{index}">','<div class="'+d+'" style="height: {height};">','<span class="'+f+' {headerLImageCls}">&nbsp;</span>','<span class="'+e+'">{columnName}</span>','<span class="'+h+'">','<div class="'+i+'"></div>',"</span>","</div>","</div>"],constructor:function(){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.initTpl(),a.render(),a.renderHeaderCheckBox(),a.setAlign(),a.setCellsPosition(),a.ons()},initTpl:function(){this.cellTpl=new a.Template(this.cellTpl)},ons:function(){var a=this,b=a.widget,d=a.el,f="div."+c;b.on("render",a.onAfterRender,a),b.on("docmove",a.onDocMove,a),b.on("columndrag",a.onColumnDrag,a),d.on("click",a.onTriggerClick,a,"span."+h),d.on("click",a.onCellClick,a,f),d.on("mousemove",a.onCellMouseMove,a,f),d.on("mousedown",a.onCellMouseDown,a,f),d.on("mousedown",a.onMouseDown,a),d.on("dblclick",a.onCellTextDBLClick,a,"."+e),d.on("mouseenter",a.onCellMouseEnter,a,f),d.on("mouseleave",a.onCellMouseLeave,a,f)},render:function(){var b,c=this,d=c.widget,e=c.getColumns(),f=a.get(document.createElement("div")),h="",i=0,l=e.length,p=1,q={},t=0,u=d.filter&&d.filter.header&&!d.subHeaderFilter,v="full",w=d.cellHeaderHeight;for(d.groupheader&&(u&&!d.filter.groupHeader?v="small":p=2),u&&p++;i<l;i++){var x=e[i],y=x.title||x.header,z=w,A="",B="";if(void 0!==y&&""!==y&&" "!==y||(y="&nbsp;"),1!==p)if(x.grouping){if(!q[x.grouping]){var C=d.groupheader.groupsMap[x.grouping];q[x.grouping]={width:0,title:x.grouping,left:t,cls:C.headerCls||""}}z=u&&d.filter.groupHeader?2*w+"px":w+"px",x.hidden||(q[x.grouping].width+=x.width),B='group-index="'+x.grouping+'"',A=k}else z=p*w+"px";if(t+=x.width,("$selected"===x.index||x.select)&&(A+=" "+m),x.menu||(A+=" "+j),x.filter&&x.filter.header)switch(v){case"small":A+=" "+o;break;case"full":d.subHeaderFilter||(A+=" "+n)}x.headerLImageCls&&(A+=" "+g),x.headerCls&&(A+=" "+x.headerCls),x.sortable?A+=" "+r:A+=" "+s,a.isNumber(z)&&(z+="px");var D={cls:A,columnName:y,columnWidth:x.width,index:i,height:z,left:"initial",groupIndex:B,display:x.hidden?"none":"",id:x.id||"",headerLImageCls:x.headerLImageCls||""};h+=c.cellTpl.getHTML(D)}f.css({height:w*p+"px",width:c.getColumnsWidth()}),f.attr("role","presentation"),f.addCls(c.cls),d.groupheader&&(f.addCls("fancy-grid-header-grouped"),h+=c.getGroupingCellsHTML(q)),f.update(h),b=d.el.select(".fancy-grid-"+c.side).dom,c.el=a.get(b.appendChild(f.dom))},insertCell:function(b,c){var d,e=this,f=e.widget,g=e.getCells(),h=e.getColumns(),i="",k=c.title||c.header,n="",o=0;if(g.length&&(d=parseInt(g.item(0).css("height"))),d=parseInt(f.header.el.css("height")),"center"===e.side&&(o=-f.scroller.scrollLeft),f.groupheader){var p=e.el.select("."+l);b!==f.columns.length-1&&p.each(function(a){var b=parseInt(a.css("left")||0)+c.width;a.css("left",b)})}("$selected"===c.index||c.select)&&(i+=" "+m),c.menu||(i+=" "+j);for(var q=0,t=b;q<t;q++)h[q].hidden||(o+=h[q].width);"center"===e.side&&(o+=f.scroller.scrollLeft||0),c.headerCls&&(i+=" "+c.headerCls),c.sortable?i+=" "+r:i+=" "+s;var u=e.cellTpl.getHTML({cls:i,columnName:k,columnWidth:c.width,index:b,height:String(d)+"px",left:String(o)+"px",groupIndex:n,id:c.id||""});0===b&&g.length?a.get(g.item(0).before(u)):0!==b&&g.length?b===g.length?e.el.append(u):a.get(g.item(b).before(u)):e.el.append(u);var v=0,w=h.length,x=0;for(o=0,"center"===e.side&&(o-=f.scroller.scrollLeft),g=e.getCells();v<w;v++){var c=h[v];if(!c.hidden){g.item(v).css("left",o),o+=c.width,x+=c.width}}var y=parseInt(e.css("width"));y>x&&(x=y),e.css("width",x),c.filter&&c.filter.header,e.reSetColumnsAlign()},setAlign:function(){for(var a=this,b=a.getColumns(),c=0,d=b.length;c<d;c++){var e=b[c];e.align&&a.getDomCell(c).css("text-align",e.align)}},onAfterRender:function(){},setCellsPosition:function(b){var c=this,d=c.widget,e=c.getColumns(),f=0,g=c.getCells();if(f+=c.scrollLeft||0,a.each(e,function(a,b){var c=g.item(b),e="0px";a.grouping&&(e=d.cellHeaderHeight+"px"),c.css({top:e,left:f+"px"}),a.hidden||(f+=a.width)}),d.groupheader){c.el.select("."+l).each(function(d){var f=d.attr("index"),g=(c.el.select('[group-index="'+f+'"]'),c.scrollLeft||0),h=0;a.each(e,function(a){if(a.grouping===f)return!0;a.hidden||(g+=a.width)}),a.each(e,function(a){a.grouping!==f||a.hidden||(h+=a.width)}),b&&!a.nojQuery?(d.css({left:g,width:h}),0===h&&d.css({display:"none"})):d.css({left:g,width:h})})}},fixGroupHeaderSizing:function(){var b=this,c=b.widget,d=c.cellHeaderHeight,e=b.getColumns(),f=b.getCells(),g=0,h={},i={},j={},m=b.calcRows(),p=c.filter&&c.filter.header,q=!1;"center"===b.side&&(g=c.scroller.scrollLeft),p&&a.each(e,function(a,b){a.grouping&&a.filter&&a.filter.header&&(q=!0)}),a.each(e,function(a,b){var e=f.item(b),l=a.grouping,p="0px",r=d*m;h[l]=!0,l?(void 0===i[l]?(i[l]=a.width,j[l]=g):i[l]+=a.width,e.addCls(k),p=d+"px",r=d,q&&(r=2*d),a.filter&&a.filter.header&&!c.subHeaderFilter&&setTimeout(function(){e.addCls(n)},30)):(e.removeCls(k),a.filter&&a.filter.header&&(setTimeout(function(){e.addCls(o)},30),e.addCls(o))),!c.groupheader||r!==d||l||a.filter||(r=2*d),e.css({top:p,height:r}),g+=a.width});for(var r in i){b.el.select('[index="'+r+'"]').css({left:j[r],width:i[r]})}b.el.select("."+l).each(function(a){var b=a.attr("index");h[b]||a.destroy()})},getColumnsWidth:function(){for(var a=this,b=a.getColumns(),c=0,d=0,e=b.length;d<e;d++){c+=b[d].width}return c},getColumns:function(){var a,b=this,c=b.widget;switch(b.side){case"left":a=c.leftColumns;break;case"center":a=c.columns;break;case"right":a=c.rightColumns}return a},getDomCell:function(a){return this.getCells().item(a)},onCellClick:function(b){var c=this,d=c.widget,e=d.columndrag,f=b.currentTarget,g=a.get(b.target),j=parseInt(a.get(f).attr("index")),k=c.getColumns(),m=k[j];e&&"dragging"===e.status||g.hasCls(h)||g.hasCls(i)||a.get(f).hasCls(l)||c.textDBLClick||(m.titleEditable?setTimeout(function(){c.textDBLClick?setTimeout(function(){delete c.textDBLClick},400):d.fire("headercellclick",{e:b,side:c.side,cell:f,index:j,column:m})},300):d.fire("headercellclick",{e:b,side:c.side,cell:f,index:j,column:m}))},onCellMouseMove:function(b){var c=this,d=c.widget,e=b.currentTarget,f=a.get(e),g=f.hasCls(l),h=parseInt(a.get(e).attr("index"));g||d.fire("headercellmousemove",{e:b,side:c.side,cell:e,index:h})},onMouseDown:function(b){"INPUT"===a.get(b.target).prop("tagName")||b.preventDefault()},onCellMouseDown:function(b){var c=this.widget,d=b.currentTarget,e=parseInt(a.get(d).attr("index"));c.fire("headercellmousedown",{e:b,side:this.side,cell:d,index:e})},scroll:function(a,b){this.scrollLeft=a,this.setCellsPosition(b)},getGroupingCellsHTML:function(b){var c=this,d=c.widget,e="";return a.each(b,function(a,b){e+=c.cellTpl.getHTML({cls:l+" "+a.cls,columnName:a.title,columnWidth:a.width,index:b,height:d.cellHeaderHeight+"px",left:a.left+"px",groupIndex:"",id:a.id||""})}),e},destroy:function(){var a=this,b=a.el,d="div."+c;b.un("click",a.onCellClick,a,d),b.un("mousemove",a.onCellMouseMove,a,d),b.un("mousedown",a.onCellMouseDown,a,d),b.un("mousedown",a.onMouseDown,a),b.un("mouseenter",a.onCellMouseEnter,a,d),b.un("mouseleave",a.onCellMouseLeave,a,d)},getCell:function(a){return this.el.select("."+c+'[index="'+a+'"]')},onTriggerClick:function(b){var c=this,d=a.get(b.currentTarget),e=d.parent().parent(),f=parseInt(e.attr("index")),g=c.getColumns(),h=g[f];b.stopPropagation(),c.showMenu(e,f,h,g)},hideCell:function(b){var c=this,d=c.widget,e=c.getCells(),f=e.item(b),g=parseInt(f.css("width")),h=0,i=e.length,j=c.getColumns();if(f.hasCls(k)){var m=f.attr("group-index"),n=c.el.select("."+l+'[index="'+m+'"]').item(0),o=parseInt(n.css("width"));n.stop(),o-g==0?n.css({display:"none",width:o-g}):n.animate({width:o-g},u)}f.hide();var p={},q=0,r=0;for("center"===c.side&&(r=d.scroller.scrollLeft,q-=r);h<i;h++){var s=e.item(h),t=parseInt(s.css("left")),v=j[h];v.hidden||(v.grouping&&j[b].grouping!==v.grouping&&(p[v.grouping]=!0),t!==q&&(s.stop(),s.animate({left:q},u)),q+=v.width)}a.each(p,function(b,e){var f=c.el.select("."+l+'[index="'+e+'"]').item(0),g=0;"center"===c.side&&(r=d.scroller.scrollLeft,g-=r),a.each(j,function(a){if(!a.hidden)return a.grouping===e||void(g+=a.width)}),f.stop(),f.animate({left:g},u)})},showCell:function(b,c){var d,e=this,f=e.widget,g=e.getCells(),h=g.item(b),i=0,j=0,m=g.length,n=e.getColumns();if(a.isNumber(c)&&h.css("width",c+"px"),h.show(),d=parseInt(h.css("width")),h.hasCls(k)){var o=h.attr("group-index"),p=e.el.select("."+l+'[index="'+o+'"]').item(0),q=parseInt(p.css("width"));p.stop(),"none"===p.css("display")&&p.show(),p.animate({width:q+d},u)}var r=0;"center"===e.side&&(r=f.scroller.scrollLeft,i-=r);for(var s={};j<m;j++){var t=g.item(j),v=(parseInt(t.css("left")),n[j]);v.hidden||(v.grouping&&n[b].grouping!==v.grouping&&(s[v.grouping]=!0),t.stop(),t.animate({left:i},u),i+=v.width)}a.each(s,function(b,c){var d=e.el.select("."+l+'[index="'+c+'"]').item(0),g=0;"center"===e.side&&(r=f.scroller.scrollLeft,g-=r),a.each(n,function(a){if(!a.hidden)return a.grouping===c||void(g+=a.width)}),d.stop(),d.animate({left:g},u)})},removeCell:function(a){var b=this,c=b.getCells(),d=c.item(a),e=parseInt(d.css("width")),f=a+1,g=c.length,h={},i=!1;for(d.attr("group-index")&&(i=d.attr("group-index"),h[i]=!0),d.destroy();f<g;f++){var j=c.item(f),k=parseInt(j.css("left"))-e;j.attr("group-index")&&(h[j.attr("group-index")]=!0),j.attr("index",f-1),j.css("left",k)}for(var l in h){var m=b.el.select('[index="'+l+'"]'),n=parseInt(m.css("width"))-e,o=parseInt(m.css("left"))-e;i&&m?(m.css("width",n),m.attr("index")!==i&&m.css("left",o)):m.css("left",o)}i&&0===b.el.select('[group-index="'+i+'"]').length&&(m=b.el.select('[index="'+i+'"]'),m.destroy()),"center"!==b.side&&b.css("width",parseInt(b.css("width"))-e)},renderHeaderCheckBox:function(){for(var b=this,c=b.widget,d=b.getColumns(),f=0,g=d.length,h=b.getCells();f<g;f++){var i=d[f];if(a.isObject(i.headerCheckBox)){var j=i.headerCheckBox.el,k=j.attr("id");j=a.get(k),j.dom||(i.headerCheckBox=!0)}if(!0===i.headerCheckBox&&"select"!==i.type){var l=h.item(f),n=l.firstChild(),o=l.select("."+e),p=!!i.title&&i.title,r=0;switch(i.type){case"checkbox":case"switcher":l.addCls(q);break;case"select":l.addCls(m)}o.update(""),p.length&&(r=15*p.width),i.headerCheckBox=new a.CheckBox({renderTo:n.dom,renderId:!0,labelWidth:r,value:!1,label:!1,labelAlign:"right",style:{padding:"0px",display:"inline-block"},events:[{change:function(a,b){for(var d=0,e=c.getViewTotal();d<e;d++)c.set(d,i.index,b)}}]})}}},reSetIndexes:function(){var a=this,b=this.getCells(),c=a.getColumns();b.each(function(a,b){a.attr("index",b);var d=c[b];a.attr("col-id",d.id)})},reSetGroupIndexes:function(){var a=this,b=a.getColumns();a.getCells().each(function(a,c){var d=b[c],e=d.grouping;a.attr("group-index")&&!e?a.removeAttr("group-index"):e&&a.attr("group-index")!==e&&a.attr("group-index",e)})},updateTitles:function(){var b=this,d=b.getColumns();a.each(d,function(a,d){a.headerCheckBox||b.el.select("div."+c+'[index="'+d+'"] .'+e).update(a.title||"")})},updateCellsSizes:function(){var b=this,d=b.widget,e=b.getColumns(),f=0;"center"===b.side&&(f=d.nativeScroller?-d.body.el.dom.scrollLeft:-d.scroller.scrollLeft),a.each(e,function(a,d){if(!a.hidden){var e=b.el.select("div."+c+'[index="'+d+'"]'),g=parseInt(e.css("left")),h=parseInt(e.css("width"));if(g===f&&h===a.width)return void(f+=a.width);Fancy.nojQuery?e.css({width:a.width,left:f}):e.animate({width:a.width,left:f},u),f+=a.width}})},calcRows:function(){var a=this,b=a.widget,c=b.columns.concat(b.leftColumns).concat(b.rightColumns),d=1;if(Fancy.each(c,function(a){a.grouping&&(d<2&&(d=2),a.filter&&a.filter.header&&d<3&&(d=3)),a.filter&&a.filter.header&&d<2&&(d=2)}),b.groupheader&&2===d){b.el.select("."+p).length&&(d=3)}return d},reSetColumnsAlign:function(){var a=this,b=a.getColumns();a.getCells().each(function(a,c){var d=b[c];a.css("text-align",d.align||"")})},destroyMenus:function(){},onDocMove:function(){var a=this,b=a.widget;("none"===b.el.css("display")||b.panel&&b.panel.el&&"none"===b.panel.el.css("display")&&a.hideMenu)&&a.hideMenu()},reSetColumnsCls:function(){var b=this,c=b.getColumns(),d=b.getCells(),e=[];a.each(c,function(a){a.headerCls&&e.push(a.headerCls),a.sortable?e.push(r):e.push(s)}),d.each(function(b,d){var f=c[d];a.each(e,function(a){b.removeCls(a)}),f.headerCls&&b.addCls(f.headerCls),f.sortable?b.addCls(r):b.addCls(s),f.menu?b.removeCls(j):b.addCls(j)})},updateCellsVisibility:function(){var a=this,b=a.getColumns();a.getCells().each(function(a,c){b[c].hidden?a.hide():"none"===a.css("display")&&a.show()})},reSetCheckBoxes:function(){var b=this,c=b.getColumns(),d=b.getCells();a.each(c,function(b,c){var e=d.item(c),f=e.select("."+t);if(f.length){if("select"===b.type||b.select)return;var g=a.getWidget(f.item(0).attr("id"));switch(e.removeCls(q),e.removeCls(m),b.type){case"select":e.addCls(m);break;case"checkbox":e.addCls(q);break;default:b.headerCheckBox||g.destroy()}}}),b.renderHeaderCheckBox()},onCellTextDBLClick:function(a){var b=this,c=b.widget,d=Fancy.get(a.target),e=d.parent().parent(),f=e.attr("index"),g=b.getColumns(),h=g[f],i=h.title;h.titleEditable&&(b.textDBLClick=!0,b.activeEditColumnField&&(b.activeEditColumnField.destroy(),delete b.activeEditColumnField),b.activeEditColumnField=new Fancy.StringField({renderTo:b.el.dom,label:!1,theme:c.theme,padding:"0px 0px 0px",width:h.width+1,value:h.title||"",inputHeight:c.cellHeaderHeight+1,events:[{enter:function(a){a.destroy()}},{esc:function(a){c.setColumnTitle(h.index,i,b.side),a.destroy(),delete b.activeEditColumnField}},{input:function(a,d){c.setColumnTitle(h.index,d,b.side),delete b.activeEditColumnField}},{render:function(a){a.focus(),delete b.activeEditColumnField}}],style:{position:"absolute",top:-1,left:parseInt(e.css("left"))-1}}),c.once("scroll",function(){b.activeEditColumnField&&(b.activeEditColumnField.destroy(),delete b.activeEditColumnField)}))},onCellMouseEnter:function(b){var c=this,d=c.widget,e=c.getEventParams(b),f=c.prevCellOver;if(a.nojQuery&&f&&c.fixZeptoBug){if(e.columnIndex===f.columnIndex&&e.side===f.side)return;d.fire("headercellleave",f)}d.fire("headercellenter",e),c.prevCellOver=e},onCellMouseLeave:function(b){var c=this,d=c.widget,e=c.getEventParams(b),f=c.prevCellOver;if(b.toElement&&c.el.within(b.toElement)||(d.fire("headercellleave",f),delete c.prevCellOver),a.nojQuery){if(void 0===f)return;return void(c.fixZeptoBug=e)}d.fire("headercellleave",f),delete c.prevCellOver},getEventParams:function(b){var c=this,d=c.widget,e=d.store,f=c.getColumns(),g=b.currentTarget,h=a.get(b.currentTarget);if(void 0===h.parent().dom)return!1;if(0===e.getLength())return!1;if(void 0===h.attr("index"))return!1;var i=parseInt(h.attr("index")),j=f[i];return{e:b,side:c.side,cell:g,column:j,columnIndex:i}},updateLImages:function(){var b=this,c=b.getCells(),d=b.getColumns();c.each(function(b){var c=b.attr("index"),e=d[c],h=e.headerLImageCls,i=b.select("."+f),j=i.getCls();a.each(j,function(a){a!==f&&(h&&a===e.headerLImageCls||i.removeCls(a))}),h?(i.addCls(h),b.addCls(g)):b.removeCls(g)})},getCells:function(){return this.el.select("."+c+":not(."+l+")")},onColumnDrag:function(){this.reSetIndexes()}})}();