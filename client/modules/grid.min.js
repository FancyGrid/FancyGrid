Fancy.Mixin("Fancy.grid.mixin.PrepareConfig",{prepareConfig:function(a,b){var c=this;return a._plugins=a._plugins||[],a.renderOuter&&(a.renderTo=a.renderOuter),a=c.generateColumnsFromData(a,b),a=c.copyColumns(a,b),a=c.prepareConfigScroll(a,b),a=c.prepareConfigData(a,b),a=c.prepareConfigTheme(a,b),a=c.prepareConfigLang(a,b),a=c.prepareConfigSpark(a,b),a=c.prepareConfigPaging(a,b),a=c.prepareConfigTBar(a),a=c.prepareConfigExpander(a),a=c.prepareConfigColumnMinMaxWidth(a),a=c.prepareConfigGrouping(a),a=c.prepareConfigGroupHeader(a),a=c.prepareConfigSorting(a),a=c.prepareConfigEdit(a),a=c.prepareConfigSelection(a),a=c.prepareConfigLoadMask(a,b),a=c.prepareConfigDefaults(a),a=c.prepareConfigFilter(a,b),a=c.prepareConfigSearch(a),a=c.prepareConfigSummary(a),a=c.prepareConfigState(a,b),a=c.prepareConfigExporter(a),a=c.prepareConfigSmartIndex(a),a=c.prepareConfigActionColumn(a),a=c.prepareConfigWidgetColumn(a),a=c.prepareConfigChart(a,b),a=c.prepareConfigCellTip(a),a=c.prepareConfigColumnsWidth(a),a=c.prepareConfigSize(a,b),a=c.prepareConfigContextMenu(a,b),a=c.prepareConfigColumns(a),a=c.prepareConfigColumnsResizer(a),a=c.prepareConfigFooter(a),a=c.prepareConfigDD(a)},copyColumns:function(a,b){return a.columns&&(a.columns=Fancy.Array.copy(a.columns,!0)),b.columns&&(b.columns=Fancy.Array.copy(b.columns)),a},generateColumnsFromData:function(a,b){if(!a.columns&&a.data&&a.data.length&&Fancy.isArray(a.data[0])){var c=a.data[0]||a.data[0],d=[],e=[];Fancy.each(c,function(a,b){d.push({index:"autoIndex"+b}),e.push("autoIndex"+b)}),a.columns=d,a.data={items:a.data,fields:e},b.data=a.data}return a},prepareConfigScroll:function(a,b){return Fancy.isIE&&!1!==b.nativeScroller&&(a.nativeScroller=!0),a},prepareConfigSpark:function(a,b){var c=this;return Fancy.each(a.columns,function(b){var d=b.sparkConfig;if(d&&d.legend)switch(d.legend.type){case"tbar":case"bbar":case"buttons":var e=d.legend.type,f=b.index;a[e]=a[e]||[],a[e]=a[e].concat(c._generateLegendBar(d.title,f,d.legend.style,b))}}),a},_generateLegendBar:function(a,b,c,d){for(var e=0,f=a.length,g=[],h=this,i={length:0},j=function(b){var c,d=h;Fancy.each(h.columns,function(a,b){a.index===h.columns[b].index&&(c=b)}),(b.hasCls("fancy-legend-item-disabled")||a.length-1!==i.length)&&(b.toggleCls("fancy-legend-item-disabled"),b.hasCls("fancy-legend-item-disabled")?(i[b.index]=!0,d.disableLegend(c,b.index),i.length++):(d.enableLegend(c,b.index),delete i[b.index],i.length--))};e<f;e++){var k=b[e];Fancy.isString(d.index)&&(k=d.index+"."+e);var l={handler:j,index:k,imageColor:Fancy.COLORS[e],text:a[e]};0===e&&c&&(l.style=c),g.push(l)}return g},prepareConfigData:function(a,b){if(Fancy.isArray(a.data)&&0===a.data.length&&a.columns){var c=[];Fancy.each(a.columns,function(a){a.index&&c.push(a.index||a.key)}),a.data={fields:c,items:[]}}return a},prepareConfigLoadMask:function(a){return a._plugins.push({type:"grid.loadmask"}),a},reConfigStore:function(a){var b=this,c=b.store,d=b.getFieldsFromData(a),e="Fancy.model."+Fancy.id();Fancy.define(e,{extend:Fancy.Model,fields:d}),b.model=e,c.model=e,b.fields=d,c.fields=d,c.setModel()},prepareConfigDefaults:function(a){return a.defaults=a.defaults||{},void 0===a.defaults.type&&(a.defaults.type="string"),Fancy.each(a.defaults,function(b,c){Fancy.each(a.columns,function(b){switch(b.type){case"select":case"order":case"expand":case"rowdrag":return}void 0===b[c]&&(b[c]=a.defaults[c]),"width"===c&&b[c].flex&&delete b[c].width})}),a},prepareConfigColumnMinMaxWidth:function(a){return Fancy.each(a.columns,function(a){void 0===a.width&&!a.flex&&a.minWidth&&(a.width=a.minWidth)}),a},prepareConfigCellTip:function(a){return Fancy.each(a.columns,function(b){if(b.cellTip)return a._plugins.push({type:"grid.celltip"}),!0}),a},prepareConfigDD:function(a){if(a.gridToGrid){var b={type:"grid.dragdrop"};Fancy.apply(b,a.gridToGrid),a._plugins.push(b)}if(a.rowDragDrop){var b={type:"grid.rowdragdrop"};Fancy.apply(b,a.rowDragDrop),a._plugins.push(b)}return a},prepareConfigColumns:function(a){for(var b=a.columns,c=[],d=[],e=0,f=b.length,g=!1,h=!1,i=!1,j=0,k=0,l=0;e<f;e++){var m=b[e];switch(m.draggable&&(g=!0),"tree"===m.type&&(h=!0),"rowdrag"!==m.type||a.rowDragDrop||(a.rowDragDrop=!0),m.headerCheckBox&&(m.sortable=!1),m.autoHeight&&(i=!0),m.type){case"select":this.checkboxRowSelection=!0,this.multiSelect=!0,b[e].index="$selected",b[e].editable=!0,j++;break;case"order":b[e].editable=!1,b[e].sortable=!1,b[e].index="$order",b[e].cellAlign="right",k++;break;case"rowdrag":b[e].editable=!1,b[e].sortable=!1,b[e].resizable=!1,b[e].width=30,b[e].index="$rowdrag",l++;break;case"checkbox":void 0===m.cellAlign&&(m.cellAlign="center");break;case"currency":void 0===m.format&&(m.format="number");break;case"string":case"number":case"text":case"date":case"combo":!1!==m.ellipsis&&(m.ellipsis=!0)}m.locked?(c.push(m),b.splice(e,1),e--,f--):m.rightLocked&&(d.push(m),b.splice(e,1),e--,f--)}if(i&&a._plugins.push({type:"grid.rowheight"}),g&&a._plugins.push({type:"grid.columndrag"}),h){var n={type:"grid.tree"};a.singleExpand&&(n.singleExpand=a.singleExpand),a._plugins.push(n),a.isTreeData=!0}return a.leftColumns=c,a.rightColumns=d,a},prepareConfigColumnsWidth:function(a){var b,c=a.columns,d=a.width,e=(a.gridBorders,a.gridWithoutPanelBorders,a.panelBodyBorders,[]),f=[],g=100,h=50,i=g,j=0,k=!1,l=!1,m=!1,n=Fancy.get(a.renderTo||document.body);if((a.width<1||void 0===a.width)&&"body"!==n.prop("tagName").toLocaleLowerCase()&&(m=n.closest(".tab-pane"))&&m.css({display:"block",visibility:"hidden"}),void 0!==d&&"fit"!==d||(d=Fancy.get(a.renderTo||document.body).width()),d-=2*a.panelBorderWidth,!1!==a.flexScrollSensitive)d-=a.bottomScrollHeight;else{var o=this.theme;Fancy.isString(a.theme)?o=a.theme:Fancy.isObject(a.theme)&&a.theme.name&&(o=a.theme.name),"bootstrap-no-borders"!==o&&(d-=1)}Fancy.each(c,function(b,c){switch(b.flex&&(a.hasFlexColumns=!0),b.type){case"select":void 0===b.width&&(b.width=35);break;case"order":void 0===b.width&&(b.width=40);break;case"rowdrag":void 0===b.width&&(b.width=30);break;case"expand":void 0===b.width&&(b.width=38)}b.locked&&(k=!0),b.rightLocked&&(l=!0),void 0===b.width?(b.flex&&(j+=b.flex,f.push(c)),e.push(c)):Fancy.isNumber(b.width)&&(d-=b.width)}),a.hasFlexColumns&&a._plugins.push({type:"grid.columnresizer"}),k&&l&&(d-=2);var p=parseInt(d/e.length);p<h&&(p=h),p>g&&(i=g),p<h&&(i=h);var q=!1,r=d;if(Fancy.each(e,function(a){b=c[a],void 0===b.flex&&(r-=i)}),j){var s=parseInt(r/j);Fancy.each(f,function(a){r-=s*c[a].flex})}return r<0&&(q=!0),Fancy.each(e,function(a){b=c[a],void 0===b.flex&&(b.width=i,d-=i)}),j&&(Fancy.each(f,function(a){b=c[a],b.width=q?i*b.flex:d/j*b.flex,b.width=parseInt(b.width),b.minWidth&&b.width<b.minWidth&&(b.width=b.minWidth)}),r>=1&&Fancy.each(f,function(a){if(r<1)return!0;b=c[a],b.width+=1,r-=1})),m&&m.css({display:"",visibility:""}),a},prepareConfigActionRender:function(a){return function(b){return Fancy.each(a.items,function(a){var c=a.text||"",d=Fancy.styleToString(a.style),e=a.cls||"";b.value+=['<div class="fancy-grid-column-action-item '+e+'" style="'+d+'">',c,"</div>"].join(" "),a.render&&(b=a.render(b))}),b}},prepareConfigSmartIndex:function(a){return Fancy.each(a.columns,function(a){if(/\+|\-|\/|\*|\[|\./.test(a.index)){var b=a.index;switch(b){case"xAxis.categories":case"yAxis.categories":case"zAxis.categories":return}b=b.replace(/(\w+)/g,function(a,b,c,d){return"."===d[c-1]?b:isNaN(Number(b))?"data."+b:b}),b="return "+b+";",a.smartIndexFn=new Function("data",b)}}),a},prepareConfigActionColumn:function(a){for(var b=this,c=a.columns,d=0,e=c.length;d<e;d++){var f=c[d];if("action"===f.type){f.sortable=!1,f.editable=!1,f.render=b.prepareConfigActionRender(f);var g=f.items;if(void 0!==g&&0!==g.length)for(var h,i=0,j=g.length;i<j;i++)switch(h=g[i],h.action){case"remove":void 0===h.handler&&(h.handler=function(a,b){a.remove(b)});break;case"dialog":!function(a){if(void 0===a.handler){for(var d=[],e=0,f=c.length,g=87;e<f;e++){var h=c[e];switch(h.type){case"action":continue}d.push({label:h.title||"",type:h.type,name:h.index}),g+=38}a.handler=function(c,e){a.dialog?(a.dialog.show(),a.dialog.set(e.data)):a.dialog=new FancyForm({window:!0,draggable:!0,modal:!0,title:{text:"Edit",tools:[{text:"Close",handler:function(){this.hide()}}]},width:300,height:g,items:d,buttons:["side",{text:"Clear",handler:function(){this.clear()}},{text:"Save",handler:function(){var a=this.get();a.id&&(b.getById(a.id).set(a),b.update())}}],events:[{init:function(){this.show(),this.set(e.data)}}]})}}}(h)}}}return a},prepareConfigWidgetColumn:function(a){for(var b=a.columns,c=0,d=b.length;c<d;c++){var e=b[c];e.widget&&(e.render=function(a){var b,c=a.cell.select("."+Fancy.FIELD_CLS),d=a.cell.dom,e=a.column,f={vtype:e.vtype,style:{padding:"0px","margin-top":"-10px","margin-left":"-1px"},label:!1,renderTo:d,value:a.value,emptyText:e.emptyText};if(c.length)b=Fancy.getWidget(c.dom.id),b.get()!=a.value&&b.set(a.value);else{var g=a.column.width,e=a.column,h=e.index;switch(a.column.type){case"number":case"currency":Fancy.apply(f,{spin:e.spin,min:e.min,max:e.max,events:[{change:function(b,c){grid.set(a.rowIndex,h,c),grid.updater.updateRow()}}]}),b=new Fancy.NumberField(f);break;case"string":case"image":Fancy.apply(f,{events:[{change:function(b,c){grid.set(a.rowIndex,h,c),grid.updater.updateRow()}}]}),b=new Fancy.StringField(f);break;case"combo":Fancy.apply(f,{displayKey:a.column.displayKey,valueKey:a.column.displayKey,padding:!1,checkValidOnTyping:!0,data:a.column.data,events:[{change:function(b,c){grid.set(a.rowIndex,h,c),grid.updater.updateRow()}}]}),b=new Fancy.Combo(f)}switch(a.column.type){case"number":case"string":case"currency":case"image":b.setInputSize({width:g+1,height:33});break;case"combo":b.size({width:g+1,height:33})}}return a})}return a},prepareConfigSorting:function(a){return(a.defaults||{}).sortable?(a._plugins.push({type:"grid.sorter"}),a):(Fancy.each(a.columns,function(b){b.sortable&&a._plugins.push({type:"grid.sorter"})}),a)},prepareConfigSelection:function(a){var b=!1,c={type:"grid.selection"},d=!1;if((a.trackOver||a.columnTrackOver||a.cellTrackOver)&&(b=!0),a.selModel){b=!0;var e=!1,f=!1,g=!0,h=!1,i=!0,j=!1,k=!0;if(Fancy.isObject(a.selModel)){if(e=!!a.selModel.checkOnly,!a.selModel.type)throw new Error("FancyGrid Error 5: Type for selection is not set");void 0!==a.selModel.mouseMoveSelection&&(k=a.selModel.mouseMoveSelection),void 0!==a.selModel.memoryPerfomance&&(g=a.selModel.memoryPerfomance),f=!0===a.selModel.memory,a.selModel.disabled&&(d=!0),a.selModel.selectLeafsOnly&&(h=!0),void 0!==a.selModel.allowDeselect&&(j=!0),void 0!==a.selModel.keyNavigation&&(i=a.selModel.keyNavigation),a.selModel=a.selModel.type}"rows"===a.selModel&&(a.multiSelect=!0),a.selection=a.selection||{},a.selection.selModel=a.selModel,a.selection[a.selModel]=!0,a.selection.checkOnly=e,a.selection.memory=f,a.selection.memoryPerformance=g,a.selection.disabled=d,a.selection.selectLeafsOnly=h,a.selection.keyNavigation=i,a.selection.allowDeselect=j,a.selection.mouseMoveSelection=k}return a.selection&&(b=!0,Fancy.isObject(a.selection)&&Fancy.apply(c,a.selection)),!0===b&&a._plugins.push(c),a},prepareConfigEdit:function(a){var b=a.defaults||{},c={type:"grid.edit"},d=!1,e=b.editable;return void 0!==a.clicksToEdit&&(c.clicksToEdit=a.clicksToEdit),e&&(d||a._plugins.push(c),a._plugins.push({type:"grid.celledit"}),d=!0),a.rowEdit&&a._plugins.push({type:"grid.rowedit"}),Fancy.each(a.columns,function(b){switch(void 0===b.index&&void 0===b.key&&(b.editable=!1),b.type){case"image":b.sortable=!1;break;case"sparklineline":case"sparklinebar":case"sparklinetristate":case"sparklinediscrete":case"sparklinebullet":case"sparklinepie":case"sparklinebox":b.editable=!1,b.sortable=!1}b.editable&&!1===d&&(a._plugins.push(c),a._plugins.push({type:"grid.celledit"}))}),a},prepareConfigExpander:function(a){if(a.expander){var b=a.expander;Fancy.apply(b,{type:"grid.expander"}),a.expanded={},a.grouping&&(b.expanded=!1),a._plugins.push(b)}return a},prepareConfigGrouping:function(a){if(a.grouping){var b=a.grouping;Fancy.apply(b,{type:"grid.grouping"}),a.expanded={},a._plugins.push(b)}return a},prepareConfigSummary:function(a){if(a.summary){var b=a.summary;!0===b&&(b={}),Fancy.apply(b,{type:"grid.summary"}),a._plugins.push(b)}return a},prepareConfigContextMenu:function(a){if(a.contextmenu){var b=a.contextmenu;Fancy.isArray(a.contextmenu)&&Fancy.each(a.contextmenu,function(b){"export"===b&&(a.exporter=!0)}),!0===b&&(b={}),Fancy.isArray(b)&&(b={items:b}),Fancy.apply(b,{type:"grid.contextmenu"}),a._plugins.push(b)}return a},prepareConfigExporter:function(a){if(a.exporter){var b=a.exporter;!0===b&&(b={}),Fancy.apply(b,{type:"grid.exporter"}),a._plugins.push(b)}return a},prepareConfigFilter:function(a,b){var c=a.columns,d=!1,e=!1,f=!1,g={type:"grid.filter"};return a.filter&&(!0===a.filter&&(d=!0,a.filter={}),Fancy.apply(g,a.filter)),Fancy.each(c,function(a){a.filter&&(d=!0,a.filter.header&&(e=!0,a.grouping&&(f=!0)))}),g.header=e,g.groupHeader=f,d&&a._plugins.push(g),a},prepareConfigSearch:function(a){var b={type:"grid.search"},c=!1;return a.searching&&(c=!0,Fancy.apply(b,a.searching)),c&&a._plugins.push(b),a},prepareConfigGroupHeader:function(a){var b=a.columns,c=0,d=b.length,e=[],f=!1,g=[];if(Fancy.each(b,function(a){a.columns&&(f=!0,e.push(a))}),f){for(c=0;c<d;c++){var h=b[c];if(h.columns){for(var i=0,j=h.columns.length,k=h.text||h.title||"  ";i<j;i++)h.locked&&(h.columns[i].locked=!0),h.rightLocked&&(h.columns[i].rightLocked=!0),h.columns[i].grouping=k,h.defaults&&(Fancy.applyIf(h.columns[i],h.defaults),h.defaults.width&&h.columns[i].flex&&delete h.columns[i].width);g=g.concat(h.columns),f=!0,e.push(h)}else g=g.concat(b.slice(c,c+1))}a.columns=g,a._plugins.push({type:"grid.groupheader",groups:e}),a.isGroupedHeader=!0}return a},prepareConfigPaging:function(a,b){var c=this,d=a.lang,e=a.paging,f="bbar";if(!e)return a;if(void 0!==e.barType)switch(e.barType){case"bbar":case"tbar":case"both":f=e.barType;break;case!1:case"none":f="none";break;default:throw new Error("[FancyGrid Error]: - not supported bar type for paging")}return a._plugins.push({i18n:b.i18n,type:"grid.paging",barType:f}),"both"===f?(a.tbar=c.generatePagingBar(e,d),a.bbar=c.generatePagingBar(e,d)):"none"===f||(a[f]=c.generatePagingBar(e,d)),a},generatePagingBar:function(a,b){var c=this,d=[],e="fancy-bar-button-disabled",f={float:"left","margin-right":"5px","margin-top":"3px"};if(d.push({imageCls:"fancy-paging-first",disabledCls:e,role:"first",handler:function(a){c.paging.firstPage()},style:{float:"left","margin-left":"5px","margin-right":"5px","margin-top":"3px"}}),d.push({imageCls:"fancy-paging-prev",disabledCls:e,role:"prev",handler:function(){c.paging.prevPage()},style:f}),d.push("|"),d.push({type:"text",text:b.paging.page}),d.push({type:"number",label:!1,padding:!1,style:{float:"left","margin-left":"-1px","margin-right":"8px","margin-top":"4px"},role:"pagenumber",min:1,width:30,listeners:[{enter:function(a){0===parseInt(a.getValue())&&a.set(1);var b=parseInt(a.getValue())-1,d=c.paging.setPage(b);b!==d&&a.set(d)}},{up:function(a,b){var d=c.store.pages;Number(b)>d&&a.set(d)}}]}),d.push({type:"text",text:"",role:"ofText"}),d.push("|"),d.push({imageCls:"fancy-paging-next",disabledCls:e,role:"next",style:f,handler:function(){c.paging.nextPage()}}),d.push({imageCls:"fancy-paging-last",disabledCls:e,role:"last",style:f,handler:function(){c.paging.lastPage()}}),Fancy.isObject(a)&&!0===a.refreshButton&&(d.push("|"),d.push({imageCls:"fancy-paging-refresh",disabledCls:e,role:"refresh",style:f,handler:function(){c.paging.refresh()}})),a&&Fancy.isArray(a.pageSizeData)){for(var g=a.pageSizeData,h=[],i=0,j=g.length,k=0;i<j;i++)h.push({index:i,value:g[i]}),a.pageSize===g[i]&&(k=i);var l=Fancy.Object.copy(f);l["margin-top"]="4px",d.push({editable:!1,width:50,type:"combo",role:"size",style:l,data:h,displayKey:"value",valueKey:"index",value:k,subSearch:!1,events:[{change:function(a,b){c.scroll(0,0),c.paging.setPageSize(g[b])}},{render:function(a){c.store.on("changepages",function(){if(c.store.pageSize!==Number(a.input.dom.value)){var b;Fancy.each(a.data,function(a){if(a.value===c.store.pageSize)return b=a.index,!0}),void 0!==b&&a.setValue(b,!1)}})}}]})}return d.push("side"),d.push({type:"text",role:"info",text:""}),d},prepareConfigState:function(a){if(a.stateful){var b={};Fancy.isObject(a.stateful)&&(b=a.stateful),a._plugins.push({type:"grid.state",stateful:!0,startState:a.state,log:b});var c=a.stateId||this.getStateName(),d=localStorage.getItem(c);if(d){d=JSON.parse(d);var e=d.columns;e&&(e=JSON.parse(e),Fancy.each(e,function(b,c){Fancy.each(b,function(b,d){a.columns[c][d]=b})}))}}else a.state&&a._plugins.push({type:"grid.state",startState:a.state});return a},prepareConfigColumnsResizer:function(a){if((a.defaults||{}).resizable)return a._plugins.push({type:"grid.columnresizer"}),a;var b=[].concat(a.columns).concat(a.leftColumns).concat(a.rightColumns);return Fancy.each(b,function(b){b.resizable&&a._plugins.push({type:"grid.columnresizer"})}),a},prepareConfigTBar:function(a){var b=this,c=a.tbar;if(c)for(var d=0,e=c.length;d<e;d++)switch("search"===c[d].type&&(a.searching=a.searching||{},a.filter=a.filter||!0),c[d].action){case"add":void 0===c[d].handler&&(c[d].handler=function(){b.insert(0,{}),b.scroll(0)});break;case"undo":void 0===c[d].handler&&(c[d].handler=function(){b.undo()});break;case"undoall":void 0===c[d].handler&&(c[d].handler=function(){b.undoAll()});break;case"redo":void 0===c[d].handler&&(c[d].handler=function(){b.redo()});break;case"remove":void 0===c[d].handler&&(c[d].disabled=!0,c[d].handler=function(){Fancy.each(b.getSelection(),function(a){b.remove(a)}),b.selection.clearSelection()},c[d].events=[{render:function(){var a=this;setTimeout(function(){var b=Fancy.getWidget(a.el.parent().parent().parent().select("."+Fancy.GRID_CLS).dom.id);b.on("select",function(){0===b.getSelection().length?a.disable():a.enable()}),b.on("clearselect",function(){a.disable()})},10)}}])}return a},prepareConfigChart:function(a){var b=a.data,c=b.chart;return Fancy.isObject(c)&&(c=[c]),b&&b.chart&&(a._plugins.push({type:"grid.chartintegration",chart:c,toChart:!!b.items||!!b.proxy}),Fancy.each(c,function(b){var c=b.type;switch(c){case"highchart":case"highcharts":a._plugins.push({type:"grid.highchart"});break;case void 0:throw new Error("[FancyGrid Error] - type of chart is undefined");default:throw new Error("[FancyGrid Error] - type of chart "+c+" does not exist")}})),a},prepareConfigSize:function(a,b){var c,d,e=a.renderTo,f=!!(a.title||a.subTitle||a.tbar||a.bbar||a.buttons||a.panel),g=a.panelBodyBorders,h=a.gridWithoutPanelBorders,i=a.gridBorders;if(void 0===a.width){if(e){if(a.responsive=!0,d=Fancy.get(e),a.width=parseInt(d.width()),a.width<1&&"body"!==d.prop("tagName").toLocaleLowerCase()){var j=d.closest(".tab-pane");j?(j.css({display:"block",visibility:"hidden"}),a.width=parseInt(d.width()),j.css({display:"",visibility:""})):a.width=d.parent().width()}0===a.width&&(a.width=parseInt(d.parent().width()))}}else if("fit"===a.width){var k=0,l=!1;this.fitWidth=!0,Fancy.each(a.columns,function(a){a.hidden||(k+=a.width),a.locked&&(l=!0)}),a.title||a.subTitle?k+=g[1]+g[3]+i[1]+i[3]:k+=h[1]+h[3]+i[1]+i[3],l&&k--,a.width=k}if(void 0===a.height){if(e){a.responsiveHeight=!0;var m=parseInt(d.height());m<50&&(m=parseInt(d.parent().css("height"))),a.height=m}}else if("fit"===a.height){var c=0,n=1;Fancy.each(a.columns,function(a){a.grouping&&(n<2&&(n=2),a.filter&&a.filter.header&&n<3&&(n=3)),a.filter&&a.filter.header&&n<2&&(n=2)}),Fancy.isArray(a.data)?c=a.data.length:a.data&&Fancy.isArray(a.data.items)&&(c=a.data.items.length);var m=c*a.cellHeight;a.title&&(m+=a.titleHeight),(a.tbar||a.tabs)&&(m+=a.barHeight),a.bbar&&(m+=a.barHeight),a.buttons&&(m+=a.barHeight),a.subTBar&&(m+=a.barHeight),a.footer&&(m+=a.barHeight),!1!==a.header&&(m+=a.cellHeaderHeight*n),m+=f?g[0]+g[2]+i[0]+i[2]:h[0]+h[2]+i[0]+i[2],a.minHeight&&m<a.minHeight&&(m=a.minHeight),a.heightFit=!0,a.height=m}return a}}),Fancy.Mixin("Fancy.grid.mixin.ActionColumn",{initActionColumnHandler:function(){var a=this;a.on("cellclick",a.onCellClickColumnAction,a)},onCellClickColumnAction:function(a,b){var c,d,e=this,f=b.column,g=f.items;"action"===f.type&&(c=e.getActiveActionColumnItem(b),g&&void 0!==c&&(d=g[c],d.handler&&d.handler(e,b)))},getActiveActionColumnItem:function(a){for(var b=Fancy.get(a.cell),c=a.e.target,d=b.select("."+Fancy.GRID_COLUMN_ACTION_ITEM_CLS),e=0,f=d.length;e<f;e++)if(d.item(e).within(c))return e}}),function(){var a,b=Fancy,c=b.TOUCH_CLS,d=b.HIDDEN_CLS,e=b.GRID_CLS,f=b.GRID_CENTER_CLS,g=b.GRID_LEFT_CLS,h=b.GRID_RIGHT_CLS,i=b.GRID_HEADER_CLS,j=b.GRID_BODY_CLS,k=b.PANEL_BODY_INNER_CLS,l=b.GRID_UNSELECTABLE_CLS,m=b.GRID_LEFT_EMPTY_CLS,n=b.GRID_RIGHT_EMPTY_CLS,o=b.GRID_COLUMN_SORT_ASC,p=b.GRID_COLUMN_SORT_DESC,q=b.PANEL_CLS,r=b.PANEL_TBAR_CLS,s=b.PANEL_SUB_TBAR_CLS,t=b.PANEL_BBAR_CLS,u=b.PANEL_BUTTONS_CLS,v=b.ANIMATE_DURATION;b.Mixin("Fancy.grid.mixin.Grid",{tabScrollStep:50,tpl:['<div class="'+g+" "+m+'"></div>','<div class="'+f+'"></div>','<div class="'+h+" "+n+'"></div>','<div class="fancy-grid-editors"></div>'],initStore:function(){var a,c,d,e=this,f=e.getFieldsFromData(e.data),g="Fancy.model."+b.id(),h=e.data,i=!1,j=e.state;e.data.items&&(h=e.data.items),a=e.data.remoteSort,c=e.data.remoteFilter,d=e.data.remotePage,d&&(d="server"),b.define(g,{extend:b.Model,fields:f}),e.grouping&&void 0!==e.grouping.collapsed&&(i=e.grouping.collapsed);var k={widget:e,model:g,data:h,paging:e.paging,remoteSort:a,remoteFilter:c,pageType:d,collapsed:i,multiSort:e.multiSort};e.multiSortLimit&&(k.multiSortLimit=e.multiSortLimit),j&&j.filters&&(k.filters=j.filters),h.pageSize&&(k.pageSize=h.pageSize),e.store=new b.Store(k),e.model=g,e.fields=f,e.store.filters&&setTimeout(function(){e.filter.filters=e.store.filters,e.filter.updateStoreFilters()},1)},initTouch:function(){var a=this;b.isTouch&&window.FastClick&&(a.panel?(FastClick.attach(a.panel.el.dom),a.panel.addCls(c)):(FastClick.attach(a.el.dom),a.addCls(c)))},initElements:function(){var a=this;!1!==a.header&&(a.leftHeader=new b.grid.Header({widget:a,side:"left"}),a.header=new b.grid.Header({widget:a,side:"center"}),a.rightHeader=new b.grid.Header({widget:a,side:"right"})),a.leftBody=new b.grid.Body({widget:a,side:"left"}),a.body=new b.grid.Body({widget:a,side:"center"}),a.rightBody=new b.grid.Body({widget:a,side:"right"}),a.leftEl=a.el.select("."+g),a.centerEl=a.el.select("."+f),a.rightEl=a.el.select("."+h)},getFieldsFromData:function(a){var b=this,c=a.items||a;if(a.fields)return b.isTreeData&&(a.fields.push("$deep"),a.fields.push("leaf"),a.fields.push("parentId"),a.fields.push("expanded"),a.fields.push("child"),a.fields.push("filteredChild")),a.fields;if(!c)throw new Error("FancyGrid Error 4: Data is empty and not set fields of data to build model");var d=c[0],e=[];for(var f in d)e.push(f);return b.isTreeData&&(e.push("$deep"),e.push("leaf"),e.push("parentId"),e.push("expanded"),e.push("child")),e},render:function(){var a=this,c=Fancy.get(a.renderTo||document.body),d=b.get(document.createElement("div")),e=a.panelBodyBorders;if(a.renderOuter&&(d=c),!c.dom)throw new Error("[FancyGrid Error 1] - Could not find renderTo element: "+a.renderTo);d.addCls(b.cls,a.widgetCls,a.cls),d.attr("id",a.id),void 0===a.panel&&a.shadow&&d.addCls("fancy-panel-shadow"),!1===a.columnLines&&d.addCls("fancy-grid-disable-column-lines"),!1===a.rowLines&&d.addCls("fancy-grid-disable-row-lines"),"default"===a.theme||a.panel||d.addCls("fancy-theme-"+a.theme);var f=0;a.panel&&(f=e[1]+e[3]),d.css({width:a.width-f+"px",height:a.height-0+"px"}),a.initTpl(),d.update(a.tpl.getHTML({})),a.renderOuter?a.el=d:a.el=b.get(c.dom.appendChild(d.dom)),a.setHardBordersWidth(),a.rendered=!0},setHardBordersWidth:function(){var a=this,b=a.panel?a.gridBorders:a.gridWithoutPanelBorders;a.wrapped&&(b=a.gridBorders),a.css({"border-top-width":b[0],"border-right-width":b[1],"border-bottom-width":b[2],"border-left-width":b[3]})},update:function(){var a=this;a.store.loading||(a.expander&&a.expander.reSet(),a.updater.update(),a.fire("update"),a.heightFit&&a.fitHeight(),a.setBodysHeight(),a.paging&&a.paging.update(),a.scroller.update())},getColumnsWidth:function(a){var b=this;switch(a){case"center":case void 0:return b.getCenterFullWidth();case"left":return b.getLeftFullWidth();case"right":return b.getRightFullWidth()}},setSides:function(){var a=this,b=a.leftColumns,c=a.rightColumns,d=a.getLeftFullWidth(),e=a.getCenterFullWidth(),k=a.getRightFullWidth(),l=a.gridBorders,o=a.panelBodyBorders,p=a.gridWithoutPanelBorders;b.length>0&&a.leftEl.removeCls(m),c.length>0&&a.rightEl.removeCls(n),e=a.wrapped?a.width-l[1]-l[3]:a.panel?a.width-l[1]-l[3]-o[1]-o[3]:a.width-p[1]-p[3],0===d&&0===k||(0===k?e-=d:0===d?e-=k:a.width>d+e+k?e-=d:e-=d+k),a.leftEl.css({width:d+"px"}),a.centerEl.css({left:d+"px",width:e+"px"}),a.header&&(a.el.select("."+g+" ."+i).css({width:d+"px"}),a.el.select("."+f+" ."+i).css({width:e+"px"})),a.el.select("."+f+" ."+j).css({width:e+"px"}),a.width>d+e+k?a.rightEl.css({right:"0px"}):a.rightEl.css({left:"",right:"0px"}),a.rightEl.css({width:k}),a.header&&a.el.select("."+h+" ."+i).css({width:k+"px"}),a.startWidths={center:e,left:d,right:k}},setColumnsPosition:function(){var a=this;a.body.setColumnsPosition(),a.leftBody.setColumnsPosition(),a.rightBody.setColumnsPosition()},setSidesHeight:function(a){var b=this,c=b.store,d=1,e=b.cellHeaderHeight;!1!==b.header&&(d+=e,b.filter&&b.filter.header&&(b.groupheader?b.filter.groupHeader&&(d+=e):d+=e),b.groupheader&&(b.filter&&b.filter.header,d+=e)),b.grouping&&(d+=b.grouping.groups.length*b.groupRowHeight),b.expander&&(d+=b.expander.plusHeight),b.summary&&(d+=b.summary.topOffSet),b.rowheight&&b.rowheight.totalHeight&&(a=b.rowheight.totalHeight),d+=a||c.getLength()*b.cellHeight-1,b.paging&&b.summary&&"bottom"===b.summary.position&&(d=b.height),b.leftEl.css({height:d+"px"}),b.centerEl.css({height:d+"px"}),b.rightEl.css({height:d+"px"})},setBodysHeight:function(){var a=this;a.body.setHeight(),a.leftBody.setHeight(),a.rightBody.setHeight()},preRender:function(){var a=this;(a.title||a.subTitle||a.tbar||a.bbar||a.buttons||a.panel)&&a.renderPanel()},renderPanel:function(){var a=this,c={renderTo:a.renderTo,renderOuter:a.renderOuter,title:a.title,subTitle:a.subTitle,width:a.width,height:a.height,titleHeight:a.titleHeight,subTitleHeight:a.subTitleHeight,barHeight:a.barHeight,theme:a.theme,shadow:a.shadow,style:a.style||{},window:a.window,modal:a.modal,frame:a.frame,items:[a],draggable:a.draggable,resizable:a.resizable,minWidth:a.minWidth,minHeight:a.minHeight,panelBodyBorders:a.panelBodyBorders,barContainer:a.barContainer,barScrollEnabled:a.barScrollEnabled,tabScrollStep:a.tabScrollStep},d=a.panelBodyBorders;a.bbar&&(c.bbar=a.bbar,a.height-=a.barHeight),a.tbar&&(c.tbar=a.tbar,a.height-=a.barHeight),a.subTBar&&(c.subTBar=a.subTBar,a.height-=a.barHeight),a.buttons&&(c.buttons=a.buttons,a.height-=a.barHeight),a.footer&&(c.footer=a.footer,a.height-=a.barHeight),a.panel=new b.Panel(c),a.bbar=a.panel.bbar,a.tbar=a.panel.tbar,a.subTBar=a.panel.subTBar,a.buttons=a.panel.buttons,a.wrapped||a.panel.addCls("fancy-panel-grid-inside"),a.title&&(a.height-=a.titleHeight),a.subTitle&&(a.height-=a.subTitleHeight,a.height+=d[2]),a.height-=d[0]+d[2],a.renderTo=a.panel.el.select("."+k).dom},getBodyHeight:function(){var a=this,b=a.height,c=1,d=a.gridBorders,e=a.gridWithoutPanelBorders;return a.groupheader&&(c=2),a.filter&&a.filter.header&&(a.groupheader?a.filter.groupHeader&&c++:c++),!1!==a.header&&(b-=a.cellHeaderHeight*c),a.panel?b-=d[0]+d[2]:b-=e[0]+e[2],a.summary&&(b-=a.summary.topOffSet,b-=a.summary.bottomOffSet),b},ons:function(){var a=this,c=a.store,d=b.get(document);c.on("change",a.onChangeStore,a),c.on("set",a.onSetStore,a),c.on("insert",a.onInsertStore,a),c.on("remove",a.onRemoveStore,a),c.on("beforesort",a.onBeforeSortStore,a),c.on("sort",a.onSortStore,a),c.on("beforeload",a.onBeforeLoadStore,a),c.on("load",a.onLoadStore,a),d.on("mouseup",a.onDocMouseUp,a),d.on("click",a.onDocClick,a),d.on("mousemove",a.onDocMove,a),c.on("servererror",a.onServerError,a),c.on("serversuccess",a.onServerSuccess,a),a.responsive&&b.$(window).bind("resize",function(){a.onWindowResize(),a.intWindowResize&&clearInterval(a.intWindowResize),a.intWindowResize=setTimeout(function(){a.onWindowResize(),delete a.intWindowResize,setTimeout(function(){a.onWindowResize()},300)},30)}),a.on("activate",a.onActivate,a),a.on("deactivate",a.onDeActivate,a)},onServerError:function(a,b,c,d){this.fire("servererror",b,c,d)},onServerSuccess:function(a,b,c){this.fire("serversuccess",b,c)},onChangeStore:function(){this.update()},onBeforeLoadStore:function(a){this.fire("beforeload")},onRemoveStore:function(a,b,c){this.fire("remove",b,c)},onInsertStore:function(a,b){this.fire("insert",b)},onLoadStore:function(a){var b=this;setTimeout(function(){b.fire("load")},1)},onSetStore:function(a,b){this.fire("set",b)},onBeforeSortStore:function(a,b){this.fire("beforesort",b)},onSortStore:function(a,b){this.fire("sort",b)},getCellsViewHeight:function(){var a=this,b=a.store,c=0,e=0;return a.grouping&&(c+=a.grouping.plusScroll),a.expander&&(c+=a.expander.plusScroll),!a.scroller.scrollBottomEl||a.scroller.scrollBottomEl.hasCls(d)||(e=a.scroller.cornerSize),a.cellHeight*b.dataView.length+e+c},onDocMouseUp:function(a){this.fire("docmouseup")},onDocClick:function(a){this.fire("docclick",a)},onDocMove:function(a){this.fire("docmove",a)},getCenterViewWidth:function(){var a=this,b=a.centerEl.width();if(0===b){for(var c=0,d=a.columns,e=0,f=d.length;e<f;e++){var g=d[e];g.hidden||(c+=g.width)}return c}return b},getCenterFullWidth:function(){for(var a=this,b=0,c=a.columns,d=0,e=c.length;d<e;d++){var f=c[d];f.hidden||(b+=f.width)}return b},getLeftFullWidth:function(){for(var a=this,b=0,c=a.leftColumns,d=0,e=c.length;d<e;d++){var f=c[d];f.hidden||(b+=f.width)}return b},getRightFullWidth:function(){for(var a=this,b=0,c=a.rightColumns,d=0,e=c.length;d<e;d++){var f=c[d];f.hidden||(b+=f.width)}return b},getColumns:function(a){var b,c=this;switch(a){case"left":b=c.leftColumns;break;case"center":b=c.columns;break;case"right":b=c.rightColumns}return b},setColumns:function(a,b){var c=this;switch(b){case"left":c.leftColumns=a;break;case"center":case void 0:c.columns=a;break;case"right":c.rightColumns=a}},getBody:function(a){var b,c=this;switch(a){case"left":b=c.leftBody;break;case"center":b=c.body;break;case"right":b=c.rightBody}return b},getHeader:function(a){var b,c=this;switch(a){case"left":b=c.leftHeader;break;case"center":b=c.header;break;case"right":b=c.rightHeader}return b},getHeaderCell:function(a,c){var d,e,f=this;if(b.isString(a)){var g=f.getColumnOrderByKey(a);e=f.getHeader(g.side),d=e.getCell(g.order)}else c=c||"center",e=f.getHeader(c),d=e.getCell(a);return d},getDomRow:function(a){for(var b=this,c=b.leftBody,d=b.body,e=b.rightBody,f=b.leftColumns,g=b.columns,h=b.rightColumns,i=0,j=f.length,k=[];i<j;i++)k.push(c.getDomCell(a,i));for(i=0,j=g.length;i<j;i++)k.push(d.getDomCell(a,i));for(i=0,j=h.length;i<j;i++)k.push(e.getDomCell(a,i));return k},initTextSelection:function(){var a=this,c=a.body,d=a.leftBody,e=a.rightBody;if(!1===a.textSelection){a.addCls(l);var f=function(a){var c=b.get(a.target);c.hasCls("fancy-field-text-input")||c.hasCls("fancy-textarea-text-input")||a.preventDefault()};c.el.on("mousedown",f),d.el.on("mousedown",f),e.el.on("mousedown",f)}},setTrackOver:function(a,b){var c=this;switch(a){case"cell":c.cellTrackOver=b;break;case"column":c.columnTrackOver=b;break;case"row":c.trackOver=b}},setSelModel:function(a){var b=this,c=b.selection;c.cell=!1,c.cells=!1,c.row=!1,c.rows=!1,c.column=!1,c.columns=!1,c[a]=!0,c.selModel=a,b.multiSelect="rows"===a,c.clearSelection()},getSelection:function(a){return this.selection.getSelection(a)},clearSelection:function(){this.selection.clearSelection()},destroy:function(){var a=this,c=a.store,d=b.get(document);d.un("mouseup",a.onDocMouseUp,a),d.un("click",a.onDocClick,a),d.un("mousemove",a.onDocMove,a),a.body.destroy(),a.leftBody.destroy(),a.rightBody.destroy(),a.header.destroy(),a.leftHeader.destroy(),a.rightHeader.destroy(),a.scroller.destroy(),a.el.destroy(),a.panel&&a.panel.el.destroy(),c.destroy()},clearData:function(){var a=this;a.setData([]),a.update(),a.scroller.update()},showAt:function(){var a=this;a.panel&&a.panel.showAt.apply(a.panel,arguments)},show:function(){var a=this;setTimeout(function(){a.panel?a.panel.show.apply(a.panel,arguments):a.el.show()},30)},hide:function(){var a=this;if(a.panel?a.panel.hide.apply(a.panel,arguments):a.el.hide(),a.celledit){var b=a.celledit.activeEditor;b&&b.hide()}},initDateColumn:function(){var a=this,c=function(c){for(var d=0,e=c.length;d<e;d++){var f=c[d];if("date"===f.type){f.format=f.format||{};var g={type:"date"};b.applyIf(g,a.lang.date),b.applyIf(f.format,g)}}return c};a.columns=c(a.columns),a.leftColumns=c(a.leftColumns),a.rightColumns=c(a.rightColumns)},stopEditor:function(){this.edit.stopEditor()},getById:function(a){return this.store.getById(a)},get:function(a,b){var c=this,d=c.store;return void 0!==b?d.get(a,b):void 0===a?d.get():d.getItem(a)},getRowById:function(a){return this.store.getRow(a)},getTotal:function(){return this.store.getTotal()},getViewTotal:function(){return this.store.getLength()},getDataView:function(){return this.store.getDataView()},getData:function(){return this.store.getData()},selectRow:function(a,b,c){this.selection.selectRow(a,b,c),this.activated=!0},deSelectRow:function(a){this.selection.selectRow(a,!1,!0),this.activated=!0},selectById:function(a,b,c){this.selection.selectById(a,b,c)},selectColumn:function(a){var b,c,d=this,e=d.leftColumns||[],f=d.columns||[],g=d.rightColumns||[],h=function(b){for(var d=0,e=b.length;d<e;d++){if(b[d].index===a)return c=d,!0}return!1};h(e)?b="left":h(f)?b="center":h(g)&&(b="right"),b&&d.selection.selectColumn(c,b)},getColumnByIndex:function(a){for(var b=this,c=b.leftColumns||[],d=b.columns||[],e=b.rightColumns||[],f=c.concat(d).concat(e),g=0,h=f.length;g<h;g++){var i=f[g];if(i.index===a)return i}},getColumnOrderByKey:function(a){var c,d=this,e=d.leftColumns||[],f=d.columns||[],g=d.rightColumns||[],h="";return b.each(f,function(b,d){b.index===a&&(h="center",c=d)}),h||(b.each(e,function(b,d){b.index===a&&(h="left",c=d)}),h||b.each(g,function(b,d){b.index===a&&(h="right",c=d)})),{side:h,order:c}},load:function(){this.store.loadData()},save:function(){this.store.save()},onWindowResize:function(){var a,c=this,d=c.renderTo;c.panel&&(d=c.panel.renderTo),a=c.responsive?b.get(d):c.panel?c.panel.el:b.get(d),(a.hasClass(q)||a.hasClass(e))&&(a=a.parent());var f=a.width();if(void 0!==a.dom){if(0===f&&(f=a.parent().width()),c.responsive?c.setWidth(f):c.fitWidth,c.responsiveHeight){var g=parseInt(a.height());0===g&&(g=parseInt(a.parent().height())),c.setHeight(g)}c.setBodysHeight(),c.updateColumnsWidth(),c.scroller.scrollDelta(0),c.scroller.update()}},updateColumnsWidth:function(){var a=this,b=function(b,c,d){Fancy.each(b,function(b,e){if(!b.hidden&&b.flex){var f=c.getCell(e);a.fire("columnresize",{cell:f.dom,width:b.width,column:b,side:d})}})};b(a.columns,a.header,"center"),b(a.leftColumns,a.leftHeader,"left"),b(a.rightColumns,a.rightHeader,"right")},setWidth:function(a){var b,c=this,d=c.el,e=c.gridBorders,g=c.gridWithoutPanelBorders,h=c.panelBodyBorders,i=c.body,j=c.header,k=function(a){for(var b=0,c=a.length,d=0;b<c;b++){a[b].hidden||(d+=a[b].width)}return d},l=k(c.leftColumns),m=k(c.rightColumns),n=a-l-m-h[1]-h[3];c.wrapped?(b=a,n=a-l-m,n-=e[1]+e[3],c.css({width:b})):c.panel?(n=a-l-m-h[1]-h[3],c.panel.el.width(a),n-=e[1]+e[3],b=a-h[1]-h[3],c.css({width:b})):(n=a-l-m-g[1]-g[3],d.css("width",a)),n<100&&(n=100),d.select("."+f).css("width",n),j.css("width",n),i.css("width",n),c.hasFlexColumns&&(c.reCalcColumnsWidth(),c.columnresizer.updateColumnsWidth()),c.scroller.setScrollBars()},getWidth:function(){var a=this;return a.panel?parseInt(a.panel.css("width")):parseInt(a.css("width"))},getHeight:function(){var a=this;return a.panel?parseInt(a.panel.css("height")):parseInt(a.css("height"))},setHeight:function(a,b){var c=this,d=c.gridBorders,e=c.panelBodyBorders;c.panel&&!1!==b&&c.panel.setHeight(a),c.title&&(a-=c.titleHeight),c.subTitle&&(a-=c.subTitleHeight),c.footer&&(a-=c.barHeight),c.bbar&&(a-=c.barHeight),c.tbar&&(a-=c.barHeight),c.subTBar&&(a-=c.barHeight),c.buttons&&(a-=c.barHeight);var f=a;c.header&&(f-=c.cellHeaderHeight,c.groupheader&&(f-=c.cellHeaderHeight)),c.panel&&(f-=e[0]+e[2]),f-=d[0]+d[2],c.body&&c.body.css("height",f),c.leftBody&&c.leftBody.css("height",f),c.rightBody&&c.rightBody.css("height",f),c.el.css("height",a),c.height=a,c.scroller.update()},find:function(a,b,c){return this.store.find(a,b,c)},findItem:function(a,b){return this.store.findItem(a,b)},each:function(a,b){this.store.each(a,b)},onActivate:function(){var c=this,d=b.get(document);a&&a.id!==c.id&&a.fire("deactivate"),setTimeout(function(){d.on("click",c.onDeactivateClick,c)},100),a=c},onDeActivate:function(){var a=this,c=b.get(document);a.activated=!1,c.un("click",a.onDeactivateClick,a)},onDeactivateClick:function(a){for(var c=this,d=0,e=20,f=b.get(a.target);d<e;d++){if(!f.dom)return;if(!f.dom.tagName||"body"===f.dom.tagName.toLocaleLowerCase())return void c.fire("deactivate");if(void 0===f.hasCls)return void c.fire("deactivate");if(f.hasCls(c.widgetCls))return;f=f.parent()}},search:function(a,b){this.searching.search(a,b)},stopSelection:function(){var a=this;a.selection&&a.selection.stopSelection()},enableSelection:function(a){var b=this;b.selection&&b.selection.enableSelection(a)},hideColumn:function(a,c){void 0===c&&(c=a,a="center");var d,e,f=this,g=f.getBody(a),h=f.getHeader(a),i=f.getColumns(a),j=0,k=i.length,l=f.centerEl,m=f.leftEl,n=f.leftHeader,o=f.rightEl,p=f.rightHeader;if(b.isNumber(c)){if(e=i[c],e.hidden)return;d=c,e.hidden=!0}else for(;j<k;j++)if(e=i[j],e.index===c){if(e.hidden)return;d=j,e.hidden=!0;break}switch(h.hideCell(d),g.hideColumn(d),f.rowedit&&f.rowedit.hideField(d,a),a){case"left":m.animate({width:parseInt(m.css("width"))-e.width},v),n.el.animate({width:parseInt(n.css("width"))-e.width},v),l.animate({left:parseInt(l.css("left"))-e.width},v),l.animate({width:parseInt(l.css("width"))+e.width},v),f.body.el.animate({width:parseInt(f.body.css("width"))+e.width},v),f.header.el.animate({width:parseInt(f.header.css("width"))+e.width},v);break;case"right":o.animate({width:parseInt(o.css("width"))-e.width},v),p.el.animate({width:parseInt(p.css("width"))-e.width},v),l.animate({width:parseInt(l.css("width"))+e.width},v),f.body.el.animate({width:parseInt(f.body.css("width"))+e.width},v),f.header.el.animate({width:parseInt(f.header.css("width"))+e.width},v)}f.grouping&&f.grouping.updateGroupRows(),f.onWindowResize(),f.fire("columnhide",{column:e,side:a,orderIndex:d})},showColumn:function(a,c){void 0===c&&(c=a,a="center");var d,e,f=this,g=f.getBody(a),h=f.getHeader(a),i=f.getColumns(a),j=0,k=i.length,l=f.centerEl,m=f.leftEl,n=f.leftHeader,o=f.rightEl,p=f.rightHeader;if(b.isNumber(c)){if(e=i[c],!e.hidden)return;d=c,e.hidden=!1}else for(;j<k;j++)if(e=i[j],e.index===c){if(!e.hidden)return;d=j,e.hidden=!1;break}switch(h.showCell(d),g.showColumn(d),f.rowedit&&f.rowedit.showField(d,a),a){case"left":m.animate({width:parseInt(m.css("width"))+e.width}),n.el.animate({width:parseInt(n.css("width"))+e.width}),l.animate({left:parseInt(l.css("left"))+e.width}),l.animate({width:parseInt(l.css("width"))-e.width}),f.body.el.animate({width:parseInt(f.body.css("width"))-e.width}),f.header.el.animate({width:parseInt(f.header.css("width"))-e.width});break;case"right":o.animate({width:parseInt(o.css("width"))+e.width}),p.el.animate({width:parseInt(p.css("width"))+e.width}),l.animate({width:parseInt(l.css("width"))-e.width}),f.body.el.animate({width:parseInt(f.body.css("width"))-e.width}),f.header.el.animate({width:parseInt(f.header.css("width"))-e.width})}f.grouping&&f.grouping.updateGroupRows(),f.onWindowResize(),f.fire("columnshow",{column:e,side:a,orderIndex:d})},removeColumn:function(a,c){var d,e=this,f=e.leftEl,g=e.leftHeader,h=e.leftBody,i=e.centerEl,j=e.body,k=e.header,l=e.rightEl,m=e.rightBody,n=e.rightHeader;if(void 0===c&&(c="center"),b.isString(a)){var o=e.getColumns(c);if(b.each(o,function(b,c){if(b.index===a)return a=c,!0}),b.isString(a)&&"center"===c&&(o=e.getColumns("left"),b.each(o,function(b,d){if(b.index===a)return a=d,c="left",!0}),b.isString(a)&&(o=e.getColumns("right"),b.each(o,function(b,d){if(b.index===a)return a=d,c="right",!0}),b.isString(a))))throw new Error("FancyGrid Error 7: Column was not found for method removeColumn")}switch(c){case"left":d=e.leftColumns[a],e.leftColumns.splice(a,1),g.removeCell(a),g.reSetIndexes(),h.removeColumn(a),f.css("width",parseInt(f.css("width"))-d.width),i.css("left",parseInt(i.css("left"))-d.width),i.css("width",parseInt(i.css("width"))+d.width),j.css("width",parseInt(j.css("width"))+d.width),k.css("width",parseInt(k.css("width"))+d.width);break;case"center":d=e.columns[a],e.columns.splice(a,1),k.removeCell(a),k.reSetIndexes(),j.removeColumn(a);break;case"right":d=e.rightColumns[a],e.rightColumns.splice(a,1),n.removeCell(a),n.reSetIndexes(),m.removeColumn(a),l.css("right",parseInt(l.css("right"))-d.width),i.css("width",parseInt(i.css("width"))+d.width),k.css("width",parseInt(k.css("width"))+d.width),j.css("width",parseInt(j.css("width"))+d.width)}return d.grouping&&delete d.grouping,e.summary&&e.summary.removeColumn(a,c),d},insertColumn:function(a,c,d,e){var f=this,g=f.leftEl,h=f.leftBody,i=f.leftHeader,j=f.centerEl,k=f.body,l=f.header,o=f.rightEl,p=f.rightBody,q=f.rightHeader;switch(d=d||"center"){case"center":delete a.rightLocked,delete a.locked,f.columns.splice(c,0,a),l.insertCell(c,a),l.reSetIndexes(),k.insertColumn(c,a);break;case"left":a.locked=!0;var r=0,s=0;0===f.leftColumns.length&&(b.nojQuery||(r=1),f.leftEl.removeCls(m)),b.nojQuery||(s=0),f.leftColumns.splice(c,0,a),i.insertCell(c,a),i.reSetIndexes(),i.css("width",parseInt(i.css("width"))+s),h.insertColumn(c,a),g.css("width",parseInt(g.css("width"))+a.width),j.css("width",parseInt(j.css("width"))-a.width),j.css("left",parseInt(j.css("left"))+a.width+r),k.el.css("width",parseInt(k.el.css("width"))-a.width),l.el.css("width",parseInt(l.el.css("width"))-a.width);break;case"right":a.rightLocked=!0;var r=0,t=0;0===f.rightColumns.length&&(b.nojQuery||(r=1,t=2),f.rightEl.removeCls(n)),f.rightColumns.splice(c,0,a),q.insertCell(c,a),q.reSetIndexes(),p.insertColumn(c,a),o.css("width",parseInt(o.css("width"))+a.width),j.css("width",parseInt(j.css("width"))-a.width-r),k.css("width",parseInt(k.css("width"))-a.width-t),l.css("width",parseInt(l.css("width"))-a.width-t)}if(a.menu&&(a.menu=!0),f.grouping){switch(d){case"left":1===f.leftColumns.length&&f.grouping.softRenderGroupedRows("left");break;case"right":1===f.rightColumns.length&&f.grouping.softRenderGroupedRows("right")}f.grouping.updateGroupRows(),f.grouping.setCellsPosition(c,d)}a.rowEditor&&("left"===d&&c--,f.rowedit.moveEditor(a,c,d,e)),f.summary&&f.summary.insertColumn(c,d),f.header.destroyMenus(),f.leftHeader.destroyMenus(),f.rightHeader.destroyMenus(),f.sorter&&f.sorter.updateSortedHeader()},addColumn:function(a,b,c){var d=this,b=b||"center";if(a.type||(a.type="string"),a.width||(a.width=d.defaultColumnWidth),void 0===c){c=d.getColumns(b).length}d.insertColumn(a,c,b),d.scroller.update()},disableLegend:function(a,b){var c=this;c.columns[a].disabled=c.columns[a].disabled||{},c.columns[a].disabled[b]=!0,c.body.updateRows(void 0,a)},enableLegend:function(a,b){var c=this;c.columns[a].disabled=c.columns[a].disabled||{},delete c.columns[a].disabled[b],c.body.updateRows(void 0,a)},fitHeight:function(){var a=this,b=a.store,c=a.panelBodyBorders,d=a.gridBorders,e=b.getLength()*a.cellHeight,f=1,g=a.columns.concat(a.leftColumns||[]).concat(a.rightColumns||[]);Fancy.each(g,function(a){a.grouping&&(f<2&&(f=2),a.filter&&a.filter.header&&f<3&&(f=3)),a.filter&&a.filter.header&&f<2&&(f=2)}),a.getCenterFullWidth()>a.getCenterViewWidth()&&!a.nativeScroller&&!Fancy.isIE&&(e+=a.bottomScrollHeight),a.title&&(e+=a.titleHeight),a.tbar&&(e+=a.barHeight),a.summary&&(e+=a.cellHeight),a.bbar&&(e+=a.barHeight),a.buttons&&(e+=a.barHeight),a.subTBar&&(e+=a.barHeight),a.footer&&(e+=a.barHeight),!1!==a.header&&(e+=a.cellHeaderHeight*f),a.grouping&&(e+=a.grouping.groups.length*a.groupRowHeight),a.panel?e+=c[0]+c[2]+d[0]+d[2]:e+=d[0]+d[2],a.setHeight(e)},addFilter:function(a,c,d,e){var f=this,g=f.filter.filters[a],d=d||"";if(void 0===g&&(g={}),b.isDate(c)){var h=this.getColumnByIndex(a).format;g.type="date",g.format=h,c=Number(c)}g[d]=c,f.filter.filters[a]=g,f.filter.updateStoreFilters(),!1!==e&&f.filter.addValuesInColumnFields(a,c,d)},clearFilter:function(a,b,c){var d=this,e=d.store;void 0===a||null===a?(d.filter.filters={},e.filters={}):void 0===b||null===b?e.filters&&e.filters[a]&&(d.filter.filters[a]={},e.filters[a]={}):d.filter&&d.filter.filters&&d.filter.filters[a]&&d.filter.filters[a][b]&&(delete d.filter.filters[a][b],delete e.filters[a][b]),e.changeDataView(),d.update(),d.filter&&!1!==c&&d.filter.clearColumnsFields(a,b),d.fire("filter",e.filters),d.setSidesHeight()},showLoadMask:function(a){this.loadmask.showLoadMask(a)},hideLoadMask:function(){this.loadmask.hideLoadMask()},prevPage:function(){this.paging.prevPage()},nextPage:function(){this.paging.nextPage()},setPage:function(a){a--,a<0&&(a=0),this.paging.setPage(a)},firstPage:function(){this.paging.firstPage()},lastPage:function(){this.paging.lastPage()},setPageSize:function(a){this.paging.setPageSize(a)},getPage:function(){return this.store.showPage+1},getPages:function(){return this.store.pages},getPageSize:function(){return this.store.pageSize},refresh:function(){this.paging.refresh()},scroll:function(a,b,c){var d=this,e=d.scroller;void 0!==b&&b>0&&(b=-b),e.scroll(a,b,c),e.scrollBottomKnob(),e.scrollRightKnob()},getDataFiltered:function(){return this.store.filteredData},reCalcColumnsWidth:function(){var a=this;if(a.hasFlexColumns){var b,c=a.scroller,d=a.getCenterViewWidth(),e=a.columns,f=0,g=0,h=e.length,i=d;for(!1!==a.flexScrollSensitive&&c.isRightScrollable()&&!c.nativeScroller&&(i-=a.bottomScrollHeight);g<h;g++){var j=e[g];j.hidden||(j.flex?f+=j.flex:i-=j.width)}if(0!==f)for(b=i/f,g=0;g<h;g++){var j=e[g];j.hidden||j.flex&&(j.width=Math.floor(j.flex*b),j.minWidth&&j.width<j.minWidth&&(j.width=j.minWidth),j.minWidth&&j.width<j.minWidth?j.width=j.minWidth:j.width<a.minColumnWidth&&(j.width=a.minColumnWidth))}}},getDisplayedData:function(){for(var a=this,c=a.getViewTotal(),d=[],e=0,f=a.leftColumns,g=a.columns,h=a.rightColumns,i=function(b){if(void 0!==b.index&&"$selected"!==b.index&&!b.hidden)switch(b.type){case"order":j.push(e+1);break;default:j.push(a.get(e,b.index))}};e<c;e++){var j=[];b.each(f,i),b.each(g,i),b.each(h,i),d.push(j)}return d},setData:function(a){var b=this,c=b.store;c.setData(a),c.isTree&&c.initTreeData(),b.setSidesHeight()},exportToExcel:function(a){var b=this;b.exporter&&b.exporter.exportToExcel(a)},getDataAsCsv:function(a){var b=this;if(b.exporter)return b.exporter.getDataAsCsv(a)},getDataAsCSV:function(a){return this.getDataAsCsv(a)},exportToCSV:function(a){var b=this;if(b.exporter)return b.exporter.exportToCSV(a)},exportToCsv:function(a){return this.exportToCSV(a)},enableSelection:function(){this.selection.enableSelection()},disableSelection:function(){this.selection.disableSelection()},setParams:function(a){var c=this,d=c.store;d.proxy&&(d.proxy.params=d.proxy.params||{},b.apply(d.proxy.params,a))},setUrl:function(a){var c=this,d=c.store;if(b.isString(a)){if(d.proxy&&d.proxy.api)if("rest"===d.proxy.type)for(var e in d.proxy.api)d.proxy.api[e]=a;else d.proxy.api.read=a}else d.proxy&&d.proxy.api&&b.apply(d.proxy.api,a)},getSideByCell:function(a){var b,c=this;return c.centerEl.within(a)?b="center":c.leftEl.within(a)?b="left":c.rightEl.within(a)&&(b="right"),b},addChild:function(a,c){var d=this,e=d.store;if(void 0===c)a.$deep=1,void 0===a.child&&(a.child=[]),d.add(a);else{b.isNumber(a)&&(a=d.getById(a));var f=!1;!0===a.get("leaf")&&(a.set("leaf",!1),a.set("expanded",!0),a.set("child",[]),f=!0);var g=a.get("$deep"),h=a.get("child"),i=d.getRowById(a.id)+h.length+1;if(c.$deep=g+1,c.parentId=a.id,f){var j=a.get("parentId");if(j){var k=d.getById(j);b.each(k.data.child,function(b){if(b.id===a.id)return b.leaf=!1,b.expanded=!0,b.child=[c],!0})}}h.push(new e.model(c)),a.set("child",h),!0===a.get("expanded")&&d.insert(i,c)}},expand:function(a){var c,d=this;switch(b.typeOf(a)){case"number":case"string":c=d.getById(a)}!0!==c.get("expanded")&&d.tree.expandRow(c)},collapse:function(a){var c,d=this;switch(b.typeOf(a)){case"number":case"string":c=d.getById(a)}!1!==c.get("expanded")&&d.tree.collapseRow(c)},collapseAll:function(){var a=this,c=a.findItem("$deep",1);b.each(c,function(b){a.collapse(b.id)})},expandAll:function(){var a=this,c=a.findItem("expanded",!1);b.each(c,function(b){a.expand(b.id)}),c=a.findItem("expanded",!1),c.length&&a.expandAll()},copy:function(a){var b=this;b.selection&&b.selection.copy(a)},sort:function(a,b){var c,d,e=this,f=e.getColumnByIndex(a),g=e.getColumnOrderByKey(a);if(g.side)if(c=e.getHeader(g.side),d=c.getCell(g.order),b){switch(b=b||"ASC",d=c.getCell(g.order),b=b.toLocaleLowerCase()){case"asc":d.removeCls(p),d.addCls(o);break;case"desc":d.removeCls(o),d.addCls(p);break;case"drop":d.removeCls(o),d.removeCls(p);break;default:throw new Error("[FancyGrid Error]: sorting type is not right - "+b)}e.sorter.sort(b,a,g.side,f,d)}else d.dom.click()},flashRow:function(a){var c=this,d=c.getDomRow(a);b.each(d,function(a){a=b.get(a),a.addCls("fancy-grid-cell-flash")}),setTimeout(function(){b.each(d,function(a){a=b.get(a),a.addCls("fancy-grid-cell-animation")})},200),setTimeout(function(){b.each(d,function(a){a=b.get(a),a.removeCls("fancy-grid-cell-flash"),a.removeCls("fancy-grid-cell-animation")})},700)},flashCell:function(a,b,c){var d=this,c=c||"center",e=d.getBody(c),f=Fancy.isObject(a)?a:e.getCell(a,b);f.addCls("fancy-grid-cell-flash"),setTimeout(function(){f.addCls("fancy-grid-cell-animation")},200),setTimeout(function(){f.removeCls("fancy-grid-cell-flash"),f.removeCls("fancy-grid-cell-animation")},700)},scrollToRow:function(a){var b=this,c=b.body.getCell(a,0);b.scroller.scrollToCell(c.dom,!1,!0),b.scroller.update(),b.flashRow(a)},getStateSorters:function(){var a=this,c={},d=JSON.parse(localStorage.getItem(a.getStateName()));if(d){if(!d.sorters)return{};var e=JSON.parse(d.sorters);return b.each(e,function(a){c[a.key]=a}),c}},getStateName:function(){var a=this,b=a.id,c=location.host+"-"+location.pathname;return a.stateId?a.stateId:b+c},setWidthFit:function(){var a=this,b=a.panelBodyBorders,c=a.gridWithoutPanelBorders,d=a.gridBorders,e=0,f=!1,g=[].concat(a.leftColumns).concat(a.columns).concat(a.rightColumns);Fancy.each(g,function(a){a.hidden||(e+=a.width),a.locked&&(f=!0)}),a.panel?e+=b[1]+b[3]+d[1]+d[3]:e+=c[1]+c[3]+d[1]+d[3],f&&e--,a.setWidth(e)},setColumnTitle:function(a,b,c){var d,e,f=this,c=c||"center",g=f.getHeader(c),h=g.getColumns();Fancy.isString(a)&&(a=f.getColumnOrderByKey(a).order),e=h[a],e.title=b,d=g.getCell(a),d.select("."+Fancy.GRID_HEADER_CELL_TEXT_CLS).item(0).update(b),f.fire("columntitlechange",{orderIndex:a,index:e.index,value:b,side:c})},clearDirty:function(){var a=this;a.store.clearDirty(),a.body.clearDirty(),a.leftBody.clearDirty(),a.rightBody.clearDirty()},hideBar:function(a){var b,c,d=this;switch(a){case"tbar":b=r;break;case"subtbar":b=s;break;case"bbar":b=t;break;case"buttons":b=u;break;default:throw new Error("FancyGrid Error: bar does not exist")}if(c=d.panel.el.select("."+b),"none"!==c.css("display")){c.hide();var e=parseInt(d.panel.el.css("height"));d.panel.el.css("height",e-d.barHeight)}},showBar:function(a){var b,c,d=this;switch(a){case"tbar":b=r;break;case"subtbar":b=s;break;case"bbar":b=t;break;case"buttons":b=u;break;default:throw new Error("FancyGrid Error: bar does not exist")}if(c=d.panel.el.select("."+b),"none"==c.css("display")){c.show();var e=parseInt(d.panel.el.css("height"));d.panel.el.css("height",e+d.barHeight)}}})}(),Fancy.define("Fancy.grid.plugin.Updater",{extend:Fancy.Plugin,ptype:"grid.updater",inWidgetName:"updater",constructor:function(a){Fancy.applyConfig(this,a),this.Super("const",arguments)},init:function(){},update:function(){var a=this.widget;a.leftBody.update(),a.body.update(),a.rightBody.update()},updateRow:function(a){var b=this.widget;b.leftBody.updateRows(a),b.body.updateRows(a),b.rightBody.updateRows(a)}}),function(){var a=Fancy,b="fancy-scroll-right-inner",c="fancy-scroll-bottom-inner",d="fancy-scroll-top-inner",e="fancy-scroll-right-hover",f="fancy-scroll-bottom-hover",g="fancy-scroll-top-hover",h="fancy-scroll-right-active",i="fancy-scroll-bottom-active",j="fancy-scroll-top-active",k=a.HIDDEN_CLS,l=a.GRID_COLUMN_CLS,m=a.GRID_CENTER_CLS;a.define("Fancy.grid.plugin.Scroller",{extend:a.Plugin,ptype:"grid.scroller",inWidgetName:"scroller",rightKnobDown:!1,bottomKnobDown:!1,minRightKnobHeight:35,minBottomKnobWidth:35,cornerSize:12,scrollLeft:0,scrollTop:0,constructor:function(a){this.Super("const",arguments)},init:function(){this.Super("init",arguments),this.ons()},ons:function(){var b=this,c=b.widget,d=a.getMouseWheelEventName();c.once("render",function(){b.render(),c.leftBody.el.on(d,b.onMouseWheel,b),c.nativeScroller&&(c.leftBody.el.on(d,b.onMouseWheelLeft,b),c.rightBody.el.on(d,b.onMouseWheelRight,b)),c.body.el.on(d,b.onMouseWheel,b),c.rightBody.el.on(d,b.onMouseWheel,b),c.once("init",b.onGridInit,b),c.nativeScroller?(c.body.el.on("scroll",b.onNativeScrollBody,b),c.leftBody.el.on("scroll",b.onNativeScrollLeftBody,b),c.rightBody.el.on("scroll",b.onNativeScrollRightBody,b)):(c.panel&&c.panel.on("resize",b.onPanelResize,b),c.body.el.on("scroll",b.onScrollBodyBugFix,b))}),b.on("render",b.onRender,b),c.store.on("change",b.onChangeStore,b)},destroy:function(){var b=this,c=b.widget,d=c.leftBody,e=c.body,f=c.rightBody,g=a.get(document),h=a.getMouseWheelEventName();g.un("mouseup",b.onMouseUpDoc,b),g.un("mousemove",b.onMouseMoveDoc,b),d.el.un(h,b.onMouseWheel,b),e.el.un(h,b.onMouseWheel,b),f.el.un(h,b.onMouseWheel,b),c.nativeScroller||(b.scrollBottomEl.un("mousedown",b.onMouseDownBottomSpin,b),b.scrollRightEl.un("mousedown",b.onMouseDownRightSpin,b)),a.isTouch&&(d.el.un("touchstart",b.onBodyTouchStart,b),d.el.un("touchmove",b.onBodyTouchMove,b),e.el.un("touchstart",b.onBodyTouchStart,b),e.el.un("touchmove",b.onBodyTouchMove,b),f.el.un("touchstart",b.onBodyTouchStart,b),f.el.un("touchmove",b.onBodyTouchMove,b),g.un("touchend",b.onMouseUpDoc,b))},onGridInit:function(){var b=this,c=b.widget,d=c.store,e=a.get(document);b.setScrollBars(),e.on("mouseup",b.onMouseUpDoc,b),e.on("mousemove",b.onMouseMoveDoc,b),c.on("columnresize",b.onColumnResize,b),c.on("lockcolumn",b.onLockColumn,b),c.on("rightlockcolumn",b.onRightLockColumn,b),c.on("unlockcolumn",b.onUnLockColumn,b),d.on("changepages",b.onChangePages,b),setTimeout(function(){b.update()},1)},render:function(){var e=this,f=e.widget,g=f.body,h=a.get(document.createElement("div")),i=a.get(document.createElement("div")),j=a.get(document.createElement("div"));f.nativeScroller?f.el.addCls("fancy-grid-native-scroller"):(h.addCls("fancy-scroll-right"),i.addCls("fancy-scroll-bottom",k),h.update(['<div class="'+b+'"></div>'].join(" ")),h.select("."+b).css("margin-top",f.knobOffSet),i.update(['<div class="'+c+'"></div>'].join(" ")),a.get(g.el.append(h.dom)),e.scrollRightEl=g.el.select(".fancy-scroll-right"),a.get(g.el.append(i.dom)),e.scrollBottomEl=g.el.select(".fancy-scroll-bottom"),f.doubleHorizontalScroll&&(j.addCls("fancy-scroll-top",k),j.update(['<div class="'+d+'"></div>'].join(" ")),a.get(g.el.append(j.dom)),e.scrollTopEl=g.el.select(".fancy-scroll-top"))),e.fire("render")},onMouseWheel:function(b){var c=this,d=c.widget,e=a.getWheelDelta(b.originalEvent||b);0!=c.isRightScrollable()&&(d.stopProp&&b.stopPropagation(),d.nativeScroller||(c.scrollDelta(e)&&b.preventDefault(),c.scrollRightKnob()))},onRender:function(){var b=this,c=b.widget;!0!==c.nativeScroller&&(b.scrollRightEl.hover(function(){!0!==b.bottomKnobDown&&b.scrollRightEl.addCls(e)},function(){b.scrollRightEl.removeCls(e)}),b.scrollBottomEl.hover(function(){!0!==b.rightKnobDown&&b.scrollBottomEl.addCls(f)},function(){b.scrollBottomEl.removeCls(f)}),c.doubleHorizontalScroll&&b.scrollTopEl.hover(function(){!0!==b.bottomKnobDown&&b.scrollTopEl.addCls(g)},function(){!0!==b.bottomKnobDown&&b.scrollTopEl.removeCls(g)}),b.initRightScroll(),b.initBottomScroll()),a.isTouch&&b.initTouch()},initTouch:function(){var b=this,c=b.widget,d=c.leftBody,e=c.body,f=c.rightBody,g=a.get(document);d.el.on("touchstart",b.onBodyTouchStart,b),d.el.on("touchmove",b.onBodyTouchMove,b),e.el.on("touchstart",b.onBodyTouchStart,b),e.el.on("touchmove",b.onBodyTouchMove,b),f.el.on("touchstart",b.onBodyTouchStart,b),f.el.on("touchmove",b.onBodyTouchMove,b),g.on("touchend",b.onMouseUpDoc,b)},onBodyTouchStart:function(a){var b=this,c=b.widget,a=a.originalEvent||a,d=a.changedTouches[0];c.nativeScroller||(b.rightKnobDown=!0,b.bottomKnobDown=!0,b.mouseDownXY={x:d.pageX,y:d.pageY},b.rightKnobTop=parseInt(b.rightKnob.css("margin-top")),b.scrollRightEl.addCls(h),b.bottomKnobLeft=parseInt(b.bottomKnob.css("margin-left")),b.scrollBottomEl.addCls(i),c.doubleHorizontalScroll&&b.scrollTopEl.addCls(j))},onBodyTouchEnd:function(){this.onMouseUpDoc()},onBodyTouchMove:function(a){var b=this,a=a.originalEvent,c=a.changedTouches[0],d=!0;if(b.nativeScroller)b.onMouseMoveDoc({pageX:c.pageX,pageY:c.pageY});else{var e=b.scrollLeft,f=b.scrollTop;b.onMouseMoveDoc({pageX:c.pageX,pageY:c.pageY}),d=e!==b.scrollLeft||f!==b.scrollTop}!0===b.rightKnobDown&&d&&a.preventDefault(),!0===b.bottomKnobDown&&d&&a.preventDefault()},initRightScroll:function(){var a=this;a.rightKnob=a.scrollRightEl.select("."+b),a.scrollRightEl.on("mousedown",a.onMouseDownRightSpin,a)},initBottomScroll:function(){var a=this,b=a.widget;a.bottomKnob=a.scrollBottomEl.select("."+c),a.scrollBottomEl.on("mousedown",a.onMouseDownBottomSpin,a),b.doubleHorizontalScroll&&(a.topKnob=a.scrollTopEl.select("."+d),a.scrollTopEl.on("mousedown",a.onMouseDownBottomSpin,a))},onMouseDownRightSpin:function(b){var c=this;a.isTouch||(b.preventDefault(),c.rightKnobDown=!0,c.mouseDownXY={x:b.pageX,y:b.pageY},c.rightKnobTop=parseInt(c.rightKnob.css("margin-top")),c.scrollRightEl.addCls(h))},onMouseDownBottomSpin:function(b){var c=this,e=a.get(b.target);b.preventDefault(),c.bottomKnobDown=!0,c.mouseDownXY={x:b.pageX,y:b.pageY},c.bottomKnobLeft=parseInt(c.bottomKnob.css("margin-left")),c.scrollBottomEl.addCls(i),e.hasClass()&&c.scrollTopEl.addCls(d)},onMouseUpDoc:function(){var a=this,b=a.widget;!1===a.rightKnobDown&&!1===a.bottomKnobDown||(a.scrollRightEl.removeCls(h),a.scrollBottomEl.removeCls(i),a.rightKnobDown=!1,a.bottomKnobDown=!1,b.doubleHorizontalScroll&&(a.scrollTopEl.removeCls(j),a.scrollTopEl.removeCls(g)))},onMouseMoveDoc:function(b){var c,d,e,f,g=this,h=g.widget,i=!1,j=!1,k=h.knobOffSet,l=b.pageX,m=b.pageY;g.rightKnobDown&&(a.isTouch?(d=g.mouseDownXY.y-m,e=d+g.rightKnobTop):(d=m-g.mouseDownXY.y,e=d+g.rightKnobTop),e<g.knobOffSet&&(e=g.knobOffSet),g.bodyViewHeight<e+g.rightKnobHeight&&(e=g.bodyViewHeight-g.rightKnobHeight),e<0&&(e=0),i=g.rightScrollScale*e,h.doubleHorizontalScroll&&"none"!==g.scrollBottomEl.css("display")&&e<g.cornerSize&&(e=g.cornerSize),g.rightKnob.css("margin-top",e+k+"px"),g.scroll(i)),g.bottomKnobDown&&(a.isTouch?(c=g.mouseDownXY.x-l,d=g.mouseDownXY.y-m,f=c+g.bottomKnobLeft):(c=l-g.mouseDownXY.x,d=m-g.mouseDownXY.y,f=c+g.bottomKnobLeft),f<1&&(f=1),g.bodyViewWidth-2<f+g.bottomKnobWidth&&(f=g.bodyViewWidth-g.bottomKnobWidth-2),g.bottomScrollScale<0&&f<0&&(f=0,g.bottomScrollScale=0),g.bottomKnob.css("margin-left",f+"px"),j=Math.ceil(g.bottomScrollScale*(f-1)),h.doubleHorizontalScroll&&g.topKnob.css("margin-left",f+"px"),g.scroll(!1,j))},setScrollBars:function(a){var b=this,c=b.widget;setTimeout(function(){b.checkRightScroll(a)},1),b.checkBottomScroll()||b.scrollTop&&c.scroll(!1,0),c.nativeScroller||(b.checkCorner(),b.setRightKnobSize(a),b.setBottomKnobSize())},checkRightScroll:function(a){var b=this,c=b.widget,d=c.body,e=c.gridBorders,f=c.getBodyHeight(),g=(a||c.getCellsViewHeight())-e[0]-e[2];c.nativeScroller?f>=g?d.el.css("overflow-y","hidden"):d.el.css("overflow-y","scroll"):f>=g?b.scrollRightEl.addCls(k):b.scrollRightEl.removeCls(k)},isRightScrollable:function(){var a=this.widget;return a.nativeScroller?"scroll"===a.body.el.css("overflow-y"):!this.scrollRightEl.hasCls(k)},setRightKnobSize:function(b){var c=this,d=c.widget;if(!d.nativeScroller){var e=d.getBodyHeight()-(c.corner?c.cornerSize:0)-2,f=(b||d.getCellsViewHeight())-(c.corner?c.cornerSize:0),g=f-e,h=100-g/(e/100),i=e*(h/100),j=d.knobOffSet;i<c.minRightKnobHeight&&(i=c.minRightKnobHeight,d.doubleHorizontalScroll&&(i+=c.minRightKnobHeight)),!1===c.corner&&(e-=j),c.rightKnob.stop(),c.rightKnob.animate({height:i},a.ANIMATE_DURATION),c.rightKnobHeight=i,c.bodyViewHeight=e,c.rightScrollScale=(f-e)/(e-i)}},checkBottomScroll:function(){var a,b=this,c=b.widget,d=c.body,e=c.getCenterViewWidth(),f=c.getCenterFullWidth()-2;return c.nativeScroller?e>f?(a=!1,d.el.css("overflow-x","hidden")):(a=!0,d.el.css("overflow-x","scroll")):e>f?(a=!1,b.scrollBottomEl.addCls(k),c.doubleHorizontalScroll&&b.scrollTopEl.addCls(k)):(a=!0,b.scrollBottomEl.removeCls(k),c.doubleHorizontalScroll&&b.scrollTopEl.removeCls(k)),a},checkCorner:function(){var a=this;a.widget.nativeScroller||(a.corner=!a.scrollRightEl.hasCls(k)&&!a.scrollBottomEl.hasCls(k))},setBottomKnobSize:function(){var b=this,c=b.widget;if(!c.nativeScroller){var d=c.getCenterViewWidth()-(b.corner?b.cornerSize:0),e=c.getCenterFullWidth()-(b.corner?b.cornerSize:0),f=e-d,g=100-f/(e/100),h=d*(g/100)-2;h<b.minBottomKnobWidth&&(h=b.minBottomKnobWidth),b.bottomKnob.stop(),b.bottomKnob.animate({width:h},a.ANIMATE_DURATION),c.doubleHorizontalScroll&&(b.topKnob.stop(),b.topKnob.animate({width:h},a.ANIMATE_DURATION)),b.bottomKnobWidth=h,b.bodyViewWidth=d,b.bottomScrollScale=(d-e)/(d-h-2-1)}},scroll:function(a,b,c){var d,e=this,f=e.widget;if(b>0&&(b=0),f.nativeScroller)return null!==a&&void 0!==a&&(f.body.el.dom.scrollTop=a),null!==b&&void 0!==b&&(f.body.el.dom.scrollLeft=Math.abs(b),f.header&&f.header.scroll(b,!0)),void f.fire("scroll");f.leftBody.scroll(a),d=f.body.scroll(a,b,c),f.rightBody.scroll(a),void 0!==d.scrollTop&&(e.scrollTop=Math.abs(d.scrollTop)),void 0!==d.scrollLeft&&(e.scrollLeft=Math.abs(d.scrollLeft)),f.fire("scroll")},scrollDelta:function(a){var b,c=this,d=c.widget;if(d.leftBody.wheelScroll(a),b=d.body.wheelScroll(a),d.rightBody.wheelScroll(a),void 0!==b)return c.scrollTop=Math.abs(b.newScroll),d.fire("scroll"),b.scrolled},scrollRightKnob:function(){var a=this,b=a.widget,c=a.getScroll(),d=c/a.rightScrollScale+b.knobOffSet;a.rightKnob&&(b.doubleHorizontalScroll&&(d+=a.cornerSize),a.rightKnob.css("margin-top",d+"px"))},scrollBottomKnob:function(){var a=this,b=a.widget,c=a.getBottomScroll(),d=c/a.bottomScrollScale+b.knobOffSet;0===c&&(d=-1),a.bottomKnob&&(a.bottomKnob.css("margin-left",-d+"px"),b.doubleHorizontalScroll&&a.topKnob.css("margin-left",-d+"px"))},getScroll:function(){var a=this,b=a.widget;return b.nativeScroller?b.body.el.dom.scrollTop:Math.abs(parseInt(b.body.el.select("."+l).item(0).css("top")))},getBottomScroll:function(){var a=this,b=a.widget;return b.nativeScroller?b.body.el.dom.scrollLeft:Math.abs(parseInt(b.body.el.select("."+l).item(0).css("left")))},update:function(a){var b=this;b.setScrollBars(a),b.checkScroll(a),b.scrollRightKnob(),b.scrollBottomKnob()},onChangeStore:function(){this.update()},onColumnResize:function(){var a=this;a.setScrollBars(),setTimeout(function(){a.setScrollBars()},Fancy.ANIMATE_DURATION+20)},checkScroll:function(b){var c=this,d=c.widget,e=c.getScroll(),f=d.getBodyHeight()-(c.corner?c.cornerSize:0),g=(b||d.getCellsViewHeight())-(c.corner?c.cornerSize:0),h=d.getCenterFullWidth(),i=d.getCenterViewWidth();if(h<c.scrollLeft+i)return void setTimeout(function(){var a=h-(c.scrollLeft+i);c.scrollLeft+a<0?d.scroll(c.scrollTop,0,!0):d.scroll(c.scrollTop,c.scrollLeft+a,!0)},a.nojQuery?10:a.ANIMATE_DURATION);e&&g<f&&(c.scroll(0),d.nativeScroller||c.scrollRightKnob())},scrollToCell:function(b,c,d){var e=this,f=e.widget,g=f.cellHeight,h=a.get(b),i=h.parent(),j=Number(h.attr("index")),k=Number(i.attr("index")),l=e.getScroll(),n=g*(j+1),o=f.getBodyHeight(),p=e.getBottomScroll(),q=f.getSideByCell(b),r=f.getColumnsWidth(q),s=parseInt(f.body.el.css("width")),t=0,u=i.parent().parent().hasCls(m);if(!f.nativeScroller||c){if(0===j&&0===k)return e.scroll(0,0),e.scrollBottomKnob(),void e.scrollRightKnob();if(f.grouping&&(n+=f.grouping.getSpecialRowsAbove(j)*f.groupRowHeight),f.expander&&(n+=f.expander.getBeforeHeight(j)),d){var v=f.getCellsViewHeight();l=n-g,v-l<o&&(l-=Math.abs(v-l-o)),e.scroll(l)}else n-l>o?(l=n-o+5,e.scroll(l)):n-l<f.cellHeight&&(l-=g,l<0&&(l=0),e.scroll(l));if(u){for(var w=f.columns,x=0;x<=k;x++)t+=w[x].width;t-p>s?w[x]?e.scroll(l,-(p+(t-p)-s)):e.scroll(l,-(r-s)):t-p<w[k].width?(p=-(t-w[k].width),p>0&&(p=0),e.scroll(l,p)):0!==p&&0===k&&e.scroll(l,0),e.scrollBottomKnob()}e.scrollRightKnob()}},onNativeScrollBody:function(){var a=this,b=a.widget,c=b.body.el.dom.scrollTop,d=b.body.el.dom.scrollLeft;b.header&&b.header.scroll(-d),b.leftBody&&(b.leftBody.el.dom.scrollTop=c),b.rightBody&&(b.rightBody.el.dom.scrollTop=c),b.leftColumns.length&&b.leftBody.el.dom.scrollTop!==b.body.el.dom.scrollTop?b.body.el.dom.scrollTop=b.leftBody.el.dom.scrollTop:b.rightColumns.length&&b.rightBody.el.dom.scrollTop!==b.body.el.dom.scrollTop&&(b.body.el.dom.scrollTop=b.rightBody.el.dom.scrollTop),b.fire("nativescroll")},onNativeScrollLeftBody:function(){var a=this.widget;a.leftBody.el.dom.scrollTop!==a.body.el.dom.scrollTop&&this.onNativeScrollBody()},onNativeScrollRightBody:function(){var a=this.widget;a.rightBody.el.dom.scrollTop!==a.body.el.dom.scrollTop&&this.onNativeScrollBody()},onMouseWheelLeft:function(b){var c=this.widget,d=a.getWheelDelta(b.originalEvent||b),e=d*c.cellHeight;c.leftBody.el.dom.scrollTop-=e,c.body.el.dom.scrollTop-=e,c.rightBody.el.dom.scrollTop-=e},onMouseWheelRight:function(b){var c=this.widget,d=a.getWheelDelta(b.originalEvent||b),e=d*c.cellHeight;c.leftBody.el.dom.scrollTop-=e,c.body.el.dom.scrollTop-=e,c.rightBody.el.dom.scrollTop-=e},onLockColumn:function(){this.update(),this.widget.setColumnsPosition()},onRightLockColumn:function(){this.update(),this.widget.setColumnsPosition()},onUnLockColumn:function(){this.update(),this.widget.setColumnsPosition()},onPanelResize:function(){this.widget.scroll(0,0)},onChangePages:function(){var a=this;!a.widget.nativeScroller&&a.scrollTop&&setTimeout(function(){a.scrollDelta(0)},1)},onScrollBodyBugFix:function(){var a=this,b=a.widget,c=b.body,d=c.el.dom.scrollLeft;c.el.dom.scrollLeft=a.scrollLeft,b.scroll(a.scrollTop,-a.scrollLeft-d)}})}(),Fancy.define("Fancy.grid.plugin.LoadMask",{extend:Fancy.Plugin,ptype:"grid.loadmask",inWidgetName:"loadmask",cls:"fancy-loadmask",innerCls:"fancy-loadmask-inner",imageCls:"fancy-loadmask-image",textCls:"fancy-loadmask-text",constructor:function(a){this.Super("const",arguments)},init:function(){this.Super("init",arguments),this.ons()},ons:function(){var a=this,b=a.widget,c=b.store;b.once("render",function(){a.render(),c.loading&&a.onBeforeLoad(),b.on("beforeload",a.onBeforeLoad,a),b.on("load",a.onLoad,a)})},render:function(){var a,b,c=this,d=c.widget,e=d.el,f=e,g=Fancy.get(document.createElement("div")),h=d.lang;d.panel&&(f=d.panel.el),a=f.width(),b=f.height(),g.addCls(c.cls),"default"!==d.theme&&g.addCls("fancy-theme-"+d.theme),g.css({width:a,height:b,opacity:0}),g.update(['<div class="'+c.innerCls+'"><div class="'+c.imageCls+'"></div><div class="'+c.textCls+'">'+h.loadingText+"</div></div>"].join(" ")),c.el=Fancy.get(f.dom.appendChild(g.dom)),c.innerEl=c.el.select("."+c.innerCls),c.textEl=c.el.select("."+c.textCls);var i=c.innerEl.width(),j=c.innerEl.height();c.innerEl.css({left:a/2-i/2,top:b/2-j/2}),!0!==d.store.loading?g.css("display","none"):(g.css("display","block"),c.showLoadMask()),g.css("opacity",1)},onBeforeLoad:function(){this.showLoadMask()},onLoad:function(){this.hideLoadMask()},showLoadMask:function(a){var b=this,c=b.widget,d=c.lang,e=c.getWidth(),f=c.getHeight();b.el.css("display","block"),b.el.css({height:f,width:e});var g=Math.abs(b.innerEl.width()),h=Math.abs(b.innerEl.height()),i=e/2-g/2,j=f/2-h/2;if(b.innerEl.css({left:i,top:j}),a)return b.textEl.update(a),void b.el.css("display","block");b.loaded=!1,setTimeout(function(){!0!==b.loaded&&(b.textEl.update(d.loadingText),b.el.css("display","block"))},50)},hideLoadMask:function(){this.loaded=!0,this.el.css("display","none")}}),function(){var a=Fancy,b=a.get,c=a.FIELD_CLS,d=a.GRID_RESIZER_LEFT_CLS,e=a.GRID_RESIZER_RIGHT_CLS,f=a.GRID_HEADER_CELL_TRIGGER_CLS,g=a.GRID_HEADER_CELL_TRIGGER_IMAGE_CLS,h=a.GRID_HEADER_CELL_CLS,i=a.GRID_COLUMN_RESIZER_CLS,j=a.GRID_COLUMN_CLS,k=a.GRID_HEADER_CELL_GROUP_LEVEL_2_CLS,l=a.GRID_STATE_RESIZE_COLUMN_CLS,m=a.ANIMATE_DURATION;a.define("Fancy.grid.plugin.ColumnResizer",{extend:a.Plugin,ptype:"grid.columnresizer",inWidgetName:"columnresizer",constructor:function(a){this.Super("const",arguments)},init:function(){var a=this,b=a.widget;a.Super("init",arguments),b.header&&b.on("render",function(){a.render(),a.ons()})},ons:function(){var a=this,b=a.widget;b.on("headercellmousemove",a.onCellMouseMove,a),b.on("headercellmousedown",a.onHeaderCellMouseDown,a),b.on("docclick",a.onDocClick,a),b.on("docmove",a.onDocMove,a),b.on("docmouseup",a.onDocMouseUp,a)},onCellMouseMove:function(a,d){var e=this,h=e.widget,i=d.e,j=b(d.cell),k=i.offsetX,l=j.width(),m=b(i.target),n=m.hasCls(f),o=m.hasCls(g),p=j.select("."+f).item(0),q=j.select("."+g).item(0),r=b(i.target).closest("."+c).hasCls(c),s=parseInt(p.css("width")),t=parseInt(q.css("width")),u=l,v=7;if(n&&(u=s),o&&(u=t),!h.startResizing){if(o)return void e.removeCellResizeCls(d.cell);if("left"===d.side&&d.index===h.leftColumns.length-1&&u-k<v+2&&(v+=2),!n&&!o&&"right"===d.side&&0===d.index&&k<v)e.isColumnResizable(d)&&(r||e.addCellResizeCls(d.cell));else if(!n&&!o&&k<v&&"center"===d.side&&0===d.index&&h.leftColumns.length)d.side="left",d.index=h.leftColumns.length-1,e.isColumnResizable(d)&&(r||e.addCellResizeCls(d.cell));else if(n||o||!(u-k<v||k<v)||0===d.index)u-k<v?o?t-k>2?e.removeCellResizeCls(d.cell):e.addCellResizeCls(d.cell):e.isColumnResizable(d)&&e.addCellResizeCls(d.cell):e.removeCellResizeCls(d.cell);else{var w=k<v;e.isColumnResizable(d,w)&&(r||e.addCellResizeCls(d.cell))}}},addCellResizeCls:function(a){var c=this,d=c.widget,e=d.columndrag;e&&"dragging"===e.status||(b(a).addCls(i),b(a).select("."+f).addCls(i))},removeCellResizeCls:function(a){b(a).removeClass(i),b(a).select("."+f).item(0).removeClass(i)},onHeaderCellMouseDown:function(d,e){var h=this,i=h.widget,d=e.e,j=b(d.target),k=b(e.cell),l=d.offsetX,m=k.width(),n=k.select("."+c),o=j.hasCls(f),p=j.hasCls(g),q=k.select("."+f).item(0),r=k.select("."+g).item(0),s=parseInt(q.css("width")),t=parseInt(r.css("width")),u=m,v=7;if(o&&(u=s),p)return void(u=t);n.length>0&&n.item(0).within(j.dom)||("left"===e.side&&e.index===i.leftColumns.length-1&&u-l<v+2&&(v+=2),!o&&!p&&"right"===e.side&&0===e.index&&l<v?(i.startResizing=!0,a.apply(h,{cell:e.cell,activeSide:e.side,clientX:d.clientX,columnIndex:e.index,moveLeftResizer:!0})):l<7&&"center"===e.side&&0===e.index&&i.leftColumns.length?(i.startResizing=!0,e.side="left",e.index=i.leftColumns.length-1,a.apply(h,{cell:h.getCell(e),activeSide:e.side,clientX:d.clientX,columnIndex:e.index})):!o&&!p&&l<v&&0!==e.index?(i.startResizing=!0,a.apply(h,{cell:h.getPrevCell(e),activeSide:e.side,clientX:d.clientX,columnIndex:e.index-1})):u-l<v&&(i.startResizing=!0,a.apply(h,{cell:e.cell,activeSide:e.side,clientX:d.clientX,columnIndex:e.index})),i.startResizing&&h.isColumnResizable())},isColumnResizable:function(a,b){var c,d,e,f=this,g=f.widget;if(a){if(c=g.getColumns(a.side),e=a.index,b&&(e--,d=c[e],e>0&&c[e].hidden&&e--),isNaN(e))return;return d=c[e],!(0===e&&d.hidden&&("center"!==a.side||!g.leftColumns))&&(!d.hidden&&!0===d.resizable)}c=g.getColumns(f.activeSide),!0!==c[f.columnIndex].resizable&&(g.startResizing=!1,delete f.cell,delete f.activeSide,delete f.clientX,delete f.columnIndex)},getMinColumnWidth:function(){var a,b,c=this,d=c.widget,e=d.minCellWidth;return void 0===c.columnIndex?e:(a=d.getColumns(c.activeSide),b=a[c.columnIndex],b.minWidth?b.minWidth:e)},getMaxColumnWidth:function(){var a,b,c=this,d=c.widget;return void 0!==c.columnIndex&&(a=d.getColumns(c.activeSide),b=a[c.columnIndex],!!b.maxWidth&&b.maxWidth)},onDocClick:function(){this.widget.startResizing=!1},onDocMove:function(a,b){this.widget.startResizing&&this.moveResizeEls(b)},render:function(){var a=this,c=a.widget,f=b(document.createElement("div")),g=b(document.createElement("div"));f.addCls(d),g.addCls(e),a.leftEl=b(c.el.dom.appendChild(f.dom)),a.rightEl=b(c.el.dom.appendChild(g.dom))},moveResizeEls:function(c){var d=this,e=d.widget,f=b(d.cell),g=parseInt(f.css("left")),h=d.getMinColumnWidth(),i=d.getMaxColumnWidth();switch(e.header.hideMenu&&e.header.hideMenu(),e.el.addCls(l),a.get(document.body).addCls(l),d.activeSide){case"left":break;case"center":g+=parseInt(e.leftEl.css("width"));break;case"right":g+=parseInt(e.leftEl.css("width")),g+=parseInt(e.centerEl.css("width"))}var j=c.clientX,k=j-d.clientX,m=f.width()+k;m<h&&(m=h),i&&m>i&&(m=i),d.deltaWidth=f.width()-m,d.moveLeftResizer?(k=j-d.clientX,m=f.width()-k,m<h&&(m=h),d.deltaWidth=f.width()-m,d.leftEl.css({display:"block",left:g+k+"px"}),d.rightEl.css({display:"block",left:g+f.width()-1+"px"})):(d.leftEl.css({display:"block",left:g+"px"}),d.rightEl.css({display:"block",left:g+m+"px"})),d.cellWidth=m},onDocMouseUp:function(){var b=this,c=b.widget;!1!==c.startResizing&&(c.el.removeCls(l),a.get(document.body).removeCls(l),b.leftEl.css({display:"none"}),b.rightEl.css({display:"none"}),b.fixSidesWidth(),c.startResizing=!1,b.moveLeftResizer=!1,delete b.cellWidth,c.scroller.update())},fixSidesWidth:function(){var c,d,e,f,g=this,i=g.widget,l=g.cellWidth,n=g.columnIndex,o=g.deltaWidth,p=i.leftEl,q=i.centerEl,r=i.rightEl,s=i.leftHeader.el,t=i.header.el,u=i.rightHeader.el,v=i.body.el,w={},x={},y=g.minCenterWidth;if(void 0!==l){var z=1;switch(a.nojQuery&&(z=0),g.activeSide){case"left":if((f=parseInt(q.css("width"))+o+z)<y)return;e=i.leftColumns[n],i.leftColumns[g.columnIndex].width=l,c=i.leftBody.el.select("."+j),d=i.leftHeader.el.select("."+h);var A=c.item(n);A.animate({width:l},m),A.css("overflow","");for(var B=g.columnIndex+1,C=d.length,D=0,E=B;D<E;D++){var F=d.item(D),G=F.attr("group-index");G&&(x[G]=!0)}for(;B<C;B++){var H=c.item(B),F=d.item(B);H.animate({left:parseInt(H.css("left"))-o-z},m),F.hasCls(k)&&x[F.attr("index")]||F.animate({left:parseInt(F.css("left"))-o-z},m)}p.animate({width:parseInt(p.css("width"))-o-z},m),s.animate({width:parseInt(s.css("width"))-o-z+"px"},m),i.columns.length&&(q.animate({left:parseInt(q.css("left"))-o-z,width:f},m),t.animate({width:parseInt(t.css("width"))+o+z},m),v.animate({width:parseInt(v.css("width"))+o+z},m));break;case"center":e=i.columns[n],i.columns[g.columnIndex].width=l,c=i.body.el.select("."+j),d=i.header.el.select("."+h);var A=c.item(n);A.animate({width:l},m),A.css("overflow","");for(var B=g.columnIndex+1,C=d.length,D=0,E=B;D<E;D++){var F=d.item(D),G=F.attr("group-index");G&&(x[G]=!0)}for(;B<C;B++){var H=c.item(B),F=d.item(B),I=parseInt(H.css("left"))-o-z,J=parseInt(F.css("left"))-o-z;F.attr("group-index")&&(w[F.attr("group-index")]={}),H.animate({left:I},m),F.hasCls(k)&&x[F.attr("index")]||F.animate({left:J},m)}break;case"right":if((f=parseInt(q.css("width"))+o+z)<y)return;e=i.rightColumns[n],i.rightColumns[g.columnIndex].width=l,c=i.rightBody.el.select("."+j),d=i.rightHeader.el.select("."+h);var A=c.item(n);A.animate({width:l+"px"},m),A.css("overflow","");for(var B=g.columnIndex+1,C=d.length,D=0,E=B;D<E;D++){var F=d.item(D),G=F.attr("group-index");G&&(x[G]=!0)}for(;B<C;B++){var H=c.item(B),F=d.item(B);H.animate({left:parseInt(H.css("left"))-o-z},m),F.hasCls(k)&&x[F.attr("index")]||F.animate({left:parseInt(F.css("left"))-o-z},m)}r.animate({width:parseInt(r.css("width"))-o-z},m),u.animate({width:parseInt(u.css("width"))-o-z+"px"},m),i.columns.length&&(q.animate({width:f},m),t.animate({width:parseInt(t.css("width"))+o+z},m),v.animate({width:parseInt(v.css("width"))+o+z},m))}var K,L=b(g.cell),M=L.attr("group-index");if(L.animate({width:l+"px"},m),M)K=i.el.select("[index='"+M+"']"),K.animate({width:parseInt(K.css("width"))-o-z},m);else for(var N in w)K=i.el.select("[index='"+N+"']"),K.css("left",parseInt(K.css("left"))-(w[N].delta||0)-z);if(i.fire("columnresize",{cell:L.dom,width:l,column:e,side:g.activeSide}),/sparkline/.test(e.type))switch(g.activeSide){case"left":i.leftBody.updateRows(void 0,n);break;case"center":i.body.updateRows(void 0,n);break;case"right":i.rightBody.updateRows(void 0,n)}}},getPrevCell:function(b){var c,d=this,e=d.widget;switch(b.side){case"left":c=e.leftHeader;break;case"center":c=e.header;break;case"right":c=e.rightHeader}var f=c.el.select("."+h).item(b.index-1).dom;return"none"===a.get(f).css("display")&&0!==b.index?(b.cell=f,b.index--,d.getPrevCell(b)):f},getCell:function(a){var b,c=this,d=c.widget;switch(a.side){case"left":b=d.leftHeader;break;case"center":b=d.header;break;case"right":b=d.rightHeader}return b.el.select("."+h).item(a.index).dom},updateColumnsWidth:function(a){for(var b=this,c=b.widget,a=a||"center",d=c.getHeader(a),e=c.getColumns(a),f=0,g=e.length;f<g;f++){var h=e[f];h.hidden||b.setColumnWidth(f,h.width,a)}d.setCellsPosition()},setColumnWidth:function(a,c,d){var e,f,g=this,h=g.widget,i=h.getColumns(d),j=h.getHeader(d),k=h.getBody(d),l=b(k.getDomColumn(a)),m=j.getCell(a),n=parseInt(l.css("left"));l.css("width",c),m.css("width",c),i[a+1]&&(n+=c,f=b(k.getDomColumn(a+1)),f.css("left",n),e=j.getCell(a+1),e.css("left",n))}})}(),Fancy.define("Fancy.grid.plugin.Licence",{extend:Fancy.Plugin,ptype:"grid.licence",inWidgetName:"licence",constructor:function(a){this.Super("const",arguments)},init:function(){this.Super("init",arguments),this.ons()},ons:function(){var a=this;a.widget.once("render",function(){a.render()})},render:function(){var a=this,b=a.widget,c=b.body,d=Fancy.get(document.createElement("div"));/fancygrid/.test(location.host)&&!b.watermark||(!0!==a.checkLicence()||b.watermark)&&(d.css({position:"absolute","z-index":2,width:"30px",height:"30px"}),b.nativeScroller?d.css({top:"2px",left:"2px"}):d.css({right:"4px",bottom:"0px"}),d.update('<a href="http://www.fancygrid.com" title="JavaScript Grid - FancyGrid" style="background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAPklEQVR42mNgGLGAo+/4f1IwTN+i8y/+k4JHLR61eNTiUYuHgcUjD5AbZORG0ajFoxaPWjxq8RC2eBQMWwAAuxzh7E9tdUsAAAAASUVORK5CYII=);color: #60B3E2;font-size: 25px;line-height: 30px;text-decoration: none;">&nbsp;&nbsp;&nbsp;&nbsp;</a>'),Fancy.get(c.el.append(d.dom)),a.licenceEl=d,b.watermark&&a.configWatermark(),a.showConsoleText())},showConsoleText:function(){window.console&&console.log&&Fancy.isChrome&&(console.log("%cFancy%cGrid%c %cTrial%c Version!","color:#A2CFE8;font-size: 14px;font-weight: bold;","color:#088EC7;font-size: 14px;font-weight: bold;","font-weight:bold;color: #515151;font-size: 12px;","color: red;font-weight: bold;font-size: 14px;","font-weight:bold;color: #515151;font-size: 12px;"),console.log("%cPurchase license for legal usage!\nSales email: sales@fancygrid.com","font-weight:bold;color: #515151;font-size: 12px;"))},configWatermark:function(){var a=this,b=a.widget,c=b.watermark;if(c.text){var d=a.licenceEl.firstChild();d.css("background-image","none"),d.css("font-size","11px"),d.update(c.text),a.licenceEl.css("width","initial")}c.style&&a.licenceEl.css(c.style)},checkLicence:function(){var a=this,b="FancyGrid";if(!Fancy.LICENSE&&!FancyGrid.LICENSE)return!1;var c,d,e=String(a.md5(location.host.replace(/^www\./,""),b)),f=Fancy.LICENSE||FancyGrid.LICENSE||[],g=a.md5("UNIVERSAL",b),h=a.md5("SAAS",b),i=a.md5("INTERNAL",b),j=a.md5("OEM",b),k=a.md5("ENTERPRISE",b);for(c=0,d=f.length;c<d;c++)switch(String(f[c])){case e:case g:case h:case i:case j:case k:return!0}return!1},md5:function(a,b,c){var d=function(a,b){var c=(65535&a)+(65535&b);return(a>>16)+(b>>16)+(c>>16)<<16|65535&c},e=function(a,b){return a<<b|a>>>32-b},f=function(a,b,c,f,g,h){return d(e(d(d(b,a),d(f,h)),g),c)},g=function(a,b,c,d,e,g,h){return f(b&c|~b&d,a,b,e,g,h)},h=function(a,b,c,d,e,g,h){return f(b&d|c&~d,a,b,e,g,h)},i=function(a,b,c,d,e,g,h){return f(b^c^d,a,b,e,g,h)},j=function(a,b,c,d,e,g,h){return f(c^(b|~d),a,b,e,g,h)},k=function(a,b){a[b>>5]|=128<<b%32,a[14+(b+64>>>9<<4)]=b;var c,e,f,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(c=0;c<a.length;c+=16)e=m,f=n,k=o,l=p,m=g(m,n,o,p,a[c],7,-680876936),p=g(p,m,n,o,a[c+1],12,-389564586),o=g(o,p,m,n,a[c+2],17,606105819),n=g(n,o,p,m,a[c+3],22,-1044525330),m=g(m,n,o,p,a[c+4],7,-176418897),p=g(p,m,n,o,a[c+5],12,1200080426),o=g(o,p,m,n,a[c+6],17,-1473231341),n=g(n,o,p,m,a[c+7],22,-45705983),m=g(m,n,o,p,a[c+8],7,1770035416),p=g(p,m,n,o,a[c+9],12,-1958414417),o=g(o,p,m,n,a[c+10],17,-42063),n=g(n,o,p,m,a[c+11],22,-1990404162),m=g(m,n,o,p,a[c+12],7,1804603682),p=g(p,m,n,o,a[c+13],12,-40341101),o=g(o,p,m,n,a[c+14],17,-1502002290),n=g(n,o,p,m,a[c+15],22,1236535329),m=h(m,n,o,p,a[c+1],5,-165796510),p=h(p,m,n,o,a[c+6],9,-1069501632),o=h(o,p,m,n,a[c+11],14,643717713),n=h(n,o,p,m,a[c],20,-373897302),m=h(m,n,o,p,a[c+5],5,-701558691),p=h(p,m,n,o,a[c+10],9,38016083),o=h(o,p,m,n,a[c+15],14,-660478335),n=h(n,o,p,m,a[c+4],20,-405537848),m=h(m,n,o,p,a[c+9],5,568446438),p=h(p,m,n,o,a[c+14],9,-1019803690),o=h(o,p,m,n,a[c+3],14,-187363961),n=h(n,o,p,m,a[c+8],20,1163531501),m=h(m,n,o,p,a[c+13],5,-1444681467),p=h(p,m,n,o,a[c+2],9,-51403784),o=h(o,p,m,n,a[c+7],14,1735328473),n=h(n,o,p,m,a[c+12],20,-1926607734),m=i(m,n,o,p,a[c+5],4,-378558),p=i(p,m,n,o,a[c+8],11,-2022574463),o=i(o,p,m,n,a[c+11],16,1839030562),n=i(n,o,p,m,a[c+14],23,-35309556),m=i(m,n,o,p,a[c+1],4,-1530992060),p=i(p,m,n,o,a[c+4],11,1272893353),o=i(o,p,m,n,a[c+7],16,-155497632),n=i(n,o,p,m,a[c+10],23,-1094730640),m=i(m,n,o,p,a[c+13],4,681279174),p=i(p,m,n,o,a[c],11,-358537222),o=i(o,p,m,n,a[c+3],16,-722521979),n=i(n,o,p,m,a[c+6],23,76029189),m=i(m,n,o,p,a[c+9],4,-640364487),p=i(p,m,n,o,a[c+12],11,-421815835),o=i(o,p,m,n,a[c+15],16,530742520),n=i(n,o,p,m,a[c+2],23,-995338651),m=j(m,n,o,p,a[c],6,-198630844),p=j(p,m,n,o,a[c+7],10,1126891415),o=j(o,p,m,n,a[c+14],15,-1416354905),n=j(n,o,p,m,a[c+5],21,-57434055),m=j(m,n,o,p,a[c+12],6,1700485571),p=j(p,m,n,o,a[c+3],10,-1894986606),o=j(o,p,m,n,a[c+10],15,-1051523),n=j(n,o,p,m,a[c+1],21,-2054922799),m=j(m,n,o,p,a[c+8],6,1873313359),p=j(p,m,n,o,a[c+15],10,-30611744),o=j(o,p,m,n,a[c+6],15,-1560198380),n=j(n,o,p,m,a[c+13],21,1309151649),m=j(m,n,o,p,a[c+4],6,-145523070),p=j(p,m,n,o,a[c+11],10,-1120210379),o=j(o,p,m,n,a[c+2],15,718787259),n=j(n,o,p,m,a[c+9],21,-343485551),m=d(m,e),n=d(n,f),o=d(o,k),p=d(p,l);return[m,n,o,p]},l=function(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c},m=function(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c},n=function(a){return l(k(m(a),8*a.length))},o=function(a,b){var c,d,e=m(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=k(e,8*a.length)),c=0;c<16;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=k(f.concat(m(b)),512+8*b.length),l(k(g.concat(d),640))},p=function(a){var b,c,d="0123456789abcdef",e="";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(b>>>4&15)+d.charAt(15&b);return e},q=function(a){return unescape(encodeURIComponent(a))},r=function(a){return n(q(a))},s=function(a){return p(r(a))},t=function(a,b){return o(q(a),q(b))},u=function(a,b){return p(t(a,b))};return function(a,b,c){return b?c?t(b,a):u(b,a):c?r(a):s(a)}(a,b,c)}}),function(){var a=Fancy,b=a.GRID_CELL_CLS,c=a.GRID_CELL_EVEN_CLS,d=a.GRID_CELL_SELECTED_CLS,e=a.GRID_COLUMN_CLS,f=a.GRID_COLUMN_TEXT_CLS,g=a.GRID_COLUMN_ELLIPSIS_CLS,h=a.GRID_COLUMN_ORDER_CLS,i=a.GRID_COLUMN_SELECT_CLS,j=a.GRID_CELL_INNER_CLS,k=a.GRID_CELL_DIRTY_CLS,l=a.GRID_CELL_DIRTY_EL_CLS,m=a.GRID_PSEUDO_CELL_CLS,n=a.GRID_EMPTY_CLS,o=a.GRID_COLUMN_SPARKLINE_CLS,p=a.GRID_COLUMN_SPARKLINE_BULLET_CLS,q=a.GRID_COLUMN_CHART_CIRCLE_CLS,r=a.GRID_COLUMN_SPARK_PROGRESS_DONUT_CLS,s=a.GRID_COLUMN_GROSSLOSS_CLS,t=a.GRID_COLUMN_PROGRESS_CLS,u=a.GRID_COLUMN_PROGRESS_BAR_CLS,v=a.GRID_COLUMN_H_BAR_CLS,w=a.GRID_COLUMN_ROW_DRAG_CLS;a.ns("Fancy.grid.body.mixin"),a.grid.body.mixin.Updater=function(){},a.grid.body.mixin.Updater.prototype={update:function(){var a=this,b=a.widget,c=b.store;a.checkDomColumns(),c.loading||(a.checkDomCells(),a.updateRows(),a.showEmptyText())},checkDomColumns:function(){var b=this,c=b.widget,d=b.el.select("."+e).length,j=b.getColumns(),k=0,l=j.length;if(!(l<=d)){for(;k<l;k++){var m=j[k],n=m.width,o=a.get(document.createElement("div"));if(m.hidden&&o.css("display","none"),o.addCls(e),o.attr("grid",c.id),"$selected"===m.index)o.addCls(i);else switch(m.type){case"order":o.addCls(h);break;case"rowdrag":o.addCls(w)}if(m.cls&&o.addCls(m.cls),"text"===m.type&&o.addCls(f),o.css({width:n+"px"}),o.attr("index",k),m.cellAlign&&o.css("text-align",m.cellAlign),!0===m.ellipsis)switch(m.type){case"string":case"text":case"number":case"date":case"combo":o.addCls(g)}b.el.dom.appendChild(o.dom)}b.fire("adddomcolumns")}},checkDomCells:function(f){var g,h,i=this,j=i.widget,k=j.body,l=j.store,n=0,o=l.dataView.length,p=0;switch(i.side){case"left":h=j.leftColumns;break;case"center":h=j.columns;break;case"right":h=j.rightColumns}g=h.length;var q=i.el.select("."+e),r=l.getLength(),s=i.cellTpl;for(j.cellWrapper&&(s=i.cellWrapperTpl),void 0!==f&&(p=f,g=f);p<g;p++){h[p];var t=q.item(p);n=0;var u=r-t.select("."+b).length;for(n=o-u;n<o;n++){var v=s.getHTML({}),w=a.get(document.createElement("div"));w.css({height:j.cellHeight+"px"}),w.addCls(b),w.attr("index",n),n%2!=0&&j.striped&&w.addCls(c),w.update(v),t.dom.appendChild(w.dom),k.el.select("."+b+"."+d+'[index="'+n+'"]').length&&w.addCls(d)}if(j.nativeScroller&&("left"===i.side||"right"===i.side)){t.select("."+m).destroy();var v=s.getHTML({cellValue:"&nbsp;"}),w=a.get(document.createElement("div"));w.css({height:j.cellHeight+"px"}),w.addCls(m),w.update(v),t.dom.appendChild(w.dom)}}},updateRows:function(a,b){var c,d,e=this,f=e.widget,g=0;switch(void 0===a?e.clearDirty():e.clearDirty(a),e.side){case"left":c=f.leftColumns;break;case"center":c=f.columns;break;case"right":c=f.rightColumns}for(d=c.length,void 0!==b&&(g=b,d=b+1);g<d;g++){var h=c[g];switch(h.type){case"string":case"number":case"combo":case"action":case"text":case"date":case"currency":e.renderUniversal(g,a);break;case"tree":e.renderTree(g,a);break;case"order":e.renderOrder(g,a);break;case"expand":e.renderExpand(g,a);break;case"select":e.renderSelect(g,a);break;case"color":e.renderColor(g,a);break;case"checkbox":e.renderCheckbox(g,a);break;case"switcher":e.renderCheckbox(g,a,!0);break;case"image":e.renderImage(g,a);break;case"sparklineline":e.renderSparkLine(g,a,"line");break;case"sparklinebar":e.renderSparkLine(g,a,"bar");break;case"sparklinetristate":e.renderSparkLine(g,a,"tristate");break;case"sparklinediscrete":e.renderSparkLine(g,a,"discrete");break;case"sparklinebullet":e.renderSparkLine(g,a,"bullet");break;case"sparklinepie":e.renderSparkLine(g,a,"pie");break;case"sparklinebox":e.renderSparkLine(g,a,"box");break;case"circle":e.renderCircle(g,a);break;case"progressdonut":e.renderProgressDonut(g,a);break;case"progressbar":e.renderProgressBar(g,a);break;case"hbar":e.renderHBar(g,a);break;case"grossloss":e.renderGrossLoss(g,a);break;case"rowdrag":e.renderRowDrag(g,a);break;default:throw new Error("[FancyGrid error] - not existed column type "+h.type)}}e.removeNotUsedCells()},renderUniversal:function(a,c){var d,f,g,h=this,i=h.widget,k=i.lang,l=i.emptyValue,m=i.store,n=h.getColumns(),o=n[a],p=h.el.select("."+e),q=p.item(a),r=q.select("."+b),s=q.select("."+b+" ."+j),t=k.currencySign;for(d=void 0!==o.index?o.index:"action"===o.type?"none":void 0,void 0!==c?(f=c,g=c+1):(f=0,g=m.getLength());f<g;f++){var u,v=m.get(f),w=m.getId(f),x=s.item(f),y=r.item(f),z={rowIndex:f,data:v,style:{},column:o,id:w,item:m.getItem(f),inner:x,cell:y},A=!1;switch(m.changed[z.id]&&m.changed[z.id][o.index]&&(A=!0),u=o.smartIndexFn?o.smartIndexFn(v):m.get(f,d),z.value=u,o.format&&(z.value=h.format(z.value,o.format),u=z.value),o.type){case"currency":""!==u&&(u=t+u),z.value=u}switch(o.render&&(z=o.render(z),u=z.value),u){case"":case void 0:u=l}if(i.cellStylingCls&&h.clearCls(y),z.cls&&y.addCls(z.cls),A&&i.dirtyEnabled&&h.enableCellDirty(y),y.css(z.style),z.column.widget||x.update(u),z.column.autoHeight){y.css("height","");var B=parseInt(y.css("height"))+4;B<i.cellHeight&&(B=i.cellHeight),i.rowheight.add(w,B)}}},renderOrder:function(a){var c=this,d=c.widget,f=d.store,g=c.getColumns(),h=g[a],i=c.el.select("."+e),k=i.item(a),l=k.select("."+b),m=k.select("."+b+" ."+j),n=0,o=f.getLength(),p=0;for(d.paging&&(p+=f.showPage*f.pageSize);n<o;n++){var q=f.get(n),r=f.getId(n),s={rowIndex:n,data:q,style:{},column:h,id:r,item:f.getItem(n)},t=n+1+p;s.value=t,h.render&&(s=h.render(s),t=s.value);var u=l.item(n);d.cellStylingCls&&c.clearCls(u),s.cls&&u.addCls(s.cls),u.css(s.style),m.item(n).update(t)}},renderRowDrag:function(a){var c=this,d=c.widget,f=d.store,g=c.getColumns(),h=g[a],i=c.el.select("."+e),k=i.item(a),l=k.select("."+b),m=k.select("."+b+" ."+j),n=0,o=f.getLength(),p=0;for(d.paging&&(p+=f.showPage*f.pageSize);n<o;n++){var q=f.get(n),r=f.getId(n),s={rowIndex:n,data:q,style:{},column:h,id:r,item:f.getItem(n)},t='<svg style="opacity: 0;" viewBox="0 0 6 14"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 2h2V0H0v2zm0 4h2V4H0v2zm0 3.999h2V8H0v1.999zM0 14h2v-2H0v2zM4 0v2h2V0H4zm0 6h2V4H4v2zm0 3.999h2V8H4v1.999zM4 14h2v-2H4v2z"></path></svg>';s.value=t,h.render&&(s=h.render(s),t=s.value);var u=l.item(n);d.cellStylingCls&&c.clearCls(u),s.cls&&u.addCls(s.cls),u.css(s.style),m.item(n).update(t)}},renderTree:function(a,c){var d,f,g=this,h=g.widget,i=h.store,k=g.getColumns(),l=k[a],m=g.el.select("."+e),n=m.item(a),o=n.select("."+b+" ."+j),p=l.index;for(void 0!==c?(d=c,f=c+1):(d=0,f=i.getLength());d<f;d++){var q=(o.item(d),h.get(d)),r=q.get(p),s=Number(q.get("$deep"))-1,t="fancy-grid-tree-expander";q.get("leaf")&&(t="fancy-grid-tree-expander-leaf"),q.get("expanded")&&(t+=" fancy-grid-tree-expander-expanded");var u=15*s,v="";if(l.render){var w=l.render({item:q,data:q.data,deep:s,leaf:q.get("leaf"),rowIndex:c,column:l,value:r});w.nodeImgCls&&(v='<div class="fancy-grid-tree-expander-node '+w.nodeImgCls+'"></div>'),void 0!==w.value&&(r=w.value)}q.get("leaf")&&(u-=8),o.item(d).update(['<div class="'+t+'" style="margin-left: '+u+'px;"></div>'+v+'<div class="fancy-grid-tree-expander-text">'+r+"</div>"].join(""))}},renderExpand:function(c,d){var f,g,h=this,i=h.widget,k=i.store,l=h.getColumns(),m=l[c],n=h.el.select("."+e),o=n.item(c),p=o.select("."+b+" ."+j);for(void 0!==d?(f=d,g=d+1):(f=0,g=k.getLength());f<g;f++){var q,r=p.item(f),s=r.select(".fancy-field-checkbox"),t=0!==s.length,u=i.get(f),v=u.id;!1===t?(p.item(f).update(""),s=new a.CheckBox({renderTo:p.item(f).dom,renderId:!0,value:!1,label:!1,expander:!0,style:{padding:"0px",display:"inline-block"},events:[{change:function(a,b){d=a.el.parent().parent().attr("index"),b?i.expander.expand(d):i.expander.collapse(d)}}]})):(q=s.dom.id,s=a.getWidget(q),i.expander._expandedIds[v]?s.set(!0,!1):s.set(!1,!1));var w=k.get(f),x=k.getId(f),y={rowIndex:f,data:w,style:{},column:m,id:x,item:k.getItem(f)};m.render&&(!0===m.render(y).hidden?s.hide():s.show())}},clearCls:function(b){var c=this.widget;a.each(c.cellStylingCls,function(a){b.removeCls(a)})},renderColor:function(a,c){var d,f,g=this,h=g.widget,i=h.store,k=g.getColumns(),l=k[a],m=l.index,n=g.el.select("."+e),o=n.item(a),p=o.select("."+b);for(void 0!==c?(d=c,f=c+1):(d=0,f=i.getLength());d<f;d++){var q,r=i.get(d),s={rowIndex:d,data:r,style:{},column:l};q=l.smartIndexFn?l.smartIndexFn(r):i.get(d,m),l.render&&(s=l.render(s),q=s.value),s.value=q;var t=p.item(d);t.css(s.style);t.select("."+j).update('<div class="fancy-grid-color-cell" style="background: '+q+';"></div>')}},renderCombo:function(a,c){var d,f,g=this,h=g.widget,i=h.store,k=g.getColumns(),l=k[a],m=l.index,n=g.el.select("."+e),o=n.item(a),p=o.select("."+b),q=o.select("."+b+" ."+j);for(void 0!==c?(d=c,f=c+1):(d=0,f=i.getLength());d<f;d++){var r=i.get(d,m),s={rowIndex:d,value:r,style:{}};l.render&&(s=l.render(s),r=s.value),p.item(d).css(s.style),q.item(d).update(r)}},renderCheckbox:function(c,d,f){var g,h,i=this,k=i.widget,l=k.store,m=i.getColumns(),n=m[c],o=n.index,p=i.el.select("."+e),q=p.item(c),r=q.select("."+b),s=q.select("."+b+" ."+j),t="CheckBox";for(f&&(t="Switcher"),void 0!==d?(g=d,h=d+1):(g=0,h=l.getLength());g<h;g++){var u,v=l.get(g),w=l.get(g,o),x=s.item(g),y=x.select(".fancy-field-checkbox"),z=0!==y.length,A=!1,B=l.getId(g),C={rowIndex:g,data:v,style:{},column:n,id:B,item:l.getItem(g),value:w};if(l.changed[C.id]&&l.changed[C.id][n.index]&&(A=!0),n.render&&(C=n.render(C),w=C.value),!1===z)if(C.stopped)s.item(g).update(w);else{var D=!0;k.rowEdit&&(D=!1),s.item(g).update(""),new a[t]({renderTo:s.item(g).dom,renderId:!0,value:w,label:!1,editable:D,style:{padding:"0px",display:"inline-block"},events:[{beforechange:function(a){"$selected"!==n.index&&!0!==n.editable&&(a.canceledChange=!0)}},{change:function(a,b){"$selected"!==n.index&&(k.celledit.checkBoxChangedValue=b)}}]})}else u=y.dom.id,y=a.getWidget(u),C.stopped?(y.destroy(),s.item(g).update(w)):y.set(w,!1);if(A&&k.dirtyEnabled){var E=r.item(g);i.enableCellDirty(E)}}},renderSelect:function(c,f){var g,h,i=this,k=i.widget,l=k.store,m=i.getColumns(),n=m[c],o=n.index,p=i.el.select("."+e),q=p.item(c),r=q.select("."+b+" ."+j);for(void 0!==f?(g=f,h=f+1):(g=0,h=l.getLength());g<h;g++){var s,t=l.get(g,o),u=l.get(g,"id"),v=r.item(g),w=v.select(".fancy-field-checkbox"),x=0!==w.length,y=!0;k.selection.memory?k.selection.memory.all&&!k.selection.memory.except[u]?(t=!0,k.selection.domSelectRow(g)):k.selection.memory.selected[u]?(t=!0,k.selection.domSelectRow(g)):(t=!1,k.selection.domDeSelectRow(g)):v.parent().hasClass(d)&&(t=!0),k.selection.disabled&&(y=!1),!1===x?(r.item(g).update(""),new a.CheckBox({renderTo:r.item(g).dom,renderId:!0,value:t,label:!1,stopIfCTRL:!0,editable:y,disabled:!y,style:{padding:"0px",display:"inline-block"}})):(s=w.dom.id,w=a.getWidget(s),w.set(t,!1))}},renderImage:function(a,c){var d,f,g=this,h=g.widget,i=h.store,k=g.getColumns(),l=k[a],m=l.index,n=g.el.select("."+e),o=n.item(a),p=o.select("."+b),q=o.select("."+b+" ."+j);for(void 0!==c?(d=c,f=c+1):(d=0,f=i.getLength());d<f;d++){var r=i.get(d,m),s=i.get(d),t={rowIndex:d,value:r,data:s,style:{}},u="";if(l.render&&(t=l.render(t),r=t.value),t.attr)for(var v in t.attr)u+=v+'="'+t.attr[v]+'"';r="<img "+u+' src="'+t.value+'">',p.item(d).css(t.style),q.item(d).update(r)}},renderSparkLine:function(c,d,f){var g,h,i=this,k=i.widget,l=k.cellHeight,m=k.store,n=i.getColumns(),q=n[c],r=q.width,s=q.index,t=i.el.select("."+e),u=t.item(c),v=u.select("."+b),w=u.select("."+b+" ."+j),x=q.sparkConfig||{};u.addCls(o),void 0!==d?(g=d,h=d+1):(g=0,h=m.getLength());var y,z=l-1,A=r-20;switch(f){case"line":case"pie":case"box":y="width";break;case"bullet":y="width",z-=11,u.addCls(p);break;case"discrete":y="width",A=r,z-=2;break;case"bar":case"tristate":y="barWidth"}for(;g<h;g++){var B=m.get(g,s),C=m.get(g),D={rowIndex:g,value:B,data:C,style:{}};if(q.render&&(D=q.render(D),B=D.value),a.isArray(q.values)){var E=0,F=q.values.length;for(B=[];E<F;E++)B.push(m.get(g,q.values[E]))}v.item(g).css(D.style);var G=w.item(g).dom,H={type:f,fillColor:"transparent",height:z};a.apply(H,x),"bar"!==f&&"tristate"!==f||(A=r-20,A/=B.length),H[y]=A,a.$(G).sparkline(B,H)}},renderProgressDonut:function(c,d){var f,g,h=this,i=h.widget,k=i.store,l=h.getColumns(),m=l[c],n=m.index,o=h.el.select("."+e),p=o.item(c),q=p.select("."+b),s=p.select("."+b+" ."+j);for(p.addCls(r),void 0!==d?(f=d,g=d+1):(f=0,g=k.getLength());f<g;f++){var t,u=k.get(f),v={rowIndex:f,data:u,style:{},column:m};t=m.smartIndexFn?m.smartIndexFn(u):k.get(f,n),v.value=t,m.format&&(v.value=h.format(v.value,m.format),t=v.value),m.render&&(v=m.render(v),t=v.value),q.item(f).css(v.style);var w=m.sparkConfig||{},x=s.item(f).dom;a.apply(w,{renderTo:x,value:t}),w.size||w.height||w.width||(w.size=i.cellHeaderHeight-6),a.get(x).update(""),new a.spark.ProgressDonut(w)}},renderGrossLoss:function(c,d){var f,g,h=this,i=h.widget,k=i.store,l=h.getColumns(),m=l[c],n=m.index,o=h.el.select("."+e),p=o.item(c),q=p.select("."+b),r=p.select("."+b+" ."+j);p.addCls(s),void 0!==d?(f=d,g=d+1):(f=0,g=k.getLength());var t=m.sparkConfig||{};for(t.showOnMax&&(t.maxValue=Math.max.apply(Math,k.getColumnData(n,m.smartIndexFn)));f<g;f++){var u,v=k.get(f),w={rowIndex:f,data:v,style:{},column:m};u=m.smartIndexFn?m.smartIndexFn(v):k.get(f,n),w.value=u,m.format&&(w.value=h.format(w.value,m.format),u=w.value),m.render&&(w=m.render(w),u=w.value),q.item(f).css(w.style),a.apply(t,{renderTo:r.item(f).dom,value:u,column:m}),new a.spark.GrossLoss(t)}},renderProgressBar:function(c,d){var f,g,h=this,i=h.widget,k=i.store,l=h.getColumns(),m=l[c],n=m.index,o=h.el.select("."+e),p=o.item(c),q=p.select("."+b),r=p.select("."+b+" ."+j),s=100;p.addCls(t),void 0!==d?(f=d,g=d+1):(f=0,g=k.getLength());var v=m.sparkConfig||{};for(!1===v.percents&&(s=Math.max.apply(Math,k.getColumnData(n)));f<g;f++){var w,x=k.get(f),y={rowIndex:f,data:x,style:{},column:m};w=m.smartIndexFn?m.smartIndexFn(x):k.get(f,n),y.value=w,m.format&&(y.value=h.format(y.value,m.format),w=y.value),m.render&&(y=m.render(y),w=y.value),q.item(f).css(y.style);var z=a.get(r.item(f).dom);if(z.select("."+u).length){var A=a.getWidget(z.select("."+u).item(0).attr("id"));A.value=w,A.maxValue=s,A.update()}else a.apply(v,{renderTo:r.item(f).dom,value:w,column:m,maxValue:s}),new a.spark.ProgressBar(v)}},renderHBar:function(c,d){var f,g,h=this,i=h.widget,k=i.store,l=h.getColumns(),m=l[c],n=m.index,o=h.el.select("."+e),p=o.item(c),q=p.select("."+b),r=p.select("."+b+" ."+j),s=m.sparkConfig||{},t=m.disabled||{};p.addCls(v);var u,w,x={},c=0,y=Number.MIN_VALUE;if(a.isArray(m.index))for(u=m.index.length;c<u;c++){var z=m.index[c];if(!t[z]){x[z]=k.getColumnData(z);var A=Math.max.apply(Math,x[z]);A>y&&(y=A),w=x[z].length}}else{var B=k.getColumnData(m.index),C=[];for(u=B.length;c<u;c++)for(var D=0,E=B[c].length;D<E;D++)t[D]||(x[D]=x[D]||[],x[D].push(B[c][D]));for(var F in x){var A=Math.max.apply(Math,x[F]);C.push(F),A>y&&(y=A),w=x[F].length}m.fields||(m.fields=C)}for(var G=[],H=0;H<w;H++){G[H]=0;for(var F in x)m.fields&&t[m.index+"."+F]||t[F]||(G[H]+=x[F][H])}for(maxValue=Math.max.apply(Math,G),s.maxItemValue=y,void 0!==d?(f=d,g=d+1):(f=0,g=k.getLength());f<g;f++){var I,B=k.get(f),J={rowIndex:f,data:B,style:{},column:m};I=m.smartIndexFn?m.smartIndexFn(B):k.get(f,n),J.value=I,m.format&&(J.value=h.format(J.value,m.format),I=J.value),m.render&&(J=m.render(J),I=J.value),q.item(f).css(J.style);var K=a.get(r.item(f).dom);if(K.select(".fancy-spark-hbar").length){var L=a.getWidget(K.select(".fancy-spark-hbar").item(0).attr("id"));L.maxValue=maxValue,L.maxItemValue=y,L.update(B)}else a.apply(s,{renderTo:r.item(f).dom,value:I,data:B,column:m,maxValue:maxValue,height:i.cellHeight-1}),new a.spark.HBar(s)}},renderCircle:function(a,c){function d(a,b){var c="http://www.w3.org/2000/svg",d=document.createElementNS(c,"svg:svg");d.setAttribute("width",b),d.setAttribute("height",b),d.setAttribute("viewBox","0 0 "+b+" "+b);var e=document.createElementNS(c,"circle");e.setAttributeNS(null,"cx",b/2),e.setAttributeNS(null,"cy",b/2),e.setAttributeNS(null,"r",b/2);var f="#F0F0F0";b>50&&(f="F0F0F0"),a<0&&(f="#F9DDE0"),e.setAttributeNS(null,"fill",f),d.appendChild(e);var g=document.createElementNS(c,"path"),h=2*Math.PI/100,i=0,j=a*h-.001,k=b/2+b/2*Math.sin(i),l=b/2-b/2*Math.cos(i),m=b/2+b/2*Math.sin(j),n=b/2-b/2*Math.cos(j),o=0;j-i>Math.PI&&(o=1);var p="M "+b/2+","+b/2+" L "+k+","+l+" A "+b/2+","+b/2+" 0 "+o+" 1 "+m+","+n+" Z";g.setAttribute("d",p),a<0?g.setAttribute("fill","#EA7369"):g.setAttribute("fill","#44A4D3"),d.appendChild(g);var q=document.createElementNS(c,"circle");return q.setAttributeNS(null,"cx",b/2),q.setAttributeNS(null,"cy",b/2),q.setAttributeNS(null,"r",.25*b),q.setAttributeNS(null,"fill","#fff"),d.appendChild(q),d}var f,g,h=this,i=h.widget,k=i.store,l=h.getColumns(),m=l[a],n=m.index,o=h.el.select("."+e),p=o.item(a),r=p.select("."+b+" ."+j),s=i.cellHeight-4;for(p.addCls(q),void 0!==c?(f=c,g=c+1):(f=0,g=k.getLength());f<g;f++){var t,u=k.get(f),v={rowIndex:f,data:u,style:{}};t=m.smartIndexFn?m.smartIndexFn(u):k.get(f,n),v.value=t,m.render&&(v=m.render(v),t=v.value);var w=r.item(f).dom;""===w.innerHTML&&w.appendChild(d(t,s))}},removeNotUsedCells:function(){for(var a=this,c=a.widget,d=c.store,f=a.el.select("."+e),g=0,h=f.length;g<h;g++)for(var i=f.item(g),j=i.select("."+b),k=d.getLength(),l=j.length;k<l;k++)j.item(k).remove()},getFormat:function(b){var c=this,d=c.widget,e=d.lang;switch(b){case"number":return function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,e.thousandSeparator)};case"date":return function(c){var d=a.Date.parse(c,e.date.read,b.mode);return c=a.Date.format(d,e.date.write,b.mode)}}switch(b.type){case"date":return function(c){if(!c||0===c.length)return"";var d=a.Date.parse(c,b.read,b.mode);return c=a.Date.format(d,b.write,void 0,b.mode)}}if(b.inputFn)return b.inputFn},format:function(b,c){switch(a.typeOf(c)){case"string":b=this.getFormat(c)(b);break;case"function":b=c(b);break;case"object":b=c.inputFn?c.inputFn(b):this.getFormat(c)(b)}return b},enableCellDirty:function(a){a.hasCls(k)||(a.addCls(k),a.append('<div class="'+l+'"></div>'))},clearDirty:function(a){var c=this;if(void 0!==a)return c.el.select("."+b+'[index="'+a+'"] .'+l).destroy(),void c.el.select("."+k+'[index="'+a+'"]').removeCls(k);c.el.select("."+l).destroy(),c.el.select("."+k).removeCls(k)},showEmptyText:function(){var b=this,c=b.widget,d=c.store;if("center"===b.side&&(b.emptyTextEl&&(b.emptyTextEl.destroy(),delete b.emptyTextEl),0===d.dataView.length)){var e=a.get(document.createElement("div"));e.addCls(n),e.update(c.emptyText),b.emptyTextEl=a.get(b.el.dom.appendChild(e.dom))}}}}(),function(){var a=Fancy,b=a.GRID_CELL_CLS,c=a.GRID_CELL_INNER_CLS,d=a.GRID_COLUMN_CLS,e=a.GRID_BODY_CLS,f=a.GRID_CELL_WRAPPER_CLS,g=a.GRID_COLUMN_SELECT_CLS,h=a.GRID_COLUMN_ELLIPSIS_CLS,i=a.GRID_COLUMN_ORDER_CLS,j=a.GRID_COLUMN_TEXT_CLS,k=a.GRID_COLUMN_SPARKLINE_CLS,l=(a.GRID_COLUMN_SPARKLINE_BULLET_CLS,a.GRID_COLUMN_CHART_CIRCLE_CLS),m=a.GRID_COLUMN_SPARK_PROGRESS_DONUT_CLS,n=a.GRID_COLUMN_GROSSLOSS_CLS,o=a.GRID_COLUMN_PROGRESS_CLS,p=(a.GRID_COLUMN_PROGRESS_BAR_CLS,a.GRID_COLUMN_H_BAR_CLS),q=a.GRID_COLUMN_ROW_DRAG_CLS,r=a.ANIMATE_DURATION;a.define("Fancy.grid.Body",{extend:a.Widget,mixins:[a.grid.body.mixin.Updater],cls:e,cellTpl:['<div class="'+c+'">{cellValue}</div>'],cellWrapperTpl:['<div class="'+f+'">','<div class="'+c+'">{cellValue}</div>',"</div>"],constructor:function(){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.addEvents("adddomcolumns"),a.initTpl(),a.render(),a.ons()},initTpl:function(){var b=this;b.cellTpl=new a.Template(b.cellTpl),b.cellWrapperTpl=new a.Template(b.cellWrapperTpl)},ons:function(){var a=this,c=a.widget,e=c.id;c.on("afterrender",a.onAfterRender,a);var f="."+d+'[grid="'+e+'"]',g=f+" div."+b;a.el.on("click",a.onCellClick,a,g),a.el.on("dblclick",a.onCellDblClick,a,g),a.el.on("mouseenter",a.onCellMouseEnter,a,g),a.el.on("mouseleave",a.onCellMouseLeave,a,g),a.el.on("mousedown",a.onCellMouseDown,a,g),a.el.on("mouseenter",a.onColumnMouseEnter,a,f),a.el.on("mouseleave",a.onColumnMouseLeave,a,f),a.el.on("contextmenu",a.onContextMenu,a,g)},render:function(){var b,c=this,d=c.widget,f=a.get(document.createElement("div"));f.addCls(e),b=d.el.select(".fancy-grid-"+c.side).dom,c.el=a.get(b.appendChild(f.dom))},onAfterRender:function(){this.update(),this.setHeight()},setColumnsPosition:function(b,c){var e=this,f=e.widget,g=e.getColumns(),h=0,i=g.length,j=0,k=e.el.select("."+d+'[grid="'+f.id+'"]'),b=b||e.scrollLeft||0;for(j+=b;h<i;h++){var l=g[h],m=k.item(h);c?m.animate({left:j+"px"},a.ANIMATE_DURATION):m.css({left:j+"px"}),l.hidden||(j+=l.width)}},wheelScroll:function(a){var b=this,c=b.widget,e=c.knobOffSet,f=b.el.select("."+d+'[grid="'+c.id+'"]');if(0!==f.length){var g=parseInt(f.item(0).css("top")),h=0,i=f.length,j=c.getBodyHeight(),k=c.getCellsViewHeight(),l=k-j+e,m={oldScroll:parseInt(f.item(0).css("top")),newScroll:parseInt(f.item(0).css("top"))+30*a,deltaScroll:30*a};for(l<0&&(l=0);h<i;h++){var n=f.item(h),o=parseInt(n.css("top"))+30*a;o>0?(o=0,m.newScroll=0):Math.abs(o)>l&&(o=-l-e,m.newScroll=o),o>0&&(o=0),n.css("top",o+"px")}return m.scrolled=g!==parseInt(f.item(0).css("top")),m}},scroll:function(a,b,c){var e=this,f=e.widget,g=e.el.select("."+d+'[grid="'+f.id+'"]'),h=0,i=g.length,j={};if(!1!==a&&null!==a&&void 0!==a)for(j.scrollTop=a;h<i;h++){var k=g.item(h);k.css("top",-a+"px")}return!1!==b&&null!==b&&void 0!==b&&(j.scrollLeft=b,f.header&&f.header.scroll(b,c),e.scrollLeft=b,f.body.setColumnsPosition(b,c),"center"===e.side&&(f.grouping&&f.grouping.scrollLeft(b),f.summary&&f.summary.scrollLeft(b))),j},setHeight:function(){var a=this.widget.getBodyHeight();this.css("height",a+"px")},onCellClick:function(a){var b=this,c=b.widget;c.fire("cellclick",b.getEventParams(a)),c.fire("rowclick",b.getEventParams(a)),c.fire("columnclick",b.getColumnEventParams(a)),!1===c.activated&&(c.activated=!0,c.fire("activate"))},onCellDblClick:function(a){var b=this,c=b.widget;c.fire("celldblclick",b.getEventParams(a)),c.fire("rowdblclick",b.getEventParams(a)),c.fire("columndblclick",b.getColumnEventParams(a))},getEventParams:function(b){var c=this,d=c.widget,e=d.store,f=c.getColumns(),g=b.currentTarget,h=a.get(b.currentTarget),i=h.parent();if(void 0===h.parent().dom)return!1;if(0===e.getLength())return!1;var j=parseInt(i.attr("index")),k=parseInt(h.attr("index")),l=f[j],m=l.index,n=e.get(k,m),o=e.getId(k),p=e.get(k),q=e.getById(o);return l.smartIndexFn&&(n=l.smartIndexFn(p)),{e:b,id:o,side:c.side,cell:g,column:l,rowIndex:k,columnIndex:j,value:n,data:p,item:q}},getColumnEventParams:function(b){var c=this,d=c.widget,e=d.store,f=a.get(b.currentTarget),g=f.parent(),h=parseInt(g.attr("index")),i=c.getColumns(),j=i[h],k={e:b,side:c.side,columnIndex:h,column:j,columnDom:g.dom,cell:f.dom};return d.columnClickData&&(k.data=e.getColumnData(j.index,j.smartIndexFn)),k},getColumnHoverEventParams:function(b){var c=this,d=a.get(b.currentTarget),e=parseInt(d.attr("index")),f=c.getColumns(),g=f[e];return{e:b,side:c.side,columnIndex:e,column:g,columnDom:d.dom,cell:b.target}},getColumns:function(){return this.widget.getColumns(this.side)},onCellMouseEnter:function(b){var c=this,d=c.widget,e=c.getEventParams(b),f=c.prevCellOver;a.nojQuery&&f&&c.fixZeptoBug&&(e.rowIndex===f.rowIndex&&e.columnIndex===f.columnIndex&&e.side===f.side||(d.fire("cellleave",f),e.rowIndex!==f.rowIndex&&d.fire("rowleave",f))),f?e.rowIndex!==c.prevCellOver.rowIndex&&d.fire("rowenter",e):d.fire("rowenter",e),d.fire("cellenter",e),c.prevCellOver=e},onCellMouseDown:function(b){var c=this,d=c.widget,e=c.getEventParams(b),f={e:e.e,side:e.side,columnDom:a.get(e.cell).parent().dom,column:e.column,columnIndex:e.columnIndex,cell:e.cell};2===b.button&&2===b.buttons||3===b.which||(d.fire("beforecellmousedown",e),d.fire("cellmousedown",e),d.fire("columnmousedown",f),!1===d.activated&&(d.activated=!0,d.fire("activate")))},onCellMouseLeave:function(b){var c=this,d=c.widget,e=c.getEventParams(b),f=c.prevCellOver;if(a.nojQuery){if(void 0===f)return;return void(c.fixZeptoBug=e)}d.fire("rowleave",f),d.fire("cellleave",f),delete c.prevCellOver},onColumnMouseEnter:function(a){var b=this,c=b.widget,d=b.getColumnHoverEventParams(a);b.prevColumnOver?b.prevCellOver&&d.rowIndex!==b.prevCellOver.rowIndex&&c.fire("rowenter",d):c.fire("columnenter",d),b.prevColumnOver=d},onColumnMouseLeave:function(a){var b=this;b.widget.fire("columnleave",b.prevColumnOver),delete b.prevColumnOver},getCell:function(a,c){var e=this,f=e.widget;return this.el.select("."+d+'[index="'+c+'"][grid="'+f.id+'"] .'+b+'[index="'+a+'"]')},getDomCell:function(a,c){var e=this,f=e.widget;return e.el.select("."+d+'[index="'+c+'"][grid="'+f.id+'"] .'+b+'[index="'+a+'"]').dom},getDomColumn:function(a){var b=this,c=b.widget;return b.el.select("."+d+'[index="'+a+'"][grid="'+c.id+'"]').dom},destroy:function(){var a=this,c=a.el,e="div."+b,f="div."+d;c.un("click",a.onCellClick,a,e),c.un("dblclick",a.onCellDblClick,a,e),c.un("mouseenter",a.onCellMouseEnter,a,e),c.un("mouseleave",a.onCellMouseLeave,a,e),c.un("mousedown",a.onCellMouseDown,a,e),c.un("mouseenter",a.onColumnMouseEnter,a,f),c.un("mouseleave",a.onColumnMouseLeave,a,f)},hideColumn:function(a){var b=this,c=b.widget,e=b.getColumns(),f=b.el.select("."+d),g=f.item(a),h=0,i=e.length,j=0,k=0;for("center"===b.side&&(k=c.scroller.scrollLeft,j-=k),g.hide();h<i;h++){var l=e[h],g=f.item(h),m=parseInt(g.css("left"));l.hidden||(m!==j&&g.animate({left:j},r),j+=l.width)}},showColumn:function(a){var b=this,c=b.widget,e=b.getColumns(),f=b.el.select("."+d),g=f.item(a),h=0,i=0,j=e.length,k=0;for("center"===b.side&&(k=c.scroller.scrollLeft,h-=k),g.show();i<j;i++){var g=f.item(i),l=parseInt(g.css("left")),m=e[i];m.hidden||(l!==h&&g.animate({left:h},r),h+=m.width)}},removeColumn:function(a){var b=this,c=b.el.select("."+d),e=c.item(a),f=parseInt(e.css("width")),g=a+1,h=c.length;for(e.destroy();g<h;g++){var i=c.item(g),j=parseInt(i.css("left"))-f;i.attr("index",g-1),i.css("left",j)}},insertColumn:function(b,c){var e,f=this,k=f.widget,l=f.getColumns(),m=f.el.select("."+d),n=c.width,o=a.get(document.createElement("div")),p=b,r=m.length,s=0,t=0,u=b;for("center"===f.side&&(s=-k.scroller.scrollLeft);t<u;t++)l[t].hidden||(s+=l[t].width);for(e=s;p<r;p++)if(!l[p].hidden){var v=m.item(p);s=parseInt(v.css("left"))+c.width,v.css("left",s),v.attr("index",p+1)}if(o.addCls(d),o.attr("grid",k.id),"$selected"===c.index)o.addCls(g);else switch(c.type){case"order":o.addCls(i);break;case"rowdrag":o.addCls(q)}if(c.cls&&o.addCls(c.cls),"text"===c.type&&o.addCls(j),o.css({width:n+"px"}),o.attr("index",b),c.cellAlign&&o.css("text-align",c.cellAlign),!0===c.ellipsis)switch(c.type){case"string":case"text":case"number":case"date":case"combo":o.addCls(h)}var w=k.scroller.getScroll();o.css("top",-w),0===b&&m.length?(o.css("left","0px"),f.el.dom.insertBefore(o.dom,m.item(b).dom)):0!==b&&m.length?b===m.length?(o.css("left",s+"px"),f.el.dom.appendChild(o.dom)):(o.css("left",e+"px"),f.el.dom.insertBefore(o.dom,m.item(b).dom)):(o.css("left",s+"px"),f.el.dom.appendChild(o.dom)),f.checkDomCells(),f.updateRows(void 0,b)},reSetIndexes:function(){this.el.select("."+d).each(function(a,b){a.attr("index",b)})},clearColumnsStyles:function(){this.el.select("div."+b).each(function(a){a.css("color",""),a.css("background-color","")})},updateColumnsSizes:function(){var b=this,c=b.widget,e=b.getColumns(),f=0;"center"===b.side&&(f=-c.scroller.scrollLeft),a.each(e,function(a,c){if(!a.hidden){var e=b.el.select("."+d+'[index="'+c+'"]');Fancy.nojQuery?e.css({width:a.width,left:f}):(e.animate({width:a.width,left:f},r),e.css("overflow","")),f+=a.width}})},reSetColumnsAlign:function(){var a=this,b=a.getColumns();this.el.select("."+d).each(function(a,c){var d=b[c];a.css("text-align",d.cellAlign||"")})},reSetColumnsCls:function(){var b=this,c=b.getColumns();b.el.select("."+d).each(function(b,e){var f=c[e],j=b.attr("class").split(" ");switch(a.each(j,function(a){switch(a){case d:case f.cls:case s[f.type]:break;default:b.removeCls(a)}}),f.cls&&b.addCls(f.cls),f.ellipsis&&b.addCls(h),f.type){case"order":b.addCls(i);break;case"select":b.addCls(g);break;case"rowdrag":b.addCls(q)}})},onContextMenu:function(a){var b=this;b.widget.fire("contextmenu",b.getEventParams(a))},updateColumnsVisibility:function(){var a=this,b=a.getColumns();a.el.select("."+d).each(function(a,c){b[c].hidden?a.hide():"none"===a.css("display")&&a.show()})}});var s={sparklineline:k,sparklinebar:k,sparklinetristate:k,sparklinediscrete:k,sparklinebullet:k,sparklinepie:k,sparklinebox:k,circle:l,progressdonut:m,grossloss:n,progressbar:o,hbar:p}}(),function(){var a=Fancy,b=a.GRID_HEADER_CLS,c=a.GRID_HEADER_CELL_CLS,d=a.GRID_HEADER_CELL_CONTAINER_CLS,e=a.GRID_HEADER_CELL_TEXT_CLS,f=a.GRID_HEADER_CELL_TRIGGER_CLS,g=a.GRID_HEADER_CELL_TRIGGER_IMAGE_CLS,h=a.GRID_HEADER_CELL_TRIGGER_DISABLED_CLS,i=a.GRID_HEADER_CELL_GROUP_LEVEL_1_CLS,j=a.GRID_HEADER_CELL_GROUP_LEVEL_2_CLS,k=a.GRID_HEADER_CELL_SELECT_CLS,l=a.GRID_HEADER_CELL_FILTER_FULL_CLS,m=a.GRID_HEADER_CELL_FILTER_SMALL_CLS,n=a.GRID_HEADER_CELL_TRIPLE_CLS,o=a.GRID_HEADER_CELL_CHECKBOX_CLS,p=(a.GRID_COLUMN_SORT_ASC,a.GRID_COLUMN_SORT_DESC,a.FIELD_CHECKBOX_CLS),q=a.ANIMATE_DURATION;a.define("Fancy.grid.Header",{extend:a.Widget,cls:b,mixins:["Fancy.grid.header.mixin.Menu"],cellTpl:['<div class="'+c+' {cls}" style="display:{display};width:{columnWidth}px;height: {height};left: {left};" {groupIndex} index="{index}">','<div class="'+d+'" style="height: {height};">','<span class="'+e+'">{columnName}</span>','<span class="'+f+'">','<div class="'+g+'"></div>',"</span>","</div>","</div>"],constructor:function(a){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.initTpl(),a.render(),a.renderHeaderCheckBox(),a.setAlign(),a.setCellsPosition(),a.ons()},initTpl:function(){this.cellTpl=new a.Template(this.cellTpl)},ons:function(){var a=this,b=a.widget,d=a.el,g="div."+c;b.on("render",a.onAfterRender,a),b.on("docmove",a.onDocMove,a),d.on("click",a.onTriggerClick,a,"span."+f),d.on("click",a.onCellClick,a,g),d.on("mousemove",a.onCellMouseMove,a,g),d.on("mousedown",a.onCellMouseDown,a,g),d.on("mousedown",a.onMouseDown,a),d.on("dblclick",a.onCellTextDBLClick,a,"."+e)},render:function(){var b,c=this,d=c.widget,e=c.getColumns(),f=a.get(document.createElement("div")),g="",j=0,n=e.length,o=1,p={},q=0,r=d.filter&&d.filter.header,s="full",t=d.cellHeaderHeight;for(d.groupheader&&(r&&!d.filter.groupHeader?s="small":o=2),r&&o++;j<n;j++){var u=e[j],v=u.title||u.header,w=t,x="",y="";if(1!==o&&(u.grouping?(p[u.grouping]||(p[u.grouping]={width:0,title:u.grouping,left:q}),w=r&&d.filter.groupHeader?2*t+"px":t+"px",u.hidden||(p[u.grouping].width+=u.width),y='group-index="'+u.grouping+'"',x=i):w=o*t+"px"),q+=u.width,"$selected"===u.index&&(x+=" "+k),u.menu||(x+=" "+h),u.filter&&u.filter.header)switch(s){case"small":x+=" "+m;break;case"full":x+=" "+l}a.isNumber(w)&&(w+="px");var z={cls:x,columnName:v,columnWidth:u.width,index:j,height:w,left:"initial",groupIndex:y,display:u.hidden?"none":""};g+=c.cellTpl.getHTML(z)}f.css({height:t*o+"px",width:c.getColumnsWidth()}),f.addCls(c.cls),d.groupheader&&(f.addCls("fancy-grid-header-grouped"),g+=c.getGroupingCellsHTML(p)),f.update(g),b=d.el.select(".fancy-grid-"+c.side).dom,c.el=a.get(b.appendChild(f.dom))},insertCell:function(b,d){var e,f=this,g=f.widget,i=f.el.select("."+c+":not(."+j+")"),l=f.getColumns(),m="",n=d.title||d.header,o="",p=0;if(i.length)e=parseInt(i.item(0).css("height"));else{g.header.el.select("."+c+":not(."+j+")")}if(e=parseInt(g.header.el.css("height")),"center"===f.side&&(p=-g.scroller.scrollLeft),g.groupheader){var q=f.el.select("."+j);b!==g.columns.length-1&&q.each(function(a){var b=parseInt(a.css("left")||0)+d.width;a.css("left",b)})}"$selected"===d.index&&(m+=" "+k),d.menu||(m+=" "+h);for(var r=0,s=b;r<s;r++)l[r].hidden||(p+=l[r].width);"center"===f.side&&(p+=g.scroller.scrollLeft||0);var t=f.cellTpl.getHTML({cls:m,columnName:n,columnWidth:d.width,index:b,height:String(e)+"px",left:String(p)+"px",groupIndex:o});0===b&&i.length?a.get(i.item(0).before(t)):0!==b&&i.length?b===i.length?f.el.append(t):a.get(i.item(b).before(t)):f.el.append(t);var u=0,v=l.length,w=0,p=0;for("center"===f.side&&(p-=g.scroller.scrollLeft),i=f.el.select("."+c+":not(."+j+")");u<v;u++){var d=l[u];if(!d.hidden){i.item(u).css("left",p),p+=d.width,w+=d.width}}var x=parseInt(f.css("width"));x>w&&(w=x),f.css("width",w)},setAlign:function(){for(var a=this,b=a.getColumns(),c=0,d=b.length;c<d;c++){var e=b[c];e.align&&a.getDomCell(c).css("text-align",e.align)}},onAfterRender:function(){},setCellsPosition:function(b){var d=this,e=d.widget,f=d.getColumns(),g=0,h=d.el.select("."+c);if(g+=d.scrollLeft||0,a.each(f,function(c,d){var f=h.item(d),i="0px";c.grouping&&(i=e.cellHeaderHeight+"px"),b&&!a.nojQuery?f.animate({top:i,left:g+"px"},a.ANIMATE_DURATION):f.css({top:i,left:g+"px"}),c.hidden||(g+=c.width)}),e.groupheader){d.el.select("."+j).each(function(c){var e=c.attr("index"),g=(d.el.select('[group-index="'+e+'"]'),d.scrollLeft||0),h=0;a.each(f,function(a){if(a.grouping===e)return!0;a.hidden||(g+=a.width)}),a.each(f,function(a){a.grouping!==e||a.hidden||(h+=a.width)}),b&&!a.nojQuery?c.animate({left:g,width:h},q):c.css({left:g,width:h})})}},fixGroupHeaderSizing:function(){var b=this,d=b.widget,e=d.cellHeaderHeight,f=b.getColumns(),g=b.el.select("."+c),h=0,k={},n={},o={},p=b.calcRows();"center"===b.side&&(h=d.scroller.scrollLeft),a.each(f,function(a,b){var c=g.item(b),f=a.grouping,j="0px",q=e*p;k[f]=!0,f?(void 0===n[f]?(n[f]=a.width,o[f]=h):n[f]+=a.width,c.addCls(i),j=e+"px",q=e,a.filter&&a.filter.header&&(q=2*e,setTimeout(function(){c.addCls(l)},30))):(c.removeCls(i),a.filter&&a.filter.header&&(setTimeout(function(){c.addCls(m)},30),c.addCls(m))),!d.groupheader||q!==e||f||a.filter||(q=2*e),c.css({top:j,height:q}),h+=a.width});for(var q in n){b.el.select('[index="'+q+'"]').css({left:o[q],width:n[q]})}b.el.select("."+j).each(function(a){var b=a.attr("index");k[b]||a.destroy()})},getColumnsWidth:function(){for(var a=this,b=a.getColumns(),c=0,d=0,e=b.length;d<e;d++){c+=b[d].width}return c},getColumns:function(){var a,b=this,c=b.widget;switch(b.side){case"left":a=c.leftColumns;break;case"center":a=c.columns;break;case"right":a=c.rightColumns}return a},getDomCell:function(a){return this.el.select("."+c).item(a)},onCellClick:function(b){var c=this,d=c.widget,e=d.columndrag,h=b.currentTarget,i=a.get(b.target),k=parseInt(a.get(h).attr("index")),l=c.getColumns(),m=l[k];e&&"dragging"===e.status||i.hasCls(f)||i.hasCls(g)||a.get(h).hasCls(j)||c.textDBLClick||(m.titleEditable?setTimeout(function(){c.textDBLClick?setTimeout(function(){delete c.textDBLClick},400):d.fire("headercellclick",{e:b,side:c.side,cell:h,index:k})},300):d.fire("headercellclick",{e:b,side:c.side,cell:h,index:k}))},onCellMouseMove:function(b){var c=this,d=c.widget,e=b.currentTarget,f=a.get(e),g=f.hasCls(j),h=parseInt(a.get(e).attr("index"));g||d.fire("headercellmousemove",{e:b,side:c.side,cell:e,index:h})},onMouseDown:function(b){"INPUT"===a.get(b.target).prop("tagName")||b.preventDefault()},onCellMouseDown:function(b){var c=this.widget,d=b.currentTarget,e=parseInt(a.get(d).attr("index"));c.fire("headercellmousedown",{e:b,side:this.side,cell:d,index:e})},scroll:function(a,b){this.scrollLeft=a,this.setCellsPosition(b)},getGroupingCellsHTML:function(b){var c=this,d=c.widget,e="";return a.each(b,function(a,b){e+=c.cellTpl.getHTML({cls:j,columnName:a.title,columnWidth:a.width,index:b,height:d.cellHeaderHeight+"px",left:a.left+"px",groupIndex:""})}),e},destroy:function(){var a=this,b=a.el,d="div."+c;b.un("click",a.onCellClick,a,d),b.un("mousemove",a.onCellMouseMove,a,d),b.un("mousedown",a.onCellMouseDown,a,d),b.un("mousedown",a.onMouseDown,a)},getCell:function(a){return this.el.select("."+c+'[index="'+a+'"]')},onTriggerClick:function(b){var c=this,d=a.get(b.currentTarget),e=d.parent().parent(),f=parseInt(e.attr("index")),g=c.getColumns(),h=g[f];b.stopPropagation(),c.showMenu(e,f,h,g)},hideCell:function(b){var d=this,e=d.widget,f=d.el.select("."+c+":not(."+j+")"),g=f.item(b),h=parseInt(g.css("width")),k=0,l=f.length,m=d.getColumns();if(g.hasCls(i)){var n=g.attr("group-index"),o=d.el.select("."+j+'[index="'+n+'"]').item(0),p=parseInt(o.css("width"));o.animate({width:p-h},q)}g.hide();var r={},s=0,t=0;for("center"===d.side&&(t=e.scroller.scrollLeft,s-=t);k<l;k++){var u=f.item(k),v=parseInt(u.css("left")),w=m[k];w.hidden||(w.grouping&&m[b].grouping!==w.grouping&&(r[w.grouping]=!0),v!==s&&u.animate({left:s},q),s+=w.width)}a.each(r,function(b,c){var f=d.el.select("."+j+'[index="'+c+'"]').item(0),g=0;"center"===d.side&&(t=e.scroller.scrollLeft,g-=t),a.each(m,function(a,b){if(!a.hidden)return a.grouping===c||void(g+=a.width)}),f.animate({left:g},q)})},showCell:function(b){var d,e=this,f=e.widget,g=e.el.select("."+c+":not(."+j+")"),h=g.item(b),k=0,l=0,m=g.length,n=e.getColumns();if(h.show(),d=parseInt(h.css("width")),h.hasCls(i)){var o=h.attr("group-index"),p=e.el.select("."+j+'[index="'+o+'"]').item(0),r=parseInt(p.css("width"));p.animate({width:r+d},q)}var s=0;"center"===e.side&&(s=f.scroller.scrollLeft,k-=s);for(var t={};l<m;l++){var u=g.item(l),v=parseInt(u.css("left")),w=n[l];w.hidden||(w.grouping&&n[b].grouping!==w.grouping&&(t[w.grouping]=!0),v!==k&&u.animate({left:k},q),k+=w.width)}a.each(t,function(b,c){var d=e.el.select("."+j+'[index="'+c+'"]').item(0),g=0;"center"===e.side&&(s=f.scroller.scrollLeft,g-=s),a.each(n,function(a){if(!a.hidden)return a.grouping===c||void(g+=a.width)}),d.animate({left:g},q)})},removeCell:function(a){var b=this,d=b.el.select("."+c+":not(."+j+")"),e=d.item(a),f=parseInt(e.css("width")),g=a+1,h=d.length,i={},k=!1;for(e.attr("group-index")&&(k=e.attr("group-index"),i[k]=!0),e.destroy();g<h;g++){var l=d.item(g),m=parseInt(l.css("left"))-f;l.attr("group-index")&&(i[l.attr("group-index")]=!0),l.attr("index",g-1),l.css("left",m)}for(var n in i){var o=b.el.select('[index="'+n+'"]'),p=parseInt(o.css("width"))-f,q=parseInt(o.css("left"))-f;k&&o?(o.css("width",p),o.attr("index")!==k&&o.css("left",q)):o.css("left",q)}if(k&&0===b.el.select('[group-index="'+k+'"]').length){var o=b.el.select('[index="'+k+'"]');o.destroy()}"center"!==b.side&&b.css("width",parseInt(b.css("width"))-f)},renderHeaderCheckBox:function(){for(var b=this,d=b.widget,f=b.getColumns(),g=0,h=f.length,i=b.el.select("."+c+":not(."+j+")");g<h;g++){var l=f[g];if(a.isObject(l.headerCheckBox)){var m=l.headerCheckBox.el,n=m.attr("id"),m=a.get(n);m.dom||(l.headerCheckBox=!0)}if(!0===l.headerCheckBox&&"select"!==l.type){var p=i.item(g),q=p.firstChild(),r=p.select("."+e),s=(r.dom.innerHTML,!!l.title&&l.title),t=0;switch(l.type){case"checkbox":case"switcher":p.addCls(o);break;case"select":p.addCls(k)}r.update(""),s.length&&(t=15*s.width),l.headerCheckBox=new a.CheckBox({renderTo:q.dom,renderId:!0,labelWidth:t,value:!1,label:s,labelAlign:"right",style:{padding:"0px",display:"inline-block"},events:[{change:function(a,b){for(var c=0,e=d.getViewTotal();c<e;c++)d.set(c,l.index,b)}}]})}}},reSetIndexes:function(){this.el.select("."+c+":not(."+j+")").each(function(a,b){a.attr("index",b)})},reSetGroupIndexes:function(){var a=this,b=a.getColumns();this.el.select("."+c+":not(."+j+")").each(function(a,c){var d=b[c],e=d.grouping;a.attr("group-index")&&!e?a.removeAttr("group-index"):e&&a.attr("group-index")!==e&&a.attr("group-index",e)})},updateTitles:function(){var b=this,d=b.getColumns();a.each(d,function(a,d){a.headerCheckBox||b.el.select("div."+c+'[index="'+d+'"] .'+e).update(a.title||"")})},updateCellsSizes:function(){var b=this,d=b.widget,e=b.getColumns(),f=0;"center"===b.side&&(f=-d.scroller.scrollLeft),a.each(e,function(a,d){if(!a.hidden){var e=b.el.select("div."+c+'[index="'+d+'"]'),g=parseInt(e.css("left")),h=parseInt(e.css("width"));if(g===f&&h===a.width)return void(f+=a.width);Fancy.nojQuery?e.css({width:a.width,left:f}):e.animate({width:a.width,left:f},q),f+=a.width}})},calcRows:function(){var a=this,b=a.widget,c=b.columns.concat(b.leftColumns).concat(b.rightColumns),d=1;if(Fancy.each(c,function(a){a.grouping&&(d<2&&(d=2),a.filter&&a.filter.header&&d<3&&(d=3)),a.filter&&a.filter.header&&d<2&&(d=2)}),b.groupheader&&2===d){b.el.select("."+n).length&&(d=3)}return d},reSetColumnsAlign:function(){var a=this,b=a.getColumns();this.el.select("."+c+":not(."+j+")").each(function(a,c){var d=b[c];a.css("text-align",d.align||"")})},destroyMenus:function(){},onDocMove:function(){var a=this,b=a.widget;("none"===b.el.css("display")||b.panel&&b.panel.el&&"none"===b.panel.el.css("display")&&a.hideMenu)&&a.hideMenu()},reSetColumnsCls:function(){var a=this,b=a.getColumns();this.el.select("."+c+":not(."+j+")").each(function(a,c){b[c].menu?a.removeCls(h):a.addCls(h)})},updateCellsVisibility:function(){var a=this,b=a.getColumns();this.el.select("."+c+":not(."+j+")").each(function(a,c){b[c].hidden?a.hide():"none"===a.css("display")&&a.show()})},reSetCheckBoxes:function(){var b=this,d=b.getColumns(),e=this.el.select("."+c+":not(."+j+")");a.each(d,function(b,c){var d=e.item(c),f=d.select("."+p);if(f.length){var g=a.getWidget(f.item(0).attr("id"));switch(d.removeCls(o),d.removeCls(k),b.type){case"select":d.addCls(k);break;case"checkbox":d.addCls(o);break;default:b.headerCheckBox||g.destroy()}}}),b.renderHeaderCheckBox()},onCellTextDBLClick:function(a){var b=this,c=b.widget,d=Fancy.get(a.target),e=d.parent().parent(),f=e.attr("index"),g=b.getColumns(),h=g[f],i=h.title;h.titleEditable&&(b.textDBLClick=!0,b.activeEditColumnField&&(b.activeEditColumnField.destroy(),delete b.activeEditColumnField),b.activeEditColumnField=new Fancy.StringField({renderTo:b.el.dom,label:!1,theme:c.theme,padding:"0px 0px 0px",width:h.width+1,value:h.title||"",inputHeight:c.cellHeaderHeight+1,events:[{enter:function(a){a.destroy()}},{esc:function(a){c.setColumnTitle(h.index,i,b.side),a.destroy(),delete b.activeEditColumnField}},{input:function(a,d){c.setColumnTitle(h.index,d,b.side),delete b.activeEditColumnField}},{render:function(a){a.focus(),delete b.activeEditColumnField}}],style:{position:"absolute",top:-1,left:parseInt(e.css("left"))-1}}),c.once("scroll",function(){b.activeEditColumnField&&(b.activeEditColumnField.destroy(),delete b.activeEditColumnField)}))}})}();