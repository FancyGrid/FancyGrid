Fancy.modules.state=!0,function(){const t=Fancy;t.define("Fancy.grid.plugin.State",{extend:t.Plugin,ptype:"grid.state",inWidgetName:"state",stateful:!1,$log:{filter:!0,sort:!0,columnresize:!0,columndrag:!0,changepage:!0,columnhide:!0,resize:!0},constructor:function(){this.log=this.log||{},this.Super("const",arguments)},init(){this.Super("init",arguments),this.initLog(),this.ons()},ons(){const t=this,e=t.widget;e.on("beforeinit",t.onBeforeInit,t),t.stateful&&(t.log.sort&&e.on("sort",t.onSort,t),t.log.filter&&e.on("filter",t.onFilter,t),t.log.columnresize&&e.on("columnresize",t.onColumnResize,t),t.log.columndrag&&(e.on("columndrag",t.onColumnDrag,t),e.on("lockcolumn",t.onColumnLock,t),e.on("rightlockcolumn",t.onColumnRightLock,t),e.on("unlockcolumn",t.onColumnUnLock,t)),t.log.changepage&&e.on("changepage",t.onChangePage,t),t.log.columnhide&&(e.on("columnhide",t.onColumnHide,t),e.on("columnshow",t.onColumnShow,t)),e.on("columnremove",t.onColumnRemove,t),e.on("columnadd",t.onColumnAdd,t),e.on("init",()=>{e.panel&&t.log.resize&&e.panel.on("resize",t.onResize,t)}),e.on("changewidth",t.onChangeWidth,t),e.on("changeheight",t.onChangeHeight,t))},onSort(){var t=this.widget,e=t.store,i=t.getStateName(),o=localStorage.getItem(i)||"{}";(o=JSON.parse(o)).sorters=JSON.stringify(e.sorters),localStorage.setItem(i,JSON.stringify(o)),this.copyColumns(),this.widget.fire("statechange",this.getState(),"sorters",o.sorters)},onFilter(){var t=this.widget,e=t.store,i=t.getStateName(),o=localStorage.getItem(i)||"{}";(o=JSON.parse(o)).filters=JSON.stringify(e.filters),localStorage.setItem(i,JSON.stringify(o)),this.copyColumns(),this.widget.fire("statechange",this.getState(),"filters",o.filters)},onColumnResize(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnDrag(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnLock(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnRightLock(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnUnLock(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnHide(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnShow(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnRemove(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnAdd(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},copyColumns(){var e=this.widget,i=e.getStateName(),o=localStorage.getItem(i)||"{}";o=JSON.parse(o);const s=e.getColumns(),n=[];t.each(s,e=>{const i={};t.each(e,(e,o)=>{switch(t.typeOf(e)){case"string":case"number":case"boolean":i[o]=e;break;case"object":switch(o){case"filterField":break;default:i[o]="OBJECT"}break;case"array":i[o]="ARRAY";break;case"function":i[o]="FUNCTION"}}),n.push(i)}),o.columns=JSON.stringify(n),localStorage.setItem(i,JSON.stringify(o))},onBeforeInit(){const e=this,i=e.widget,o=i.getStateName(),s=localStorage.getItem(o)||"{}",n=e.startState;"{}"===s&&i.autoColumnWidth&&(i.allowAutoWidthStateIsEmpty=!0);const a=function(){for(var t in n.filters){var e=n.filters[t];for(var o in e)"*"===o&&i.searching?i.addFilter(t,e[o],o,!1):i.addFilter(t,e[o],o)}},g=function(){t.each(n.sorters,t=>{i.sort(t.key,t.dir,!1)})};if(n){if(i.waitingForFilters=!0,i.stateIsWaiting=!0,i.WAIT_FOR_STATE_TO_LOAD&&(n.filters&&(a(),i.store.remoteFilter&&i.store.serverFilter(!1)),n.sorters&&g(),delete i.WAIT_FOR_STATE_TO_LOAD,i.store.loadData()),i.store.loading)return void i.once("load",()=>{e.onBeforeInit()},e);setTimeout(()=>{i.SERVER_FILTER_SORT||(n.filters&&a(),n.sorters&&g()),void 0!==n.page&&i.setPage(Number(n.page),!1),delete i.waitingForFilters,i.store.changeDataView(),delete i.stateIsWaiting,i.update(),i.setSidesHeight()},100)}s.width&&i.setWidth(s.width),s.height&&i.setHeight(s.height)},onChangePage(t,e){var i=this.widget,o=i.getStateName(),s=localStorage.getItem(o)||"{}";void 0!==e&&s&&i.inited&&((s=JSON.parse(s)).page=e+1,localStorage.setItem(o,JSON.stringify(s)),this.widget.fire("statechange",this.getState(),"page",s.page))},onResize(t,e){var i=this.widget,o=i.getStateName(),s=localStorage.getItem(o)||"{}";s=JSON.parse(s),i.responsiveWidth||i.wrapped||(s.width=e.width),i.responsiveHeight||i.wrapped||(s.height=e.height),localStorage.setItem(o,JSON.stringify(s)),this.widget.fire("statechange",this.getState(),"size",[s.width,s.height])},onChangeWidth(t,e){var i=this.widget,o=i.getStateName(),s=localStorage.getItem(o)||"{}";s=JSON.parse(s),i.responsiveWidth||i.wrapped||(s.width=e),localStorage.setItem(o,JSON.stringify(s)),this.widget.fire("statechange",this.getState(),"width",s.width)},onChangeHeight(t,e){var i=this.widget,o=i.getStateName(),s=localStorage.getItem(o)||"{}";s=JSON.parse(s),i.responsiveHeight||i.wrapped||(s.height=e),localStorage.setItem(o,JSON.stringify(s)),this.widget.fire("statechange",this.getState(),"height",s.height)},initLog(){t.applyIf(this.log,this.$log)},getState(){var e=this.widget.getStateName(),i=localStorage.getItem(e)||"{}";return"{}"===i&&(i=this.startState),t.isString(i)?JSON.parse(i):i}})}();