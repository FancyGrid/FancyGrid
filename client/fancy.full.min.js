/*
All of the code within the FancyGrid software is developed and copyrighted by FancyGrid, Inc., and may not be copied,
replicated, or used in any other software or application without prior permission from FancyGrid. All usage must coincide with the
FancyGrid End User License Agreement which can be requested by email at support@fancygrid.com.

Build: 1.7.179
*/

!function(e,t){"object"==typeof module&&module.exports?module.exports=e.document?t(e):t:e.Fancy=t(e)}("undefined"!=typeof window?window:this,function(win){const Fancy={global:window,version:"1.7.179",site:"fancygrid.com",COLORS:["#9DB160","#B26668","#4091BA","#8E658E","#3B8D8B","#ff0066","#eeaaee","#55BF3B","#DF5353","#7798BF","#aaeeee"]};var ua,rv,userAgent,check,isOpera,isIE,isChromium,winNav,vendorName,isIEedge,isIOSChrome,isChrome;return window.Fancy=Fancy,Fancy.apply=((e,t)=>{if(void 0!==t)for(const i in t)e[i]=t[i]}),Fancy.applyIf=((e,t)=>{for(const i in t)void 0===e[i]&&(e[i]=t[i])}),Fancy.namespace=((...e)=>{e.forEach(e=>{let t=e.split("."),i=1,n=t.length;Fancy.global[t[0]]=Fancy.global[t[0]]||{};let s=Fancy.global[t[0]];for(;i<n;i++)s[t[i]]=s[t[i]]||{},s=s[t[i]]})}),Fancy.ns=Fancy.namespace,Fancy.typeOf=(e=>{if(null===e)return"null";const t=typeof e;if("undefined"===t||"string"===t||"number"===t||"boolean"===t)return t;const i=Object.prototype.toString.call(e);if(void 0!==e.length&&"function"!=typeof e)return"array";switch(i){case"[object Array]":return"array";case"[object Date]":return"date";case"[object Boolean]":return"boolean";case"[object Number]":return"number";case"[object RegExp]":return"regexp"}return"function"===t?"function":"object"===t?"object":void 0}),Fancy.isArray="isArray"in Array?Array.isArray:e=>{return"[object Array]"===Object.prototype.toString.call(e)},Fancy.isObject=(e=>{return"[object Object]"===Object.prototype.toString.call(e)}),Fancy.isFunction=(e=>{return"[object Function]"===Object.prototype.toString.apply(e)}),Fancy.isString=(e=>"string"==typeof e),Fancy.isNumber=(e=>"number"==typeof e&&isFinite(e)),Fancy.isDom=(e=>{try{return e instanceof HTMLElement}catch(t){return"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument}}),Fancy.isBoolean=(e=>"boolean"==typeof e),Fancy.isDate=(e=>"date"===Fancy.typeOf(e)),Fancy.each=((e,t)=>{switch(Fancy.typeOf(e)){case"array":case"string":let i=0,n=e.length;for(;i<n&&!0!==t(e[i],i,e);i++);break;case"object":for(const i in e)if(!0===t(e[i],i,e))break}}),Fancy.mixin=((e,t)=>{let i,n=0,s=t.length;if("object"===Fancy.typeOf(t[0]))for(;n<s;n++)for(var r=(i=t[n])._class,o=i.methods,a=0,l=o.length;a<l;a++){const t=o[a];e[t]=r.prototype[t]}else for(;n<s;n++)if(i=t[n],Fancy.isString(i)){const t=Fancy.ClassManager.getMixin(i);t?Fancy.apply(e,t.prototype):Fancy.ClassManager.waitMixin(i,e)}else Fancy.apply(e,i.prototype)}),Fancy.Mixin=((e,t)=>{const i=e.split(".");let n=1,s=i.length-1;Fancy.ns(e);let r=Fancy.global[i[0]];for(;n<s;n++)r=r[i[n]];i.length>1?(r[i[i.length-1]]=function(){},r[i[i.length-1]].prototype=t):(Fancy.global[i[0]]=function(){},Fancy.global[i[0]].prototype=t);let o=Fancy.ClassManager.waitMixins[e];if(o)for(n=0,s=(o=o.waiters).length;n<s;n++)Fancy.apply(o[n],t)}),Fancy.applyConfig=((e,t={})=>{if(e.plugins&&t.plugins&&(e.plugins=e.plugins.concat(t.plugins),delete t.plugins),!0===e._isConfigApplied)return e;for(const i in t)e[i]=t[i];return e._isConfigApplied=!0,e}),Fancy.styleToString=((e={})=>{let t="";for(const i in e)t+=`${i}: ${e[i]};`;return t}),Fancy.newEl=(e=>Fancy.get(document.createElement(e))),Fancy.newDomEl=(e=>document.createElement(e)),Fancy.apply(Fancy,{prefix:"fancy-gen-",idSeed:0,zIndex:1,id:(e,t)=>e?((e=e.dom||{}).id||(e.id=(t||Fancy.prefix)+ ++Fancy.idSeed),e.id):(t||Fancy.prefix)+ ++Fancy.idSeed}),Fancy.apply(Fancy,{cls:"fancy",TOUCH_CLS:"fancy-touch",HIDDEN_CLS:"fancy-display-none",CLEARFIX_CLS:"fancy-clearfix",MODAL_CLS:"fancy-modal",PANEL_CLS:"fancy-panel",PANEL_BODY_CLS:"fancy-panel-body",PANEL_BODY_INNER_CLS:"fancy-panel-body-inner",PANEL_GRID_INSIDE_CLS:"fancy-panel-grid-inside",PANEL_SHADOW_CLS:"fancy-panel-shadow",PANEL_SUB_HEADER_CLS:"fancy-panel-sub-header",PANEL_SUB_HEADER_TEXT_CLS:"fancy-panel-sub-header-text",PANEL_HEADER_CLS:"fancy-panel-header",PANEL_HEADER_IMG_CLS:"fancy-panel-header-img",PANEL_HEADER_TEXT_CLS:"fancy-panel-header-text",PANEL_HEADER_TOOLS_CLS:"fancy-panel-header-tools",PANEL_TBAR_CLS:"fancy-panel-tbar",PANEL_BBAR_CLS:"fancy-panel-bbar",PANEL_SUB_TBAR_CLS:"fancy-panel-sub-tbar",PANEL_BAR_PAGING_CLS:"fancy-panel-bar-paging",PANEL_BUTTONS_CLS:"fancy-panel-buttons",PANEL_NOFRAME_CLS:"fancy-panel-noframe",PANEL_FOOTER_CLS:"fancy-panel-footer",PANEL_TAB_CLS:"fancy-panel-tab",PANEL_DRAGGABLE_CLS:"fancy-panel-draggable",BAR_CLS:"fancy-bar",BAR_TEXT_CLS:"fancy-bar-text",BAR_CONTAINER_CLS:"fancy-bar-container",BAR_BUTTON_CLS:"fancy-bar-button",BAR_SEG_BUTTON_CLS:"fancy-bar-seg-button",BAR_LEFT_SCROLLER_CLS:"fancy-bar-left-scroller",BAR_RIGHT_SCROLLER_CLS:"fancy-bar-right-scroller",FORM_CLS:"fancy-form",FORM_BODY_CLS:"fancy-form-body",FORM_PANEL_CLS:"fancy-form-panel",FIELD_CLS:"fancy-field",FIELD_LABEL_CLS:"fancy-field-label",FIELD_EMPTY_CLS:"fancy-field-empty",FIELD_DISABLED_CLS:"fancy-field-disabled",FIELD_BLANK_ERR_CLS:"fancy-field-blank-err",FIELD_NOT_VALID_CLS:"fancy-field-not-valid",FIELD_TEXT_CLS:"fancy-field-text",FIELD_TEXT_INPUT_CLS:"fancy-field-text-input",FIELD_ERROR_CLS:"fancy-field-error",FIELD_SPIN_CLS:"fancy-field-spin",FIELD_SPIN_UP_CLS:"fancy-field-spin-up",FIELD_SPIN_DOWN_CLS:"fancy-field-spin-down",FIELD_CHECKBOX_CLS:"fancy-field-checkbox",FIELD_CHECKBOX_DISABLED_CLS:"fancy-field-checkbox-disabled",FIELD_CHECKBOX_INPUT_CLS:"fancy-field-checkbox-input",FIELD_CHECKBOX_ON_CLS:"fancy-checkbox-on",FIELD_CHECKBOX_MIDDLE_CLS:"fancy-checkbox-middle",FIELD_INPUT_LABEL_CLS:"fancy-field-input-label",FIELD_BUTTON_CLS:"fancy-field-button",FIELD_TAB_CLS:"fancy-field-tab",FIELD_COMBO_CLS:"fancy-combo",FIELD_COMBO_SELECTED_ITEM_CLS:"fancy-combo-item-selected",FIELD_COMBO_FOCUSED_ITEM_CLS:"fancy-combo-item-focused",FIELD_COMBO_DROPDOWN_BUTTON_CLS:"fancy-combo-dropdown-button",FIELD_COMBO_INPUT_CONTAINER_CLS:"fancy-combo-input-container",FIELD_COMBO_LIST_VALUE_CLS:"fancy-combo-list-value",FIELD_COMBO_LEFT_EL_CLS:"fancy-combo-left-el",FIELD_COMBO_RESULT_LIST_CLS:"fancy-combo-result-list",FIELD_SEARCH_CLS:"fancy-field-search",FIELD_SEARCH_LIST_CLS:"fancy-field-search-list",FIELD_SEARCH_PARAMS_LINK_CLS:"fancy-field-search-params-link",FIELD_SEARCH_PARAMED_CLS:"fancy-field-search-paramed",FIELD_SEARCH_PARAMED_EMPTY_CLS:"fancy-field-search-paramed-empty",FIELD_PICKER_BUTTON_CLS:"fancy-field-picker-button",FIELD_LABEL_ALIGN_TOP_CLS:"fancy-field-label-align-top",FIELD_LABEL_ALIGN_RIGHT_CLS:"fancy-field-label-align-right",FIELD_TEXTAREA_CLS:"fancy-textarea",FIELD_TEXTAREA_TEXT_CLS:"fancy-textarea-text",FIELD_TEXTAREA_TEXT_INPUT_CLS:"fancy-textarea-text-input",FIELD_RADIO_CLS:"fancy-field-radio",FIELD_RADIO_COLUMN_CLS:"fancy-field-radio-column",FIELD_RADIO_ON_CLS:"fancy-field-radio-on",FIELD_RADIO_INPUT_CLS:"fancy-field-radio-input",FIELD_TAB_ACTIVE_CLS:"fancy-field-tab-active",GRID_CLS:"fancy-grid",GRID_ANIMATION_CLS:"fancy-grid-animation",GRID_UNSELECTABLE_CLS:"fancy-grid-unselectable",GRID_EMPTY_CLS:"fancy-grid-empty-text",GRID_LEFT_EMPTY_CLS:"fancy-grid-left-empty",GRID_RIGHT_EMPTY_CLS:"fancy-grid-right-empty",GRID_CENTER_CLS:"fancy-grid-center",GRID_LEFT_CLS:"fancy-grid-left",GRID_RIGHT_CLS:"fancy-grid-right",GRID_RESIZER_LEFT_CLS:"fancy-grid-resizer-left",GRID_RESIZER_RIGHT_CLS:"fancy-grid-resizer-right",GRID_STATE_DRAG_COLUMN_CLS:"fancy-grid-state-drag-column",GRID_STATE_RESIZE_COLUMN_CLS:"fancy-grid-state-resize-column",GRID_STATE_SORTED_CLS:"fancy-grid-state-sorted",GRID_STATE_FILTERED_CLS:"fancy-grid-state-filtered",GRID_COPY_TEXTAREA:"fancy-grid-copy-textarea",GRID_HEADER_CLS:"fancy-grid-header",GRID_HEADER_CELL_CLS:"fancy-grid-header-cell",GRID_HEADER_CELL_CONTAINER_CLS:"fancy-grid-header-cell-container",GRID_HEADER_CELL_TEXT_CLS:"fancy-grid-header-cell-text",GRID_HEADER_CELL_LEFT_IMAGE_CLS:"fancy-grid-header-cell-left-image",GRID_HEADER_CELL_CONTAINS_LI:"fancy-grid-header-cell-contains-left-image",GRID_HEADER_CELL_DOUBLE_CLS:"fancy-grid-header-cell-double",GRID_HEADER_CELL_TRIPLE_CLS:"fancy-grid-header-cell-triple",GRID_HEADER_CELL_TRIGGER_CLS:"fancy-grid-header-cell-trigger",GRID_HEADER_CELL_TRIGGER_IMAGE_CLS:"fancy-grid-header-cell-trigger-image",GRID_HEADER_CELL_TRIGGER_DISABLED_CLS:"fancy-grid-header-cell-trigger-disabled",GRID_HEADER_CELL_GROUP_LEVEL_1_CLS:"fancy-grid-header-cell-group-level-1",GRID_HEADER_CELL_GROUP_LEVEL_2_CLS:"fancy-grid-header-cell-group-level-2",GRID_HEADER_CELL_SELECT_CLS:"fancy-grid-header-cell-select",GRID_HEADER_CELL_TRIGGER_UP_CLS:"fancy-grid-header-cell-trigger-up",GRID_HEADER_CELL_TRIGGER_DOWN_CLS:"fancy-grid-header-cell-trigger-down",GRID_HEADER_COLUMN_TRIGGERED_CLS:"fancy-grid-header-column-triggered",GRID_HEADER_CELL_FILTER_CLS:"fancy-grid-header-filter-cell",GRID_HEADER_CELL_FILTER_FULL_CLS:"fancy-grid-header-filter-cell-full",GRID_HEADER_CELL_FILTER_SMALL_CLS:"fancy-grid-header-filter-cell-small",GRID_HEADER_CELL_CHECKBOX_CLS:"fancy-grid-header-cell-checkbox",GRID_HEADER_CELL_SORTABLE_CLS:"fancy-grid-header-cell-sortable",GRID_HEADER_CELL_NOT_SORTABLE_CLS:"fancy-grid-header-cell-not-sortable",GRID_HEADER_CELL_FILTERED_CLS:"fancy-grid-header-cell-filtered",GRID_SUB_HEADER_FILTER_CLS:"fancy-grid-sub-header-filter",GRID_SUB_HEADER_FILTER_CONTAINER_CLS:"fancy-grid-sub-header-filter-container",GRID_CELL_CLS:"fancy-grid-cell",GRID_CELL_INNER_CLS:"fancy-grid-cell-inner",GRID_CELL_OVER_CLS:"fancy-grid-cell-over",GRID_CELL_SELECTED_CLS:"fancy-grid-cell-selected",GRID_CELL_ACTIVE_CLS:"fancy-grid-cell-active",GRID_CELL_EVEN_CLS:"fancy-grid-cell-even",GRID_CELL_WRAPPER_CLS:"fancy-grid-cell-wrapper",GRID_CELL_DIRTY_CLS:"fancy-grid-cell-dirty",GRID_CELL_DIRTY_EL_CLS:"fancy-grid-cell-dirty-el",GRID_PSEUDO_CELL_CLS:"fancy-grid-pseudo-cell",GRID_COLUMN_CLS:"fancy-grid-column",GRID_COLUMN_OVER_CLS:"fancy-grid-column-over",GRID_COLUMN_SELECT_CLS:"fancy-grid-column-select",GRID_COLUMN_SELECTED_CLS:"fancy-grid-column-selected",GRID_COLUMN_ELLIPSIS_CLS:"fancy-grid-column-ellipsis",GRID_COLUMN_ORDER_CLS:"fancy-grid-column-order",GRID_COLUMN_TEXT_CLS:"fancy-grid-column-text",GRID_COLUMN_SORT_ASC:"fancy-grid-column-sort-ASC",GRID_COLUMN_SORT_DESC:"fancy-grid-column-sort-DESC",GRID_COLUMN_COLOR_CLS:"fancy-grid-column-color",GRID_COLUMN_RESIZER_CLS:"fancy-grid-column-resizer",GRID_COLUMN_ROW_DRAG_CLS:"fancy-grid-column-row-drag",GRID_ROW_DRAG_EL_CLS:"fancy-grid-row-drag-el",GRID_COLUMN_TREE_CLS:"fancy-grid-column-tree",GRID_COLUMN_TREE_EXPANDER_CLS:"fancy-grid-tree-expander",GRID_COLUMN_SPARKLINE_CLS:"fancy-grid-column-sparkline",GRID_COLUMN_SPARKLINE_BULLET_CLS:"fancy-grid-column-sparkline-bullet",GRID_COLUMN_SPARK_PROGRESS_DONUT_CLS:"fancy-grid-column-spark-progress-donut",GRID_COLUMN_CHART_CIRCLE_CLS:"fancy-grid-column-chart-circle",GRID_COLUMN_GROSSLOSS_CLS:"fancy-grid-column-grossloss",GRID_COLUMN_PROGRESS_CLS:"fancy-grid-column-progress",GRID_COLUMN_PROGRESS_BAR_CLS:"fancy-grid-column-progress-bar",GRID_COLUMN_H_BAR_CLS:"fancy-grid-column-h-bar",GRID_COLUMN_ACTION_ITEM_CLS:"fancy-grid-column-action-item",GRID_ROW_OVER_CLS:"fancy-grid-cell-over",GRID_ROW_EDIT_CLS:"fancy-grid-row-edit",GRID_ROW_EDIT_BUTTONS_CLS:"fancy-grid-row-edit-buttons",GRID_ROW_EDIT_BUTTON_UPDATE_CLS:"fancy-edit-row-button-update",GRID_ROW_EDIT_BUTTON_CANCEL_CLS:"fancy-edit-row-button-cancel",GRID_ROW_GROUP_CLS:"fancy-grid-group-row",GRID_ROW_GROUP_INNER_CLS:"fancy-grid-group-row-inner",GRID_ROW_GROUP_COLLAPSED_CLS:"fancy-grid-group-row-collapsed",GRID_ROW_SUMMARY_CLS:"fancy-grid-summary-row",GRID_ROW_SUMMARY_CONTAINER_CLS:"fancy-grid-summary-container",GRID_ROW_SUMMARY_BOTTOM_CLS:"fancy-grid-summary-row-bottom",GRID_ROW_EXPAND_CLS:"fancy-grid-expand-row",GRID_ROW_EXPAND_OVER_CLS:"fancy-grid-expand-row-over",GRID_ROW_EXPAND_SELECTED_CLS:"fancy-grid-expand-row-selected",GRID_BODY_CLS:"fancy-grid-body",GRID_ACTIVE_CELL_ENABLED:"fancy-grid-active-cell-enabled",MENU_CLS:"fancy-menu",MENU_ITEM_CLS:"fancy-menu-item",MENU_ITEM_IMAGE_CLS:"fancy-menu-item-image",MENU_ITEM_TEXT_CLS:"fancy-menu-item-text",MENU_ITEM_SIDE_TEXT_CLS:"fancy-menu-item-side-text",MENU_ITEM_ACTIVE_CLS:"fancy-menu-item-active",MENU_ITEM_RIGHT_IMAGE_CLS:"fancy-menu-item-right-image",MENU_ITEM_EXPAND_CLS:"fancy-menu-item-expand",MENU_ITEM_DISABLED_CLS:"fancy-menu-item-disabled",MENU_ITEM_SEP_CLS:"fancy-menu-item-sep",MENU_ITEM_NO_IMAGE_CLS:"fancy-menu-item-no-image",MENU_ITEM_IMG_COPY_CLS:"fancy-menu-item-img-copy",MENU_ITEM_IMG_DELETE_CLS:"fancy-menu-item-img-delete",MENU_ITEM_IMG_DUPLICATE_CLS:"fancy-menu-item-img-duplicate",MENU_ITEM_IMG_EDIT_CLS:"fancy-menu-item-img-edit",TAB_WRAPPER_CLS:"fancy-tab-wrapper",TAB_ACTIVE_WRAPPER_CLS:"fancy-active-tab-wrapper",TAB_TBAR_CLS:"fancy-toolbar-tab",TAB_TBAR_ACTIVE_CLS:"fancy-toolbar-tab-active",BUTTON_CLS:"fancy-button",BUTTON_DISABLED_CLS:"fancy-button-disabled",BUTTON_PRESSED_CLS:"fancy-button-pressed",BUTTON_IMAGE_CLS:"fancy-button-image",BUTTON_IMAGE_COLOR_CLS:"fancy-button-image-color",BUTTON_TEXT_CLS:"fancy-button-text",BUTTON_DROP_CLS:"fancy-button-drop",BUTTON_MENU_CLS:"fancy-button-menu",SEG_BUTTON_CLS:"fancy-seg-button",TOOLTIP_CLS:"fancy-tooltip",TOOLTIP_INNER_CLS:"fancy-tooltip-inner",SEPARATOR_CLS:"fancy-separator",FOOTER_STATUS_CLS:"fancy-footer-status",STATUS_SOURCE_TEXT_CLS:"fancy-status-source-text",STATUS_SOURCE_LINK_CLS:"fancy-status-source-link",FOOTER_SOURCE_CLS:"fancy-footer-source",PICKER_MONTH_CELL_ACTIVE_CLS:"fancy-month-picker-cell-active",PICKER_MONTH_CLS:"fancy-month-picker",PICKER_BUTTON_BACK_CLS:"fancy-picker-button-back",PICKER_BUTTON_NEXT_CLS:"fancy-picker-button-next",PICKER_MONTH_ACTION_BUTTONS_CLS:"fancy-month-picker-action-buttons",PICKER_DATE_CLS:"fancy-date-picker",PICKER_DATE_CELL_TODAY_CLS:"fancy-date-picker-cell-today",PICKER_DATE_CELL_ACTIVE_CLS:"fancy-date-picker-cell-active",PICKER_DATE_CELL_OUT_RANGE_CLS:"fancy-date-picker-cell-out-range",PICKER_BUTTON_DATE_CLS:"fancy-picker-button-date",PICKER_BUTTON_DATE_WRAPPER_CLS:"fancy-picker-button-date-wrapper",PICKER_BUTTON_TODAY_CLS:"fancy-picker-button-today",PICKER_BUTTON_TODAY_WRAPPER_CLS:"fancy-picker-button-today-wrapper"}),Fancy.ANIMATE_DURATION=400,userAgent=navigator.userAgent.toLowerCase(),check=function(e){return e.test(userAgent)},isOpera=check(/opera/),isIE=!isOpera&&check(/msie/),isChromium=window.chrome,winNav=window.navigator,vendorName=winNav.vendor,isIEedge=winNav.userAgent.indexOf("Edge")>-1,isIOSChrome=winNav.userAgent.match("CriOS"),isChrome=function(){const e=winNav.userAgent.indexOf("OPR")>-1;return!!isIOSChrome||null!==isChromium&&void 0!==isChromium&&"Google Inc."===vendorName&&!1===e&&!1===isIEedge}(),11===(rv=-1,"Microsoft Internet Explorer"==navigator.appName?(ua=navigator.userAgent,null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(ua)&&(rv=parseFloat(RegExp.$1))):"Netscape"==navigator.appName&&(ua=navigator.userAgent,null!=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(ua)&&(rv=parseFloat(RegExp.$1))),rv)&&(isIE=!0),!1===isIE&&isIEedge&&(isIE=!0),Fancy.apply(Fancy,{isOpera:isOpera,isIE:isIE,isChrome:isChrome}),Fancy.getViewSize=(()=>{const e=[];return Fancy.isIE?(e[0]=document.documentElement.clientHeight,e[1]=document.documentElement.clientWidth):(e[0]=window.innerHeight,e[1]=window.innerWidth),e}),Fancy.getScroll=(()=>{const e=document.documentElement,t=document.body;return e&&(e.scrollTop||e.scrollLeft)?[e.scrollTop,e.scrollLeft]:t?[t.scrollTop,t.scrollLeft]:[0,0]}),Fancy.getMouseWheelEventName=(()=>"onmousewheel"in document.body?"mousewheel":"DOMMouseScroll"),Fancy.getWheelDelta=(e=>{let t=0;return e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),t}),Fancy.isTouch=void 0!==document.ontouchstart,Fancy.i18n={},Fancy.currency={EUR:"€",USD:"$",GBP:"£",RUB:"₽",CZK:"Kč",AUD:"$",JPY:"¥",PLN:"zł",TRY:"₺",DKK:"kr",KRW:"₩",BRL:"R$",CNY:"¥",SEK:"kr",CAD:"$",NOK:"kr",IDR:"Rp"},Fancy.modules={},Fancy.getModulesList=(()=>{const e=[];return Fancy.each(Fancy.modules,(t,i)=>{e.push(i)}),e}),function(){const e={};Fancy.loadModule=function(t,i){var n=document.getElementsByTagName("body")[0],s=document.createElement("script"),r=t,o=Fancy.DEBUG?".js":".min.js",a=Fancy.version.replace(/\./g,""),l=Fancy.MODULESDIR||FancyGrid.MODULESDIR||`https://cdn.jsdelivr.net/npm/fancygrid@${Fancy.version}/client/modules/`;i=i||function(){},!1!==Fancy.MODULELOAD&&!1!==Fancy.MODULESLOAD&&(t=t.replace(/ /g,"-"),Fancy.DEBUG?o+="?_dc="+ +new Date:o+=`?_v=${a}`,Fancy.Modules.on("loaded",(e,n)=>{n===t&&(Fancy.modules[r]=!0,i(t))}),e[t]||(e[t]=!0,s.src=l+t+o,s.charset="utf-8",s.onload=(()=>{Fancy.Modules.fire("loaded",t)}),s.onerror=(()=>{throw new Error(`[FancyGrid Error] - module ${t} was not loaded`)}),n.appendChild(s)))},Fancy.loadLang=((e,t)=>{if(void 0!==Fancy.i18n[e])return!0;const i=document.getElementsByTagName("body")[0],n=document.createElement("script"),s=Fancy.MODULESDIR||FancyGrid.MODULESDIR||`https://cdn.jsdelivr.net/npm/fancygrid@${Fancy.version}/client/modules/`;n.src=`${s}i18n/${e}.js`,n.charset="utf-8",n.async="true",n.onload=(()=>{t({lang:Fancy.i18n[e]})}),i.appendChild(n)}),Fancy.loadStyle=(()=>{let e=document.querySelectorAll("link");if(!Fancy.stylesLoaded&&(e.forEach(e=>{/fancy\./.test(e.href)&&(Fancy.stylesLoaded=!0)}),e=document.querySelectorAll("link"),!Fancy.stylesLoaded&&(e.forEach(e=>{/fancy\./.test(e.href)&&(Fancy.stylesLoaded=!0)}),!Fancy.stylesLoaded))){var t=document.getElementsByTagName("head")[0],i=document.createElement("link"),n=Fancy.DEBUG?".css":".min.css",s=Fancy.version.replace(/\./g,""),r=Fancy.MODULESDIR||FancyGrid.MODULESDIR||`https://cdn.jsdelivr.net/npm/fancygrid@${Fancy.version}/client/modules/`;r=(r=r.replace("modules/","")).replace("modules",""),Fancy.DEBUG?n+="?_dc="+ +new Date:n+=`?_v=${s}`,i.href=r+"fancy"+n,i.rel="stylesheet",Fancy.loadingStyle=!0,i.onload=(()=>{setTimeout(()=>{Fancy.loadingStyle=!1,Fancy.stylesLoaded=!0},100)}),t.appendChild(i)}}),Fancy.error=((e,t)=>{throw new Error(`[FancyGrid Error${t?" {code}":""}]: ${e}`)})}(),Fancy.fullBuilt=!0,Fancy.themes={},Fancy.defineTheme=((e,t)=>{const i={};t.extend?(Fancy.apply(i,Fancy.getTheme(t.extend).config),i.extendedThemes=i.extendedThemes||[],i.extendedThemes.push(t.extend)):"default"!==e&&Fancy.apply(i,Fancy.getTheme("default").config),Fancy.apply(i,t.config),t.config=i,Fancy.themes[e]=t}),Fancy.getThemeCSSCls=(e=>{const t=Fancy.getTheme(e);let i=`fancy-theme-${e}`;return t&&t.config.extendedThemes&&Fancy.each(t.config.extendedThemes,e=>{i+=` fancy-theme-${e}`}),i}),Fancy.getTheme=(e=>{const t={config:{}};return Fancy.isObject(e)?(Fancy.applyIf(t,Fancy.themes[e.name||"default"]),Fancy.apply(t.config,Fancy.themes[e.name||"default"].config),Fancy.apply(t.config,e.config),t):Fancy.themes[e]}),Fancy.defineTheme("default",{config:{cellHeaderHeight:30,cellWidth:70,minCellWidth:40,cellHeight:32,titleHeight:42,subTitleHeight:42,barHeight:38,bottomScrollHeight:12,minCenterWidth:100,panelBorderWidth:2,groupRowHeight:31,gridBorders:[1,1,1,1],gridWithoutPanelBorders:[1,1,1,1],panelBodyBorders:[0,2,2,2],knobOffSet:2,fieldHeight:37,charWidth:7,menuItemHeight:30}}),Fancy.defineTheme("blue",{config:{panelBorderWidth:1,gridBorders:[1,1,1,1],gridWithoutPanelBorders:[1,1,1,1],panelBodyBorders:[0,0,0,0],charWidth:7,menuItemHeight:30}}),Fancy.defineTheme("gray",{config:{panelBorderWidth:0,gridBorders:[0,0,1,0],gridWithoutPanelBorders:[1,1,1,1],panelBodyBorders:[0,0,0,0],charWidth:7,menuItemHeight:30}}),Fancy.defineTheme("extra-gray",{config:{panelBorderWidth:0,gridBorders:[0,0,1,0],gridWithoutPanelBorders:[1,1,1,1],panelBodyBorders:[0,0,0,0],charWidth:7,menuItemHeight:27,titleHeight:32,subTitleHeight:32,cellHeight:28,cellHeaderHeight:28,barHeight:32,datePickerHeight:287}}),Fancy.defineTheme("extra-dark",{extend:"extra-gray",config:{}}),Fancy.defineTheme("dark",{config:{panelBorderWidth:1,gridBorders:[1,1,1,1],gridWithoutPanelBorders:[1,1,1,1],panelBodyBorders:[0,0,0,0],charWidth:7,menuItemHeight:30}}),Fancy.defineTheme("sand",{config:{panelBorderWidth:1,gridBorders:[0,1,1,1],gridWithoutPanelBorders:[1,1,1,1],panelBodyBorders:[0,0,0,0],charWidth:7,menuItemHeight:30}}),Fancy.defineTheme("bootstrap",{config:{panelBorderWidth:1,gridBorders:[1,1,1,1],gridWithoutPanelBorders:[1,1,1,1],panelBodyBorders:[0,0,0,0],charWidth:7,menuItemHeight:30}}),Fancy.defineTheme("bootstrap-no-borders",{config:{panelBorderWidth:0,gridBorders:[0,0,0,0],gridWithoutPanelBorders:[0,0,0,0],panelBodyBorders:[0,0,0,0],columnLines:!1,charWidth:8,menuItemHeight:30}}),Fancy.defineTheme("material",{config:{columnLines:!1,cellHeaderHeight:40,panelBorderWidth:0,cellHeight:40,titleHeight:48,barHeight:48,subTitleHeight:48,groupRowHeight:40,gridBorders:[1,0,1,0],gridWithoutPanelBorders:[1,1,1,1],panelBodyBorders:[0,0,0,0],charWidth:7,menuItemHeight:35}}),Fancy.String={format(e){var t,i,n;if("array"===Fancy.typeOf(arguments[1]))t=arguments[1];else for(n=arguments.length,t=[],i=1;i<n;i++)t[i-1]=arguments[i];return e.replace(/\[(\d+)]/g,function(e,i){return t[i]})},upFirstChar:e=>e[0].toLocaleUpperCase()+e.substr(1,e.length),trim:e=>e.replace(/\s/g,"")},Fancy.Array={copy(e,t){if(!t)return e.slice();let i=[],n=0,s=e.length;for(;n<s;n++)switch(Fancy.typeOf(e[n])){case"object":i[n]=Fancy.Object.copy(e[n]);break;case"array":i[n]=Fancy.Array.copy(e[n]);break;default:i=e[n]}return i},each(e,t){e.forEach((e,i)=>{t(e,i)})},count:e=>e.length,sum(e){var t=0,i=e.length,n=0;if(Fancy.isArray(e[0]))for(n=[];t<i;t++)for(var s=0,r=e[t].length;s<r;s++)void 0===n[s]&&(n[s]=0),n[s]+=e[t][s];else for(;t<i;t++)!1!==Fancy.isNumber(e[t])&&(n+=e[t]);return n},min(e){return Math.min.apply(this,e)},max(e){return Math.max.apply(this,e)},average(e){for(var t=0,i=0,n=e.length;i<n;i++)!1!==Fancy.isNumber(e[i])&&(t+=e[i]);return Math.round(t/e.length)},insert(e,t,i){const n=e.splice(t,e.length-t);return e=e.concat(i).concat(n)}},Fancy.Object={copy(e){const t={};for(const i in e)t[i]=e[i];return t},isEmpty(e){for(const t in e)return!1;return!0},keys(e){if(Object.keys)return Object.keys(e);const t=[];for(const i in e)t.push(i);return t}},Fancy.modules.date=!0,Fancy.Date={daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],dayIndexes:["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],format(e,t,i,n){var s,r,o,a,l,d,c,h,u,g,p="";if(n=n||"",null===e||void 0===e)return"";if("Invalid Date"===e.toString())return"";n=n.toLocaleLowerCase(),void 0===i?i=Fancy.i18n.en:Fancy.isString(i)&&(i=Fancy.i18n[i]);for(var m=0,f=t.length;m<f;m++){var y=t[m];switch(y){case"i":p+=(r=e.getMinutes())<10?"0"+r:r;break;case"s":if(r=e.getSeconds(),"sql"===n){if("ss"!==t.substr(m,2))throw new Error("[FancyGrid Error] - Invalid date format: "+t);p+=r<10?"0"+r:r,m++}else p+=r<10?"0"+r:r;break;case"S":if(r=e.getSeconds(),"sql"!==n)throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);if("SS"!==t.substr(m,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);p+=r<10?"0"+r:r,m++;break;case"a":p+=(s=e.getHours())<12?i.date.am:i.date.pm;break;case"A":p+=(s=e.getHours())<12?i.date.AM:i.date.PM;break;case"n":p+=e.getMonth();break;case"j":p+=e.getDate();break;case"m":if(g=e.getMonth()+1,"sql"===n)if("mm"===t.substr(m,2))g<10&&(g="0"+g),p+=g,m++;else{if("mi"!==t.substr(m,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);p+=(r=e.getMinutes())<10?"0"+r:r,m++}else g<10&&(g="0"+g),p+=g;break;case"d":if(u=e.getDate(),"sql"===n){if("dd"!==t.substr(m,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);u<10&&(u="0"+u),p+=u,m++}else u<10&&(u="0"+u),p+=u;break;case"Y":if("sql"===n)if("YYYY"===t.substr(m,4))p+=e.getFullYear(),m+=3;else{if("YY"!==t.substr(0,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);String(e.getFullYear()).substr(2,p.length),m+=1}else p+=e.getFullYear();break;case"y":if("sql"===n)if("yyyy"===t.substr(m,4))p+=e.getFullYear(),m+=3;else{if("yy"!==t.substr(0,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);String(e.getFullYear()).substr(2,4),m+=1}else p+=String(e.getFullYear()).substr(2,4);break;case"D":if(o=e.getDay(),"sql"===n){if("DD"!==t.substr(m,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);p+=i.date.days[o].substr(0,3),m++}else p+=i.date.days[o].substr(0,3);break;case"l":a=e.getDay(),p+=i.date.days[a];break;case"N":0===(l=e.getDay())&&(l=7),p+=l;break;case"w":p+=e.getDay();break;case"F":d=e.getMonth(),p+=i.date.months[d];break;case"M":if(c=e.getMonth(),"sql"===n)if("MM"===t.substr(m,2))p+=i.date.months[c].substr(0,3),m+=1;else{if("MI"!==t.substr(m,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);p+=(r=e.getMinutes())<10?"0"+r:r,m++}else p+=i.date.months[c].substr(0,3);break;case"t":p+="sql"===n?" ":new Date(e.getFullYear(),e.getMonth(),0).getDate();break;case"T":if("sql"!==n)throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);p+=" ";break;case"g":p+=e.getHours()%12;break;case"G":p+=e.getHours();break;case"h":if(s=e.getHours(),"sql"===n){if("hh"!==t.substr(m,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);p+=s>12?s-12:s>9&&s<13?s:"0"+s,m+=1}else p+=s>12?s-12:s>9&&s<13?s:"0"+s;break;case"H":if(h=e.getHours(),"sql"===n){if("HH"!==t.substr(m,2))throw new Error("[FancyGrid Error] - Invalid date format: "+t);p+=h<10?"0"+h:h,m+=1}else p+=h<10?"0"+h:h;break;case"u":p+=e.getMilliseconds();break;case"U":p+=Number(e)/1e3;break;default:p+=y}}return p},parse(e,t,i=""){var n=new Date,s=n.getFullYear(),r=n.getMonth(),o=n.getDate(),a=0,l=0,d=0,c=0;i=i.toLocaleLowerCase();for(var h=0,u=t.length;h<u;h++){var g,p,m;switch(t[h]){case"n":var f;"0"===e[1]||"1"===e[1]||"2"===e[1]?(f=e[0]+e[1],e=e.substr(2,e.length)):(f=e[0],e=e.substr(1,e.length)),r=Number(f);break;case"j":Fancy.isNumber(parseInt(e[1]))?(g=e[0]+e[1],e=e.substr(2,e.length)):(g=e[0],e=e.substr(1,e.length)),o=Number(g);break;case"h":if("sql"===i){if("hh"!==t.substr(h,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);isNaN(Number(e[1]))?(v=e[0],e=e.substr(1,e.length)):(v=e[0]+e[1],e=e.substr(2,e.length),h+=1),a=Number(v)}else{"0"===e[1]||"1"===e[1]||"2"===e[1]?(v=e[0]+e[1],e=e.substr(2,e.length)):(v=e[0],e=e.substr(1,e.length)),a=Number(v)}break;case"a":"m"===e[1]&&(a+=12),e=e.substr(2,e.length);break;case"A":"M"===e[1]&&(a+=12),e=e.substr(2,e.length);break;case"i":l=e[0]+e[1],e=e.substr(2,e.length);break;case"s":if("sql"===i){if("ss"!==t.substr(h,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);d=e[0]+e[1],e=e.substr(2,e.length),h++}else d=e[0]+e[1],e=e.substr(2,e.length);break;case"S":if("sql"===i){if("SS"!==t.substr(h,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);d=e[0]+e[1],e=e.substr(2,e.length),h++}else d=e[0]+e[1],e=e.substr(2,e.length);break;case"u":c=e[0]+e[1]+e[2],e=e.substr(3,e.length);break;case"m":if("sql"===i)if("mm"===t.substr(h,2))switch(e[0]){case"0":case"1":case"2":case"3":isNaN(parseInt(e[1]))?(r=Number(e[0])-1,e=e.substr(1,e.length)):(r=Number(e[0]+e[1])-1,e=e.substr(2,e.length)),h+=1;break;default:r=Number(e[0])-1,e=e.substr(1,e.length)}else{if("mi"!==t.substr(h,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);l=e[0]+e[1],e=e.substr(2,e.length),h++}else switch(e[0]){case"0":case"1":case"2":case"3":isNaN(parseInt(e[1]))?(r=Number(e[0])-1,e=e.substr(1,e.length)):(r=Number(e[0]+e[1])-1,e=e.substr(2,e.length));break;default:r=Number(e[0])-1,e=e.substr(1,e.length)}break;case"d":if("sql"===i){if("dd"!==t.substr(h,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);isNaN(parseInt(e[1]))?(o=Number(e[0]),e=e.substr(1,e.length)):(o=Number(e[0]+e[1]),e=e.substr(2,e.length)),h++}else isNaN(parseInt(e[1]))?(o=Number(e[0]),e=e.substr(1,e.length)):(o=Number(e[0]+e[1]),e=e.substr(2,e.length));break;case"Y":if("sql"===i)if("YYYY"===t.substr(h,4))s=Number(e[0]+e[1]+e[2]+e[3]),e=e.substr(4,e.length),h+=3;else{if("YY"!==t.substr(0,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);s=Number(e[0]+e[1]),e=e.substr(2,e.length),h+=1,s=s<51?Number("20"+s):Number("19"+s)}else s=Number(e[0]+e[1]+e[2]+e[3]),e=e.substr(4,e.length);break;case"y":if("sql"===i)if("yyyy"===t.substr(h,4))s=Number(e[0]+e[1]+e[2]+e[3]),e=e.substr(4,e.length),h+=3;else{if("yy"!==t.substr(0,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);s=Number(e[0]+e[1]),e=e.substr(2,e.length),h+=1,s=s<51?Number("20"+s):Number("19"+s)}else s=(s=Number(e[0]+e[1]))<51?Number("20"+s):Number("19"+s),e=e.substr(2,e.length);break;case"D":if("sql"===i){if("DD"!==t.substr(h,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);isNaN(parseInt(e[1]))?(o=Number(e[0]),e=e.substr(1,e.length)):(o=Number(e[0]+e[1]),e=e.substr(2,e.length)),h++}else e=e.substr(3,e.length);break;case"l":for(m=e[0]+e[1]+e[2],g=0,p=7;g<p;g++){var y=lang.days[g];if(m===y.substr(0,3)){e=e.substr(y.length,e.length);break}}break;case"N":case"w":e=e.substr(1,e.length);break;case"F":for(m=e[0]+e[1]+e[2],g=0,p=7;g<p;g++){var C=lang.months[g];if(m===C.substr(0,3)){e=e.substr(C.length,e.length);break}}break;case"M":if("sql"===i)if("MM"===t.substr(h,2))switch(e[0]){case"0":case"1":case"2":case"3":isNaN(parseInt(e[1]))?(r=Number(e[0])-1,e=e.substr(1,e.length)):(r=Number(e[0]+e[1])-1,e=e.substr(2,e.length)),h+=1;break;default:r=Number(e[0])-1,e=e.substr(1,e.length)}else{if("MI"!==t.substr(h,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);l=e[0]+e[1],e=e.substr(2,e.length),h++}else e=e.substr(3,e.length);break;case"t":e="sql"===i?e.substr(1,e.length):e.substr(2,e.length);break;case"T":if("sql"!==i)throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);e=e.substr(1,e.length);break;case"G":Fancy.isNumber(parseInt(e[1]))?(a=Number(e[0]+e[1]),e=e.substr(2,e.length)):(a=Number(e[0]),e=e.substr(1,e.length));break;case"g":e=e.substr(1,e.length);break;case"H":if("sql"===i){if("HH"!==t.substr(h,2))throw new Error(`[FancyGrid Error] - Invalid date format: ${t}`);var v;isNaN(Number(e[1]))?(v=e[0],e=e.substr(1,e.length)):(v=e[0]+e[1],e=e.substr(2,e.length),h+=1),a=Number(v)}else a=Number(e[0]+e[1]),e=e.substr(2,e.length);break;default:e=e.substr(1,e.length)}}return new Date(s,r,o,a,l,d,c)},getDaysInMonth(e){const t=e.getMonth();return 1===t&&Fancy.Date.isLeapYear(e)?29:Fancy.Date.daysInMonth[t]},getFirstDayOfMonth(e){const t=(e.getDay()-(e.getDate()-1))%7;return t<0?t+7:t},isLeapYear(e){const t=e.getFullYear();return!(0!=(3&t)||!(t%100||t%400==0&&t))},getMonthNumber:(e,t)=>new Date(e,t+1,0).getDate()},Fancy.Number={isFloat:e=>Number(e)===e&&e%1!=0,getPrecision:e=>(e+"").split(".")[1].length+1,correctFloat:e=>parseFloat(e.toPrecision(14)),format(e,t,i){let n,s;void 0===t&&(t=","),Fancy.isNumber(t)&&(i=t,t=","),n=""===t?".":","===t?".":",";const r=e.toString().split(".");if(r[0]=r[0].replace(/\B(?=(\d{3})+(?!\d))/g,t),void 0===r[1]&&(r[1]=""),void 0!==i)if(0===i)s=r[0];else{var o=i-r[1].length;if(o>0)for(var a=0;a<o;a++)r[1]+="0";else o<0&&(r[1]=r[1].substring(0,i));s=r[0]+n+r[1]}else s=r[0],r[1].length&&(s+=n+r[1]);return s},currencyFormat(e,t,i,n){const s=e.toString().split(t);if(n=n||0,s[0]=s[0].replace(/\B(?=(\d{3})+(?!\d))/g,i),s[1]){if(n>0){if(s[1].length<n){for(var r="",o=s[1].length;o<n;o++)r+="0";return s[0]+t+s[1]+r}s[1]=String(s[1]).substring(0,n)}return s[0]+t+s[1]}if(n>0&&""!==s[0]){for(r="",o=0;o<n;o++)r+="0";return s[0]+t+r}return s[0]}},Fancy.Collection=function(e){const t=this;if(t.items=[],t.keys=[],t.map={},t.indexMap={},t.length=0,e)if(e.length>0)for(var i=0,n=e.length;i<n;i++)t.add(i,e[i]);else for(const i in e)t.add(i,e[i])},Fancy.Collection.prototype={add(e,t){const i=this;i.items.push(t),i.keys.push(e),i.map[e]=t,i.indexMap[e]=i.length,i.length++},remove(e){const t=this,i=t.indexMap[e];t.items.splice(i,1),t.keys.splice(i,1),delete t.indexMap[i],delete t.map[e],t.length--,t.updateIndexMap()},updateIndexMap(){let e=this,t=0,i=e.keys.length;for(e.indexMap={};t<i;t++)e.indexMap[e.keys[t]]=t},removeAll(){const e=this;e.items=[],e.keys=[],e.indexMap={},e.map={},e.length=0},get(e){return this.map[e]},each(e){let t=this,i=0,n=t.length;for(;i<n;i++)e(t.keys[i],t.items[i],i,t.length)}},Fancy.Template=function(e){const t=this;Fancy.isArray(e)?t.tpl=e.join(""):t.tpl=e,t.compile()},Fancy.Template.prototype={re:/\{([\w\-]+)\}/g,getHTML(e={}){return this.compiled(e)},compile(){const me=this;function fn(e,t){return"'+("+(t="values['"+t+"']")+" === undefined ? '' : "+t+")+'"}return eval("me.compiled = function(values){ return '"+me.tpl.replace(me.re,fn)+"';};"),me}},Fancy.key={BACKSPACE:8,TAB:9,ENTER:13,RETURN:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_DOT:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,WHEEL_SCALE:120,DOT:190},Fancy.Key={isNum(e){const t=Fancy.key;switch(e){case t.ZERO:case t.ONE:case t.TWO:case t.THREE:case t.FOUR:case t.FIVE:case t.SIX:case t.SEVEN:case t.EIGHT:case t.NINE:case t.NUM_ZERO:case t.NUM_ONE:case t.NUM_TWO:case t.NUM_THREE:case t.NUM_FOUR:case t.NUM_FIVE:case t.NUM_SIX:case t.NUM_SEVEN:case t.NUM_EIGHT:case t.NUM_NINE:return!0;default:return!1}},isNumControl(e,t){const i=Fancy.key;if(Fancy.Key.isNum(e))return!0;if(t.shiftKey&&187===e)return!0;switch(e){case i.NUM_PLUS:case 189:case i.NUM_MINUS:case i.NUM_DOT:case i.BACKSPACE:case i.DELETE:case i.TAB:case i.ENTER:case i.RETURN:case i.SHIFT:case i.CTRL:case i.ALT:case i.ESC:case i.END:case i.HOME:case i.LEFT:case i.UP:case i.RIGHT:case i.DOWN:case i.INSERT:case i.DOT:return!0;default:return!1}}},function(){const e={},t={},i=function(){this.waitMixins={}};i.prototype={items:new Fancy.Collection,add(e,t){const i=e.split(".");let n=1,s=i.length-1;Fancy.ns(e);let r=Fancy.global[i[0]];for(;n<s;n++)r=r[i[n]];i.length>1?r[i[i.length-1]]=t:Fancy.global[i[0]]=t,this.items.add(e,t)},get(e){return this.items.get(e)},waitMixin(e,t){this.waitMixins[e]=this.waitMixins[e]||{waiters:[]},this.waitMixins[e].waiters.push(t)},getMixin(e){const t=e.split(".");let i=1,n=t.length,s=Fancy.global[t[0]];if(void 0===s)return!1;for(;i<n;i++)if(void 0===(s=s[t[i]]))return!1;return s},has(t){if(Fancy.isString(t))return!!e[t];if(Fancy.isArray(t)){let e=!1;return Fancy.each(t,t=>{Fancy.ClassManager.get(t)&&(e=!0)}),e}}},Fancy.ClassManager=new i,Fancy.define=((i,n={})=>{let s=[];if(Fancy.ClassManager.has(i)&&Fancy.error(`Overwriting class name ${i}`),Fancy.isArray(i)&&(i=(s=i)[0]),n.constructor===Object&&(void 0===n.extend?n.constructor=function(){}:n.constructor=function(){this.Super("constructor",arguments)}),void 0===n.extend)e[i]=n.constructor;else{var r;switch(e[i]=n.constructor,typeof n.extend){case"string":r=Fancy.ClassManager.get(n.extend),e[i].prototype.$Super=Fancy.ClassManager.get(n.extend);break;case"function":r=n.extend,e[i].prototype.$Super=n.extend}delete n.extend,e[i].prototype.Super=function(e,t){const i=this;switch(i.$Iam?i.$Iam=Fancy.ClassManager.get(i.$Iam.prototype.$Super.prototype.$name):i.$Iam=Fancy.ClassManager.get(i.$Super.prototype.$name),e){case"const":case"constructor":i.$Iam.apply(i,t);break;default:i.$Iam.prototype[e].apply(i,t)}delete i.$Iam},((e,t)=>{for(const i in t.prototype)void 0===e.prototype[i]&&(e.prototype[i]=t.prototype[i])})(e[i],r)}e[i].prototype.$name=i,n.mixins&&(Fancy.mixin(e[i].prototype,n.mixins),delete e[i].prototype.mixins),void 0!==n.plugins&&(void 0===e[i].prototype.$plugins&&(e[i].prototype.$plugins=[]),e[i].prototype.$plugins=e[i].prototype.$plugins.concat(n.plugins),delete e[i].prototype.plugins);for(const t in n)e[i].prototype[t]=n[t];var o=e[i];!0===n.singleton&&(delete e[i],o=new o(n),e[i]=o),s.length>1?Fancy.each(s,e=>{Fancy.ClassManager.add(e,o)}):Fancy.ClassManager.add(i,o),n.type?(t[n.type]=o,Fancy.addWidgetType(n.type,o)):n.ptype&&(t[n.type]=o,Fancy.addPluginByType(n.ptype,o))}),Fancy.getClassByType=(e=>t[e])}(),Fancy.MixinClass=function(){},Fancy.MixinClass.prototype={initId(){const e=this,t=e.prefix||Fancy.prefix;e.id=e.id||Fancy.id(null,t),Fancy.addWidget(e.id,e)},initPlugins(){const e=this,t=e;let i,n,s;if(e.plugins=e.plugins||[],e._plugins&&(e.plugins=e.plugins.concat(e._plugins)),void 0!==e.plugins&&(e.$plugins=e.plugins,delete e.plugins),void 0!==e.$plugins)for(var r,o=0,a=e.$plugins,l=a.length,d={};o<l;o++){(s=a[o]).widget=t;const e=s.type||s.ptype;if(!0!==d[e]){if(d[e]=!0,void 0===(i=Fancy.getPluginByType(e)))throw new Error(`[FancyGrid Error] - some of module was not loaded. Grid plugin does not exist - ${e}`);n=new i(s),void 0!==(r=s.inWidgetName||n.inWidgetName)&&(t[r]=n)}}}},Fancy.define("Fancy.Data",{constructor:function(e){const t=this;if(t.map={},e)for(var i=0,n=e.length,s=t.map;i<n;i++)s[i]=e[i];t.length=0},add(e,t){this.map[e]=t,this.length++},get(e){return this.map[e]}}),Fancy.define("Fancy.Model",{constructor:function(e){var t=this,i={},n=t.fields||[],s=0,r=n.length;if(Fancy.isArray(e)){for(;s<r;s++){i[o=n[s]]=e[s]}void 0===i.id&&(Fancy.idSeed++,i.id=Fancy.idSeed+1e3),t.data=i,t.id=t.data.id}else{if(e.id?t.id=e.id:(Fancy.idSeed++,t.id=Fancy.idSeed+1e3,e.id=t.id),void 0===t.fields){for(var o in n=[],e)n.push(o);t.fields=n}for(r=n.length;s<r;s++){void 0===e[o=n[s]]?i[o]="":i[o]=e[o]}i.id||(t.fields.push("id"),e.id||(e.id=t.id),i.id=e.id),t.data=i}},get(e){const t=this;return void 0===e?t.data:t.data[e]},set(e,t){const i=this;if(void 0===t&&Fancy.isObject(e))for(const t in e)i.set(t,e[t]);else i.data[e]=t}}),Fancy.define("Fancy.PluginManager",{singleton:!0,constructor:function(){this.ptypes=new Fancy.Data},addPlugin(e,t){this.ptypes.add(e,t)},getPlugin(e){return this.ptypes.get(e)}}),Fancy.addPluginByType=((e,t)=>{Fancy.PluginManager.addPlugin(e,t)}),Fancy.getPluginByType=(e=>Fancy.PluginManager.getPlugin(e)),function(){const e=Fancy;e.define("Fancy.WidgetManager",{singleton:!0,constructor:function(){this.wtypes=new e.Data,this.widgets=new e.Data},addWidgetType(e,t){t.prototype.wtype=e,this.wtypes.add(e,t)},getWidgetClassByType(e){return this.wtypes.get(e)},addWidget(e,t){this.widgets.add(e,t)},getWidget(e){return this.widgets.get(e)}});const t=e.WidgetManager;e.addWidgetType=((e,i)=>{t.addWidgetType(e,i)}),e.getWidgetClassByType=(e=>t.getWidgetClassByType(e)),e.addWidget=((e,i)=>{t.addWidget(e,i)}),e.getWidget=(e=>t.getWidget(e)),e.getGrid=(e=>t.getWidget(e)),e.getForm=(e=>t.getWidget(e))}(),function(){let e=0,t={};Fancy.define(["Fancy.Event","Fancy.Observable"],{mixins:[Fancy.MixinClass],constructor:function(e={}){const t=this;if(Fancy.applyConfig(t,e),t.$events={},t.listeners||t.events)for(var i=t.listeners||t.events,n=0,s=i.length;n<s;n++){var r=i[n],o=null,a=null,l=null,d=0,c=[];for(var h in r)switch(h){case"scope":l=r[h];break;case"params":c=r[h];break;case"delay":d=r[h];break;default:o=h,a=r[h]}if(null===o)throw new Error("[FancyGrid Error] - Event was not set");switch(Fancy.typeOf(a)){case"string":a=t[a],r.handler=a,void 0===r.scope&&(l=t),r.scope=l;break;case"function":break;default:throw new Error("[FancyGrid Error] - Handler has wrong type or not defined")}if(!1===Fancy.isArray(c))throw new Error("[FancyGrid Error] - params must be array");t.addEvent(o),t.on(o,a,l,c,d)}},on(i,n,s,r=[],o){if(void 0===this.$events[i])throw new Error(`[FancyGrid Error] - Event name is not set: ${i}`);if(void 0===n)throw new Error(`[FancyGrid Error] - Handler is undefined. Name of event is ${i}.`);n.$fancyFnSeed=e,t[e]=n,e++,this.$events[i].push({fn:n,scope:s,params:r,delay:o})},un(e,t){const i=this.$events[e];if(!i)return!1;let n=0,s=i.length;for(;n<s;n++){const e=i[n];if(e.fn.$fancyFnSeed===t.$fancyFnSeed)return e.toRemove=!0,!0}return!1},once(e,t,i){const n=this,s=function(){t.apply(this,arguments),n.un(e,s)};n.on(e,s,i)},unAll(){this.$events={}},unAllByType(e){this.$events[e]=[]},fire(e){const t=this,i=t.$events[e];if(!i)return!1;for(var n=1,s=arguments.length,r=[t];n<s;n++)r.push(arguments[n]);for(n=0,s=i.length;n<s;n++){var o=i[n],a=[];!0!==o.toRemove?(a=a.concat(r),o.params&&(a=a.concat(o.params)),o.delay?setTimeout(function(e){return function(){e.fn.apply(e.scope||t,a)}}(o),o.delay):o.fn.apply(o.scope||t,a)):(i.splice(n,1),n--,s=i.length)}},addEvent(e){return this.addEvents(e)},addEvents(e){const t=this;if(arguments.length>1){for(var i=[],n=0,s=arguments.length;n<s;n++)i[n]=arguments[n];e=i}if("string"===Fancy.typeOf(e))t.$events[e]=t.$events[e]||[];else if("array"===Fancy.typeOf(e))for(n=0,s=e.length;n<s;n++)t.$events[e[n]]=t.$events[e[n]]||[]},has(e){const t=this.$events[e];return!!t&&0!==t.length}}),Fancy.define("Fancy.Modules",{extend:Fancy.Event,singleton:!0,constructor:function(){this.Super("const",arguments),this.init()},init(){this.addEvents("loaded")}})}(),Fancy.modules.paging=!0,Fancy.Mixin("Fancy.store.mixin.Paging",{initPaging(){const e=this;void 0!==e.paging&&(Fancy.isObject(e.paging)&&Fancy.apply(e,e.paging),e.calcPages())},firstPage(){const e=this;e.calcPages(),e.showPage=0,"server"===e.pageType?e.loadPage():e.changeDataView({stoppedFilter:!0})},prevPage(){const e=this;e.calcPages(),e.showPage--,e.showPage<0&&(e.showPage=0),"server"===e.pageType?e.loadPage():e.changeDataView({stoppedFilter:!0})},nextPage(){const e=this;e.calcPages(),e.showPage++,e.showPage===e.pages&&e.showPage--,e.showPage<0&&(e.showPage=0),"server"===e.pageType?e.loadPage():e.changeDataView({stoppedFilter:!0})},lastPage(){const e=this;e.calcPages(),e.showPage=e.pages-1,e.showPage<0&&(e.showPage=0),"server"===e.pageType?e.loadPage():e.changeDataView({stoppedFilter:!0})},calcPages(){var e,t=this;switch(t.widget.paging.pageOverFlowType){case void 0:case"last":e="last";break;case"first":e="first"}if("server"===t.pageType){if(t.pages=Math.ceil(t.getTotal()/t.pageSize),!isNaN(t.showPage)&&t.showPage>t.pages)return"last"===e?(t.showPage=Math.floor(t.getTotal()/t.pageSize)-1,t.showPage<0&&(t.showPage=0)):t.showPage=0,"needs reload"}else t.pages=Math.ceil(t.getTotal()/t.pageSize);t.showPage>=t.pages&&(t.showPage="last"===e?t.pages-1:0),t.showPage<0&&(t.showPage=0),t.fire("changepages",t.showPage)},setPage(e,t){const i=this;i.showPage=e,i.showPage===i.pages&&i.showPage--,i.showPage<0&&(i.showPage=0),"server"===i.pageType?i.loadPage():!1!==t&&i.changeDataView({stoppedFilter:!0})},refresh(){const e=this;"server"===e.pageType?e.loadPage():e.changeDataView({stoppedFilter:!0})},processPagingData(e){const t=this,i=t.widget;void 0!==e.totalCount&&(t.totalCount=e.totalCount),t.checkPagingType(e),!1===t.proxy.wrapper||void 0===e[t.readerRootProperty]?t.setData(e):t.setData(e[t.readerRootProperty]),i.stateIsWaiting?t.calcPages():(t.changeDataView({stoppedFilter:!0}),"needs reload"===t.calcPages()&&t.loadPage())},checkPagingType(e){const t=this;void 0!==e.totalCount&&e.totalCount!==e[t.readerRootProperty].length&&(t.totalCount=e.totalCount,t.pageType="server",void 0===t.remoteSort&&(t.remoteSort=!0))},loadPage(){this.loadData()},setPageSize(e){const t=this,i=t.widget;t.pageSize=e,t.calcPages(),"server"===t.pageType?t.loadPage():t.changeDataView({stoppedFilter:!0}),i.fire("changepagesize",e)}}),Fancy.modules.infinite=!0,Fancy.Mixin("Fancy.store.mixin.Infinite",{initInfinite(){const e=this;void 0!==e.infinite&&(Fancy.isObject(e.infinite)&&Fancy.apply(e,e.infinite),Fancy.applyIf(e,{infiniteDisplayedRows:50,infiniteScrolledToRow:0}))},getNumOfInfiniteRows(){const e=this;return e.filteredData?e.filteredData.length:e.data.length}}),Fancy.modules["server-data"]=!0,Fancy.Mixin("Fancy.store.mixin.Proxy",{pageParam:"page",startParam:"start",limitParam:"limit",sortParam:"sort",directionParam:"dir",keyParam:"key",valueParam:"value",filterParam:"filter",autoLoad:!0,autoSave:!0,saveOrder:["create","update","destroy"],batch:!0,filterOperators:{"<":"lt",">":"gt","<=":"lteq",">=":"gteq","=":"eq","==":"eq","===":"stricteq","!=":"noteq","!==":"notstricteq","":"like","*":"likeor","|":"or"},loadedTimes:0,initProxy(){const e=this,t=e.widget;e.proxy=e.data.proxy||{};const i=e.proxy;if(i.words)for(const e in i.words)this[e+"Param"]=i.words[e];void 0!==i.autoLoad&&(e.autoLoad=i.autoLoad),void 0!==i.autoSave&&(e.autoSave=i.autoSave),void 0!==i.batch&&(e.batch=i.batch),e.initReader(),e.initWriter(),"rest"===e.proxy.type?e.initRest():(e.initServerAPI(),e.initActionMethods(),e.checkProxy()),e.autoLoad&&((t.stateful||t.state)&&(e.remoteFilter||e.remoteSort)?(t.WAIT_FOR_STATE_TO_LOAD=!0,t.SERVER_FILTER_SORT=!0):e.loadData())},checkProxy(){void 0===this.proxy.api.read&&Fancy.error("In data proxy there is not url")},checkUrl(){if(void 0===this.proxy.url)throw new Error("[FancyGrid Error] - in data proxy there is not url")},initServerAPI(){const e=this,t=e.proxy;t.api=t.api||{},t.url&&(t.api.read=t.url),(t.api.update||t.api.read||t.api.create&&t.api.destroy)&&(e.proxyType="server")},initActionMethods(){const e=this.proxy,t=e.methods||{},i=e.method||"GET";t.create=t.create||i,t.read=t.read||i,t.update=t.update||i,t.destroy=t.destroy||i,e.methods=t},loadData(e){var t,i=this,n=i.proxy,s={},r=n.headers||{};if(document.activeElement&&(t=document.activeElement,document.activeElement.blur()),Fancy.apply(s,i.params),Fancy.applyIf(s,n.params),i.fire("beforeload"),"server"===i.pageType&&(s[i.pageParam]=i.showPage,s[i.limitParam]=i.pageSize,s[i.startParam]=i.showPage*i.pageSize),n.beforeRequest){const e=n.beforeRequest({type:"read",params:s,headers:r});s=e.params,r=e.headers}i.loading=!0,Fancy.Ajax({url:n.api.read,method:n.methods.read,params:s,getJSON:!0,headers:r,success(s,r,o){if(t&&t.focus(),n.afterRequest){s=n.afterRequest({type:"read",response:s}).response}if(i.loadedTimes++,i.loading=!1,!1===n.wrapper||void 0===s[i.readerRootProperty]?i.defineModel(s):i.defineModel(s[i.readerRootProperty]),i.widget.isTreeData)return!1===n.wrapper||void 0===s[i.readerRootProperty]?i.data=s:i.data=s[i.readerRootProperty],i.initTreeData(),i.widget.setSidesHeight(),i.fire("change"),i.fire("load"),i.fire("serversuccess",s,o),void(e&&e());i.paging?i.processPagingData(s):(!1===n.wrapper||void 0===s[i.readerRootProperty]?i.setData(s):i.setData(s[i.readerRootProperty]),i.widget.setSidesHeight()),i.fire("change"),i.fire("load"),i.fire("serversuccess",s,o),e&&e(),i.widget.lightStartUpdate(),i.widget._setColumnsAutoWidth()},error(e,t,n){i.fire("servererror",t,n,e)}})},proxyCRUD(e,t,i,n){const s=this;switch(e){case"UPDATE":s.proxyServerUpdate(t,i,n);break;case"DESTROY":s.proxyServerDestroy(t,i);break;case"CREATE":s.proxyServerCreate(t,i)}},proxyServerUpdate(e,t,i){var n=this,s=n.proxy,r={},o=s.headers||{},a="json"===n.writerType;if(Fancy.apply(r,n.params),Fancy.applyIf(r,s.params),s.api.update){if(a?r=Fancy.isArray(e)&&void 0===t&&void 0===i?e:n.prepareWriterJSONParams(e,t,i):(r.id=e,r[n.keyParam]=t,r[n.valueParam]=i,r.action="update"),s.beforeRequest){const e=s.beforeRequest({type:"update",params:r,headers:o});r=e.params,o=e.headers}n.loading=!0,n.fire("beforeupdate",e,t,i),Fancy.Ajax({url:s.api.update,method:s.methods.update,params:r,sendJSON:a,headers:o,success(r,o,a){if(s.afterRequest){r=s.afterRequest({type:"update",response:r}).response}n.loading=!1,n.fire("update",e,t,i),n.fire("serversuccess",r,a)},error(e,t,i){n.fire("servererror",t,i,e)}})}},proxyServerDestroy(e,t){var i=this,n=i.proxy,s={},r=n.headers||{},o="json"===i.writerType||!1===i.autoSave;if(Fancy.apply(s,i.params),Fancy.applyIf(s,n.params),o&&Fancy.isArray(e)?s=e:t?s=t:s.id=e,i.loading=!0,i.fire("beforedestroy"),n.beforeRequest){var a=n.beforeRequest({type:"destroy",params:s,headers:r});s=a.params,r=a.headers}Fancy.Ajax({url:n.api.destroy,method:n.methods.destroy,params:s,sendJSON:o,headers:r,success(t,s,r){if(n.afterRequest){t=n.afterRequest({type:"destroy",response:t}).response}i.loading=!1,i.fire("destroy",e,t),i.fire("serversuccess",t,r)},error(e,t,n){i.fire("servererror",t,n,e)}})},proxyServerCreate(e,t){var i=this,n=i.proxy,s={},r=n.headers||{},o="json"===i.writerType||!1===i.autoSave;if(Fancy.isObject(e)&&(t=e,e=e.id),Fancy.apply(s,i.params),Fancy.applyIf(s,n.params),o&&Fancy.isArray(e)?s=e:t?s=t:(s.id=e,void 0===s.id&&delete s.id),i.loading=!0,i.fire("beforecreate"),n.beforeRequest){var a=n.beforeRequest({type:"create",params:s,headers:r});s=a.params,r=a.headers}Fancy.Ajax({url:n.api.create,method:n.methods.create,params:s,sendJSON:o,headers:r,success(t,s,r){if(n.afterRequest){t=n.afterRequest({type:"create",response:t}).response}if(i.loading=!1,Fancy.isObject(t.data)&&String(e)!==String(t.data.id))i.changeItemId(e,t.data.id);else if(Fancy.isArray(t.data))for(var o=0,a=e.length;o<a;o++)String(e[o].id)!==String(t.data[o].id)&&i.changeItemId(String(e[o].id),String(t.data[o].id));i.fire("create",t.data),i.fire("serversuccess",t,r)},error(e,t,n){i.fire("servererror",t,n,e)}})},save(){var e=this,t=e.removed,i=e.changed,n=e.inserted,s=0,r=e.saveOrder.length;for(const e in n)"length"!==e&&void 0!==i[e]&&(delete i[e],i.length--);for(;s<r;s++)switch(e.saveOrder[s]){case"create":e.saveInsertActions(n);break;case"update":e.saveChangeActions(i);break;case"destroy":e.saveRemoveActions(t)}e.changed={length:0},e.removed={length:0},e.inserted={length:0}},saveChangeActions(e){const t=this;if(e.length)if(t.batch){var i=[];for(var n in e)if("length"!==n){var s=e[n],r={id:n};if(t.writeAllFields)r=t.getById(n).data;else for(var o in s)"length"!==o&&(r[o]=s[o].value);i.push(r)}1===i.length?(i=i[0],t.proxyCRUD("UPDATE",i.id,i)):t.proxyCRUD("UPDATE",i)}else for(var n in e)if("length"!==n){s=e[n],i={};if(t.writeAllFields)i=t.getById(n).data;else for(var o in s)"length"!==o&&(i[o]={id:s.id});t.proxyCRUD("UPDATE",n,i)}},saveRemoveActions(e){const t=this;if(0!==e.length)if(t.batch){var i=[];for(var n in e)if("length"!==n){var s=e[n],r={id:n};if(t.writeAllFields)r=e[n];else for(var o in s)"length"!==o&&(r={id:s.id});i.push(r)}1===i.length?(i=i[0],t.proxyCRUD("DESTROY",i.id,i)):t.proxyCRUD("DESTROY",i)}else for(var n in e)if("length"!==n){s=e[n],i={};if(t.writeAllFields)i=s;else for(var o in s)"length"!==o&&(i[o]=s[o].value);t.proxyCRUD("DESTROY",n,i)}},saveInsertActions(e){const t=this;if(0!==e.length)if(t.batch){var i=[];for(var n in e)if("length"!==n){var s=e[n],r={id:n};if(t.writeAllFields)r=t.getById(n).data;else for(var o in s.data)r[o]=s.data[o];i.push(r)}1===i.length?(i=i[0],t.proxyCRUD("CREATE",i.id,i)):t.proxyCRUD("CREATE",i)}else for(var n in e)if("length"!==n){s=e[n],i={};if(t.writeAllFields)i=s;else for(var o in s)"length"!==o&&(i[o]=s[o].value);t.proxyCRUD("CREATE",n,i)}}}),Fancy.Mixin("Fancy.store.mixin.Rest",{initRest(){this.proxyType="server",this.checkUrl(),this.initRestServerAPI(),this.initRestActionMethods()},initRestServerAPI(){const e=this.proxy,t=e.url;e.api=e.api||{},e.api.create=t,e.api.read=t,e.api.update=t,e.api.destroy=t},initRestActionMethods(){const e=this.proxy,t=e.methods||{};t.create=t.create||e.method||"POST",t.read=t.read||e.method||"GET",t.update=t.update||e.method||"PUT",t.destroy=t.destroy||e.method||"DELETE",e.methods=t}}),Fancy.Mixin("Fancy.store.mixin.Reader",{readerType:"json",readerRootProperty:"data",initReader(){const e=this,t=e.proxy;t.reader&&e.configReader(t.reader)},configReader(e){const t=this;switch(Fancy.typeOf(e)){case"string":switch(e){case"json":t.readerType=e;break;default:throw new Error(`[FancyGrid Error] - reader ${e} does not exist`)}break;case"object":switch(e.type){case void 0:t.readerType="json";break;case"json":t.readerType=e.type;break;default:throw new Error(`[FancyGrid Error] - reader ${e.type} does not exist`)}e.root&&(t.readerRootProperty=e.root)}}}),Fancy.Mixin("Fancy.store.mixin.Writer",{writerType:"string",writeAllFields:!1,initWriter(){const e=this,t=e.proxy;t.writer&&e.configWriter(t.writer)},configWriter(e){const t=this;switch(e.allFields&&(t.writeAllFields=e.allFields,e.writeAllFields=e.allFields),Fancy.typeOf(e)){case"string":switch(e){case"json":case"string":t.writerType=e;break;default:Fancy.error(`writer ${e.type} does not exist`)}break;case"object":switch(e.type){case void 0:t.writerType="string";break;case"json":case"string":t.writerType=e.type;break;default:Fancy.error(`writer ${e.type} does not exist`)}e.writeFields&&(t.writeFields=!0),e.root&&(t.writerRootProperty=e.root)}},prepareWriterJSONParams(e,t,i){var n=this,s=n.params||{},r={};return r.id=e,n.writeAllFields?Fancy.applyIf(r,n.getById(e).data):void 0===i&&Fancy.isObject(t)?Fancy.applyIf(r,t):void 0===i&&Fancy.isArray(t)?r=t:r[t]=i,n.rootProperty?(s[n.rootProperty]=r,s):r}}),Fancy.modules.sort=!0,Fancy.Mixin("Fancy.store.mixin.Sort",{multiSortLimit:3,sort(e,t,i,n={}){let s,r,o=this,a=o.widget;switch(o.fire("beforesort",{key:"key",action:e}),o.multiSort&&!0!==o.multiSortInited&&o.initMultiSort(),t){case"number":case"checkbox":case"select":case"switcher":case"progressdonut":case"progressbar":case"grossloss":case"date":case"currency":s="sortNumber",r="number";break;case"string":case"combo":case"text":case"color":case"tree":s="sortString",r="string";break;default:throw new Error("[FancyGrid Error] - does not exist sort function for type "+t)}if(o.multiSort?o.addSorter(i,e.toLocaleUpperCase(),r):(o.sorters=[],"DROP"!==e.toLocaleUpperCase()&&o.sorters.push({key:i,dir:e.toLocaleUpperCase(),type:r,_type:t,options:n})),o.remoteSort)o.serverSort(e,t,i,!0!==a.stateIsWaiting);else{if(n.type=t,"drop"===e?delete o.order:o[s](e,i,n),o.multiSort)for(var l=0,d=o.sorters.length-1;l<d;l++)o.multiSortOrder(l);!1!==n.update&&o.changeDataView(),o.fire("sort",{key:i,action:e})}},serverSort(e,t,i,n){const s=this;s.params=s.params||{},s.multiSort?s.params.sorters=s.sorters:(s.params[s.sortParam]=i,"drop"===e?delete s.params[s.directionParam]:s.params[s.directionParam]=e),s.once("serversuccess",()=>{s.fire("sort",{key:i,action:e})}),!1!==n&&s.loadData()},sortNumber(e,t,i){var n,s=this,r=[],o=i.sorter;if(s.isTree){r=s.getColumnOriginalValues("id");const i=s.treeGetDataAsTree(),a=s.treeSort(i,e,t,"number",o);n=s.treeReadSortedId(a)}else if(s.grouping){const a=s.getColumnOriginalValuesByGroup(t,s.grouping.by,i);switch(n=[],d=0,c=a.length,e){case"asc":for(;d<c;d++)r=r.concat(a[d].values),n=o?n.concat(a[d].values.sort(function(e,t){return o("asc",e,t)})):n.concat(a[d].values.sort(function(e,t){return e-t}));break;case"desc":for(;d<c;d++)r=r.concat(a[d].values),n=o?n.concat(a[d].values.sort(function(e,t){o("desc",e,t)})):n.concat(a[d].values.sort(function(e,t){return t-e}))}}else{r=s.getColumnOriginalValues(t,i),"$selected"===t&&(r=r.map(function(e){return!!e}));for(var a=[],l=Fancy.Array.copy(r),d=0,c=l.length;d<c;d++)isNaN(l[d])&&(a.push(l[d]),l.splice(d,1),c--);switch(e){case"asc":n=(n=o?Fancy.Array.copy(l).sort((e,t)=>o("asc",e,t)):Fancy.Array.copy(l).sort((e,t)=>e-t)).concat(a);break;case"desc":n=o?Fancy.Array.copy(l).sort((e,t)=>o("desc",e,t)):Fancy.Array.copy(l).sort((e,t)=>t-e),n=a.concat(n)}}s.order=s.getOrder(r,n)},sortString(e,t,i){var n,s,r,o=this,a=[],l=i.sorter;if(o.isTree){a=o.getColumnOriginalValues("id");const i=o.treeGetDataAsTree(),s=o.treeSort(i,e,t,"string",l);n=o.treeReadSortedId(s)}else if(o.grouping){const d=o.getColumnOriginalValuesByGroup(t,o.grouping.by,i);switch(n=[],s=0,r=d.length,e){case"asc":for(;s<r;s++)a=a.concat(d[s].values),n=l?n.concat(d[s].values.sort(function(e,t){return l("asc",e,t)})):n.concat(d[s].values.sort());break;case"desc":for(;s<r;s++)a=a.concat(d[s].values),n=l?n.concat(d[s].values.sort(function(e,t){return l("desc",e,t)})):n.concat(d[s].values.sort().reverse())}}else switch(a=o.getColumnOriginalValues(t,i),e){case"asc":n=l?Fancy.Array.copy(a).sort(function(e,t){return l("asc",e,t)}):Fancy.Array.copy(a).sort();break;case"desc":n=l?Fancy.Array.copy(a).sort(function(e,t){return l("desc",e,t)}):(n=Fancy.Array.copy(a).sort()).reverse()}o.order=o.getOrder(a,n)},getOrder(e,t){for(var i,n={},s=0,r=e.length,o=[];s<r;s++){var a=e[s];void 0===n[a]&&(n[a]=[]),n[a].push(s)}for(s=0;s<r;s++)i=n[a=t[s]],o.push(i[0]),i.length>1&&i.splice(0,1);return o},changeOrderIndexes(e,t){const i=this;if(void 0===t&&(t="-"),void 0===i.order)return;let n=0,s=i.order.length;if("-"===t)for(;n<s;n++)i.order[n]>e&&i.order[n]--;else for(;n<s;n++)i.order[n]>=e&&i.order[n]++},initMultiSort(){const e=this;e.multiSortInited=!0,e.sorters||(e.sorters=[])},addSorter(e,t,i){for(var n=this,s=0,r=n.sorters.length;s<r;s++)if(n.sorters[s].key===e){n.sorters.splice(s,1);break}"DROP"!==t.toLocaleUpperCase()&&(n.sorters.push({key:e,dir:t.toLocaleUpperCase(),type:i}),n.sorters.length>n.multiSortLimit&&n.sorters.shift())},multiSortOrder(e){for(var t,i,n,s=this,r=s.widget.store,o=s.sorters[e],a=s.sorters[e+1].key,l=o.key,d=0,c=r.data.length,h=[],u=[],g=[];d<c;d++)t=r.get(s.order[d],a,!0),n=r.get(s.order[d],l,!0),t===i?(h[h.length-1].push(n),u[u.length-1].push(s.order[d])):(h.push([n]),u.push([s.order[d]])),i=t;for(d=0,c=u.length;d<c;d++){if(1===u[d].length){g.push(u[d][0]);continue}let e;if("number"===o.type)switch(o.dir){case"ASC":e=Fancy.Array.copy(h[d]).sort(function(e,t){return e-t});break;case"DESC":e=Fancy.Array.copy(h[d]).sort(function(e,t){return t-e})}else if("string"===o.type)switch(o.dir){case"ASC":e=Fancy.Array.copy(h[d]).sort();break;case"DESC":e=Fancy.Array.copy(h[d]).sort().reverse()}for(var p,m=u[d],f=[],y=0,C=(p=s.getOrder(h[d],e)).length;y<C;y++)f.push(m[p[y]]);g=g.concat(f)}s.order=g},reSort(){const e=this;Fancy.each(e.sorters,t=>{e.sort(t.dir.toLocaleLowerCase(),t.type,t.key,{update:!1})})}}),Fancy.Mixin("Fancy.store.mixin.Edit",{remove(e,t){var i,n,s,r=this,o=r.widget,a=e.id;switch(Fancy.typeOf(e)){case"string":case"number":a=e;break;default:a=e.id||e.data.id}if(r.isTree&&!0!==r.treeCollapsing){var l=r.getById(a),d=r.getById(l.get("parentId"));if(!1===l.get("leaf")&&l.get("expanded")){var c=l.data.child.length-1;Fancy.each(l.data.child,function(e,t,i){r.remove(i[c]),c--})}d&&Fancy.each(d.data.child,function(e,t){if(e.id===a)return d.data.child.splice(t,1),!0})}if("server"===r.proxyType&&r.autoSave&&r.proxy.api.destroy)!1!==t&&(!1!==o.loadMask&&o.showLoadMask(),r.proxyCRUD("DESTROY",a));else{if(e.rowIndex)i=r.dataViewIndexes[e.rowIndex],n=e.rowIndex;else if(i=r.getDataIndex(a),n=r.getRow(a),void 0===i&&void 0===n)return;var h;if(r.isTree&&r.treeCollapsing&&r.filteredData)Fancy.each(r.data,function(e,t){if(e.data.id===a)return h=t,!0}),s=r.data.splice(h,1)[0];else s=r.data.splice(i,1)[0];r.paging&&(n+=r.showPage*r.pageSize),r.order&&r.order.splice(n,1),r.changeOrderIndexes&&r.changeOrderIndexes(i),r.paging&&(0!==r.showPage&&r.showPage*r.pageSize===r.getTotal()&&r.showPage--,r.calcPages()),delete r.map[a],r.treeCollapsing||!1===t||r.fire("remove",a,s,i),!1!==t&&r.changeDataView()}},removeAt(e){this.remove({rowIndex:e,id:this.getId(e)})},removeAll(){const e=this;e.data=[],e.dataView=[],delete e.order,e.paging&&(e.showPage=0,e.calcPages()),e.filters&&(delete e.filters,delete e.filteredData,delete e.filterOrder)},add(e){return this.insert(this.getTotal(),e)},insert(e,t,i){const n=this;if(Fancy.each(n.fields,e=>{void 0===t[e]&&(t[e]="")}),n.grouping&&!n.bugFixGrouping&&(n.defineModel(t,!0),n.bugFixGrouping=!0),n.addIndex=e,void 0===t.id){Fancy.idSeed++;const e=Fancy.idSeed+1e3;"server"===n.proxyType?t.id=`Temp-${e}`:t.id=e}if(n.getById(t.id)&&n.remove(t.id,i),n.widget.isGroupable()&&(clearTimeout(this.timeOutGroupDataOrder),this.timeOutGroupDataOrder=setTimeout(function(){n.orderDataByGroup()})),"server"!==n.proxyType||!n.autoSave||!n.proxy.api.create)return n.insertItem(t,e,i);!1!==i&&(n.once("create",n.onCreate,n),n.proxyCRUD("CREATE",t))},insertItem(e,t,i){const n=this,s=new(0,n.model)(e);return t=n.addIndex,n.treeExpanding||!1===i||n.fire("beforeinsert"),delete n.addIndex,n.data.splice(t,0,s),n.order&&(n.order.splice(t,0,t),n.changeOrderIndexes(t,"+"),n.order[t]--),!1!==i&&n.changeDataView(),n.map[e.id]=s,n.treeExpanding||!1===i||n.fire("insert",s),s},onCreate(e,t){return this.insertItem(t)}}),Fancy.modules.grouping=!0,Fancy.Mixin("Fancy.store.mixin.Grouping",{expand(e,t){var i=this,n=i.data,s=0,r=n.length,o=[],a={},l={};for(i.filteredData&&(r=(n=i.filteredData).length),i.expanded=i.expanded||{},i.memoryCollapsed=i.memoryCollapsed||{},Fancy.isArray(t)?Fancy.each(t,function(e){i.expanded[e]=!0,delete i.memoryCollapsed[e]}):(i.expanded[t]=!0,delete i.memoryCollapsed[t]);s<r;s++){var d=n[s];i.expanded[d.data[e]]&&(o.push(d),a[d.id]=o.length-1,l[o.length-1]=s)}i.dataView=o,i.dataViewMap=a,i.dataViewIndexes=l},collapse(e,t){var i=this,n=i.data,s=0,r=n.length,o=[],a={},l={};for(i.expanded=i.expanded||{},i.expanded[t]=!1,i.memoryCollapsed=i.memoryCollapsed||{},i.memoryCollapsed[t]=!0;s<r;s++){var d=n[s];i.expanded[d.data[e]]&&(o.push(d),a[d.id]=o.length-1,l[o.length-1]=s)}i.dataView=o,i.dataViewMap=a,i.dataViewIndexes=l},changeOrderByGroups(e,t){var i={},n=[],s=[];Fancy.each(e,e=>i[e]=[]),Fancy.isArray(this.data)&&Fancy.each(this.data,e=>{const n=e.data[t];i[n]?i[n].push(e):s.push(e)}),Fancy.each(e,e=>{n=n.concat(i[e])}),n=n.concat(s),this.grouping={by:t},this.data=n},getColumnOriginalValuesByGroup(e,t,i){var n=this.data,s=0,r=n.length,o=[],a=[],l=n[0].data[t];if(i&&i.format&&"date"===i.type)for(;s<r;s++)n[s].data[t]===l?a.push(Fancy.Date.parse(n[s].data[e],i.format,i.mode)):(o.push({values:a,groupName:l}),a=[],l=n[s].data[t],s--);else for(;s<r;s++)n[s].data[t]===l?a.push(n[s].data[e]):(o.push({values:a,groupName:l}),a=[],l=n[s].data[t],s--);return r>0&&o.push({values:a,groupName:l}),o},addGroup(e){this.widget.grouping.by=e,this.orderDataByGroup()},initGroups(e){const t=this.widget.grouping.by;if(e=e||"data",!t)throw new Error("[FancyGrid Error] - not set by param in grouping");const i=this.getColumnOriginalValues(t,{dataProperty:e,groupMap:!0}),n={};Fancy.each(i,e=>{e=String(e),void 0===n[e]&&(n[e]=0),n[e]++});let s=[];for(const e in n)s.push(e);return{groups:s=this.sortGroupNames(s),_groups:n}},orderDataByGroup(){const e=this,t=e.widget.grouping,i=e.initGroups(),n=e.sortGroupNames(i.groups);e.changeOrderByGroups(n,t.by),e.expanded={},t.collapsed?e.collapsed=!0:Fancy.each(n,t=>{void 0===e.expanded[t]&&(e.expanded[t]=!0)}),e.changeDataView({doNotFired:!0})},sortGroupNames(e){var t={},i=[],n=[],s=this.widget.grouping.sortGroups||"asc";Fancy.each(e,e=>{let n=String(e).toLocaleUpperCase();n=isNaN(Number(e))||""===e||" "===e?e.toLocaleUpperCase():String(Number(e)),t[n]=e,i.push(n)});const r=this.areGroupsNumber(i);switch(s){case"asc":case"ASC":case!0:i=r?i.sort(function(e,t){return Number(e)-Number(t)}):i.sort();break;case"desc":case"DESC":i=r?i.sort(function(e,t){return Number(t)-Number(e)}):i.reverse()}for(var o=0,a=e.length;o<a;o++)n[o]=t[i[o]];return n},getItemsByGroup(e){return this.findItem(this.grouping.by,e)},clearGroup(){const e=this;delete e.expanded,delete e.collapsed,delete e.groupMap,delete e.grouping,delete e.grouping,delete e.memoryCollapsed},areGroupsNumber(e){let t=!1;return Fancy.each(e,e=>{if(Fancy.isString(e)&&""!==e&&" "!==e)return t=!0,!0}),!t}}),Fancy.modules.filter=!0,Fancy.Mixin("Fancy.store.mixin.Filter",{filterCheckItem(e){var t=this,i=t.widget,n=i.filterCaseSensitive,s=Fancy.Object.copy(t.filters),r=!0,o=!1,a=!1;if(void 0===e.data&&(e=new Fancy.Model(e)),t.isTree){const i=e.get("child");if(i){const n=[];if(Fancy.each(i,e=>{const i=e.data?e:new t.model(e);t.filterCheckItem(i)&&n.push(e)}),e.set("filteredChild",n),n.length)return!0}}for(var l in s){var d=i.getColumnByIndex(l),c=s[l],h=e.data[l];if(d&&d.filter&&d.filter.fn)return d.filter.fn(h,s,e);if(t.smartIndexes&&t.smartIndexes[l])h=t.smartIndexes[l](e.data);else if(/\./.test(l)){var u=l.split(".");h=e.data[u[0]][u[1]]}for(var g in"date"===c.type&&(h=null===h?Number.NEGATIVE_INFINITY:Number(Fancy.Date.parse(h,c.format.read,c.format.mode))),!n&&Fancy.isString(h)&&(h=h.toLocaleLowerCase()),c){switch(g){case"type":case"format":continue}var p=c[g];switch(!n&&Fancy.isString(p)&&(p=p.toLocaleLowerCase()),g){case"<":r=Number(h)<Number(p);break;case">":r=Number(h)>Number(p);break;case"<=":r=Number(h)<=Number(p);break;case">=":r=Number(h)>=Number(p);break;case"<>":var m=!1;for(var f in p){var y=p[f];switch(f){case"<":Number(h)<Number(y)&&(m=!0);break;case">":Number(h)>Number(y)&&(m=!0);break;case"<=":Number(h)<=Number(y)&&(m=!0);break;case">=":Number(h)>=Number(y)&&(m=!0)}}r=m;break;case"=":case"==":Fancy.isArray(p)?(Fancy.each(p,function(e,t){p[t]=String(e)}),h=String(h),r=-1!==p.indexOf(h)):r=h==p;break;case"===":Fancy.isArray(p)?(h=String(h),r=-1!==p.indexOf(h)):r=h===p;break;case"!==":r=h!==p;break;case"!=":Fancy.isArray(p)?(Fancy.each(p,function(e,t){p[t]=String(e)}),h=String(h),r=-1===p.indexOf(h)):r=h!=p;break;case"":var C=function(e,i){return e=String(e).toLocaleLowerCase(),i=String(i).toLocaleLowerCase(),e=t.replaceSpecialSigns(e),new RegExp(e).test(i)};if(Fancy.isArray(p))for(var v=0,w=p.length;v<w&&!1!==(r=C(p[v],h));v++);else r=C(p,h);break;case"*":p=String(p).toLocaleLowerCase(),p=t.replaceSpecialSigns(p),(r=new RegExp(p).test(String(h).toLocaleLowerCase()))&&(a=!0),o=!0;break;case"|":r=!0===p[String(h).toLocaleLowerCase()];break;case"fn":r=!0===p(h,e);break;default:throw new Error("[FancyGrid Error 5]: Unknown filter "+g)}if("*"!==g&&!1===r)return!1}}return(!0!==o||!1!==a)&&(!0!==o||!0!==r||!1!==a)},filterData(e){var t=this,i=t.widget,n=t.data,s=[],r=0,o=n.length,a=[],l=[];if(t.remoteFilter)i.UPDATING_AFTER_LOAD||t.serverFilter(!0!==i.stateIsWaiting);else{for(t.filteredDataMap={};r<o;r++)t.order?(a.push(t.order[r]),l=n[t.order[r]]):(a.push(r),l=n[r]),t.filterCheckItem(l)&&(s.push(l),t.filteredDataMap[l.id]=l);t.filterOrder=a,t.filteredData=s,t.paging&&t.calcPages(),!1!==e&&t.fire("filter")}},serverFilter(e){var t=this,i="[",n=t.filters||{};for(var s in n){var r=n[s];for(var o in r){switch(o){case"type":case"format":continue}const e=t.filterOperators[o];if("or"===e){var a=[];for(var l in r[o])a.push(l);i+='{"operator":"'+e+'","value":"'+a.join(", ")+'","property":"'+s+'"},'}else i+='{"operator":"'+e+'","value":"'+r[o]+'","property":"'+s+'"},'}}i=i.replace(/\,$/,""),i+="]",t.params=t.params||{},"[]"===i?(i="",delete t.params[t.filterParam]):t.params[t.filterParam]=i,!1!==e&&t.loadData()},hasFilters(){const e=this;if(!e.filters)return!1;for(const t in e.filters)return!0;return!1},"combineСomparisonSigns"(e){for(const t in e){const i=Fancy.Object.copy(e[t]);for(const e in i)switch(e){case"<":case">":case"<=":case">=":i["<>"]=i["<>"]||{},i["<>"][e]=i[e],delete i[e]}e[t]=i}return e},replaceSpecialSigns:e=>e=(e=(e=(e=(e=(e=(e=e.replace(/\\/g,"\\\\")).replace(/\(/g,"\\(")).replace(/\)/g,"\\)")).replace(/\[/g,"\\[")).replace(/\]/g,"\\]")).replace(/\+/g,"\\+")).replace(/\-/g,"\\-")}),Fancy.modules.tree=!0,Fancy.Mixin("Fancy.store.mixin.Tree",{initTreeData(e){const t=this;e=e||t.data,t.isTree=!0,e&&0!==e.length&&(e=Fancy.isObject(e)?t.treeReadData(e.items):t.treeReadData(e),t.setData(e))},treeReadData(e,t,i){const n=this,s=n.widget;let r=[];return t=t||1,Fancy.each(e,e=>{e.data&&(e=e.data),e.$deep=t,e.leaf=!!e.leaf,e.expanded=!!e.expanded,Fancy.isArray(e.filteredChild)&&e.filteredChild.length?e.leaf=!1:e.child&&e.child.length&&(e.leaf=!1),i&&(e.parentId=i),e.id||(Fancy.idSeed++,e.id=Fancy.idSeed+1e3),r.push(e),e.expanded&&(e.id&&(s.tree?s.tree.expandMap[e.id]=!0:(s._tempExpandMap=s._tempExpandMap||{},s._tempExpandMap[e.id]=!0)),r=r.concat(n.treeReadData(e.child||[],t+1,e.id)))}),r},treeGetDataAsTree(){const e=[];return Fancy.each(this.data,t=>{1===t.get("$deep")&&e.push(t)}),e},treeSort(e,t,i,n,s){var r=this,o=[],a=[],l={},d=[];Fancy.each(e,e=>{const t=e.data||e;o.push(t[i]),void 0===l[t[i]]?l[t[i]]=e:(Fancy.isArray(l[t[i]])||(l[t[i]]=[l[t[i]]]),l[t[i]].push(e))});let c=!1,h=!1;if(o.length){let t;c=!0,h=!0,Fancy.each(e,e=>{const n=e.data||e;""!==n[i]&&(c=!1),void 0!==t&&t!==n[i]&&(h=!1),t=n[i]})}if("number"===n)switch(t){case"asc":a=s?Fancy.Array.copy(o).sort((e,t)=>s("asc",e,t)):Fancy.Array.copy(o).sort((e,t)=>e-t);break;case"desc":a=s?Fancy.Array.copy(o).sort((e,t)=>s("desc",e,t)):Fancy.Array.copy(o).sort((e,t)=>t-e)}else switch(t){case"asc":a=Fancy.Array.copy(o).sort();break;case"desc":a=(a=Fancy.Array.copy(o).sort()).reverse()}return Fancy.each(a,(s,o)=>{let a=l[s];Fancy.isArray(a)&&(a=a.splice(0,1)[0]),(c||h)&&(a=e[o]);var u=a.data||a;u.child&&u.expanded&&(a.data.sorted=r.treeSort(u.child,t,i,n)),d.push(a)}),d},treeReadSortedId(e){let t=this,i=[];return Fancy.each(e,e=>{i.push(e.id),(e=t.getById(e.id)).data.expanded&&(e.data.sorted?i=i.concat(t.treeReadSortedId(e.data.sorted)):e.data.child&&(i=i.concat(t.treeReadSortedId(e.data.child))))}),i},treeReBuildData(){let e=[],t=[];Fancy.each(this.data,t=>{1===t.get("$deep")&&e.push(t.data)}),t=this.treeReadData(e),this.setData(t)}}),Fancy.Mixin("Fancy.store.mixin.Dirty",{initTrackDirty(){const e=this;e.changed={length:0},e.removed={length:0},e.inserted={length:0},e.undoActions=[],e.redoActions=[],e.on("remove",e.onDirtyRemove,e),e.on("set",e.onDirtySet,e),e.on("insert",e.onDirtyInsert,e)},onDirtySet(e,t){const i=this,n=t.id;if("$selected"!==t.key){if(void 0===i.changed[n]?(i.changed[n]={length:1},i.changed.length++):i.changed[n].length++,void 0===i.changed[n][t.key]&&(i.changed[n][t.key]={originValue:t.oldValue}),i.changed[n][t.key].value=t.value,i.changed[n][t.key].value===i.changed[n][t.key].originValue){delete i.changed[n][t.key],i.changed[n].length--;for(var s=0,r=i.undoActions.length-1;s<=r;s++){var o=r-s,a=i.undoActions[o];if(a.id===n&&t.key===a.key){var l=i.undoActions.splice(o,1);i.redoActions.push(l)}}}else i.redoing||(i.redoActions=[]),i.undoActions.push({id:n,type:"edit",key:t.key,value:t.value,oldValue:t.oldValue});0===i.changed[n].length&&(delete i.changed[n],i.changed.length--)}},onDirtyRemove(e,t,i,n){const s=this;s.removed[t]=i.data,s.removed.length++,!0!==s.undoStoppped&&(s.redoing||(s.redoActions=[]),s.undoActions.push({id:t,type:"remove",data:i.data,rowIndex:n}))},onDirtyInsert(e,t){const i=this;i.treeExpanding||(i.inserted[t.id]=t,i.inserted.length++,!0!==i.undoStoppped&&(i.redoing||(i.redoActions=[]),i.undoActions.push({id:t.id,type:"insert",data:t.data})))},clearDirty(){const e=this;e.changed={length:0},e.removed={length:0},e.inserted={length:0},e.undoActions=[],e.redoActions=[]},isDirty(){var e=!1;return this.changed.length&&(e=!0),this.removed.length&&(e=!0),this.inserted.length&&(e=!0),e}}),Fancy.define("Fancy.Store",{extend:Fancy.Event,mixins:["Fancy.store.mixin.Paging","Fancy.store.mixin.Infinite","Fancy.store.mixin.Proxy","Fancy.store.mixin.Rest","Fancy.store.mixin.Reader","Fancy.store.mixin.Writer","Fancy.store.mixin.Sort","Fancy.store.mixin.Edit","Fancy.store.mixin.Grouping","Fancy.store.mixin.Filter","Fancy.store.mixin.Dirty","Fancy.store.mixin.Tree"],pageSize:10,showPage:0,pages:0,loading:!1,constructor:function(){const e=this;e.Super("const",arguments),e.init(),e.data=e.data||[],e.dataView=e.dataView||[],e.dataViewMap=e.dataViewMap||{},e.map={},e.setModel(),e.data&&(e.data.proxy?e.initProxy():e.widget.isTreeData||e.setData(e.data)),e.readSmartIndexes(),e.widget.isGroupable()&&e.orderDataByGroup(),e.widget.isTreeData&&e.initTreeData()},init(){const e=this;e.addEvents("add","change","changepages","set","beforeupdate","update","beforeremove","remove","beforedestroy","destroy","beforecreate","create","beforesort","sort","beforeload","load","filter","beforeinsert","insert","servererror","serversuccess"),e.initId(),e.initPlugins(),e.paging&&e.initPaging(),e.infinite&&e.initInfinite(),e.initTrackDirty&&e.initTrackDirty()},setModel(){var e=this,t=e.model;if(t=void 0===t?Fancy.Model:Fancy.ClassManager.get(e.model),e.model=t,e.fields=t.prototype.fields,void 0===e.fields)throw new Error("[FancyGrid Error] - needed to set fields in Model of Store")},setData(e){var t,i=this,n=0,s=e.length,r=i.model;if(i.data=[],i.dataView=[],i.dataViewMap={},i.dataViewIndexes={},i.map={},i.collapsed)for(;n<s;n++)t=new r(e[n]),i.data[n]=t,i.map[t.id]=t;else if(i.expanded)for(;n<s;n++)t=new r(e[n]),i.data[n]=t,i.map[t.id]=t;else if(i.paging)for(;n<s;n++)t=new r(e[n]),i.data[n]=t,n<i.pageSize&&(i.dataView[n]=t,i.dataViewMap[t.id]=n,i.dataViewIndexes[n]=n),i.map[t.id]=t;else for(;n<s;n++)t=new r(e[n]),i.data[n]=t,i.dataView[n]=t,i.dataViewMap[t.id]=n,i.dataViewIndexes[n]=n,i.map[t.id]=t;i.isTree&&Fancy.each(i.data,e=>{e.get("expanded")&&Fancy.each(e.data.child,function(t,n){const s=i.getById(t.id);e.data.child[n]=s})})},getItem(e){var t=this,i=t.dataView[e];return i||(i=t.order?t.data[t.order[e]]:t.data[e]),i},get(e,t,i){let n,s=this;if(void 0===e)return s.data;let r=s.dataView[e];return r?void 0===t?(void 0===(n=r.data).id&&(n.id=s.dataView[e].id),s.dataView[e].data):"none"===t?"":i?(r=s.data[e],"id"===t?r.data[t]||r.id:r.data[t]):(r=s.dataView[e],"id"===t?r.data[t]||r.id:r.data[t]):(r=s.order?s.data[s.order[e]]:s.data[e])?"id"===t?r.data[t]||r.id:r.data[t]:r},getId(e){return this.dataView[e]?this.dataView[e].id:""},getRow(e){return this.dataViewMap[e]},set(e,t,i,n){var s,r=this,o=r.widget,a=0;if(!Number.isNaN(i)){if(r.infiniteScrolledToRow&&(a=r.infiniteScrolledToRow),e+a===-1?s=r.getById(n):(s=r.dataView[e+a],n=s.data.id||s.id),r._stopSaving||o.fire("beforesaving",{rowIndex:e,key:t,value:i,id:n,saving:function(){r._set(e,t,i,n)}}),r.stopSaving)return r._stopSaving=!0,void setTimeout(()=>{delete r.stopSaving,delete r._stopSaving});this._set(e,t,i,n)}},_set(e,t,i,n){var s,r,o=this,a=0;if(o.infiniteScrolledToRow&&(a=o.infiniteScrolledToRow),e+a===-1?s=o.getById(n):n=(s=o.dataView[e+a]).data.id||s.id,void 0!==i){if((r=e+a===-1?s.get(t):o.get(e+a,t))!=i){if(e+a===-1)s.set(t,i);else{var l=o.dataView[e+a];if(l.data.parentId){var d=o.getById(l.data.parentId);Fancy.each(d.data.child,e=>{e.id===l.id&&(e[t]=i)})}l.data[t]=i}var c;"server"===o.proxyType&&o.autoSave&&o.proxyCRUD("UPDATE",n,t,i),c=-1===e?s.data:o.dataView[e+a].data,o.fire("set",{id:n,data:c,rowIndex:e,infiniteRowIndex:e+a,key:t,value:i,oldValue:r,item:s})}}else{const i=t;for(const t in i){if("id"===t)continue;let l;e+a===-1?(r=s.get(t),s.set(t,i[t]),l=s.data):(r=o.get(e+a,t),o.dataView[e+a].data[t]=i[t],l=o.dataView[e+a].data),o.fire("set",{id:n,data:l,rowIndex:e,infiniteRowIndex:e+a,key:t,value:i[t],oldValue:r,item:s})}"server"===o.proxyType&&o.autoSave&&o.proxyCRUD("UPDATE",n,i)}},setItemData(e,t){const i=this,n=i.get(e);if(i.infinite&&(e-=i.infiniteScrolledToRow),i.writeAllFields&&"server"===i.proxyType)i.set(e,t);else for(const s in t)n[s]!=t[s]&&i.set(e,s,t[s])},getLength(){let e=this,t=e.dataView.length;return e.infinite&&t>e.infiniteDisplayedRows&&(t=e.infiniteDisplayedRows),t},getTotal(){const e=this;return"server"===e.pageType?e.totalCount:e.filteredData?e.filteredData.length:void 0===e.data?0:Fancy.isObject(e.data)?0:e.data.length},defineModel(e,t){const i=this,n=i.store;if(!i.model||!i.fields||0===i.fields.length||t){e=e||i.data||n.data;var s=i.getFieldsFromData(e),r="Fancy.model."+Fancy.id();Fancy.define(r,{extend:Fancy.Model,fields:s}),i.model=r,i.fields=s,i.setModel()}},getFieldsFromData(e){const t=e.items||e;if(e.fields)return e.fields;if(!t)throw new Error("[FancyGrid Error] - not set fields of data");var i=t[0],n=[];void 0===t.length&&(i=t);for(const e in i)n.push(e);return n},getColumnOriginalValues(e,t={}){var i,n=this,s=0,r=[],o=n[t.dataProperty||"data"],a=o.length;if(/\./.test(e)&&(i=!0),t.smartIndexFn)if(n.infinite)for(;s<a;s++)r.push(t.smartIndexFn(o[s+n.infiniteScrolledToRow].data));else for(;s<a;s++)r.push(t.smartIndexFn(o[s].data));else if(t.format)if("date"===t.type)for(;s<a;s++){null===(d=o[s].data[e])||""===d?r.push(Number.NEGATIVE_INFINITY):r.push(Fancy.Date.parse(d,t.format,t.mode))}else if(i)for(;s<a;s++)r.push(this.getNestedValue(o[s].data,e));else for(;s<a;s++)r.push(o[s].data[e]);else if(t.groupMap)if(n.groupMap={},i)for(;s<a;s++){var l=o[s],d=this.getNestedValue(l.data,e);r.push(d),n.groupMap[l.id]=d}else for(;s<a;s++){d=(l=o[s]).data[e];r.push(d),n.groupMap[l.id]=d}else if(i)for(;s<a;s++)r.push(this.getNestedValue(o[s].data||o[s],e));else for(;s<a;s++){var c=o[s].data||o[s];r.push(c[e])}return r},getNestedValue(e,t){const i=t.split(".");return i.length>1?this.getNestedValue(e[i.shift(0,1)],i.join(".")):e[t]},changeDataView(e={}){var t,i=this,n=[],s={},r=0,o=i.data.length,a=i.isFiltered(),l=i.isSorted(),d=i.data;if(l&&e.reSort&&(i.remoteSort||i.reSort()),a){if(e.stoppedFilter||e.doNotFired){if(i.paging&&"server"===i.pageType)return}else i.filterData();i.remoteFilter||(void 0===(d=i.filteredData)&&(d=i.data),o=d.length)}i.dataViewIndexes={},i.dataViewMap={},i.paging&&(o=(r="server"===i.pageType?0:i.showPage*i.pageSize)+i.pageSize);const c=i.getTotal();let h;if(o>i.data.length&&(o=i.data.length),a&&o>c&&(o=c),Fancy.isObject(i.data)&&(o=0),i.order)if(i.grouping)for(t=i.grouping.by;r<o;r++)!0===a?(i.dataViewIndexes[n.length]=i.filterOrder[r],h=d[r]):(i.dataViewIndexes[n.length]=i.order[r],h=d[i.order[r]]),i.expanded[h.data[t]]&&(n.push(h),s[h.id]=n.length-1);else for(;r<o;r++)!0===a?(i.dataViewIndexes[n.length]=i.filterOrder[r],h=d[r]):(i.dataViewIndexes[n.length]=i.order[r],h=d[i.order[r]]),n.push(h),s[h.id]=n.length-1;else if(i.grouping)for(t=i.grouping.by;r<o;r++)i.expanded[d[r].data[t]]&&(i.dataViewIndexes[n.length]=r,h=d[r],n.push(h),s[h.id]=n.length-1);else for(;r<o;r++)i.dataViewIndexes[n.length]=r,h=d[r],n.push(d[r]),s[h.id]=n.length-1;i.dataView=n,i.dataViewMap=s,e.doNotFired||i.fire("change")},getColumnData(e,t){var i=0,n=this.data.length,s=[];if(t)for(;i<n;i++)s.push(t(this.data[i].data));else for(;i<n;i++)s.push(this.data[i].data[e]);return s},getColumnUniqueData(e){for(var t=0,i=this.data.length,n=[],s={};t<i;t++){var r=this.data[t].data[e];!0!==s[r]&&(s[r]=!0,n.push(r))}return n=n.sort()},getData(){for(var e=0,t=this.data.length,i=[];e<t;e++)i.push(this.data[e].data);return i},getDataView(){for(var e=0,t=this.dataView.length,i=[];e<t;e++)i.push(this.dataView[e].data);return i},getById(e){return this.map[e]},changeItemId(e,t){var i=this.getById(e);if(!i)return!1;i.id=t,void 0!==i.data.id&&(i.data.id=t),delete this.map[e],this.map[t]=i,this.fire("changeitemid",e,t)},find(e,t,i){var n=this,s=n.dataView,r=0,o=s.length,a=[];if(i)for(o=n.data.length;r<o;r++)(n.order?n.data[n.order[r]]:n.data[r]).data[e]===t&&a.push(r);else for(;r<o;r++)s[r].data[e]===t&&a.push(r);return a},findItem(e,t){for(var i,n=this.data,s=0,r=n.length,o=[];s<r;s++)(i=n[s]).data[e]===t&&o.push(i);return o},getDataIndex(e){for(var t,i=this.data,n=0,s=i.length;n<s;n++)i[n].data.id===e&&(t=n);return t},each(e,t){var i=this.dataView,n=0,s=i.length;if(t)for(;n<s;n++)e.apply(this,[i[n]]);else for(;n<s;n++)e(i[n])},readSmartIndexes(){var e=this.widget,t=0,i={};Fancy.each(e.columns,e=>{e.smartIndexFn&&(i[e.index]=e.smartIndexFn,t++)}),t&&(this.smartIndexes=i)},destroy(){const e=this;Fancy.each(e.data,e=>{delete e.data,delete e.id}),e.data=[],e.map={},e.dataView=[],e.dataViewIndexes={},e.dataViewMap={}},addField(e){var t=this,i=t.fields,n=!1;Fancy.isArray(e)?Fancy.Array.each(e,e=>t.addField(e)):(Fancy.each(i,t=>{if(t===e)return n=!0,!0}),n||t.fields.push(e))},isFiltered(){const e=this.filters||{};if(this._clearedFilter)return!0;for(const t in e)return!0;return!1},isSorted(){const e=this.sorters||{};return!Fancy.Object.isEmpty(e)}}),Fancy.$=window.$||window.jQuery,Fancy.nojQuery=void 0===Fancy.$,Fancy.get=(e=>{switch(Fancy.typeOf(e)){case"string":return new Fancy.Element(Fancy.$("#"+e)[0]);case"array":return new Fancy.Elements(e);default:return new Fancy.Element(e)}}),Fancy.Element=function(e){const t=this;t.dom=e,t.$dom=Fancy.$(e),e&&e.id&&(t.id=e.id),t.length=1},Fancy.Element.prototype={last(){return Fancy.get(this.$dom)},closest(e){return Fancy.get(this.$dom.closest(e)[0])},destroy(){this.$dom.remove()},remove(){this.$dom.remove()},finish(){this.$dom.finish()},prev(){return Fancy.get(this.$dom.prev()[0])},lastChild(){const e=this.$dom.children();return Fancy.get(e[e.length-1])},firstChild(){return Fancy.get(this.$dom.children()[0])},child(){return this.$dom.children().map(e=>Fancy.get(e))},on(e,t,i,n){const s=this;switch(i&&(t=Fancy.$.proxy(t,i)),n?s.$dom.on(e,n,t):s.$dom.on(e,t),e){case"mouseenter":s.onTouchEnterEvent&&s.onTouchEnterEvent(e,t,i,n);break;case"mouseleave":s.onTouchLeaveEvent&&s.onTouchLeaveEvent(e,t,i,n);break;case"mousemove":s.onTouchMove&&s.onTouchMove("touchmove",t)}},once(e,t,i,n){const s=this;i&&(t=Fancy.$.proxy(t,i)),n?s.$dom.one(e,n,t):s.$dom.one(e,t)},prop:function(e){return this.$dom.prop(e)},un(e,t,i,n){const s=this;i&&(t=Fancy.$.proxy(t,i)),n?s.$dom.off(e,n,t):s.$dom.off(e,t)},show(){this.$dom.show()},hide(){this.$dom.hide()},replaceClass(e,t){this.$dom.removeClass(e),this.$dom.addClass(t)},getByTag(e){return Fancy.get(this.$dom.find(e)[0])},getByClass(e){return this.$dom.find(`.${e}`)[0]},addClass(...e){this.addCls.apply(this,e)},addCls(e,...t){this.$dom.addClass(e),t.forEach(e=>this.$dom.addClass(e))},removeClass(e,...t){this.$dom.removeClass(e),t.forEach(e=>this.$dom.removeClass(e))},removeCls(e,...t){this.$dom.removeClass(e),t.forEach(e=>this.$dom.removeClass(e))},hasClass(e){return this.$dom.hasClass(e)},hasCls(e){return this.$dom.hasClass(e)},toggleClass(e){this.$dom.toggleClass(e)},toggleCls(e){this.$dom.toggleClass(e)},select(e){const t=this.$dom.find(e);return 1===t.length?Fancy.get(t[0]):t.length>1?Fancy.get(t):0===t.length?{length:0,dom:void 0,addClass:()=>{},addCls:()=>{},removeClass:()=>{},removeCls:()=>{},destroy:()=>{},remove:()=>{},css:()=>{},each:()=>{},last:()=>{},attr:()=>{}}:t},css(e,t){return void 0===t?this.$dom.css(e):this.$dom.css(e,t)},attr(e,t){return void 0===t?this.$dom.attr(e):this.$dom.attr(e,t)},append(e){return Fancy.get(this.$dom.append(e)[0])},after(e){return Fancy.get(this.$dom.after(e)[0])},next(){return Fancy.get(this.$dom.next()[0])},insertAfter(e){return Fancy.get(this.$dom.insertAfter(e)[0])},before(e){return Fancy.get(this.$dom.before(e)[0])},height(e){return e?(this.$dom.height(e),this):this.$dom.height()},width(e){return e?(this.$dom.width(e),this):this.$dom.width()},parent(e){return Fancy.get(this.$dom.parent(e)[0])},update(e){this.dom.innerHTML=e},hover(e,t){e&&this.$dom.on("mouseenter",e),e&&this.$dom.on("mouseleave",t)},position(){return this.$dom.position()},offset(){return this.$dom.offset()},focus(){this.$dom.focus()},blur(){this.$dom.blur()},within(e){var t,i=!0,n=!1;return void 0!==(t=(e=Fancy.get(e)).attr("id"))&&""!==t||(t=Fancy.id(),n=!0),e.attr("id",t),0===this.select(`#${t}`).length&&(i=!1),this.dom.id===e.dom.id&&(i=!0),n&&this.removeAttr(t),i},removeAttr(e){this.$dom.removeAttr(e)},item(){return this},stop(){this.$dom.stop&&this.$dom.stop()},animate(e,t,i,n){var s={},r=!1,o=e.force;Fancy.nojQuery||(r=!0,o=!0),Fancy.isObject(e)&&delete e.force;for(const t in e){let i=e[t];Fancy.isString(i)&&(i=Number(i.replace("px","")));let n=this.css(t);Fancy.isString(n)&&(n=Number(n.replace("px",""))),i!==n&&(s[t]=e[t],r=!0)}!1!==r&&(o?this.$dom.animate(s,t,i,n):this.$dom.css(s))},index(){return this.$dom.index()},onTouchEnterEvent(e,t,i,n){const s=this,r=Fancy.get(document.body);if(Fancy.isTouch){r.on("touchmove",function(e,r){const o=Fancy.id(),a="fancy-tempt-attr";e=e.originalEvent||e,s.attr(a,o);for(var l=e.targetTouches[0],d=[l.pageX,l.pageY],c=Fancy.get(document.elementFromPoint(d[0]-document.body.scrollLeft,d[1]-document.body.scrollTop)),h=!1,u=10,g=c;u>0&&g.dom;){if(g.attr(a)===o){h=!0;break}g=g.parent(),u--}if(!h||s.touchIn||n||(e.pageX=l.pageX,e.pageY=l.pageY,t(e,r),s.touchIn=!0),h&&n){u=10,g=c;for(var p=[],m=0;u>0&&g.dom;){var f=g.select(n);if(0!==f.length){var y=s.getDelegateTarget(n,f,p,m);y&&(e.currentTarget=y,e.delegateTarget=y,e.pageX=l.pageX,e.pageY=l.pageY,s.touchIn=!0,s.touchInDelegate=s.touchInDelegate||{},void 0===s.touchInDelegate[n]?s.touchInDelegate[n]=y:s.touchInDelegate[n]!==y&&(s.touchInDelegate[n]=[s.touchInDelegate[n],y]),t.apply(i,[e,y]));break}if(g.attr(a)===o)break;p.push(g.dom),g=g.parent(),u--,m++}}s.removeAttr(a)})}},onTouchLeaveEvent(e,t,i,n){var s=this,r=Fancy.get(document.body),o=[];if(Fancy.isTouch){r.on("touchmove",function(e,i){var r=Fancy.id(),a="fancy-tempt-attr";e=e.originalEvent||e;if(s.attr(a,r),!0===s.touchIn){var l=e.targetTouches[0],d=[l.pageX,l.pageY],c=Fancy.get(document.elementFromPoint(d[0]-document.body.scrollLeft,d[1]-document.body.scrollTop));if(!n){for(var h=!1,u=10,g=c;u>0&&g.dom;){if(g.attr(a)===r){h=!0;break}g=g.parent(),u--}if(!1===h)return e.pageX=l.pageX,e.pageY=l.pageY,s.touchIn=!1,t(e,i),void s.removeAttr(a)}if(o.length>30&&(o=o.slice(o.length-5,o.length-1)),o.push(c.dom),n&&s.touchInDelegate[n]){var p,m=Fancy.id();(p=Fancy.isArray(s.touchInDelegate[n])?Fancy.get(s.touchInDelegate[n][0]):Fancy.get(s.touchInDelegate[n])).attr(a,m),u=10;var f=!1;for(g=c;u>0&&g.dom;){if(g.attr(a)===m){f=!0;break}g=g.parent(),u--}p.removeAttr(a),f||(delete s.touchInDelegate[n],s.touchIn=!1,e.currentTarget=p.dom,e.delegateTarget=p.dom,e.pageX=l.pageX,e.pageY=l.pageY,t(e,p.dom))}s.removeAttr(a)}else s.removeAttr(a)})}},getDelegateTarget(e,t,i,n){for(var s=i[n-e.match(/\./g).length],r=0,o=t.length;r<o;r++)if(t.item(r).dom===s)return s;return!1},onTouchMove(e,t,i){const n=this,s=Fancy.get(document.body);if(Fancy.isTouch){s.on("touchmove",function(e,i){var s=Fancy.id(),r="fancy-tempt-attr";e=e.originalEvent||e,n.attr(r,s);for(var o=e.targetTouches[0],a=[o.pageX,o.pageY],l=!1,d=10,c=Fancy.get(document.elementFromPoint(a[0]-document.body.scrollLeft,a[1]-document.body.scrollTop));d>0&&c.dom;){if(c.attr(r)===s){l=!0;break}c=c.parent(),d--}n.removeAttr(r),l&&(e.pageX=o.pageX,e.pageY=o.pageY,t(e,i))})}},each(e){e(this,0)},getCls(){return this.dom.className.split(/\s+/)}},Fancy.Elements=function(e){this.dom=e,this.$dom=e,this.length=e.length},Fancy.Elements.prototype={attr(e,t){var i=this.$dom;return this.length>1&&(i=this.$dom[0]),void 0===t?i.attr(e):i.attr(e,t)},addClass(...e){this.addCls.apply(this,e)},finish(){for(var e=0,t=this.length;e<t;e++)Fancy.get(this.$dom[e]).finish()},addCls(e){for(var t=0,i=this.length;t<i;t++)Fancy.get(this.$dom[t]).addClass(e);if(arguments.length>1)for(t=1,i=arguments.length;t<i;t++)this.addClass(arguments[t])},removeClass(e){this.removeCls.apply(this,arguments)},removeCls(e){for(var t=0,i=this.length;t<i;t++)Fancy.get(this.$dom[t]).removeCls(e)},hover(e){this.$dom.on("mouseenter",e)},on:Fancy.Element.prototype.on,once:Fancy.Element.prototype.once,item(e){return Fancy.get(this.$dom[e])},css(e,t){const i=this;let n=0,s=i.length;for(;n<s;n++)Fancy.get(i.$dom[n]).css(e,t)},toggleClass(e){const t=this;let i=0,n=t.length;for(;i<n;i++)Fancy.get(t.$dom[i]).toggleClass(e)},toggleCls(e){const t=this;let i=0,n=t.length;for(;i<n;i++)Fancy.get(t.$dom[i]).toggleClass(e)},destroy(){const e=this;let t=0,i=e.length;for(;t<i;t++)Fancy.get(e.$dom[t]).destroy()},remove(){this.destroy()},hide(){for(var e=0,t=this.length;e<t;e++)Fancy.get(this.$dom[e]).hide()},show(){for(var e=0,t=this.length;e<t;e++)Fancy.get(this.$dom[e]).show()},index(){return this.$dom[0].index()},each(e){for(var t=0,i=this.length;t<i;t++)e(new Fancy.Element(this.$dom[t]),t)},last(){return new Fancy.Element(this.$dom[this.length-1])}},Fancy.select=(e=>Fancy.get(document.body).select(e)),Fancy.onReady=(e=>{Fancy.$(document).ready(e)}),Fancy.Ajax=(e=>{const t={};e.url&&(t.url=e.url),e.success&&(t.success=e.success),e.error&&(t.error=e.error),e.method&&(t.type=e.method),e.params&&(t.data=e.params),e.dataType&&(t.dataType=e.dataType),e.sendJSON&&(t.dataType="json",t.contentType="application/json; charset=utf-8",t.data=JSON.stringify(t.data)),e.getJSON&&(t.dataType="json",t.contentType="application/json; charset=utf-8"),e.headers&&(t.headers=e.headers),Fancy.$.ajax(t)}),Fancy.nojQuery&&(Array.prototype.forEach||(Array.prototype.forEach=function(e){Fancy.each(this,e)}),Fancy.modules.dom=!0,Fancy.$=function(){var e,t,i,n,s,r,o=[],a=o.concat,l=o.filter,d=o.slice,c=window.document,h={},u={},g={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},p=/^\s*<(\w+|!)[^>]*>/,m=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,f=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,y=/^(?:body|html)$/i,C=/([A-Z])/g,v=["val","css","html","text","data","width","height","offset"],w=c.createElement("table"),b=c.createElement("tr"),S={tr:c.createElement("tbody"),tbody:w,thead:w,tfoot:w,td:b,th:b,"*":c.createElement("div")},x=/complete|loaded|interactive/,I=/^[\w-]*$/,E={},T=E.toString,F={},L=c.createElement("div"),_={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},D=Array.isArray||function(e){return e instanceof Array};function k(e){return null==e?String(e):E[T.call(e)]||"object"}function R(e){return"function"==k(e)}function M(e){return null!=e&&e==e.window}function A(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function B(e){return"object"==k(e)}function O(e){return B(e)&&!M(e)&&Object.getPrototypeOf(e)==Object.prototype}function N(e){return"number"==typeof e.length}function H(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function P(e){return e in u?u[e]:u[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function G(e,t){return"number"!=typeof t||g[H(e)]?t:t+"px"}function W(e){return"children"in e?d.call(e.children):i.map(e.childNodes,function(e){if(1==e.nodeType)return e})}function $(e,t){var i,n=e?e.length:0;for(i=0;i<n;i++)this[i]=e[i];this.length=n,this.selector=t||""}function U(e,t){return null==t?i(e):i(e).filter(t)}function V(e,t,i,n){return R(t)?t.call(e,i,n):t}function z(e,t,i){null==i?e.removeAttribute(t):e.setAttribute(t,i)}function j(t,i){var n=t.className||"",s=n&&n.baseVal!==e;if(i===e)return s?n.baseVal:n;s?n.baseVal=i:t.className=i}function K(e){try{return e?"true"==e||"false"!=e&&("null"==e?null:+e+""==e?+e:/^[\[\{]/.test(e)?i.parseJSON(e):e):e}catch(t){return e}}return F.matches=function(e,t){if(!t||!e||1!==e.nodeType)return!1;var i=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(i)return i.call(e,t);var n,s=e.parentNode,r=!s;return r&&(s=L).appendChild(e),n=~F.qsa(s,t).indexOf(e),r&&L.removeChild(e),n},s=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},r=function(e){return l.call(e,function(t,i){return e.indexOf(t)==i})},F.fragment=function(t,n,s){var r,o,a;return m.test(t)&&(r=i(c.createElement(RegExp.$1))),r||(t.replace&&(t=t.replace(f,"<$1></$2>")),n===e&&(n=p.test(t)&&RegExp.$1),n in S||(n="*"),(a=S[n]).innerHTML=""+t,r=i.each(d.call(a.childNodes),function(){a.removeChild(this)})),O(s)&&(o=i(r),i.each(s,function(e,t){v.indexOf(e)>-1?o[e](t):o.attr(e,t)})),r},F.Z=function(e,t){return new $(e,t)},F.isZ=function(e){return e instanceof F.Z},F.init=function(t,n){var s,r;if(!t)return F.Z();if("string"==typeof t)if(t.trim&&(t=t.trim()),"<"==t[0]&&p.test(t))s=F.fragment(t,RegExp.$1,n),t=null;else{if(n!==e)return i(n).find(t);s=F.qsa(c,t)}else{if(R(t))return i(c).ready(t);if(F.isZ(t))return t;if(D(t))r=t,s=l.call(r,function(e){return null!=e});else if(B(t))s=[t],t=null;else if(p.test(t))s=F.fragment(t.trim(),RegExp.$1,n),t=null;else{if(n!==e)return i(n).find(t);s=F.qsa(c,t)}}return F.Z(s,t)},(i=function(e,t){return F.init(e,t)}).extend=function(i){var n,s=d.call(arguments,1);return"boolean"==typeof i&&(n=i,i=s.shift()),s.forEach(function(s){!function i(n,s,r){for(t in s)r&&(O(s[t])||D(s[t]))?(O(s[t])&&!O(n[t])&&(n[t]={}),D(s[t])&&!D(n[t])&&(n[t]=[]),i(n[t],s[t],r)):s[t]!==e&&(n[t]=s[t])}(i,s,n)}),i},F.qsa=function(e,t){var i,n="#"==t[0],s=!n&&"."==t[0],r=n||s?t.slice(1):t,o=I.test(r);return e.getElementById&&o&&n?(i=e.getElementById(r))?[i]:[]:1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType?[]:d.call(o&&!n&&e.getElementsByClassName?s?e.getElementsByClassName(r):e.getElementsByTagName(t):e.querySelectorAll(t))},i.contains=c.documentElement.contains?function(e,t){return e!==t&&e.contains(t)}:function(e,t){for(;t&&(t=t.parentNode);)if(t===e)return!0;return!1},i.type=k,i.isFunction=R,i.isWindow=M,i.isArray=D,i.isPlainObject=O,i.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},i.inArray=function(e,t,i){return o.indexOf.call(t,e,i)},i.camelCase=s,i.trim=function(e){return null==e?"":String.prototype.trim.call(e)},i.uuid=0,i.support={},i.expr={},i.noop=function(){},i.map=function(e,t){var n,s,r,o,a=[];if(N(e))for(s=0;s<e.length;s++)null!=(n=t(e[s],s))&&a.push(n);else for(r in e)null!=(n=t(e[r],r))&&a.push(n);return(o=a).length>0?i.fn.concat.apply([],o):o},i.each=function(e,t){var i,n;if(N(e)){for(i=0;i<e.length;i++)if(!1===t.call(e[i],i,e[i]))return e}else for(n in e)if(!1===t.call(e[n],n,e[n]))return e;return e},i.grep=function(e,t){return l.call(e,t)},window.JSON&&(i.parseJSON=JSON.parse),i.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){E["[object "+t+"]"]=t.toLowerCase()}),i.fn={constructor:F.Z,length:0,forEach:o.forEach,reduce:o.reduce,push:o.push,sort:o.sort,splice:o.splice,indexOf:o.indexOf,concat:function(){var e,t,i=[];for(e=0;e<arguments.length;e++)t=arguments[e],i[e]=F.isZ(t)?t.toArray():t;return a.apply(F.isZ(this)?this.toArray():this,i)},map:function(e){return i(i.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return i(d.apply(this,arguments))},ready:function(e){return x.test(c.readyState)&&c.body?e(i):c.addEventListener("DOMContentLoaded",function(){e(i)},!1),this},get:function(t){return t===e?d.call(this):this[t>=0?t:t+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(e){return o.every.call(this,function(t,i){return!1!==e.call(t,i,t)}),this},filter:function(e){return R(e)?this.not(this.not(e)):i(l.call(this,function(t){return F.matches(t,e)}))},add:function(e,t){return i(r(this.concat(i(e,t))))},is:function(e){return this.length>0&&F.matches(this[0],e)},not:function(t){var n=[];if(R(t)&&t.call!==e)this.each(function(e){t.call(this,e)||n.push(this)});else{var s="string"==typeof t?this.filter(t):N(t)&&R(t.item)?d.call(t):i(t);this.forEach(function(e){s.indexOf(e)<0&&n.push(e)})}return i(n)},has:function(e){return this.filter(function(){return B(e)?i.contains(this,e):i(this).find(e).size()})},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!B(e)?e:i(e)},last:function(){var e=this[this.length-1];return e&&!B(e)?e:i(e)},find:function(e){var t=this;return e?"object"==typeof e?i(e).filter(function(){var e=this;return o.some.call(t,function(t){return i.contains(t,e)})}):1==this.length?i(F.qsa(this[0],e)):this.map(function(){return F.qsa(this,e)}):i()},closest:function(e,t){var n=this[0],s=!1;for("object"==typeof e&&(s=i(e));n&&!(s?s.indexOf(n)>=0:F.matches(n,e));)n=n!==t&&!A(n)&&n.parentNode;return i(n)},parents:function(e){for(var t=[],n=this;n.length>0;)n=i.map(n,function(e){if((e=e.parentNode)&&!A(e)&&t.indexOf(e)<0)return t.push(e),e});return U(t,e)},parent:function(e){return U(r(this.pluck("parentNode")),e)},children:function(e){return U(this.map(function(){return W(this)}),e)},contents:function(){return this.map(function(){return this.contentDocument||d.call(this.childNodes)})},siblings:function(e){return U(this.map(function(e,t){return l.call(W(t.parentNode),function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return i.map(this,function(t){return t[e]})},show:function(){return this.each(function(){var e,t,i;"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=(e=this.nodeName,h[e]||(t=c.createElement(e),c.body.appendChild(t),i=getComputedStyle(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),"none"==i&&(i="block"),h[e]=i),h[e]))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var t=R(e);if(this[0]&&!t)var n=i(e).get(0),s=n.parentNode||this.length>1;return this.each(function(r){i(this).wrapAll(t?e.call(this,r):s?n.cloneNode(!0):n)})},wrapAll:function(e){if(this[0]){var t;for(i(this[0]).before(e=i(e));(t=e.children()).length;)e=t.first();i(e).append(this)}return this},wrapInner:function(e){var t=R(e);return this.each(function(n){var s=i(this),r=s.contents(),o=t?e.call(this,n):e;r.length?r.wrapAll(o):s.append(o)})},unwrap:function(){return this.parent().each(function(){i(this).replaceWith(i(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(t){return this.each(function(){var n=i(this);(t===e?"none"==n.css("display"):t)?n.show():n.hide()})},prev:function(e){return i(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return i(this.pluck("nextElementSibling")).filter(e||"*")},html:function(e){return 0 in arguments?this.each(function(t){var n=this.innerHTML;i(this).empty().append(V(this,e,t,n))}):0 in this?this[0].innerHTML:null},text:function(e){return 0 in arguments?this.each(function(t){var i=V(this,e,t,this.textContent);this.textContent=null==i?"":""+i}):0 in this?this.pluck("textContent").join(""):null},attr:function(i,n){var s;return"string"!=typeof i||1 in arguments?this.each(function(e){if(1===this.nodeType)if(B(i))for(t in i)z(this,t,i[t]);else z(this,i,V(this,n,e,this.getAttribute(i)))}):this.length&&1===this[0].nodeType?!(s=this[0].getAttribute(i))&&i in this[0]?this[0][i]:s:e},removeAttr:function(e){return this.each(function(){1===this.nodeType&&e.split(" ").forEach(function(e){z(this,e)},this)})},prop:function(e,t){return e=_[e]||e,1 in arguments?this.each(function(i){this[e]=V(this,t,i,this[e])}):this[0]&&this[0][e]},data:function(t,i){var n="data-"+t.replace(C,"-$1").toLowerCase(),s=1 in arguments?this.attr(n,i):this.attr(n);return null!==s?K(s):e},val:function(e){return 0 in arguments?this.each(function(t){this.value=V(this,e,t,this.value)}):this[0]&&(this[0].multiple?i(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(e){if(e)return this.each(function(t){var n=i(this),s=V(this,e,t,n.offset()),r=n.offsetParent().offset(),o={top:s.top-r.top,left:s.left-r.left};"static"==n.css("position")&&(o.position="relative"),n.css(o)});if(!this.length)return null;if(!i.contains(c.documentElement,this[0]))return{top:0,left:0};var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(e,n){if(arguments.length<2){var r,o=this[0];if(!o)return;if(r=getComputedStyle(o,""),"string"==typeof e)return o.style[s(e)]||r.getPropertyValue(e);if(D(e)){var a={};return i.each(e,function(e,t){a[t]=o.style[s(t)]||r.getPropertyValue(t)}),a}}var l="";if("string"==k(e))n||0===n?l=H(e)+":"+G(e,n):this.each(function(){this.style.removeProperty(H(e))});else for(t in e)e[t]||0===e[t]?l+=H(t)+":"+G(t,e[t])+";":this.each(function(){this.style.removeProperty(H(t))});return this.each(function(){this.style.cssText+=";"+l})},index:function(e){return e?this.indexOf(i(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return!!e&&o.some.call(this,function(e){return this.test(j(e))},P(e))},addClass:function(e){return e?this.each(function(t){if("className"in this){n=[];var s=j(this);V(this,e,t,s).split(/\s+/g).forEach(function(e){i(this).hasClass(e)||n.push(e)},this),n.length&&j(this,s+(s?" ":"")+n.join(" "))}}):this},removeClass:function(t){return this.each(function(i){if("className"in this){if(t===e)return j(this,"");n=j(this),V(this,t,i,n).split(/\s+/g).forEach(function(e){n=n.replace(P(e)," ")}),j(this,n.trim())}})},toggleClass:function(t,n){return t?this.each(function(s){var r=i(this);V(this,t,s,j(this)).split(/\s+/g).forEach(function(t){(n===e?!r.hasClass(t):n)?r.addClass(t):r.removeClass(t)})}):this},scrollTop:function(t){if(this.length){var i="scrollTop"in this[0];return t===e?i?this[0].scrollTop:this[0].pageYOffset:this.each(i?function(){this.scrollTop=t}:function(){this.scrollTo(this.scrollX,t)})}},scrollLeft:function(t){if(this.length){var i="scrollLeft"in this[0];return t===e?i?this[0].scrollLeft:this[0].pageXOffset:this.each(i?function(){this.scrollLeft=t}:function(){this.scrollTo(t,this.scrollY)})}},position:function(){if(this.length){var e=this[0],t=this.offsetParent(),n=this.offset(),s=y.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(i(e).css("margin-top"))||0,n.left-=parseFloat(i(e).css("margin-left"))||0,s.top+=parseFloat(i(t[0]).css("border-top-width"))||0,s.left+=parseFloat(i(t[0]).css("border-left-width"))||0,{top:n.top-s.top,left:n.left-s.left}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||c.body;e&&!y.test(e.nodeName)&&"static"==i(e).css("position");)e=e.offsetParent;return e})}},i.fn.detach=i.fn.remove,["width","height"].forEach(function(t){var n=t.replace(/./,function(t){return t[0]===e?t.charAt(0).toUpperCase():t[0].toUpperCase()});i.fn[t]=function(s){var r,o=this[0];return s===e?M(o)?o["inner"+n]:A(o)?o.documentElement["scroll"+n]:(r=this.offset())&&r[t]:this.each(function(e){(o=i(this)).css(t,V(this,s,e,o[t]()))})}}),["after","prepend","before","append"].forEach(function(e,t){var n=t%2;i.fn[e]=function(){var e,s,r=i.map(arguments,function(t){return"object"==(e=k(t))||"array"==e||null==t?t:F.fragment(t)}),o=this.length>1;return r.length<1?this:this.each(function(e,a){s=n?a:a.parentNode,a=0==t?a.nextSibling:1==t?a.firstChild:2==t?a:null;var l=i.contains(c.documentElement,s);r.forEach(function(e){if(o)e=e.cloneNode(!0);else if(!s)return i(e).remove();s.insertBefore(e,a),l&&function e(t,i){i(t);for(var n=0,s=t.childNodes.length;n<s;n++)e(t.childNodes[n],i)}(e,function(e){null==e.nodeName||"SCRIPT"!==e.nodeName.toUpperCase()||e.type&&"text/javascript"!==e.type||e.src||window.eval.call(window,e.innerHTML)})})})},i.fn[n?e+"To":"insert"+(t?"Before":"After")]=function(t){return i(t)[e](this),this}}),F.Z.prototype=$.prototype=i.fn,F.uniq=r,F.deserializeValue=K,i.zepto=F,i}()),Fancy.nojQuery&&function(e){var t,i=1,n=Array.prototype.slice,s=Fancy.isFunction,r=function(e){return"string"==typeof e},o={},a={},l="onfocusin"in window,d={focus:"focusin",blur:"focusout"},c={mouseenter:"mouseover",mouseleave:"mouseout"};function h(e){return e._zid||(e._zid=i++)}function u(e,t,i,n){if((t=g(t)).ns)var s=(r=t.ns,new RegExp("(?:^| )"+r.replace(" "," .* ?")+"(?: |$)"));var r;return(o[h(e)]||[]).filter(function(e){return e&&(!t.e||e.e==t.e)&&(!t.ns||s.test(e.ns))&&(!i||h(e.fn)===h(i))&&(!n||e.sel==n)})}function g(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function p(e,t){return e.del&&!l&&e.e in d||!!t}function m(e){return c[e]||l&&d[e]||e}function f(i,n,s,r,a,l,d){var u=h(i),f=o[u]||(o[u]=[]);n.split(/\s/).forEach(function(n){if("ready"==n)return e(document).ready(s);var o=g(n);o.fn=s,o.sel=a,o.e in c&&(s=function(t){var i=t.relatedTarget;if(!i||i!==this&&!e.contains(this,i))return o.fn.apply(this,arguments)}),o.del=l;var h=l||s;o.proxy=function(e){if(!(e=S(e)).isImmediatePropagationStopped()){e.data=r;var n=h.apply(i,e._args==t?[e]:[e].concat(e._args));return!1===n&&(e.preventDefault(),e.stopPropagation()),n}},o.i=f.length,f.push(o),"addEventListener"in i&&i.addEventListener(m(o.e),o.proxy,p(o,d))})}function y(e,t,i,n,s){var r=h(e);(t||"").split(/\s/).forEach(function(t){u(e,t,i,n).forEach(function(t){delete o[r][t.i],"removeEventListener"in e&&e.removeEventListener(m(t.e),t.proxy,p(t,s))})})}a.click=a.mousedown=a.mouseup=a.mousemove="MouseEvents",e.event={add:f,remove:y},e.proxy=function(t,i){var o=2 in arguments&&n.call(arguments,2);if(s(t)){var a=function(){return t.apply(i,o?o.concat(n.call(arguments)):arguments)};return a._zid=h(t),a}if(r(i))return o?(o.unshift(t[i],t),e.proxy.apply(null,o)):e.proxy(t[i],t);throw new TypeError("expected function")},e.fn.bind=function(e,t,i){return this.on(e,t,i)},e.fn.unbind=function(e,t){return this.off(e,t)},e.fn.one=function(e,t,i,n){return this.on(e,t,i,n,1)};var C=function(){return!0},v=function(){return!1},w=/^([A-Z]|returnValue$|layer[XY]$)/,b={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};function S(i,n){return!n&&i.isDefaultPrevented||(n||(n=i),e.each(b,function(e,t){var s=n[e];i[e]=function(){return this[t]=C,s&&s.apply(n,arguments)},i[t]=v}),(n.defaultPrevented!==t?n.defaultPrevented:"returnValue"in n?!1===n.returnValue:n.getPreventDefault&&n.getPreventDefault())&&(i.isDefaultPrevented=C)),i}function x(e){var i,n={originalEvent:e};for(i in e)w.test(i)||e[i]===t||(n[i]=e[i]);return S(n,e)}e.fn.delegate=function(e,t,i){return this.on(t,e,i)},e.fn.undelegate=function(e,t,i){return this.off(t,e,i)},e.fn.live=function(t,i){return e(document.body).delegate(this.selector,t,i),this},e.fn.die=function(t,i){return e(document.body).undelegate(this.selector,t,i),this},e.fn.on=function(i,o,a,l,d){var c,h,u=this;return i&&!r(i)?(e.each(i,function(e,t){u.on(e,o,a,t,d)}),u):(r(o)||s(l)||!1===l||(l=a,a=o,o=t),l!==t&&!1!==a||(l=a,a=t),!1===l&&(l=v),u.each(function(t,s){d&&(c=function(e){return y(s,e.type,l),l.apply(this,arguments)}),o&&(h=function(t){var i,r=e(t.target).closest(o,s).get(0);if(r&&r!==s)return i=e.extend(x(t),{currentTarget:r,liveFired:s}),(c||l).apply(r,[i].concat(n.call(arguments,1)))}),f(s,i,l,a,o,h||c)}))},e.fn.off=function(i,n,o){var a=this;return i&&!r(i)?(e.each(i,function(e,t){a.off(e,n,t)}),a):(r(n)||s(o)||!1===o||(o=n,n=t),!1===o&&(o=v),a.each(function(){y(this,i,o,n)}))},e.fn.trigger=function(t,i){return(t=r(t)||e.isPlainObject(t)?e.Event(t):S(t))._args=i,this.each(function(){t.type in d&&"function"==typeof this[t.type]?this[t.type]():"dispatchEvent"in this?this.dispatchEvent(t):e(this).triggerHandler(t,i)})},e.fn.triggerHandler=function(t,i){var n,s;return this.each(function(o,a){(n=x(r(t)?e.Event(t):t))._args=i,n.target=a,e.each(u(a,t.type||t),function(e,t){if(s=t.proxy(n),n.isImmediatePropagationStopped())return!1})}),s},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return 0 in arguments?this.bind(t,e):this.trigger(t)}}),e.Event=function(e,t){r(e)||(e=(t=e).type);var i=document.createEvent(a[e]||"Events"),n=!0;if(t)for(var s in t)"bubbles"==s?n=!!t[s]:i[s]=t[s];return i.initEvent(e,n,!0),S(i)}}(Fancy.$),Fancy.nojQuery&&function(e,t){var i,n,s,r,o,a,l,d,c,h,u="",g=document.createElement("div"),p=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,m={};function f(e){return i?i+e:e.toLowerCase()}e.each({Webkit:"webkit",Moz:"",O:"o"},function(e,t){if(void 0!==g.style[e+"TransitionProperty"])return u="-"+e.toLowerCase()+"-",i=t,!1}),n=u+"transform",m[s=u+"transition-property"]=m[r=u+"transition-duration"]=m[a=u+"transition-delay"]=m[o=u+"transition-timing-function"]=m[l=u+"animation-name"]=m[d=u+"animation-duration"]=m[h=u+"animation-delay"]=m[c=u+"animation-timing-function"]="",e.fx={off:void 0===i&&void 0===g.style.transitionProperty,speeds:{_default:400,fast:200,slow:600},cssPrefix:u,transitionEnd:f("TransitionEnd"),animationEnd:f("AnimationEnd")},e.fn.animate=function(t,i,n,s,r){return e.isFunction(i)&&(s=i,n=void 0,i=void 0),e.isFunction(n)&&(s=n,n=void 0),e.isPlainObject(i)&&(n=i.easing,s=i.complete,r=i.delay,i=i.duration),i&&(i=("number"==typeof i?i:e.fx.speeds[i]||e.fx.speeds._default)/1e3),r&&(r=parseFloat(r)/1e3),this.anim(t,i,n,s,r)},e.fn.anim=function(t,i,u,g,f){var y,C,v,w={},b="",S=this,x=e.fx.transitionEnd,I=!1;if(void 0===i&&(i=e.fx.speeds._default/1e3),void 0===f&&(f=0),e.fx.off&&(i=0),"string"==typeof t)w[l]=t,w[d]=i+"s",w[h]=f+"s",w[c]=u||"linear",x=e.fx.animationEnd;else{for(y in C=[],t)p.test(y)?b+=y+"("+t[y]+") ":(w[y]=t[y],C.push(y.replace(/([a-z])([A-Z])/,"$1-$2").toLowerCase()));b&&(w[n]=b,C.push(n)),i>0&&"object"==typeof t&&(w[s]=C.join(", "),w[r]=i+"s",w[a]=f+"s",w[o]=u||"linear")}return v=function(t){if(void 0!==t){if(t.target!==t.currentTarget)return;e(t.target).unbind(x,v)}else e(this).unbind(x,v);I=!0,e(this).css(m),g&&g.call(this)},i>0&&(this.bind(x,v),setTimeout(function(){I||v.call(S)},1e3*(i+f)+25)),this.size()&&this.get(0).clientLeft,this.css(w),i<=0&&setTimeout(function(){S.each(function(){v.call(this)})},0),this},g=null}(Fancy.$),Fancy.nojQuery&&function(e,t){var i=e.fn.show,n=e.fn.hide,s=e.fn.toggle;function r(i,n,s,r,o){"function"!=typeof n||o||(o=n,n=t);var a={opacity:s};return r&&(a.scale=r,i.css(e.fx.cssPrefix+"transform-origin","0 0")),i.animate(a,n,null,o)}function o(t,i,s,o){return r(t,i,0,s,function(){n.call(e(this)),o&&o.call(this)})}e.fn.show=function(e,n){return i.call(this),e===t?e=0:this.css("opacity",0),r(this,e,1,"1,1",n)},e.fn.hide=function(e,i){return e===t?n.call(this):o(this,e,"0,0",i)},e.fn.toggle=function(i,n){return i===t||"boolean"==typeof i?s.call(this,i):this.each(function(){var t=e(this);t["none"==t.css("display")?"show":"hide"](i,n)})},e.fn.fadeTo=function(e,t,i){return r(this,e,t,null,i)},e.fn.fadeIn=function(e,t){var n=this.css("opacity");return n>0?this.css("opacity",0):n=1,i.call(this).fadeTo(e,n,t)},e.fn.fadeOut=function(e,t){return o(this,e,null,t)},e.fn.fadeToggle=function(t,i){return this.each(function(){var n=e(this);n[0==n.css("opacity")||"none"==n.css("display")?"fadeIn":"fadeOut"](t,i)})}}(Fancy.$),Fancy.nojQuery&&(Fancy.modules.ajax=!0,function(e){var t,i,n=0,s=window.document,r=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,o=/^(?:text|application)\/javascript/i,a=/^(?:text|application)\/xml/i,l="application/json",d="text/html",c=/^\s*$/,h=s.createElement("a");function u(t,i,n,r){if(t.global)return function(t,i,n){var s=e.Event(i);return e(t).trigger(s,n),!s.isDefaultPrevented()}(i||s,n,r)}function g(e,t){var i=t.context;if(!1===t.beforeSend.call(i,e,t)||!1===u(t,i,"ajaxBeforeSend",[e,t]))return!1;u(t,i,"ajaxSend",[e,t])}function p(e,t,i,n){var s=i.context;i.success.call(s,e,"success",t),n&&n.resolveWith(s,[e,"success",t]),u(i,s,"ajaxSuccess",[t,i,e]),f("success",t,i)}function m(e,t,i,n,s){var r=n.context;n.error.call(r,i,t,e),s&&s.rejectWith(r,[i,t,e]),u(n,r,"ajaxError",[i,n,e||t]),f(t,i,n)}function f(t,i,n){var s=n.context;n.complete.call(s,i,t),u(n,s,"ajaxComplete",[i,n]),function(t){t.global&&!--e.active&&u(t,null,"ajaxStop")}(n)}function y(){}function C(e,t){return""==t?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function v(t,i,n,s){return e.isFunction(i)&&(s=n,n=i,i=void 0),e.isFunction(n)||(s=n,n=void 0),{url:t,data:i,success:n,dataType:s}}h.href=window.location.href,e.active=0,e.ajaxJSONP=function(t,i){if(!("type"in t))return e.ajax(t);var r,o,a=t.jsonpCallback,l=(e.isFunction(a)?a():a)||"jsonp"+ ++n,d=s.createElement("script"),c=window[l],h=function(t){e(d).triggerHandler("error",t||"abort")},u={abort:h};return i&&i.promise(u),e(d).on("load error",function(n,s){clearTimeout(o),e(d).off().remove(),"error"!=n.type&&r?p(r[0],u,t,i):m(null,s||"error",u,t,i),window[l]=c,r&&e.isFunction(c)&&c(r[0]),c=r=void 0}),!1===g(u,t)?(h("abort"),u):(window[l]=function(){r=arguments},d.src=t.url.replace(/\?(.+)=\?/,"?$1="+l),s.head.appendChild(d),t.timeout>0&&(o=setTimeout(function(){h("timeout")},t.timeout)),u)},e.ajaxSettings={type:"GET",beforeSend:y,success:y,error:y,complete:y,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:l,xml:"application/xml, text/xml",html:d,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},e.ajax=function(n){var r,f,v=e.extend({},n||{}),w=e.Deferred&&e.Deferred();for(t in e.ajaxSettings)void 0===v[t]&&(v[t]=e.ajaxSettings[t]);!function(t){t.global&&0==e.active++&&u(t,null,"ajaxStart")}(v),v.crossDomain||((r=s.createElement("a")).href=v.url,r.href=r.href,v.crossDomain=h.protocol+"//"+h.host!=r.protocol+"//"+r.host),v.url||(v.url=window.location.toString()),(f=v.url.indexOf("#"))>-1&&(v.url=v.url.slice(0,f)),function(t){t.processData&&t.data&&"string"!=e.type(t.data)&&(t.data=e.param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||(t.url=C(t.url,t.data),t.data=void 0)}(v);var b=v.dataType,S=/\?.+=\?/.test(v.url);if(S&&(b="jsonp"),!1!==v.cache&&(n&&!0===n.cache||"script"!=b&&"jsonp"!=b)||(v.url=C(v.url,"_="+Date.now())),"jsonp"==b)return S||(v.url=C(v.url,v.jsonp?v.jsonp+"=?":!1===v.jsonp?"":"callback=?")),e.ajaxJSONP(v,w);var x,I=v.accepts[b],E={},T=function(e,t){E[e.toLowerCase()]=[e,t]},F=/^([\w-]+:)\/\//.test(v.url)?RegExp.$1:window.location.protocol,L=v.xhr(),_=L.setRequestHeader;if(w&&w.promise(L),v.crossDomain||T("X-Requested-With","XMLHttpRequest"),T("Accept",I||"*/*"),(I=v.mimeType||I)&&(I.indexOf(",")>-1&&(I=I.split(",",2)[0]),L.overrideMimeType&&L.overrideMimeType(I)),(v.contentType||!1!==v.contentType&&v.data&&"GET"!=v.type.toUpperCase())&&T("Content-Type",v.contentType||"application/x-www-form-urlencoded"),v.headers)for(i in v.headers)T(i,v.headers[i]);if(L.setRequestHeader=T,L.onreadystatechange=function(){if(4==L.readyState){L.onreadystatechange=y,clearTimeout(x);var t,i=!1;if(L.status>=200&&L.status<300||304==L.status||0==L.status&&"file:"==F){if(b=b||((n=v.mimeType||L.getResponseHeader("content-type"))&&(n=n.split(";",2)[0]),n&&(n==d?"html":n==l?"json":o.test(n)?"script":a.test(n)&&"xml")||"text"),"arraybuffer"==L.responseType||"blob"==L.responseType)t=L.response;else{t=L.responseText;try{"script"==b?(0,eval)(t):"xml"==b?t=L.responseXML:"json"==b&&(t=c.test(t)?null:e.parseJSON(t))}catch(e){i=e}if(i)return m(i,"parsererror",L,v,w)}p(t,L,v,w)}else m(L.statusText||null,L.status?"error":"abort",L,v,w)}var n},!1===g(L,v))return L.abort(),m(null,"abort",L,v,w),L;if(v.xhrFields)for(i in v.xhrFields)L[i]=v.xhrFields[i];var D=!("async"in v)||v.async;for(i in L.open(v.type,v.url,D,v.username,v.password),E)_.apply(L,E[i]);return v.timeout>0&&(x=setTimeout(function(){L.onreadystatechange=y,L.abort(),m(null,"timeout",L,v,w)},v.timeout)),L.send(v.data?v.data:null),L},e.get=function(){return e.ajax(v.apply(null,arguments))},e.post=function(){var t=v.apply(null,arguments);return t.type="POST",e.ajax(t)},e.getJSON=function(){var t=v.apply(null,arguments);return t.dataType="json",e.ajax(t)},e.fn.load=function(t,i,n){if(!this.length)return this;var s,o=this,a=t.split(/\s/),l=v(t,i,n),d=l.success;return a.length>1&&(l.url=a[0],s=a[1]),l.success=function(t){o.html(s?e("<div>").html(t.replace(r,"")).find(s):t),d&&d.apply(o,arguments)},e.ajax(l),this};var w=encodeURIComponent;e.param=function(t,i){var n=[];return n.add=function(t,i){e.isFunction(i)&&(i=i()),null==i&&(i=""),this.push(w(t)+"="+w(i))},function t(i,n,s,r){var o,a=e.isArray(n),l=e.isPlainObject(n);e.each(n,function(n,d){o=e.type(d),r&&(n=s?r:r+"["+(l||"object"==o||"array"==o?n:"")+"]"),!r&&a?i.add(d.name,d.value):"array"==o||!s&&"object"==o?t(i,d,s,n):i.add(n,d)})}(n,t,i),n.join("&").replace(/%20/g,"+")}}(Fancy.$)),Fancy.i18n.en={paging:{first:"First Page",last:"Last Page",prev:"Previous Page",next:"Next Page",info:"Rows [0] - [1] of [2]",page:"Page",of:"of [0]"},loadingText:"Loading...",thousandSeparator:",",decimalSeparator:".",currencySign:"$",sourceText:"Source",date:{read:"m/d/Y",write:"m/d/Y",edit:"m/d/Y",today:"Today",startDay:0,days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],am:"am",pm:"pm",AM:"AM",PM:"PM",ok:"OK",cancel:"Cancel"},yes:"Yes",no:"No",dragText:"[0] selected row[1]",update:"Update",cancel:"Cancel",columns:"Columns",autoSizeColumn:"Autosize Column",autoSizeColumns:"Autosize All Columns",sortAsc:"Sort ASC",sortDesc:"Sort DESC",lock:"Lock",unlock:"Unlock",rightLock:"Right Lock"},Fancy.i18n["en-US"]=Fancy.i18n.en,Fancy.controllers={},Fancy.defineController=((e,t)=>{Fancy.controllers[e]=t}),Fancy.defineControl=Fancy.defineController,Fancy.getController=(e=>Fancy.controllers[e]),Fancy.getControl=Fancy.getController,Fancy.define("Fancy.DD",{extend:Fancy.Event,singleton:!0,constructor:function(){this.Super("const",arguments),this.init()},init(){this.addEvents(),this.els={}},add(e){const t=Fancy.id(e.overEl);this.els[t]=e,e.overEl.on("mousedown",this.onMouseDown,this)},onMouseDown(e){const t=this,i=Fancy.get(document),n=Fancy.get(e.currentTarget),s=t.els[n.attr("id")].dragEl;e.preventDefault(),t.clientX=e.clientX,t.clientY=e.clientY,t.startX=parseInt(s.css("left")),t.startY=parseInt(s.css("top")),t.activeId=n.attr("id"),i.once("mouseup",t.onMouseUp,t),i.on("mousemove",t.onMouseMove,t)},onMouseUp(){Fancy.get(document).un("mousemove",this.onMouseMove,this)},onMouseMove(e){var t=this,i=t.els[t.activeId].dragEl,n=e.clientX,s=e.clientY,r=t.clientX-n,o=t.clientY-s,a=t.startX-r,l=t.startY-o;l<0&&(l=0),i.css({left:a,top:l})}}),Fancy.define("Fancy.Widget",{extend:Fancy.Event,constructor:function(e){const t=this;Fancy.applyConfig(t,e),t.preInitControls(),t.Super("const",arguments),t.init(),t.initControls()},init(){this.initId(),this.addEvents("beforerender","afterrender","render","show","beforehide","hide","destroy"),this.initPlugins()},renderItems(e){const t=this;Fancy.each(t.items,function(i,n){const s=Fancy.getClassByType(i.type);i.renderTo=e,t.items[n]=new s(i)})},preInitControls(){const e=this;let t=e.controller||e.controllers;if(t)switch(Fancy.typeOf(t)){case"string":for(var i in t=Fancy.getController(t))void 0===e[i]&&(e[i]=t[i]);break;case"array":for(var n=[],s=0,r=t.length;s<r;s++){var o=Fancy.getController(t[s]);for(var i in o)"controls"!==i?void 0===e[i]&&(e[i]=o[i]):n=n.concat(o.controls)}e.controls=n}},initControls(){const e=this;if(void 0!==e.controls)for(var t=e.controls,i=0,n=t.length;i<n;i++){var s=t[i];void 0===s.event&&Fancy.error("Not set event name for control"),void 0===s.handler&&Fancy.error("Not set event handler for control");var r=s.event,o=s.handler,a=s.scope||e,l=s.selector;Fancy.isString(o)&&(o=e[o]),l?function(t,i,n,s){e.$events[t]?e.on(t,(e,t)=>{const r=t.e.target,o=Fancy.get(r).parent().select(s);if(1===o.length&&o.within(r))i.apply(n,arguments);else if(o.length>1)for(var a=0,l=o.length;a<l;a++)o.item(a).within(r)&&i.apply(n,arguments)},n):e.on("render",()=>e.el.on(t,i,n,s))}(r,o,a,l):void 0===l&&void 0===s.widget&&e.on(r,o,a)}},css(e,t){return this.el.css(e,t)},addClass(e){this.el.addCls(e)},addCls(e){this.el.addCls(e)},removeClass(e){this.el.removeCls(e)},removeCls(e){this.el.removeCls(e)},hasClass(e){return this.el.hasCls(e)},hasCls(e){return this.el.hasCls(e)},toggleClass(e){this.el.toggleCls(e)},toggleCls(e){this.el.toggleCls(e)},destroy(){this.el&&this.el.dom&&this.el.destroy()},show(){this.el.show()},hide(){this.el.hide()},isVisible(){return"none"!==this.el.css("display")},initTpl(){this.tpl&&(this.tpl=new Fancy.Template(this.tpl))}}),Fancy.define("Fancy.Plugin",{extend:Fancy.Event,constructor:function(){this.Super("const",arguments),this.init()},init(){this.initId(),this.addEvents("beforerender","afterrender","render","show","hide","destroy")},initTpl(){const e=this.tpl;e&&(this.tpl=new Fancy.Template(e))}}),function(){const e={},t=Fancy,i=t.GRID_CLS,n=t.PANEL_BODY_CLS,s=t.BUTTON_CLS,r=t.BUTTON_DISABLED_CLS,o=t.BUTTON_PRESSED_CLS,a=t.BUTTON_IMAGE_CLS,l=t.BUTTON_IMAGE_COLOR_CLS,d=t.BUTTON_TEXT_CLS,c=t.BUTTON_DROP_CLS,h=t.BUTTON_MENU_CLS;t.define("Fancy.Button",{extend:t.Widget,minWidth:30,constructor:function(t,i){const n=this;t.toggleGroup&&(e[t.toggleGroup]=e[t.toggleGroup]||{active:!1,items:[]},e[t.toggleGroup].items.push(n)),n.scope=i||t.scope||n.scope||n,n.Super("const",arguments)},init(){const e=this;e.addEvents("click","mousedown","mouseup","mouseover","mouseout","pressedchange","init-menu"),e.Super("init",arguments),e.style=e.style||{},e.initTpl(),e.render(),e.setOns()},setOns(){const e=this,t=e.el;t.on("click",e.onClick,e),t.on("mousedown",e.onMouseDown,e),t.on("mouseup",e.onMouseUp,e),t.on("mouseover",e.onMouseOver,e),t.on("mouseout",e.onMouseOut,e),e.tip&&t.on("mousemove",e.onMouseMove,e)},widgetCls:s,cls:"",extraCls:"",disabledCls:r,pressedCls:o,buttonImageCls:a,buttonImageColorCls:l,textCls:d,dropCls:c,text:"",height:28,paddingTextWidth:5,imageWidth:20,rightImageWidth:20,pressed:!1,theme:"default",tpl:['<div class="'+a+'"></div>','<a class="'+d+'">{text}</a>','<div class="'+c+'" style="{dropDisplay}"></div>'],render(){var e,i=this,n=t.newEl("div"),s=0,o=7;switch(i.theme&&Fancy.themes[i.theme]&&(o=Fancy.themes[i.theme].config.charWidth),i.i18n){case"zh-CN":case"zh-TW":case"ja":case"ko":o=10}if(i.fire("beforerender"),i.wrapper&&i.renderWrapper(),e=t.get(i.renderTo||document.body).dom,i.width?s=i.width:!1!==i.text&&void 0!==i.text&&(s+=i.text.length*o+2*o),i.imageColor&&(i.imageCls=l),s<i.minWidth&&(s=(i.text&&i.text.length,i.minWidth)),i.imageCls&&i.text&&(s+=i.imageWidth),i.menu&&(s+=i.rightImageWidth),n.addCls(t.cls,i.widgetCls,i.cls,i.extraCls),i.disabled&&n.addCls(r),i.menu&&!1!==i.menuIcon&&n.addCls(h),n.css({width:s+"px",height:i.height+"px"}),i.hidden&&n.css("display","none"),n.css(i.style||{}),n.update(i.tpl.getHTML({text:i.text||""})),i.imageCls){const e=n.select(`.${a}`);i.imageColor&&e.css("background-color",i.imageColor),e.css("display","block"),t.isString(i.imageCls)&&e.addCls(i.imageCls)}i.id&&n.attr("id",i.id),i.el=t.get(e.appendChild(n.dom)),i.disabled&&i.disable(),i.pressed&&i.setPressed(i.pressed),i.initToggle(),i.width=s,i.fire("afterrender"),i.fire("render")},renderWrapper(){const e=this,i=e.wrapper,n=t.get(e.renderTo||document.body).dom,s=t.newEl("div");s.css(i.style||{}),s.addCls(i.cls||""),e.wrapper=t.get(n.appendChild(s.dom)),e.renderTo=e.wrapper.dom},initToggle(){if(!this.enableToggle)return!1},setPressed(t,i){const n=this;if(t){if(n.addCls(o),n.pressed=!0,n.toggleGroup){const t=e[n.toggleGroup].active;t&&t.setPressed(!1),e[n.toggleGroup].active=n}}else n.removeCls(o),n.pressed=!1,n.toggleGroup&&delete e[n.toggleGroup].active;!1!==i&&n.fire("pressedchange",n.pressed)},toggle(){const e=!this.pressed;this.setPressed(e),this.pressed=e},onClick(e){let i=this,n=i.handler;i.fire("click"),!0!==i.disabled&&(n&&(t.isString(n)&&(n=i.getHandler(n)),i.scope?n.apply(i.scope,[i]):n(i)),i.enableToggle&&(i.toggleGroup?i.pressed?i.setPressed(!1):i.setPressed(!0):i.toggle()),i.menu&&(i.toggleMenuShow(e),i.toggle()))},getHandler(e){return t.getWidget(this.el.closest(`.${n}`).select(`.${i}`).attr("id"))[e]||function(){t.error("Handler does not exist")}},onMouseDown(){this.fire("mousedown")},onMouseUp(){this.fire("mouseup")},onMouseOver(e){const t=this;t.fire("mouseover"),t.tip&&t.renderTip(e)},renderTip(e){const i=this;i.tooltip&&i.tooltip.destroy(),i.tooltip=new t.ToolTip({text:i.tip}),i.tooltip.css("display","block"),i.tooltip.show(e.pageX+15,e.pageY-25)},onMouseOut(){const e=this;e.fire("mouseout"),e.tooltip&&(e.tooltip.destroy(),delete e.tooltip)},setText(e,t){let i=this,n=i.el,s=7;switch(i.text=e,i.theme&&Fancy.themes[i.theme]&&(s=Fancy.themes[i.theme].config.charWidth),i.i18n){case"zh-CN":case"zh-TW":case"ja":case"ko":s=10}t||(t=0),t||(t+=e.length*s+2*s,i.imageColor&&(i.imageCls=l),t<i.minWidth&&(t=(i.text&&i.text.length,i.minWidth)),i.imageCls&&i.text&&(t+=i.imageWidth),i.menu&&(t+=i.rightImageWidth)),i.css("width",t),n.select(`.${d}`).update(e)},disable(){this.disabled=!0,this.addCls(r)},enable(){this.disabled=!1,this.removeCls(r)},onMouseMove(e){const t=this;t.tip&&t.tooltip&&t.tooltip.show(e.pageX+15,e.pageY-25)},toggleMenuShow(){const e=this,i=e.el.$dom.offset(),n=[i.left,i.top+e.el.$dom.height()];e.pressed?e.menu.hide():(t.isArray(e.menu)?e.initMenu():e.menu.type||e.initMenu(),setTimeout(()=>{e.menu.showAt(n[0],n[1])},100))},initMenu(){const e=this,i={theme:e.theme,events:[{hide:e.onMenuHide,scope:e}]};t.isObject(e.menu)?t.apply(i,e.menu):i.items=e.menu,e.menu=new t.Menu(i),e.fire("init-menu")},onMenuHide(){this.setPressed(!1)}})}(),Fancy.define("Fancy.SegButton",{extend:Fancy.Widget,constructor:function(e,t){this.scope=t,this.Super("const",arguments)},init(){const e=this;e.addEvents("toggle"),e.Super("init",arguments),e.style=e.style||{},e.render()},widgetCls:Fancy.SEG_BUTTON_CLS,cls:"",extraCls:"",text:"",render(){let e,t=this,i=Fancy.newEl("div");t.fire("beforerender"),e=Fancy.get(t.renderTo||document.body).dom,i.addCls(Fancy.cls,t.widgetCls,t.cls,t.extraCls),t.hidden&&i.css("display","none"),t.el=Fancy.get(e.appendChild(i.dom)),Fancy.each(t.style,(e,i)=>{t.el.css(i,e)}),t.renderButtons(),t.fire("afterrender"),t.fire("render")},renderButtons(){for(var e=this,t=e.items,i=0,n=t.length,s=Fancy.id(null,"fancy-toggle-group-");i<n;i++){const r=t[i];r.renderTo=e.el.dom,!1!==e.allowToggle&&(r.enableToggle=!0,!0!==e.multiToggle&&(r.toggleGroup=s)),0===i?(r.style={"border-right-width":0,"border-top-right-radius":0,"border-bottom-right-radius":0},1===n&&delete r.style["border-right-width"]):r.style=i>1?{"border-left-width":0,"border-top-left-radius":0,"border-bottom-left-radius":0}:{"border-top-left-radius":0,"border-bottom-left-radius":0},t.length>2&&0!==i&&i!==n-1&&Fancy.apply(r.style,{"border-top-right-radius":0,"border-bottom-right-radius":0,"border-top-left-radius":0,"border-bottom-left-radius":0}),e.items[i]=new Fancy.Button(r),e.items[i].on("pressedchange",function(t,i){e.fire("toggle",t,i,e.getValues())})}},getValues(){for(var e=[],t=this.items,i=0,n=t.length;i<n;i++)e.push(t[i].pressed);return e},clear(e){for(var t=this.items,i=0,n=t.length;i<n;i++)t[i].setPressed(!1,e)},setItems(e){this.el.update(""),this.items=e,this.renderButtons()},setActiveItem(e,t){this.items[e].setPressed(!0,t)},setValue(e){const t=this.items;switch(this.clear(!1),Fancy.typeOf(e)){case"array":Fancy.each(e,function(e){switch(Fancy.typeOf(e)){case"string":Fancy.each(t,function(t){t.value===e&&t.setPressed(!0,!0)});break;case"number":t[e].setPressed(!0,!0)}});break;case"string":Fancy.each(t,function(t){t.value===e&&t.setPressed(!0,!0)});break;case"number":var i=t[e];i&&i.setPressed(!0,!0)}}}),Fancy.define("Fancy.toolbar.Tab",{extend:Fancy.Button,constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments)},cls:`${Fancy.BUTTON_CLS} ${Fancy.TAB_TBAR_CLS}`,render(){this.Super("render",arguments)}}),Fancy.modules.menu=!0,function(){const e=Fancy,t=e.MENU_CLS,i=e.MENU_ITEM_CLS,n=e.MENU_ITEM_IMAGE_CLS,s=e.MENU_ITEM_TEXT_CLS,r=e.MENU_ITEM_SIDE_TEXT_CLS,o=e.MENU_ITEM_ACTIVE_CLS,a=e.MENU_ITEM_RIGHT_IMAGE_CLS,l=e.MENU_ITEM_EXPAND_CLS,d=e.MENU_ITEM_DISABLED_CLS,c=e.MENU_ITEM_SEP_CLS,h=e.MENU_ITEM_NO_IMAGE_CLS;Fancy.define("Fancy.Menu",{extend:Fancy.Widget,constructor:function(e){Fancy.applyConfig(this,e),this.theme&&(this.itemHeight=Fancy.themes[this.theme].config.menuItemHeight),this.Super("const",arguments)},init(){const e=this;e.addEvents("hide"),e.Super("init",arguments),e.width<e.minWidth&&(e.width=e.minWidth),e.applyDefaults(),e.render(),e.ons()},ons(){const e=this,t=e.el;t.on("mousedown",e.onItemMouseDown,e,`.${i}`),t.on("click",e.onItemClick,e,`.${i}`),t.on("mouseenter",e.onItemEnter,e,`.${i}`),t.on("mouseleave",e.onItemLeave,e,`.${i}`)},widgetCls:t,itemCls:i,itemImageCls:n,cls:"",extraCls:"",width:142,minWidth:50,itemHeight:30,maxHeight:200,rendered:!1,theme:"default",render(){const e=this,t=Fancy.newEl("div");let i;e.fire("beforerender"),"default"!==e.theme&&t.addCls(Fancy.getThemeCSSCls(e.theme)),t.addClass(Fancy.cls,e.widgetCls,e.cls,e.extraCls),e.width<e.minWidth&&(e.width=e.minWidth),t.css({width:e.width,height:e.getItemsHeight()}),e.height&&t.css({height:e.height,"overflow-y":"scroll"}),i=Fancy.get(e.renderTo||document.body),e.el=i.dom.appendChild(t.dom),e.el=Fancy.get(e.el),e.renderItems(),e.items.length||e.el.css("border","0px"),e.fire("afterrender"),e.fire("render"),e.rendered=!0,e.checkHeight()},checkHeight(){const e=this;parseInt(e.el.css("height"))>e.maxHeight&&e.el.css({height:e.maxHeight,"overflow-y":"scroll"})},getItemsHeight(){for(var e=this.items,t=this.itemHeight,i=0,n=0,s=e.length;n<s;n++){var r=e[n];"sep"===r.type||"-"===r.type||"-"===r?i+=2:i+=t}return i},renderItems(){for(var e,t=this,i=0,o=t.items.length;i<o;i++){"-"===(e=t.items[i])&&(e={type:"sep"});const o=Fancy.newEl("div");o.attr("index",i),o.addCls(t.itemCls),"sep"===e.type?o.addCls(c):o.css("height",t.itemHeight),t.el.dom.appendChild(o.dom),e.el=o;const u=e.imageCls||"";if(e.cls&&o.addCls(e.cls),"sep"!==e.type&&"-"!==e.type){const t=[!1===e.image?"":'<div class="'+n+" "+u+'"></div>','<div class="'+s+'"></div>'];e.sideText&&t.push('<div class="'+r+'">'+e.sideText+"</div>"),t.push('<div class="'+a+" "+(e.items?l:"")+'"></div>'),o.update(t.join(""))}switch(!1===e.image&&o.addCls(h),!0===e.disabled&&o.addCls(d),e.type){case"":case"-":case"sep":break;case"number":t.items[i].field=new Fancy.NumberField({label:!1,theme:t.theme,padding:"1px 0px 0px",width:90,renderAfter:o.select("."+n).item(0).dom,events:t.items[i].events,value:e.value||""});break;case"string":t.items[i].field=new Fancy.StringField({label:!1,theme:t.theme,padding:"1px 0px 0px",width:90,renderAfter:o.select("."+n).item(0).dom,events:t.items[i].events,value:e.value||""});break;default:o.select("."+s).item(0).update(e.text||"")}void 0!==e.checked&&(t.items[i].checkbox=new Fancy.CheckBox({label:!1,theme:t.theme,padding:"1px 8px 0px",renderTo:o.select("."+n).item(0).dom,value:e.checked}))}},applyDefaults(){var e=0,t=this.items.length;if(this.defaults)for(;e<t;e++)Fancy.applyIf(this.items[e],this.defaults)},onItemClick(e){var t=Fancy.get(e.currentTarget).attr("index"),i=this.items[t],n=[this,i];i.handler&&!i.disabled&&(i.scope?i.handler.apply(i.scope,n):i.handler(this,i))},onItemEnter(e){var t=this,i=Fancy.get(e.currentTarget),n=i.attr("index"),s=t.items[n],r=i.offset();if(t.shownSubMenu&&t.shownSubMenu.hide(),t.deActivateItem(),t.activateItem(n),s.items){if(!s.menu){const e=t.items[n];Fancy.apply(e,{parentItem:s,parentMenu:t,defaults:s.defaults,items:s.items,theme:t.theme}),t.items[n].menu=new Fancy.Menu(e)}s.menu.showAt(r.left+parseInt(i.width()),r.top),t.shownSubMenu=s.menu}},onItemLeave(){},showAt(t,i,n){const s=this;s.css("position","absolute"),s.css("left",t),s.css("top",i),s.css("z-index",1e3+e.zIndex++),s.el.show(),!1!==n&&(!s.parentMenu&&Fancy.MenuManager.activeMenu&&Fancy.MenuManager.activeMenu.id!==s.id&&Fancy.MenuManager.remove(),s.checkPosition()),s.parentMenu||Fancy.MenuManager.add(s)},hide(){const e=this;e.el.hide(),e.deActivateItem(),e.shownSubMenu&&e.shownSubMenu.hide(),e.fire("hide")},hideAll(){const e=this.parentMenu;e&&"none"!==e.el.css("display")&&e.hide(),this.hide()},activateItem(e){const t=this.items[e];"sep"===t.type||"-"===t||t.disabled||(this.activeItem=t,t.el.addCls(o))},deActivateItem(){const e=this.activeItem;e&&(e.el.removeClass(o),delete this.activeItem)},onItemMouseDown(e){"input"===e.target.tagName.toLocaleLowerCase()||e.preventDefault()},enableItem(e){const t=this.items[e];t.el.removeCls(d),t.disabled=!1},disableItem(e){const t=this.items[e];t.el.addCls(d),t.disabled=!0},checkPosition(){var t=this.el,i=t.offset(),n=parseInt(t.css("height")),s=parseInt(t.css("width")),r=e.getViewSize(),o=e.getScroll(),a=i.top+n,l=i.left+s,d=i.top,c=i.left;(a>r[0]+o[0]-20&&(d=i.top-(a-(r[0]+o[0]))-20),l>r[1]+o[1]-20)&&(c=this.parentMenu?parseInt(this.parentMenu.el.css("left"))-s:i.left-(l-(r[1]+o[1]))-20);this.showAt(c,d,!1)},setChecked(t,i){const n=this;i&&n.clearChecked();const s=n.el.select(".fancy-menu-item").item(t);e.getWidget(s.select(".fancy-field-checkbox").attr("id")).set(!0)},clearChecked(){this.el.select(".fancy-checkbox-on").each(t=>{const i=t.attr("id");e.getWidget(i).set(!1)})}}),Fancy.define("Fancy.MenuManager",{singleton:!0,inited:!1,constructor:function(){},init(){Fancy.get(document).on("click",this.onDocClick,this)},add(e){const t=this;t.inited||t.init(),t.activeMenu=e},remove(){this.activeMenu&&(this.activeMenu.hide(),delete this.activeMenu)},onDocClick(e){var i=10,n=Fancy.get(e.target);if(this.activeMenu){for(;i>0&&n.dom;){if(n.hasCls(t))return;n=n.parent(),i--}this.remove()}}})}(),function(){const e=Fancy,t=e.FOOTER_STATUS_CLS,i=e.STATUS_SOURCE_TEXT_CLS,n=e.STATUS_SOURCE_LINK_CLS,s=e.FOOTER_SOURCE_CLS;Fancy.Mixin("Fancy.panel.mixin.PrepareConfig",{prepareConfigTheme(e,t){const i=e.theme||t.theme,n=Fancy.getTheme(i).config;return Fancy.isObject(i)&&(e.theme=i.name),Fancy.applyIf(e,n),e.theme&&(this.theme=e.theme),e},prepareConfigFooter(e){const r=e.footer,o=e.lang;if(r){const a=[];if(Fancy.isString(r.status)&&a.push({type:"text",text:r.status,cls:t}),r.status&&r.source&&a.push("side"),Fancy.isString(r.source))a.push({type:"text",text:r.source,cls:s});else if(Fancy.isObject(r.source)){let e=r.source.text,t=r.source.sourceText||o.sourceText;if(r.source.link){let s=r.source.link;s=(s=s.replace("http://","")).replace("https://",""),e=`<span class="${i}">${t}</span>: <a class="${n}" href="${s=`https://${s}`}">${e}</a>`}else e=`<span>${t}:</span> ${e}`;a.push({type:"text",text:e,cls:s})}e.footer=a}return e},prepareConfigLang(e,t){const i=e.i18n||t.i18n,n=Fancy.Object.copy(Fancy.i18n[i]);if(e.lang){for(var s in e.lang)switch(Fancy.isObject(e.lang[s])){case!1:case void 0:n[s]=e.lang[s]}for(var s in n.paging={},e.lang.paging&&Fancy.apply(n.paging,e.lang.paging),e.lang.paging)"paging"!==s&&(Fancy.isObject(s)||(n[s]=e.lang.paging[s]));n.date={},e.lang.date&&Fancy.apply(n.date,e.lang.date)}return e.lang=n,e}})}(),Fancy.Mixin("Fancy.panel.mixin.methods",{setTitle(e){this.panel&&this.panel.setTitle(e)},getTitle(){if(this.panel)return this.panel.getTitle()},setSubTitle(e){this.panel&&this.panel.setSubTitle(e)},getSubTitle(){if(this.panel)return this.panel.getSubTitle()}}),Fancy.Mixin("Fancy.panel.mixin.DD",{ddCls:Fancy.PANEL_DRAGGABLE_CLS,initDD(){this.addDDCls(),this.addDD()},addDDCls(){this.el.addCls(this.ddCls)},addDD(){Fancy.DD.add({dragEl:this.el,overEl:this.el.select(`.${Fancy.PANEL_HEADER_CLS}`).item(0)})}}),Fancy.Mixin("Fancy.panel.mixin.Resize",{cornerResizeCls:"fancy-panel-resize-corner",resizeMaskCls:"fancy-panel-resize-mask",initResize(){this.activeResizeEl=void 0,this.renderResizeEls(),this.onsResizeEls()},renderResizeEls(){const e=this.el,t=Fancy.newEl("div");t.addCls(this.cornerResizeCls),this.cornerResizeEl=Fancy.get(e.dom.appendChild(t.dom))},onResize(){const e=this;e.tbar&&e._tbar.applyScrollChanges(),e.subTBar&&e._subTBar.applyScrollChanges(),e.bbar&&e._bbar.applyScrollChanges(),e.footer&&e._footer.applyScrollChanges(),e.buttons&&e._buttons.applyScrollChanges();const t=e.items[0];t&&"grid"===t.type&&t.infinite&&(delete t.numOfVisibleCells,t.update())},onsResizeEls(){const e=this;Fancy.isTouch?e.cornerResizeEl.on("touchstart",e.onMouseDownResizeEl,e):e.cornerResizeEl.on("mousedown",e.onMouseDownResizeEl,e),e.on("resize",e.onResize,e)},onMouseDownResizeEl(e){const t=this,i=Fancy.get(document);if(e.preventDefault(),Fancy.nojQuery&&t.el.select(`.${Fancy.GRID_ANIMATION_CLS}`).removeCls(Fancy.GRID_ANIMATION_CLS),Fancy.isTouch){const n=(e=e.originalEvent||e).changedTouches[0];i.once("touchend",t.onMouseUpResize,t),i.on("touchmove",t.onMouseMoveResize,t),t.renderResizeMask(),t.startClientX=n.clientX,t.startClientY=n.clientY}else i.once("mouseup",t.onMouseUpResize,t),i.on("mousemove",t.onMouseMoveResize,t),t.renderResizeMask(),t.startClientX=e.clientX,t.startClientY=e.clientY},onMouseUpResize(){const e=this,t=Fancy.get(document);delete e.activeResizeEl,e.resizeMaskEl.destroy(),delete e.startClientX,delete e.startClientY,t.un("mousemove",e.onMouseMoveResize,e),e.setWidth(e.newResizeWidth),e.setHeight(e.newResizeHeight),e.fire("resize",{width:e.newResizeWidth,height:e.newResizeHeight}),Fancy.nojQuery&&e.el.select(".fancy-grid").addCls(Fancy.GRID_ANIMATION_CLS)},onMouseMoveResize(e){let t=this,i=e.clientX,n=e.clientY;if(Fancy.isTouch){const t=(e=e.originalEvent||e).originalEvent.changedTouches[0];i=t.clientX,n=t.clientY}let s=t.startClientX-i,r=t.startClientY-n,o=t.startResizeWidth-s,a=t.startResizeHeight-r;e.preventDefault(),e.stopPropagation(),o<t.minWidth&&(o=t.minWidth),a<t.minHeight&&(a=t.minHeight),t.newResizeWidth=o,t.newResizeHeight=a,t.resizeMaskEl.css({width:o,height:a})},renderResizeMask(){const e=this,t=e.el;let i=Fancy.newEl("div"),n=parseInt(t.css("top")),s=parseInt(t.css("left")),r=parseInt(t.css("width"))-4,o=parseInt(t.css("height"))-4,a=parseInt(t.css("z-index"));if(e.startResizeWidth=r,e.startResizeHeight=o,!e.window&&"absolute"!==t.css("position")){const e=t.offset();n=e.top,s=e.left}i.addCls(e.resizeMaskCls),i.css({left:s,top:n,width:r,height:o,"z-index":a}),e.resizeMaskEl=Fancy.get(document.body.appendChild(i.dom))}}),function(){const e=Fancy,t=e.HIDDEN_CLS,i=e.MODAL_CLS,n=e.PANEL_CLS,s=e.PANEL_HEADER_CLS,r=e.PANEL_SUB_HEADER_TEXT_CLS,o=e.PANEL_HEADER_TEXT_CLS,a=e.PANEL_HEADER_TOOLS_CLS,l=e.PANEL_SUB_HEADER_CLS,d=e.PANEL_BODY_CLS,c=e.PANEL_BODY_INNER_CLS,h=e.PANEL_TBAR_CLS,u=e.PANEL_SUB_TBAR_CLS,g=e.PANEL_BUTTONS_CLS,p=e.PANEL_BBAR_CLS,m=e.PANEL_HEADER_IMG_CLS,f=e.PANEL_NOFRAME_CLS,y=e.PANEL_SHADOW_CLS,C=e.PANEL_FOOTER_CLS,v=e.FIELD_PICKER_BUTTON_CLS;e.define("Fancy.Panel",{extend:e.Widget,barScrollEnabled:!0,tabScrollStep:80,mixins:["Fancy.panel.mixin.DD","Fancy.panel.mixin.Resize"],constructor:function(t){e.apply(this,t),this.Super("constructor",arguments)},init(){const e=this;e.Super("init",arguments),e.addEvents("resize"),e.initTpl(),e.render(),e.draggable&&e.initDD(),e.resizable&&e.initResize(),e.window&&e.setActiveWindowWatcher()},cls:"",fieldCls:n,value:"",width:300,height:200,titleHeight:30,subTitleHeight:30,barHeight:37,title:void 0,frame:!0,shadow:!0,draggable:!1,minWidth:200,minHeight:200,barContainer:!0,theme:"default",tpl:['<div style="height:{titleHeight}px;" class="'+s+" "+t+'">',"{titleImg}",'<div class="'+o+'">{title}</div>','<div class="'+a+'"></div>',"</div>",'<div style="height:{subTitleHeight}px;" class="'+l+" "+t+'">','<div class="'+r+'">{subTitle}</div>',"</div>",'<div class="'+d+'">','<div class="'+h+" "+t+'" style="height:{tbarHeight}px;"></div>','<div class="'+u+" "+t+'" style="height:{subTBarHeight}px;"></div>','<div class="'+c+'"></div>','<div class="'+p+" "+t+'" style="height:{bbarHeight}px;"></div>','<div class="'+g+" "+t+'" style="height:{buttonsHeight}px;"></div>','<div class="'+C+" "+t+'" style="height:{barHeight}px;"></div>',"</div>"],render(){var n=this,r=e.get(n.renderTo||document.body),o=e.newEl("div"),a=n.titleHeight,c=n.subTitleHeight;n.renderOuter&&(o=r),r.dom||e.error(`Could not find renderTo element: ${n.renderTo}`,1),!0===n.window&&o.css({display:"none",position:"absolute"}),!1===n.frame&&o.addCls(f),o.addCls(e.cls,n.cls,n.fieldCls),"default"!==n.theme&&o.addCls(Fancy.getThemeCSSCls(n.theme)),n.shadow&&o.addCls(y),o.css({width:`${n.width}px`,height:n.height-0+"px"}),n.style&&o.css(n.style);let v="",w="";e.isObject(n.title)?v=n.title.text:e.isString(n.title)&&(v=n.title),e.isObject(n.subTitle)?w=n.subTitle.text:e.isString(n.subTitle)&&(w=n.subTitle);let b="";e.isObject(n.title)&&n.title.imgCls&&(b=`<div class="${m} ${n.title.imgCls}"></div>`),o.update(n.tpl.getHTML({titleImg:b,barHeight:n.barHeight,subTBarHeight:n.subTBarHeight||n.barHeight,tbarHeight:n.tbarHeight||n.barHeight,bbarHeight:n.bbarHeight||n.barHeight,buttonsHeight:n.buttonsHeight||n.barHeight,titleHeight:a,subTitleHeight:c,title:v,subTitle:w})),e.isObject(n.title)&&(n.title.style&&o.select(`.${s}`).css(n.title.style),n.title.cls&&o.select(`.${s}`).addCls(n.title.cls),n.title.tools&&(n.tools=n.title.tools)),e.isObject(n.subTitle)&&(n.subTitle.style&&o.select(`.${l}`).css(n.subTitle.style),n.subTitle.cls&&o.select(`.${l}`).addCls(n.subTitle.cls)),n.title?o.select(`.${s}`).removeCls(t):o.select(`.${d}`).css("border-top-width","0px"),n.subTitle&&(o.select(`.${d}`).css("border-top-width","0px"),o.select(`.${l}`).removeCls(t)),n.tbar&&o.select(`.${h}`).removeCls(t),n.subTBar&&o.select(`.${u}`).removeCls(t),n.bbar&&o.select(`.${p}`).removeCls(t),n.buttons&&o.select(`.${g}`).removeCls(t),n.footer&&o.select(`.${C}`).removeCls(t),n.renderOuter?n.el=o:(n.el=r.dom.appendChild(o.dom),n.el=e.get(n.el)),n.modal&&0===e.select(i).length&&e.get(document.body).append(`<div class="${i}" style="display: none;"></div>`),n.id&&!n.el.attr("id")&&n.el.attr("id",n.id),n.renderTools(),n.renderBars(),n.setHardBordersWidth()},setHardBordersWidth(){const e=this.panelBodyBorders;this.el.select(`.${d}`).css({"border-top-width":e[0],"border-right-width":e[1],"border-bottom-width":e[2],"border-left-width":e[3]})},renderTools(){const t=this,i=t.tools;void 0!==i&&e.each(i,function(i,n){i.renderTo=t.el.select(`.${a}`).dom,t.tools[n]=new e.Tool(i,t.scope||t)})},renderBars(){var t=this,i=!1,n=t.theme,s=this;t.items&&t.items[0]&&("grid"===t.items[0].type&&(i=!0),s=t.items[0]),t.bbar&&(t._bbar=new e.Bar({el:t.el.select(`.${p}`),items:t.bbar,height:t.bbarHeight||t.barHeight,barContainer:t.barContainer,barScrollEnabled:t.barScrollEnabled,tabScrollStep:t.tabScrollStep,hidden:!0===t.bbarHidden,scope:s,theme:n,i18n:this.i18n}),t.bbar=t._bbar.items),t.buttons&&(t._buttons=new e.Bar({el:t.el.select(`.${g}`),items:t.buttons,height:t.buttonsHeight||t.barHeight,barScrollEnabled:t.barScrollEnabled,tabScrollStep:t.tabScrollStep,hidden:!0===t.buttonsHidden,scope:s,theme:n}),t.buttons=t._buttons.items),t.tbar&&(t._tbar=new e.Bar({el:t.el.select(`.${h}`),items:t.tbar,height:t.tbarHeight||t.barHeight,tabEdit:!t.subTBar&&i,barScrollEnabled:t.barScrollEnabled,tabScrollStep:t.tabScrollStep,hidden:!0===t.tbarHidden,scope:s,theme:n}),t.tbar=t._tbar.items),t.subTBar&&(t._subTBar=new e.Bar({el:t.el.select(`.${u}`),items:t.subTBar,height:t.subTBarHeight||t.barHeight,tabEdit:i,barScrollEnabled:t.barScrollEnabled,tabScrollStep:t.tabScrollStep,hidden:!0===t.subTBarHidden,scope:s,theme:n}),t.subTBar=t._subTBar.items),t.footer&&(t._footer=new e.Bar({disableScroll:!0,el:t.el.select(`.${C}`),items:t.footer,height:t.barHeight,barScrollEnabled:t.barScrollEnabled,tabScrollStep:t.tabScrollStep,scope:s,theme:n,isFooter:!0}),t.footer=t._footer.items)},showAt(t,i){this.css({left:`${t}px`,display:"","z-index":1e3+e.zIndex++}),void 0!==i&&this.css({top:i+"px"})},show(){const t=this;if(t.el.show(),!0!==t.window)return;t.buttons&&t._buttons.checkScroll(),t.tbar&&t._tbar.checkScroll(),t.bbar&&t._bbar.checkScroll(),t.subTBar&&t._subTBar.checkScroll();const n=e.getViewSize(),s=t.el.height(),r=t.el.width(),o=[],a=e.getScroll(),l=a[0],d=a[1];o[0]=(n[1]-r)/2,o[1]=(n[0]-s)/2,o[0]<10&&(o[0]=10),o[1]<10&&(o[1]=10),t.css({left:o[0]+d+"px",top:o[1]+l+"px",display:"","z-index":1e3+e.zIndex++}),t.modal&&e.select(`.${i}`).css({display:"","z-index":1e3+e.zIndex-2})},hide(){this.css({display:"none"}),this.modal&&e.select(`.${i}`).css("display","none"),e.each(this.items||[],e=>{"combo"===e.type&&e.hideList()})},setTitle(e){this.el.select(`.${o}`).update(e)},getTitle(){return this.el.select(`.${o}`).dom.innerHTML},setSubTitle(e){this.el.select(`.${r}`).update(e)},getSubTitle(){return this.el.select(`.${r}`).dom.innerHTML},getHeight(){return parseInt(this.css("height"))},setWidth(e){this.items[0].setWidth(e)},setHeight(e){this.css("height",e),this.items[0].setHeight(e,!1)},setActiveWindowWatcher(){const t=this;t.el.on("mousedown",function(i){e.get(i.target).hasCls(v)||(1e3+e.zIndex-1>parseInt(t.css("z-index"))&&t.css("z-index",1e3+e.zIndex++),e.get(document.body).select(".fancy-active-panel").removeCls("fancy-active-panel"),t.el.addCls("fancy-active-panel"))})}})}(),function(){const e=Fancy,t=e.BUTTON_CLS;e.define("Fancy.Tool",{extend:e.Widget,constructor:function(e,t){this.scope=t,this.Super("const",arguments)},init(){const e=this;e.addEvents("click","mousedown","mouseup","mouseover","mouseout"),e.Super("init",arguments),e.style=e.style||{},e.render(),e.ons()},ons(){this.el.on("click",this.onClick,this)},cls:t,text:"",height:28,paddingTextWidth:5,render(){const t=this,i=e.get(t.renderTo||document.body).dom,n=e.newDomEl("div");t.fire("beforerender"),n.className="fancy-tool-button",n.innerHTML=t.text,t.el=e.get(i.appendChild(n)),t.fire("afterrender"),t.fire("render")},onClick(){const e=this;e.fire("click"),e.handler&&(e.scope?e.handler.apply(e.scope,[e]):e.handler(e))},setText(e){this.el.update(e)}})}(),function(){var e=Fancy;const t=e.PANEL_BODY_INNER_CLS,i=e.PANEL_GRID_INSIDE_CLS,n=e.TAB_WRAPPER_CLS,s=e.TAB_ACTIVE_WRAPPER_CLS,r=e.TAB_TBAR_ACTIVE_CLS,o=e.PANEL_TAB_CLS,a=e.PANEL_CLS,l=e.GRID_CLS;e.define(["Fancy.panel.Tab","Fancy.Tab","FancyTab"],{extend:e.Panel,constructor:function(e,t){const i=this,n=function(){Fancy.isDom(e)?(t=t||{}).renderTo=e:t=e,(t=t||{}).renderOuter&&(t.renderTo=t.renderOuter),Fancy.loadStyle(),i.prepareConfigTheme(t),i.prepareConfigSize(t),Fancy.applyConfig(i,t),i.Super("const",arguments)};Fancy.fullBuilt||!1===Fancy.MODULELOAD?n():!Fancy.nojQuery||Fancy.modules.dom||Fancy.modules.grid?n():Fancy.loadModule("dom",function(){Fancy.loadModule("grid",function(){n()})})},init(){const e=this;e.prepareTabs(),e.Super("init",arguments),e.setActiveTab(e.activeTab),e.ons()},activeTab:0,theme:"default",render:function(){const e=this;e.Super("render",arguments),Fancy.loadingStyle&&(e.el.css("opacity",0),e.intervalStyleLoad=setInterval(()=>{Fancy.loadingStyle||(clearInterval(e.intervalStyleLoad),e.el.animate({opacity:1,force:!0}))},100)),e.panelBodyEl=e.el.select(`.${t}`).item(0),e.setPanelBodySize(),e.renderTabWrappers(),e.wrapped||e.el.addCls(i),e.el.addCls(o),e.rendered=!0},ons(){const t=this;t.responsive&&e.$(window).bind("resize",function(){t.onWindowResize(),clearInterval(t.intWindowResize),t.intWindowResize=setTimeout(()=>{t.onWindowResize(),delete t.intWindowResize,setTimeout(()=>{t.onWindowResize()},300)},30)})},onWindowResize(){var t,i=this,s=i.renderTo;i.panel&&(s=i.panel.renderTo),((t=i.responsive?e.get(s):i.panel?i.panel.el:e.get(s)).hasClass(a)||t.hasClass(l))&&(t=t.parent());let r=t.width();if(void 0===t.dom)return;if(0===r&&(r=t.parent().width()),i.responsive&&i.setWidth(r),i.responsiveHeight){let e=parseInt(t.height());0===e&&(e=parseInt(t.parent().height())),i.setHeight(e)}i.setPanelBodySize(),i.el.select(`.${n} .${a}:first-child`).forEach(e=>{e.css({height:"auto",width:"auto"})})},setPanelBodySize(){let e=this,t=e.height,i=e.panelBodyBorders;e.title&&(t-=e.titleHeight),e.subTitle&&(t-=e.subTitleHeight,t+=i[2]),e.bbar&&(t-=e.bbarHeight||e.barHeight),e.tbar&&(t-=e.tbarHeight||e.barHeight),e.subTBar&&(t-=e.subTBarHeight||e.barHeight),e.buttons&&(t-=e.buttonsHeight||e.barHeight),e.footer&&(t-=e.barHeight),t-=i[0]+i[2],e.panelBodyEl.css({height:t}),e.panelBodyHeight=t,e.panelBodyWidth=e.width-i[1]-i[3]},prepareConfigTheme(t){const i=this,n=t.theme||i.theme,s=e.getTheme(n).config;(i.wrapped||t.wrapped)&&(t.panelBodyBorders=[0,0,0,0],i.panelBodyBorders=[0,0,0,0]),e.applyIf(t,s),e.apply(i,t)},prepareConfigSize(e){let t,i=e.renderTo;if(void 0===e.width&&i&&(e.responsive=!0,t=Fancy.get(i),e.width=parseInt(t.width())),void 0===e.height&&i){e.responsiveHeight=!0,t=Fancy.get(i);let n=parseInt(t.height());n<50&&(n=parseInt(t.parent().css("height"))),e.height=n}},prepareTabs(){const e=this;let t=[],i=0,n=e.items.length;for(;i<n;i++){const n=e.items[i],s={type:"tab"};n.tabTitle?s.text=n.tabTitle:n.title&&(s.text=n.title,delete n.title),s.handler=function(t){return function(){e.setActiveTab(t)}}(i),t.push(s)}e.tbar=t,e.tabs=t},renderTabWrappers(){const t=this;t.items.forEach(i=>{const s=e.newEl("div");s.addCls(n),i.renderTo=t.panelBodyEl.dom.appendChild(s.dom)})},setActiveTab(e){const t=this,i=t.el.select(`.${n}`),o=t.activeTab;if(0===t.items.length)return;i.item(t.activeTab).removeCls(s),t.activeTab=e,i.item(t.activeTab).addCls(s);const a=t.items[t.activeTab];if(a.theme=t.theme,a.wrapped=!0,a.width=t.panelBodyWidth,a.height=t.panelBodyHeight,a.rendered)t.setActiveItemWidth(),t.setActiveItemHeight();else switch(a.type){case"form":t.items[t.activeTab]=new FancyForm(a);break;case"grid":t.items[t.activeTab]=new FancyGrid(a);break;case"tab":t.items[t.activeTab]=new FancyTab(a)}t.tabs&&(t.tbar[o].removeCls(r),t.tbar[t.activeTab].addCls(r))},setWidth(e){this.width=e,this.css("width",e),this.setPanelBodySize(),this.setActiveItemWidth()},setHeight(e){this.height=e,this.css("height",e),this.setPanelBodySize(),this.setActiveItemHeight()},setActiveItemWidth(){0!==this.items.length&&this.items[this.activeTab].setWidth(this.panelBodyWidth)},setActiveItemHeight(){0!==this.items.length&&this.items[this.activeTab].setHeight(this.panelBodyHeight,!1)}}),FancyTab.get=(t=>{const i=e.get(t).select(`.${o}`).dom.id;return e.getWidget(i)}),!e.nojQuery&&e.$&&(e.$.fn.FancyTab=function(t){return this.selector?t.renderTo=e.$(this.selector)[0].id:t.renderTo=this.attr("id"),new FancyTab(t)})}(),function(){const e=Fancy,t=e.GRID_CLS,i=e.GRID_CELL_CLS,n=e.BAR_CLS,s=e.BAR_CONTAINER_CLS,r=e.BAR_BUTTON_CLS,o=e.BAR_SEG_BUTTON_CLS,a=e.BAR_LEFT_SCROLLER_CLS,l=e.BAR_RIGHT_SCROLLER_CLS,d=e.FIELD_LABEL_CLS,c=e.FIELD_TEXT_CLS,h=e.FIELD_TEXT_INPUT_CLS,u=e.FIELD_SEARCH_CLS,g=e.FIELD_SEARCH_LIST_CLS,p=e.FIELD_SEARCH_PARAMS_LINK_CLS,m=e.FIELD_SEARCH_PARAMED_CLS,f=e.FIELD_SEARCH_PARAMED_EMPTY_CLS,y=e.PICKER_MONTH_ACTION_BUTTONS_CLS,C=e.CLEARFIX_CLS;e.define("Fancy.Bar",{extend:e.Widget,widgetCls:n,containerCls:s,cls:"",text:"",floating:"left",sideRight:3,scrolled:0,tabOffSet:5,tabScrollStep:80,barScrollEnabled:!0,constructor:function(t){e.apply(this,t),this.init()},init(){const e=this;e.roles={},e.render(),e.barScrollEnabled&&(e.initScroll(),setTimeout(function(){e.checkScroll()},150))},render(){this.renderEl(),this.renderItems(),this.initTabEdit()},renderEl(){const t=this;if(!t.el){const i=e.newEl("div");i.addCls(t.widgetCls,t.cls),i.update(t.text),t.el=e.get(t.renderTo.appendChild(i.dom)),t.style&&t.el.css(t.style)}t.hidden&&t.el.css("display","none");const i=e.newEl("div");i.addCls(t.containerCls),t.containerEl=e.get(t.el.dom.appendChild(i.dom))},renderItems(){for(var t=this,i=t.containerEl,n=t.items||[],s=0,r=n.length,o=!1,a=[],l=r-1,d=0;s<r;s++){var c=n[s];switch(o&&(c=n[l],l--),c.toggleGroup&&(c.enableToggle=!0),e.isObject(c)&&(c.type=c.type||"button"),o&&(t.floating="right",c.style=c.style||{},c.style.right=d),e.isObject(c)&&(c.renderTo=i.dom),c){case"|":const s={float:t.floating,"margin-right":"5px","margin-top":"6px","padding-left":"0px"};"right"===t.floating&&e.applyIf(s,{right:"1px",position:"absolute"}),a.push(new e.Separator({renderTo:i.dom,style:s}));continue;case"side":case"->":t.isFooter||(o=!0);continue;default:o?a[l]=t.renderItem(c):a.push(t.renderItem(c))}o&&(c.text?d+=7*c.text.length+5+5+5:c.width&&(d+=c.width+5),c.imageCls&&(c.imageWidth?d+=c.imageWidth:d+=20),d+=3)}t.items=a},renderItem(i){var n,s=this,a=s.containerEl,l=s.theme;switch(i.style=i.style||{},i.label=!1,i.padding=!1,i.theme=s.theme,e.applyIf(i.style,{float:s.floating}),"right"===s.floating&&e.applyIf(i.style,{right:s.sideRight,position:"absolute"}),!i.scope&&s.scope&&(i.scope=s.scope),i.type){case"wrapper":i.cls===y&&(a.destroy(),a=s.el);for(var v,w=a.append('<div class="'+(i.cls||"")+'"></div>').select("div").item(0),b=0,S=i.items.length,x=0;b<S;b++){v=i.items[b],e.isObject(v)&&(v.type=v.type||"button"),v.renderTo=w.dom;const t=(n=s.renderItem(v)).el;b===S-1?t.css("margin-right","0px"):x+=parseInt(t.css("margin-right")),e.nojQuery?x+=parseInt(t.width()):x+=parseInt(t.$dom.outerWidth()),x+=parseInt(t.css("margin-left"))}w.css("width",x);break;case void 0:case"button":i.extraCls=r,i.scope=i.scope||s.scope,n=new e.Button(i);break;case"segbutton":i.extraCls=o,e.applyIf(i.style,{"margin-right":"6px"}),n=new e.SegButton(i);break;case"tab":n=new e.toolbar.Tab(i);break;case"text":s.isFooter||e.applyIf(i.style,{"margin-right":"10px","padding-left":"0px","padding-top":"11px"}),e.apply(i,{renderTo:a.dom,cls:i.cls||""}),n=new e.bar.Text(i);break;case"combo":i.inputWidth=18,e.applyIf(i.style,{"padding-left":"0px","margin-right":"8px","margin-top":"4px"}),e.applyIf(i,{width:70}),n=new e.Combo(i);break;case"date":i.inputWidth=18,e.applyIf(i.style,{"padding-left":"0px","margin-right":"8px","margin-top":"4px"}),e.applyIf(i,{width:100}),n=new e.DateField(i);break;case"number":i.inputWidth=18,e.applyIf(i.style,{"padding-left":"0px","margin-right":"8px","margin-top":"4px"}),e.applyIf(i,{width:35}),n=new e.NumberField(i);break;case"checkbox":e.applyIf(i.style,{"padding-left":"0px","margin-right":"8px","margin-top":"4px"}),n=new e.CheckBox(i);break;case"switcher":e.applyIf(i.style,{"padding-left":"0px","margin-right":"8px","margin-top":"4px"}),e.applyIf(i,{width:35}),n=new e.Switcher(i);break;case"string":i.inputWidth=18,e.applyIf(i.style,{"padding-left":"0px","margin-right":"8px","margin-top":"4px"}),e.applyIf(i,{width:100}),n=new e.StringField(i);break;case"search":i.inputWidth=18,i.events=i.events||[],i.events=i.events.concat([{enter:function(i,n){const s=e.getWidget(i.el.parent().parent().parent().parent().select(`.${t}`).item(0).attr("id"));s.search(n),s.expander&&s.expander.reSet()}},{key:function(i,n){const s=this,r=e.getWidget(i.el.parent().parent().parent().parent().select(`.${t}`).item(0).attr("id"));r.filter&&!1===r.filter.autoEnterDelay||(s.autoEnterTime||(s.autoEnterTime=new Date),clearInterval(s.intervalAutoEnter),delete s.intervalAutoEnter,s.intervalAutoEnter=setInterval(function(){new Date-s.autoEnterTime>500&&(clearInterval(s.intervalAutoEnter),delete s.intervalAutoEnter,n=i.getValue(),r.search(n),r.expander&&r.expander.reSet())},200))}},{render:function(i){var n=this,s=!1;i.el.on("mouseenter",function(){s=!0},null,"."+p),i.el.on("mousedown",function(e){e.preventDefault()},null,"."+p),i.el.on("click",function(r){var o=!1,a=e.getWidget(i.el.parent().parent().parent().parent().select("."+t).attr("id")),d=a.columns||[],c=a.leftColumns||[],h=a.rightColumns||[],u=d.concat(c).concat(h),p=[],m=0,f=u.length,y=1;if(a.searching.items)e.each(a.searching.items,function(e){p.push({inputLabel:" &nbsp;&nbsp;"+e.text,value:!0,name:e.index}),y+=a.fieldHeight});else for(;m<f;m++){var C=u[m],v=C.title;if(void 0===v&&(v=""),!1!==C.searchable){switch(C.type){case"color":case"combo":case"date":case"number":case"string":case"text":case"currency":break;default:continue}y+=a.fieldHeight,p.push({inputLabel:" &nbsp;&nbsp;"+v,value:!0,name:C.index})}}if(n.list){if("none"!==n.list.el.css("display"))return void n.list.el.css("display","none");o=!0}else{var w=0;e.each(p,function(e){e.inputLabel.replace(/\&nbsp\;/g,"").length>w&&(w=e.inputLabel.length)});var b=150;w>15&&(b=9*w),n.list=new FancyForm({width:b,height:y,theme:l,defaults:{type:"checkbox",label:!1,style:{padding:"8px 16px 0px"}},items:p,cls:g,events:[{set:function(){a.searching.setKeys(n.list.get())}},{init:function(){setTimeout(function(){var t=n.list.el;t.on("mouseenter",function(){s=!0}),t.on("mouseleave",function(){s=!1,setTimeout(function(){!1===s&&n.list&&t.css("display","none")},750)});var o=e.get(r.target).offset(),a=parseInt(i.el.css("height"));t.css({position:"absolute",top:o.top+a+20,left:o.left}),n.list.el.css("display","block"),t.animate({duration:200,top:o.top+a-1})},50)}}]})}var S=e.get(r.target).offset(),x=parseInt(i.el.css("height"));n.list&&n.list.el&&(n.list.css({position:"absolute",top:S.top+x+20,left:S.left}),o&&n.list.css("display","block"),n.list.el.animate({duration:200,top:S.top+x-1}))},null,"."+p),i.el.on("mouseleave",function(){s=!1,setTimeout(function(){!1===s&&n.list&&n.list.el.css("display","none")},750)},null,"."+p)}}]),e.applyIf(i.style,{float:s.floating,"padding-left":"0px","margin-right":"8px","margin-top":"4px"});var I=u;i.paramsMenu&&(i.tpl=['<div class="'+d+'" style="{labelWidth}{labelDisplay}">',"{label}","</div>",'<div class="'+c+'">','<input placeholder="{emptyText}" class="'+h+'" style="{inputWidth}" value="{value}">','<div class="'+p+'" style="">'+(i.paramsText||"&nbsp;")+"</div>","</div>",'<div class="'+C+'"></div>'],I+=" "+m,i.paramsText||(I+=" "+f)),e.applyIf(i,{padding:!1,width:250,cls:I,emptyText:"Search"}),n=new e.StringField(i)}return"right"===s.floating&&(s.sideRight+=n.width,s.sideRight+=7),i.role&&(s.roles[i.role]=n),n},initScroll:function(){const t=this;t.leftScroller=new e.Button({imageCls:!0,renderTo:t.el.dom,cls:a,height:t.height+2,minWidth:20,paddingTextWidth:0,imageWidth:20,width:0,text:!1,style:{position:"absolute",left:-1,top:-1,display:"none"},listeners:[{click:t.onPrevScrollClick,scope:t}]}),t.rightScroller=new e.Button({imageCls:!0,renderTo:t.el.dom,cls:l,height:t.height+2,minWidth:20,paddingTextWidth:0,imageWidth:20,width:0,text:!1,style:{position:"absolute",right:-1,top:-1,display:"none"},listeners:[{click:t.onNextScrollClick,scope:t}]})},getBarWidth(){return parseInt(this.el.css("width"))},getItemsWidth(){let t=0;return e.each(this.items,function(i){"none"!==i.el.css("display")&&(t+=i.el.width(),t+=parseInt(i.el.css("margin-left")),t+=parseInt(i.el.css("margin-right")),e.nojQuery||(t+=parseInt(i.el.css("padding-right")),t+=parseInt(i.el.css("padding-left")),t+=parseInt(i.el.css("border-left-width")),t+=parseInt(i.el.css("border-right-width"))))}),t},onPrevScrollClick(){const e=this;e.scrolled+=e.tabScrollStep,e.scrolled>-20&&(e.scrolled=0),e.applyScrollChanges()},onNextScrollClick(){this.scrolled-=this.tabScrollStep,this.applyScrollChanges()},applyScrollChanges(){const e=this,t=e.getItemsWidth()+e.tabOffSet,i=e.getBarWidth()-parseInt(e.leftScroller.el.css("width"))-parseInt(e.rightScroller.el.css("width"))-2*e.tabOffSet,n=t-i;if(0===e.scrolled?e.leftScroller.disable():e.scrolled<0&&e.leftScroller.enable(),t>i&&0===e.scrolled&&e.rightScroller.enable(),i+Math.abs(e.scrolled)<t&&e.rightScroller.enable(),t<i)return e.scrolled=0,e.leftScroller.el.hide(),e.rightScroller.el.hide(),void e.containerEl.css({"margin-left":"0px"});e.scrolled>0?(e.scrolled=0,e.leftScroller.disable(),e.rightScroller.enable()):e.scrolled<-n&&(e.scrolled=-n,e.leftScroller.enable(),e.rightScroller.disable()),e.leftScroller.el.show(),e.rightScroller.el.show(),e.containerEl.css({"margin-left":e.scrolled+20+"px"})},onDocMouseUp(){const e=this;e.scrollInterval&&(clearTimeout(e.scrollInterval),delete e.scrollInterval)},checkScroll(){const e=this,t=e.getItemsWidth(),i=e.getBarWidth();e.disableScroll||(e.isParentHidden()?e.checkVisInt=setInterval(function(){e.isParentHidden()||(e.checkScroll(),clearInterval(e.checkVisInt),delete e.checkVisInt)},300):(clearInterval(e.checkVisInt),delete e.checkVisInt),t>i?e.enableScroll():e.barScrollEnabled&&(e.leftScroller.el.hide(),e.rightScroller.el.hide()))},enableScroll(){const e=this;e.barScrollEnabled&&(e.leftScroller.el.show(),e.rightScroller.el.show(),0===e.scrolled&&(e.leftScroller.disable(),e.containerEl.css("margin-left","20px")))},initTabEdit(){const e=this;if(!e.tabEdit)return;let t=e.items.length-1;for(;t>-1;t--){const i=e.items[t];switch(i.type){case"number":case"string":case"date":return void i.on("tab",e.onTabLastInput,e)}}},onTabLastInput(n,s){const r=e.getWidget(this.el.parent().select(`.${t}`).attr("id"));s.preventDefault(),r.leftColumns.length?setTimeout(()=>{r.leftBody.el.select(`.${i}`).item(0).dom.click()},100):setTimeout(()=>{r.body.el.select(`.${i}`).item(0).dom.click()},100)},isParentHidden(i,n=1){const s=e.getWidget(this.el.parent().select(`.${t}`).attr("id"));return!!s&&(i||(i=s.el),"none"===i.css("display")||!(n>5||"body"===i.dom.tagName.toLocaleLowerCase())&&(n++,i=i.parent(),this.isParentHidden(i,n)))}})}(),Fancy.define("Fancy.Separator",{cls:Fancy.SEPARATOR_CLS,constructor:function(e){Fancy.apply(this,e),this.init()},init(){this.render()},render(){const e=this,t=Fancy.newEl("div");t.addCls(e.cls),t.update("<div></div>"),e.el=Fancy.get(e.renderTo.appendChild(t.dom)),e.style&&e.el.css(e.style)}}),Fancy.define("Fancy.bar.Text",{extend:Fancy.Widget,widgetCls:Fancy.BAR_TEXT_CLS,cls:"",text:"",tipTpl:"{value}",constructor:function(e){Fancy.apply(this,e),this.Super("const",arguments)},init(){this.Super("init",arguments),this.render(),this.ons()},render(){const e=this,t=Fancy.newEl("div");t.addCls(e.widgetCls,e.cls),t.update(e.text),e.el=Fancy.get(e.renderTo.appendChild(t.dom));const{style:i,hidden:n,id:s,width:r}=e;i&&e.el.css(i),n&&e.el.css("display","none"),s&&e.el.attr("id",s),r&&e.el.css("width",r)},get(){return this.el.dom.innerHTML},getValue(){return this.get()},set(e){this.el.dom.innerHTML=e},ons(){const e=this,t=e.el;t.on("mouseover",e.onMouseOver,e),t.on("mouseout",e.onMouseOut,e),e.tip&&t.on("mousemove",e.onMouseMove,e)},onMouseMove(e){const t=this;t.tip&&t.tooltip&&t.tooltip.show(e.pageX+15,e.pageY-25)},onMouseOver(e){const t=this;t.fire("mouseover"),t.tip&&t.renderTip(e)},renderTip(e){const t=this;let i="";if(t.tooltip&&t.tooltip.destroy(),!0===t.tip)t.tip=new Fancy.Template(t.tipTpl).getHTML({value:t.get()});else switch(Fancy.typeOf(t.tip)){case"function":i=t.tip(this,t.get,t.label||"");break;case"string":i=t.tpl.getHTML({value:t.get()})}t.tooltip?t.tooltip.update(i):t.tooltip=new Fancy.ToolTip({text:i}),t.tooltip.css("display","block"),t.tooltip.show(e.pageX+15,e.pageY-25)},onMouseOut(){const e=this;e.fire("mouseout"),e.tooltip&&(e.tooltip.destroy(),delete e.tooltip)}}),Fancy.modules.form=!0,function(){const e=Fancy,t=e.MODAL_CLS,i=e.FIELD_NOT_VALID_CLS,n=e.FORM_CLS,s=e.FORM_BODY_CLS,r=e.PANEL_BODY_INNER_CLS,o=e.FORM_PANEL_CLS,a=e.PANEL_SHADOW_CLS,l=e.FIELD_BLANK_ERR_CLS,d=e.FIELD_TAB_CLS,c=e.FIELD_TAB_ACTIVE_CLS,h=e.TAB_TBAR_ACTIVE_CLS,u=e.PANEL_CLS,g=e.PANEL_TBAR_CLS,p=e.PANEL_BBAR_CLS,m=e.PANEL_SUB_TBAR_CLS,f=e.PANEL_BUTTONS_CLS,y=e.TAB_TBAR_CLS,C=e.FIELD_TEXT_CLS;e.Mixin("Fancy.form.mixin.Form",{tabScrollStep:80,init(){const t=this;t.calcFieldSize(),t.Super("init",arguments),t.addEvents("init","set","changetab"),!0===e.fullBuilt||!1===e.MODULELOAD||!1===e.MODULESLOAD||!0===t.fullBuilt||!0===t.neededModules?(t.fire("beforerender"),t.applyDefaults(),t.preRender(),t.render(),t.scrollable&&t.checkScroll(),t.ons(),t.fire("init")):t.loadModules()},cls:"",widgetCls:n,value:"",width:200,height:300,emptyText:"",tpl:['<div class="'+s+'"></div>'],preRender(){const e=this;e.initRenderTo(),(e.title||e.tbar||e.bbar||e.buttons)&&e.renderPanel()},renderPanel(){const t=this,i={renderTo:t.renderTo,renderOuter:t.renderOuter,title:t.title,subTitle:t.subTitle,subTitleHeight:t.subTitleHeight,width:t.width,height:t.height,titleHeight:t.titleHeight,barHeight:t.barHeight,subTBarHeight:t.subTBarHeight||t.barHeight,tbarHeight:t.tbarHeight||t.barHeight,bbarHeight:t.bbarHeight||t.barHeight,buttonsHeight:t.buttonsHeight||t.barHeight,theme:t.theme,shadow:t.shadow,style:t.style||{},window:t.window,modal:t.modal,frame:t.frame,items:[t],tabs:t.tabs,draggable:t.draggable,minWidth:t.minWidth,minHeight:t.minHeight,panelBodyBorders:t.panelBodyBorders,resizable:t.resizable,tabScrollStep:t.tabScrollStep};e.each(t.buttons,i=>{e.isObject(i)&&(i.scope=i.scope||t)}),e.each(t.bbar,i=>{e.isObject(i)&&(i.scope=i.scope||t)}),e.each(t.tbar,i=>{e.isObject(i)&&(i.scope=i.scope||t)}),e.each(t.subTBar,i=>{e.isObject(i)&&(i.scope=i.scope||t)}),t.cls&&(i.cls=t.cls,delete t.cls),t.tabs&&(i.tbar=t.generateTabs(),t.height-=t.barHeight),t.bbar&&(i.bbar=t.bbar,t.height-=t.bbarHeight||t.barHeight),t.tbar&&(i.tbar=t.tbar,t.height-=t.tbarHeight||t.barHeight),t.subTBar&&(i.subTBar=t.subTBar,t.height-=t.subTBarHeight||t.barHeight),t.buttons&&(i.buttons=t.buttons,t.height-=t.buttonsHeight||t.barHeight,i.buttons=t.buttons),t.footer&&(i.footer=t.footer,t.height-=t.barHeight),t.panel=new e.Panel(i),t.bbar=t.panel.bbar,t.tbar=t.panel.tbar,t.buttons=t.panel.buttons,t.extraCls&&t.panel&&t.panel.addCls(t.extraCls),t.panel&&t.panel.addCls(o),t.title&&(t.height-=t.titleHeight),t.subTitle&&(t.height-=t.subTitleHeight,t.height+=t.panelBodyBorders[2]),t.height-=t.panelBodyBorders[0],t.renderTo=t.panel.el.select("."+r).dom},initRenderTo(){let t=this.renderTo||document.body;e.isString(t)&&((t=document.getElementById(t))||(t=e.select(t).item(0))),this.renderTo=t},render(){let t=this,i=e.get(t.renderTo||document.body),n=e.newEl("div");if(t.renderOuter&&!t.panel&&(n=i),!i.dom)throw new Error(`[FancyGrid Error 1] - Could not find renderTo element: ${t.renderTo}`);n.addCls(t.cls,e.cls,t.widgetCls),Fancy.loadingStyle&&(t.panel?(t.panel.el.css("opacity",0),t.intervalStyleLoad=setInterval(()=>{Fancy.loadingStyle||(clearInterval(t.intervalStyleLoad),t.panel.el.animate({opacity:1,force:!0}))},100)):(n.css("opacity",0),t.intervalStyleLoad=setInterval(()=>{Fancy.loadingStyle||(clearInterval(t.intervalStyleLoad),t.el.animate({opacity:1,force:!0}))},100))),n.attr("id")||n.attr("id",t.id),n.css({width:t.width+"px",height:t.height+"px"}),n.update(t.tpl.join(" ")),t.renderOuter&&!t.panel?(t.el=n,e.isObject(t.style)&&t.el.css(t.style)):t.el=e.get(i.dom.appendChild(n.dom)),void 0===t.panel&&(t.shadow&&n.addCls(a),"default"!==t.theme&&n.addCls(Fancy.getThemeCSSCls(t.theme))),t._items=[],t.renderItems(),t.items=t._items,delete t._items,(t.tabs||t.tabbed)&&t.setActiveTab(),t.$tabs&&t.$prepareTabs(),t.fire("afterrender"),t.fire("render"),t.rendered=!0},generateTabs(){const t=this,i=[];if(t.tabs){let n=0,s=t.tabs.length;for(;n<s;n++){let s={type:"tab"};e.isString(t.tabs[n])?s.text=t.tabs[n]:s=t.tabs[n],t.tabs[n]=s,void 0===t.tabs[n].handler&&(t.tabs[n].handler=function(e){return function(){t.setActiveTab(e)}}(n)),i.push(t.tabs[n])}}return i},setActiveTab(e){const t=this,i=t.el.select(`.${d}`),n=t.el.select(`.${c}`);if(void 0!==e&&(t.activeTab=e),void 0===t.activeTab&&(t.activeTab=0),n.removeCls(c),i.item(t.activeTab).addCls(c),t.tabs){const e=t.panel.el.select(`.${g} .${y}`);e.removeCls(h),e.item(t.activeTab).addCls(h)}t.fire("changetab",t.activeTab)},renderItems(t,i){let n,r=this,o=0;for(n=(i=i||r.items).length,t=t||r.el.getByClass(s);o<n;o++){let n,s=i[o];switch(s.theme=r.theme,s.i18n=r.i18n,s.type){case"pass":case"password":n=e.form.field.String,s.type="string",s.isPassword=!0;break;case"hidden":n=e.form.field.String,s.hidden=!0;break;case"line":case"row":n=e.form.field.Line,s=r.applyDefaults(s);break;case"set":case"fieldset":s.form=r,n=e.form.field.Set,s=r.applyDefaults(s);break;case"tab":n=e.form.field.Tab,s=r.applyDefaults(s),r.$tabs=r.$tabs||[],r.$tabs.push(s.items);break;case"string":case void 0:n=e.form.field.String;break;case"number":n=e.form.field.Number;break;case"textarea":n=e.form.field.TextArea;break;case"checkbox":n=e.form.field.CheckBox;break;case"switcher":n=e.form.field.Switcher;break;case"combo":n=e.form.field.Combo;break;case"html":n=e.form.field.HTML;break;case"radio":n=e.form.field.Radio;break;case"date":n=e.form.field.Date;break;case"recaptcha":n=e.form.field.ReCaptcha;break;case"button":n=e.form.field.Button;break;case"segbutton":n=e.form.field.SegButton;break;default:throw new Error(`type ${s.type} is not set`)}s.renderTo=s.renderTo||t;const a=new n(s);switch(s.type){case"line":case"row":case"set":case"fieldset":r.renderItems(a.el.select(`.${C}`).dom,a.items);break;case"tab":r.renderItems(a.el.select(".fancy-field-tab-items").dom,a.items);break;default:r._items.push(a)}}},applyDefaults(t){const i=this;if(void 0!==t){var n,s;if(t.defaults)for(n=0,s=t.items.length;n<s;n++)e.applyIf(t.items[n],t.defaults);return t}for(var r=i.items,o=0,a=r.length,l=i.defaults||{};o<a;o++)e.applyIf(r[o],l)},ons(){const t=this;e.each(t.items,e=>{switch(e.type){case"line":case"row":break;case"set":case"fieldset":break;case"tab":case"button":case"segbutton":break;default:e.on("change",t.onChange,t)}}),t.responsive&&e.$(window).bind("resize",function(){t.onWindowResize(),clearInterval(t.intWindowResize),t.intWindowResize=setTimeout(()=>{t.onWindowResize(),delete t.intWindowResize,setTimeout(()=>{t.onWindowResize()},300)},30)})},onChange(e,t,i){this.fire("set",{name:e.name,value:t,oldValue:i})},getValues(){return this.get()},get(t){const i=this;if(t){let n;return e.each(i.items,i=>{switch(i.type){case"html":case"button":return}if(i.name===t)return n=i.get(),"number"===i.type&&""!==n&&" "!==n&&e.isString(n)&&(n=Number(n)),!0}),n}{const t={};return e.each(i.items,e=>{switch(e.type){case"html":case"button":return}void 0!==e.name&&(t[e.name]=e.get())}),t}},set(t,i){const n=this;if(e.isObject(t))for(const e in t)n.set(e,t[e]);else if(t)return e.each(n.items,e=>{e.name===t&&e.set(i)}),i},clear(t){const n=this;e.each(n.items,e=>{switch(e.type){case"html":case"recaptcha":case"button":return}!1!==t&&e.clear(),delete e.acceptValue,n.hasCls(i)&&(n.removeCls(i),n.css("height",parseInt(n.css("height"))-6+"px")),n.hasCls(l)&&(n.removeCls(l),n.css("height",parseInt(n.css("height"))-6+"px")),e.name&&n.params&&n.params[e.name]&&delete n.params[e.name]})},submit(t={}){const i=this,n=t.params||{},s=i.get();t.method?i.method=t.method:i.method="GET",t.failure?i.failure=t.failure:delete i.failure,t.success?i.success=t.success:delete i.success,t.url&&(i.url=t.url),i.clear(!1),!1!==i.valid()&&(i.params&&"wait"===i.params.recaptcha?i.submit(t):i.params&&""===i.params.recaptcha||(e.applyIf(n,s),i.params=i.params||{},e.applyIf(n,s),e.applyIf(n,i.params),i.params=n,i.params["g-recaptcha-response"]=i.params.recaptcha,delete i.params.recaptcha,e.Ajax(i)))},valid(){let t=!0;return e.each(this.items,e=>{switch(e.type){case"field.string":case"string":case"number":case"field.number":case"textarea":case"field.textarea":break;default:return}!0===t?t=e.onBlur():e.onBlur()}),!!t},getItem(t,i){let n,s=!1;return e.each(this.items,(e,i)=>{if(e.name===t)return s=e,n=i,!0}),i?{item:s,order:n}:s},showAt(){const e=this.panel;e&&e.showAt.apply(e,arguments)},show(){const e=this,t=e.panel;setTimeout(()=>{t?t.show.apply(t,arguments):e.el.show()},30)},hide(){const i=this;i.panel?i.panel.css({display:"none"}):i.css({display:"none"});const n=e.select(`.${t}`);n.dom&&n.css("display","none");let s=0,r=i.items.length;for(;s<r;s++)"combo"===i.items[s].type&&i.items[s].hideList()},setHeight(e){const t=this;t.panel&&(t.panel.css("height",e),t.buttons&&(e-=t.buttonsHeight||t.barHeight),t.bbar&&(e-=t.bbarHeight||t.barHeight),(t.tbar||t.tabs)&&(e-=t.tbarHeight||t.barHeight),t.title&&(e-=t.titleHeight),e-=t.panelBodyBorders[0],e-=t.panelBodyBorders[2]),t.css("height",e)},setWidth(t){const i=this;i.panel&&(i.panel.css("width",t),t-=i.panelBodyBorders[1],t-=i.panelBodyBorders[3]),i.css("width",t);const n={};e.each(i.items,i=>{if(i.lineName)return n[i.lineName]=n[i.lineName]||[],void n[i.lineName].push(i);let s;switch(i.type){case"line":s=t;s-=parseInt(i.css("margin-left")),s-=parseInt(i.css("margin-right")),e.each(i.items,e=>{switch(e.type){case"button":s-=e.css("width"),s-=parseInt(e.css("margin-left")),s-=parseInt(e.css("margin-right"));break;default:0,e.css("width")}});break;default:s=t,s-=parseInt(i.css("margin-left")),s-=parseInt(i.css("margin-right")),i.setWidth(s)}}),e.each(n,i=>{var n=[],s=t,r=0;e.each(i,(e,t)=>{const o=parseInt(e.el.css("width"));switch(s-=parseInt(e.css("padding-left")),t===i.length-1&&(s-=parseInt(e.css("padding-right"))),e.type){case"button":return void(s-=o)}r+=o,n.push(o)});var o=[];e.each(i,e=>{switch(e.type){case"button":break;default:o.push(e)}});const a=r/100,l=s/100;e.each(n,(e,t)=>{const i=e/a*l;o[t].setWidth(i)})})},getHeight(){const e=this.panel;return e?e.getHeight():parseInt(this.css("height"))},getWidth(){let e,t=this;return e=t.panel?parseInt(t.panel.css("width")):parseInt(t.css("width"))},calcFieldSize(){var t,i=this,n=i.width,s=i.defaults||{},r=i.maxLabelNumber;s.width=n-2*i.panelBorderWidth,e.each(i.items,t=>{switch(t.type){case"set":case"tab":"tab"===t.type&&(i.tabbed=!0);const d="set"===t.type?62:20;e.each(t.items,e=>{void 0===e.width&&(e.width=n-d),e.label&&e.label.length>r&&(r=e.label.length)}),t.defaults=t.defaults||{},t.defaults.labelWidth=t.defaults.labelWidth||8*(r+1);break;case"line":var s,o=t.items.length,a=!1,l=n;e.each(t.items,e=>{void 0===e.label&&"top"!==e.labelAlign&&(e.label=!1),e.width&&(l-=e.width,o--)}),s=(l-8-8-8)/o,e.each(t.items,e=>{e.width||(e.width=s),(e.labelWidth||e.inputWidth)&&(a=!0)}),!1===a&&e.each(t.items,e=>{"top"===e.labelAlign?e.labelWidth=s:e.labelWidth=100}),t.defaults=t.defaults||{},void 0===t.defaults.labelWidth&&(t.defaults.labelWidth=i.labelWidth);break;default:t.label&&t.label.length>r&&(r=t.label.length)}}),(t=6*++r)<80&&(t=80),s.labelWidth=t,i.inputWidth&&(s.inputWidth=i.inputWidth),i.defaults=s},destroy(){const e=this;e.el.destroy(),e.panel&&e.panel.el.destroy()},each(e,t){let i=this.items,n=0,s=i.length;if(t)for(;n<s;n++)e.apply(this,[i[n]]);else for(;n<s;n++)e(i[n])},loadModules(){const t=this,i=e.modules||{},n={},s=t.items||[];e.modules=i,e.nojQuery&&(n.dom=!0),e.isTouch&&(n.touch=!0);let r=0,o=s.length;for(;r<o;r++){const e=s[r];if("date"===e.type&&(n.grid=!0,n.selection=!0,n.date=!0),e.items){let t=0,i=e.items.length;for(;t<i;t++){"date"===e.items[t].type&&(n.grid=!0,n.selection=!0,n.date=!0)}}}for(var a in t.neededModules={length:0},n)void 0===e.modules[a]&&(t.neededModules[a]=!0,t.neededModules.length++);if(0===t.neededModules.length)return t.neededModules=!0,void t.init();const l=function(e){delete t.neededModules[e],t.neededModules.length--,0===t.neededModules.length&&(t.neededModules=!0,t.init())};for(var a in t.neededModules)"length"!==a&&e.loadModule(a,l)},prevTab(){const e=this;e.activeTab--,e.activeTab<0&&(e.activeTab=0),e.setActiveTab()},nextTab(){const e=this,t=e.el.select(`.${d}`).length;e.activeTab++,e.activeTab>=t&&(e.activeTab=t-1),e.setActiveTab()},onWindowResize(){let t,i=this,s=i.renderTo;i.panel&&(s=i.panel.renderTo),((t=i.responsive?e.get(s):i.panel?i.panel.el:e.get(s)).hasClass(u)||t.hasClass(n))&&(t=t.parent());let r=t.width();void 0!==t.dom&&(0===r&&(r=t.parent().width()),i.responsive&&i.setWidth(r))},hideBar(e){let t,i,n=this;switch(e){case"tbar":t=g;break;case"subtbar":t=m;break;case"bbar":t=p;break;case"buttons":t=f;break;default:throw new Error("[FancyGrid Error]: bar does not exist")}if("none"!==(i=n.panel.el.select("."+t)).css("display")){i.hide();const e=parseInt(n.panel.el.css("height"));n.panel.el.css("height",e-n.barHeight)}},showBar(e){var t,i;switch(e){case"tbar":t=g;break;case"subtbar":t=m;break;case"bbar":t=p;break;case"buttons":t=f;break;default:throw new Error("[FancyGrid Error]: bar does not exist")}if("none"==(i=this.panel.el.select(`.${t}`)).css("display")){i.show();const e=parseInt(this.panel.el.css("height"));this.panel.el.css("height",e+this.barHeight)}},$prepareTabs(){let t=this,i=0,n=0;e.each(t.items,e=>{t.$tabs[n][i]=e,i++,t.$tabs[n][i]||(i=0,n++)})},remove(t){let i,n=this;(i=e.isString(t)?n.getItem(t,!0):{item:n.items[t],order:t}).item.destroy(),n.items.splice(i.order,1)},checkScroll(){let t=this.el.select(`.${s}`).item(0),i=parseInt(t.css("height")),n=0;e.each(this.items,e=>{n+=parseInt(e.css("height"))}),i<n&&t.css({"overflow-y":"scroll","overflow-x":"hidden"})}})}(),Fancy.Mixin("Fancy.form.mixin.PrepareConfig",{prepareConfig(e,t){const i=this;return e.renderOuter&&(e.renderTo=e.renderOuter),e=i.prepareConfigTheme(e,t),e=i.prepareConfigSize(e,t),e=i.prepareConfigLang(e,t),e=i.prepareConfigBars(e,t),e=i.prepareConfigDefaults(e),e=i.prepareConfigItems(e),e=i.prepareConfigFooter(e)},prepareConfigSize(e){let t,i=this,n=e.renderTo;return void 0===e.width&&n&&(e.responsive=!0,t=Fancy.get(n),e.width=parseInt(t.width())),void 0===e.height||"fit"===e.height&&setTimeout(()=>{i.setHeightFit(),i.on("changetab",i.onChangeTab,i)}),e},prepareConfigDefaults(e){if(e.defaults)for(const t in e.defaults)Fancy.each(e.items,i=>{void 0===i[t]&&(i[t]=e.defaults[t])});return e},prepareConfigBars(e){const t=function(t){for(var i=0,n=t.length;i<n;i++)switch(t[i].type){case"date":if(!t[i].format){var s=e.lang.date;t[i].format={read:s.read,write:s.write,edit:s.edit}}e.i18n&&(t[i].i18n=e.i18n)}};return t(e.tbar||[]),t(e.subTBar||[]),t(e.bbar||[]),t(e.buttons||[]),e},prepareConfigItems(e){const t=this,i=function(e){e.theme=t.theme||"",void 0===e.labelWidth&&(e.labelWidth=t.labelWidth),void 0===e.inputWidth&&(e.inputWidth=t.inputWidth),"pass"!==e.type&&"password"!==e.type||(e.type="string",e.isPassword=!0),e.items&&Fancy.each(e.items,i)};return Fancy.each(e.items,i),e},setHeightFit(){const e=this,t=!!(e.title||e.subTitle||e.tbar||e.bbar||e.buttons||e.panel),i=e.panelBodyBorders,n=e.gridWithoutPanelBorders,s=e.gridBorders;e.heightFit=!0;let r=e.fieldHeight,o=e.items;if(e.$tabs){var a=e.activeTab||0;o=e.$tabs[a]}Fancy.each(o,e=>{e.hidden||(r+=parseInt(e.css("height")))}),e.title&&(r+=e.titleHeight),(e.tbar||e.tabs)&&(r+=e.tbarHeight||e.barHeight),e.bbar&&(r+=e.bbarHeight||e.barHeight),e.buttons&&(r+=e.buttonsHeight||e.barHeight),e.subTBar&&(r+=e.subTBarHeight||e.barHeight),e.footer&&(r+=e.barHeight),r+=t?i[0]+i[2]+s[0]+s[2]:n[0]+n[2]+s[0]+s[2],e.minHeight&&r<e.minHeight&&(r=e.minHeight),e.setHeight(r)},onChangeTab(){this.setHeightFit()}}),Fancy.define(["Fancy.Form","FancyForm"],{extend:Fancy.Widget,mixins:["Fancy.form.mixin.Form",Fancy.panel.mixin.PrepareConfig,Fancy.panel.mixin.methods,"Fancy.form.mixin.PrepareConfig"],type:"form",theme:"default",i18n:"en",maxLabelNumber:11,minWidth:200,minHeight:200,barScrollEnabled:!0,scrollable:!1,constructor:function(e,t){const i=this;Fancy.isDom(e)?(t=t||{}).renderTo=e:t=e,t=t||{};const n=function(e){e&&Fancy.apply(t,e),t=i.prepareConfig(t,i),Fancy.applyConfig(i,t),i.Super("const",arguments)},s=function(){const e=t.i18n||i.i18n;!0===Fancy.loadLang(e,n)&&n({})};Fancy.loadStyle(),Fancy.modules.form||Fancy.fullBuilt||!1===Fancy.MODULELOAD||!1===Fancy.MODULESLOAD||!0===i.fullBuilt||!0===i.neededModules?s():Fancy.modules.grid?Fancy.loadModule("form",function(){s()}):i.loadModules(s,t)},loadModules(e,t){const i=this,n={form:!0};Fancy.modules=Fancy.modules||{},Fancy.nojQuery&&(n.dom=!0),Fancy.isTouch&&(n.touch=!0),t.url&&(n.ajax=!0);const s=function(e){if(e.menu)return n.menu=!0,!0};Fancy.each(t.tbar,s),Fancy.each(t.bbar,s),Fancy.each(t.buttons,s),Fancy.each(t.subTBar,s);const r=function(e){for(var t,i=0,s=e.length;i<s;i++)"combo"===(t=e[i]).type&&t.data&&t.data.proxy&&(n.ajax=!0),"date"===t.type&&(n.grid=!0,n.date=!0,n.selection=!0),t.items&&r(t.items)};for(var o in r(t.items||[]),i.neededModules={length:0},n)void 0===Fancy.modules[o]&&(i.neededModules[o]=!0,i.neededModules.length++);if(0===i.neededModules.length)return i.neededModules=!0,void e();const a=function(t){delete i.neededModules[t],i.neededModules.length--,0===i.neededModules.length&&(i.neededModules=!0,e())};if(i.neededModules.dom)Fancy.loadModule("dom",function(){for(var e in delete i.neededModules.dom,i.neededModules.length--,i.neededModules)"length"!==e&&Fancy.loadModule(e,a)});else for(var o in i.neededModules)"length"!==o&&Fancy.loadModule(o,a)}}),FancyForm.get=(e=>{const t=Fancy.get(e);if(!t.dom)return;const i=t.select(".fancy-form").dom.id;return Fancy.getWidget(i)}),FancyForm.defineTheme=Fancy.defineTheme,FancyForm.defineController=Fancy.defineController,FancyForm.addValid=Fancy.addValid,!Fancy.nojQuery&&Fancy.$&&(Fancy.$.fn.FancyForm=function(e){return this.selector?e.renderTo=Fancy.$(this.selector)[0].id:e.renderTo=this.attr("id"),new Fancy.Form(e)}),function(){const e=Fancy,t=e.FIELD_NOT_VALID_CLS,i=e.FIELD_LABEL_ALIGN_TOP_CLS,n=e.FIELD_TEXT_CLS,s=e.FIELD_LABEL_CLS,r=e.FIELD_TEXTAREA_TEXT_CLS,o=e.FIELD_LABEL_ALIGN_RIGHT_CLS,a=e.FIELD_DISABLED_CLS;e.ns("Fancy.form.field"),e.form.field.Mixin=function(){},e.form.field.Mixin.prototype={padding:"8px 8px 0px 8px",inputHeight:29,labelHeight:18,failedValidCls:t,cls:"",checkValidOnTyping:!1,editable:!0,ons(){const e=this,t=e.el,i=e.el.getByTag("input");if(e.input=i,i.on("blur",e.onBlur,e),i.on("focus",e.onFocus,e),i.on("input",e.onInput,e),i.on("keydown",e.onKeyDown,e),t.on("mouseenter",e.onMouseOver,e),t.on("mouseleave",e.onMouseOut,e),e.on("key",e.onKey,e),e.tip&&t.on("mousemove",e.onMouseMove,e),e.format&&e.format.inputFn){switch(e.value){case"":case void 0:break;default:e.formatValue(e.value)}e.on("key",e.onKeyInputFn)}e.stopPropagation&&t.on("mousedown",function(e){e.stopPropagation()}),t.on("mousedown",function(t){e.disabled&&(t.preventDefault(),t.stopPropagation())})},onKeyInputFn(t,i,n){const s=n.keyCode,r=e.key;if(!this.disabled){switch(s){case r.ENTER:case r.ESC:case r.LEFT:case r.RIGHT:case r.TAB:return}this.formatValue(i)}},formatValue(e){e=this.format.inputFn(e);let t=this.input.dom.selectionStart;const i=this.input.dom.value;this.input.dom.value=e,i.length<e.length&&t++,this.setCaretPosition(t)},setCaretPosition(e){const t=this.input.dom;if(t.createTextRange){var i=t.createTextRange();i.move("character",e),i.select()}else t.selectionStart?(t.focus(),t.setSelectionRange(e,e)):t.focus()},onMouseOver(e){const t=this;t.disabled||(t.fire("mouseover"),t.tip&&t.renderTip(e))},onMouseOut(){this.disabled||(this.fire("mouseout"),this.tip&&e.tip.hide())},render(){var t=this,l=t.renderTo||document.body,d=t.renderAfter,c=t.renderBefore,h=e.newEl("div");e.isString(l)&&((l=document.getElementById(l))||(l=e.select(l).item(0))),t.fire("beforerender"),h.addCls(e.cls,t.cls,t.fieldCls),h.attr("id",t.id);var u="",g="";t.itemsHTML&&(g=t.itemsHTML),"top"===t.labelAlign&&t.label&&t.labelWidth<7*t.label.length&&(t.labelWidth=7*(t.label.length+2)),t.labelWidth&&(u="width:"+t.labelWidth+"px;");let p=t.label;""===t.label?p="&nbsp;":void 0===t.label?p="&nbsp;":"right"!==t.labelAlign&&(p+=":");var m="",f="",y="";if(!1===t.label&&(m="display:none;"),t.inputLabel?y=t.inputLabel:f="display:none;","recaptcha"===t.type)h.update(t.tpl.getHTML({key:t.key}));else{const e={labelWidth:u,label:p,labelDisplay:m,inputLabelDisplay:f,inputLabel:y,emptyText:t.emptyText,value:t.value,height:t.height,itemsHTML:g,errorTextStyle:"",buttonText:t.buttonText};"set"===t.type&&delete e.height,h.update(t.tpl.getHTML(e))}if(t.el=h,t.setStyle(),!0===t.renderId&&h.attr("id",t.id),d?h=(d=e.get(d)).after(h.dom.outerHTML).next():c?h=c.before(h.dom.outerHTML).prev():l.appendChild(h.dom),t.el=h,"textarea"===t.type?t.input=t.el.getByTag("textarea"):t.input=t.el.getByTag("input"),t.name&&(t.input.name=t.name),t.setSize(),"top"===t.labelAlign)t.el.addCls(i),t.el.select("."+n).css("float","none");else if("right"===t.labelAlign)switch(t.el.addCls(o),t.type){case"radio":e.$(h.dom).find("."+s).insertAfter(e.$(h.dom).find("."+n+":last")),e.$(h.dom).find("."+s).css("float","right");break;case"textarea":e.$(h.dom).find("."+s).insertAfter(e.$(h.dom).find("."+r));break;case"checkbox":e.$(h.dom).find("."+s).css("float","right");break;default:e.$(h.dom).find("."+s).insertAfter(e.$(h.dom).find("."+n))}else t.type;if(t.acceptedValue=t.value,t.fire("afterrender"),t.fire("render"),"recaptcha"!==t.type&&"chat"!==t.type&&setTimeout(function(){t.input&&t.input.dom&&0===t.input.dom.value.length&&void 0===t.prevColor&&(t.prevColor=t.input.css("color"))},1),t.disabled){switch(t.type){case"hidden":break;default:t.addCls(a)}t.input&&t.input.attr("tabIndex",-1)}else t.input&&t.tabIndex&&t.input.attr("tabIndex",t.tabIndex)},onKeyDown(t){const i=this,n=t.keyCode,s=e.key;if(i.fire("beforekey",i.input.dom.value,t),!i.disabled){switch(n){case s.BACKSPACE:case s.DELETE:switch(i.type){case"field.number":case"field.string":case"field.date":setTimeout(function(){""===i.getValue()&&i.fire("empty")},1)}break;case s.TAB:i.fire("tab",t);break;case s.ESC:i.fire("esc",t);break;case s.ENTER:const e="textarea"===i.type||"field.textarea"===i.type;if(e&&t.shiftKey)break;i.fire("enter",i.getValue()),e||(t.preventDefault(),t.stopPropagation());break;case s.UP:switch(i.type){case"number":case"field.number":this.spin&&i.spinUp()}i.fire("up",i.getValue()),"textarea"!==i.type&&(t.preventDefault(),t.stopPropagation());break;case s.DOWN:switch(i.type){case"number":case"field.number":this.spin&&i.spinDown()}i.fire("down",i.getValue()),"textarea"!==i.type&&(t.preventDefault(),t.stopPropagation());break;case s.LEFT:case s.RIGHT:t.stopPropagation();break;default:setTimeout(function(){i.input&&(0===i.input.dom.value.length?(void 0===i.prevColor&&(i.prevColor=i.input.css("color")),i.input.css("color","grey")):i.prevColor?i.input.css("color",i.prevColor):i.input.css("color"," "))},1)}setTimeout(()=>{i.fire("key",i.input.dom.value,t)},1)}},onKey(e,t){e.disabled||e.isValid()&&!e.checkValidOnTyping||e.validate(t)},onBlur(){const e=this;if(e.disabled)return!0;if(e.fire("blur"),e.input){if("combo"!==e.type)return e.validate(e.input.dom.value);setTimeout(()=>{e.listItemClicked||e.validate(e.input.dom.value)},100)}return!0},validate(t){const i=this,n=i.vtype;if(void 0===n)return!0;{const s=e.isValid(n,t);return!0!==s?(i.errorText=new e.Template(s.text).getHTML(s),i.failedValid(),!1):(i.successValid(),!0)}},isValid(){return!this.hasCls(this.failedValidCls)},onFocus(){this.disabled||!1===this.editable?this.input.blur():this.fire("focus")},blur(){this.input.blur()},onInput(){const e=this,t=e.getValue(),i=e.acceptedValue;e.disabled||(e.acceptedValue=e.get(),e.fire("input",t),e.fire("change",t,i))},get(){const t=this;if(t.format)if(e.isString(t.format));else{if(!e.isObject(t.format))return t.value;if(t.format.inputFn&&("number"===t.type||"field.number"===t.type))return isNaN(parseFloat(t.value))?t.value:Number(t.value)}return t.input.dom.value},getValue(){return this.get()},set(e,t){const i=this;i.value=e,i.format&&i.format.inputFn?i.formatValue(e):i.input.dom.value=e,!1!==t&&i.onInput(),i.validate(e)},setLabel(e){this.el.select(`.${s}`).update(e)},setValue(e,t){this.set(e,t)},clear(){this.set(""),this.clearValid()},failedValid(){const t=this;t.hasCls(t.failedValidCls)?t.tooltip&&t.errorText&&e.tip.update(t.errorText):(!t.tooltip&&t.errorText&&(t.showErrorTip(),t.el.on("mousemove",t.onMouseMove,t),t.input.hover(function(i){t.errorText&&(t.showErrorTip(),e.tip.show(i.pageX+15,i.pageY-25))},function(){t.hideErrorTip()})),t.addCls(t.failedValidCls))},clearValid(){this.removeCls(this.failedValidCls)},successValid(){this.removeCls(this.failedValidCls),this.hideErrorTip(),delete this.errorText},showErrorTip(){e.tip.update(this.errorText)},hideErrorTip(){e.tip.hide()},setInputSize(e){const t=this;"combo"===t.type&&t.inputContainer.css("width",e.width),e.width&&t.input.css("width",e.width),e.height&&"set"!==t.type&&t.input.css("height",e.height)},focus(){const e=this;e.input.focus(),setTimeout(()=>{e.input.dom.selectionStart=e.input.dom.selectionEnd=1e4},0)},hide(){this.fire("beforehide"),this.css("display","none"),this.fire("hide")},show(){this.css("display","block")},setSize(e,t){const i=this;if(i.type,void 0===e&&void 0===t)e=i.width,t=i.height;else if(void 0===t){const n=e;e=n.width?n.width:i.width,t=n.height?n.height:i.height}i.size?i.size({width:e,height:t}):(void 0!==e&&i.css("width",e),"top"===i.labelAlign?i.css("height",1.5*t):("set"!==i.type&&i.css("height",t),i.label&&i.el.select("."+s).css("height",i.inputHeight)),i.setInputSize({width:i.inputWidth,height:i.inputHeight}))},setStyle(){let t=this,i=t.style||{},n=t.padding;n?(e.isNumber(n)?n+="px":e.isString(n),void 0===i.padding&&(i.padding=n)):i.padding="0px",t.hidden&&t.css("display","none"),t.css(i)},preRender(){const t=this;t.tpl&&!1===e.isObject(t.tpl)&&(t.tpl=new e.Template(t.tpl)),t.calcSize()},calcSize(){var t,i,n,s,r=this,o=r.inputHeight,a=r.padding;if(e.isString(a))switch((a=(a=a.replace(/px/g,"")).split(" ")).length){case 1:a=[i=Number(a[0]),i,i,i];break;case 2:a=[n=Number(a[0]),s=Number(a[1]),n,s];break;case 3:a=[n=Number(a[0]),s=Number(a[1]),Number(a[2]),n];break;case 4:a=[Number(a[0]),Number(a[1]),Number(a[2]),Number(a[3])]}else e.isNumber(a)?a=[a,a,a,a]:!1===a&&(a=[0,0,0,0]);"top"===r.labelAlign&&(r.height*=1.5),t=r.width,"top"!==r.labelAlign&&r.label&&(t-=r.labelWidth),r.height===r.inputHeight&&!1!==r.padding&&(o-=a[0]+a[2]),"radio"!==r.type||r.column||(r.calcColumns(),1!==r.rows&&(o=(o-a[0]-a[2])*r.rows)),r.inputHeight=o,r.inputWidth=t-a[1]-a[3],r.height=o+a[0]+a[2]},setWidth(e){const t=this;t.width=e,t.calcSize(),t.css("width",e),t.setInputSize({width:t.inputWidth})},onMouseMove(t){const i=this,n=i.widget;if(!i.disabled){if(n){if(n.startResizing&&i.tooltip)return void e.tip.hide();if(n.columndrag&&"dragging"===n.columndrag.status)return void e.tip.hide()}i.tooltip?e.tip.show(t.pageX+15,t.pageY-25):i.tip&&i.renderTip(t)}},renderTip(t){var i,n=this,s="",r=n.tip;if(n.getValue)switch(n.type){case"button":case"field.button":s="";break;default:s=n.getValue()}switch(Fancy.typeOf(r)){case"function":i=r(this,s,n.label||"");break;case"string":i=new e.Template(r).getHTML({value:s})}e.tip.update(i),e.tip.show(t.pageX+15,t.pageY-25)},getInputSelection(){var e,t,i,n,s,r=0,o=0,a=this.input.dom;return"number"==typeof a.selectionStart&&"number"==typeof a.selectionEnd?(r=a.selectionStart,o=a.selectionEnd):(t=document.selection.createRange())&&t.parentElement()==a&&(n=a.value.length,e=a.value.replace(/\r\n/g,"\n"),(i=a.createTextRange()).moveToBookmark(t.getBookmark()),(s=a.createTextRange()).collapse(!1),i.compareEndPoints("StartToEnd",s)>-1?r=o=n:(r=-i.moveStart("character",-n),r+=e.slice(0,r).split("\n").length-1,i.compareEndPoints("EndToEnd",s)>-1?o=n:(o=-i.moveEnd("character",-n),o+=e.slice(0,o).split("\n").length-1))),{start:r,end:o}},enable(){const e=this;e.disabled=!1,e.removeCls(a),e.button&&e.button.enable(),e.input&&e.input.attr("tabIndex",e.tabIndex||0)},disable(){const e=this;e.disabled=!0,e.addCls(a),e.button&&e.button.disable(),e.input&&e.input.attr("tabIndex",-1)},getInputValue(){return this.input.dom.value},clearInput(){const e=this;e.input&&(e.input.dom.value="")}}}(),Fancy.define(["Fancy.form.field.String","Fancy.StringField"],{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.string",constructor:function(e){Fancy.apply(this,e),this.Super("const",arguments)},init(){const e=this;e.addEvents("focus","blur","input","enter","up","down","esc","tab","change","key","empty"),e.Super("init",arguments),e.preRender(),e.render(),e.ons(),e.isPassword&&(e.input.attr({type:"password"}),e.showPassTip&&(e.el.select(".fancy-field-text").item(0).append('<div class="fancy-field-pass-tip">abc</div>'),e.passTipEl=e.el.select(".fancy-field-pass-tip").item(0),e.passTipEl.on("mousedown",function(e){e.preventDefault()}),e.passTipEl.on("click",function(){"password"!==e.input.attr("type")?(e.passTipEl.update("abc"),e.input.attr("type","password"),e.passTipEl.css("line-height","22px")):(e.passTipEl.update("***"),e.input.attr("type",""),e.passTipEl.css("line-height","28px"))}))),e.hidden&&e.css("display","none"),e.style&&e.css(e.style)},fieldCls:Fancy.FIELD_CLS,value:"",width:100,emptyText:"",tpl:['<div class="fancy-field-label" style="{labelWidth}{labelDisplay}">',"{label}","</div>",'<div class="fancy-field-text">','<input autocomplete="off" placeholder="{emptyText}" class="fancy-field-text-input" style="{inputWidth}" value="{value}">','<div class="fancy-field-error" style="{errorTextStyle}"></div>',"</div>",'<div class="fancy-clearfix"></div>']}),function(){const e=Fancy.CLEARFIX_CLS,t=Fancy.FIELD_CLS,i=Fancy.FIELD_LABEL_CLS,n=Fancy.FIELD_ERROR_CLS,s=Fancy.FIELD_TEXT_CLS,r=Fancy.FIELD_TEXT_INPUT_CLS,o=Fancy.FIELD_SPIN_CLS,a=Fancy.FIELD_SPIN_UP_CLS,l=Fancy.FIELD_SPIN_DOWN_CLS;Fancy.define(["Fancy.form.field.Number","Fancy.NumberField"],{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.number",allowBlank:!0,constructor:function(e){Fancy.apply(this,e),this.Super("const",arguments)},init(){const e=this;e.addEvents("focus","blur","input","enter","up","down","esc","tab","change","key","empty"),e.Super("init",arguments),e.preRender(),e.render(),e.ons(),e.hidden&&e.css("display","none"),e.initSpin()},fieldCls:t,value:"",width:100,emptyText:"",step:1,tpl:['<div class="'+i+'" style="{labelWidth}{labelDisplay}">',"{label}","</div>",'<div class="'+s+'">','<input autocomplete="off" placeholder="{emptyText}" class="'+r+'" style="{inputWidth}" value="{value}">','<div class="'+o+'">','<div class="'+a+'"></div>','<div class="'+l+'"></div>',"</div>",'<div class="'+n+'" style="{errorTextStyle}"></div>',"</div>",'<div class="'+e+'"></div>'],onInput(){var e=this,t=e.input,i=e.get(),n=e.acceptedValue;if(e.isValid()){for(var s=t.dom.value,r="",o=0,a=s.length;o<a;o++)switch(s[o]){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":case"+":case".":r+=s[o]}isNaN(Number(r))||(e.value=r,i=r)}e.acceptedValue=Number(e.get()),e.fire("input",i),e.fire("change",Number(i),Number(n))},isNumber:e=>""===e||"-"===e||Fancy.isNumber(+e),checkMinMax(e){return""===e||"-"===e||(e=+e)>=this.min&&e<=this.max},setMin(e){this.min=e},setMax(e){this.max=e},initSpin(){const e=this;!0===e.spin&&(e.el.select("."+o).css("display","block"),e.el.select("."+a).on("mousedown",e.onMouseDownSpinUp,e),e.el.select("."+l).on("mousedown",e.onMouseDownSpinDown,e))},onMouseDownSpinUp(e){var t=this,i=Fancy.get(document),n=700,s=new Date;t.disabled||(e.preventDefault(),t.mouseDownSpinUp=!0,t.spinUp(),t.spinInterval=setInterval(function(){t.mouseDownSpinUp=!1,new Date-s>n&&(700===n&&(n=150),s=new Date,t.spinUp(),--n<20&&(n=20))},20),i.once("mouseup",()=>clearInterval(t.spinInterval)),t.focus())},onMouseDownSpinDown(e){var t=this,i=Fancy.get(document),n=700,s=new Date;t.disabled||(e.preventDefault(),t.mouseDownSpinDown=!0,t.spinDown(),t.spinInterval=setInterval(function(){t.mouseDownSpinDown=!1,new Date-s>n&&(700===n&&(n=150),s=new Date,t.spinDown(),--n<20&&(n=20))},20),i.once("mouseup",()=>clearInterval(t.spinInterval)),t.focus())},spinUp(){let e=this,t=+e.get()+e.step;Fancy.Number.isFloat(e.step)&&(t=Fancy.Number.correctFloat(t)),isNaN(t)&&(t=e.min||0),void 0!==e.max&&t>e.max?t=e.max:t<e.min&&(t=e.min),e.set(t)},spinDown(){let e=this,t=+e.get()-e.step;Fancy.Number.isFloat(e.step)&&(t=Fancy.Number.correctFloat(t)),isNaN(t)&&(t=e.min||0),void 0!==e.min&&t<e.min?t=e.min:t>e.max&&(t=e.max),e.set(t)}})}(),function(){const e=Fancy,t=e.CLEARFIX_CLS,i=e.FIELD_CLS,n=e.FIELD_LABEL_CLS,s=e.FIELD_TEXT_CLS,r=e.FIELD_ERROR_CLS,o=e.FIELD_TEXT_INPUT_CLS;e.define(["Fancy.form.field.Date","Fancy.DateField"],{mixins:[e.form.field.Mixin],extend:e.Widget,type:"field.date",picker:!0,i18n:"en",theme:"default",fieldCls:i,value:"",width:100,cellHeight:32,emptyText:"",tpl:['<div class="'+n+'" style="{labelWidth}{labelDisplay}">',"{label}","</div>",'<div class="'+s+'">','<input autocomplete="off" placeholder="{emptyText}" class="'+o+'" style="{inputWidth}" value="{value}">','<div class="fancy-field-picker-button"></div>','<div class="'+r+'" style="{errorTextStyle}"></div>',"</div>",'<div class="'+t+'"></div>'],constructor:function(t){e.apply(this,t),this.Super("const",arguments)},init(){const t=this;t.addEvents("focus","blur","input","enter","up","down","esc","tab","change","key","showpicker"),t.initFormat(),t.Super("init",arguments),t.preRender(),t.render(),t.ons(),t.hidden&&t.css("display","none"),t.style&&t.css(t.style),e.isDate(t.value)?t.date=t.value:t.initDate(),t.changeInputValue(),t.initPicker()},initDate(t,i){const n=this;if(t){if("date"===e.typeOf(t))return void(n.date=t);let s;if("Invalid Date"===(s=i?e.Date.parse(t,i,n.format.mode):e.Date.parse(t,n.format.read,n.format.mode)).toString&&(s=e.Date.parse(t,n.format.edit,n.format.mode)),"Invalid Date"===s.toString)return;n.date=s}else switch(e.typeOf(t)){case"date":n.date=n.value;break;case"undefined":case"string":if(!n.value)return void delete n.date;n.date=e.Date.parse(n.value,n.format.read,n.format.mode)}},changeInputValue(){const t=this;if("date"!==e.typeOf(t.date)||"Invalid Date"===t.date.toString())return void(t.input.dom.value="");let i=e.Date.format(t.date,t.format.edit,void 0,t.format.mode);t.format&&t.format.inputFn&&(i=t.format.inputFn(i)),void 0===i&&(i=""),t.input.dom.value=i,t.fire("change",i)},initFormat(){const t=this;t.format?e.isObject(t.format)&&e.applyIf(t.format,e.i18n[t.i18n].date):t.format=e.i18n[t.i18n].date},formatValue(t){const i=this;if(!i.value&&t?i.value=t:!t&&i.value&&(t=i.value),i.value)if("date"===e.typeOf(i.value)){if(i.value=e.Date.format(i.value,i.format.read,void 0,i.format.mode),void 0===t){const n=e.Date.parse(i.value,i.format.edit,i.format.mode);t=e.Date.format(n,i.format.edit,void 0,i.format.mode)}i.acceptedValue=t}else{const t=e.Date.parse(i.value,i.format.read,i.format.mode);i.value=e.Date.format(t,i.format.edit,void 0,i.format.mode)}else;i.format&&i.format.inputFn&&(t=i.format.inputFn(t)),void 0===t&&(t=""),/NaN/.test(t)&&(t=""),i.input.dom.value=t},ons(){const e=this,t=e.el,i=e.el.getByTag("input");e.input=i,i.on("blur",e.onBlur,e),i.on("focus",e.onFocus,e),i.on("input",e.onInput,e),i.on("keydown",e.onKeyDown,e),e.on("key",e.onKey,e),e.on("enter",e.onEnter,e),e.on("beforehide",e.onBeforeHide,e),e.format&&e.format.inputFn&&e.on("key",e.onKeyInputFn),t.on("mouseenter",e.onMouseOver,e),t.on("mouseleave",e.onMouseOut,e),e.tip&&t.on("mousemove",e.onMouseMove,e)},initPicker(){const e=this;!1!==e.picker&&!1!==e.editable&&(!1===e.dateImage?(e.el.select(".fancy-field-picker-button").css("display","none"),e.input.on("click",e.onInputClick,e)):(e.pickerButton=e.el.select(".fancy-field-picker-button"),e.pickerButton.on("mousedown",e.onPickerButtonMouseDown,e),e.input.on("mousedown",e.onInputMouseDown,e)))},onInputClick(e){e.preventDefault(),this.toggleShowPicker()},onInputMouseDown(e){const t=this.picker;t&&t.el&&"none"!==t.el.css("display")&&e.stopPropagation()},onPickerButtonMouseDown(e){this.disabled||(e.preventDefault(),this.toggleShowPicker())},showPicker(){var t=this,i=t.el,n=t.input,r=e.get(document),o=!1;!0===t.picker?(o=!0,t.renderPicker()):t.picker.monthPicker&&(t.picker.monthPicker.hide(),t.picker.monthPicker.panel.css("top","-300px"));let a=n.offset(),l=a.left,d=a.top+i.select("."+s).height(),c=t.date||new Date;"Invalid Date"===c.toString()&&(c=new Date),t.picker.setDate(c,o),e.datepicker.Manager.add(t.picker),t.picker.showAt(l,d),t.fire("showpicker"),t.docSpy||(t.docSpy=!0,r.on("click",t.onDocClick,t),r.on("scroll",t.onDocScroll,t))},onDocClick(t){const i=this,n=i.picker,s=n.monthPicker,r=t.target;"input"===r.tagName.toLocaleLowerCase()||e.get(r).hasCls("fancy-field-picker-button")||n.panel.el.within(r)||s&&s.panel.el.within(r)||i.hidePicker()},onDocScroll(){this.hidePicker()},hidePicker(){const t=this;if(!1!==t.picker&&t.picker.hide&&t.picker.hide(),t.docSpy){const i=e.get(document);t.docSpy=!1,i.un("click",t.onDocClick,t),i.un("scroll",t.onDocScroll,t)}},toggleShowPicker(){const e=this;!0!==e.picker?"none"===e.picker.panel.el.css("display")?e.showPicker():e.hidePicker():e.showPicker()},renderPicker(){const t=this;if(!e.fullBuilt&&!e.modules.grid&&!1!==e.MODULELOAD&&!1!==e.MODULESLOAD)return;const i={window:!0,date:t.date,format:t.format,theme:t.theme,minValue:t.min,maxValue:t.max,i18n:t.i18n,events:[{changedate:t.onPickerChangeDate,scope:t}]},n=e.themes[t.theme].config;n.datePickerHeight&&(i.height=n.datePickerHeight),t.picker=new e.DatePicker(i)},get(){const t=this;return""===t.input.dom.value?(delete t.date,delete t.value,""):t.date?e.Date.format(t.date,t.format.write,void 0,t.format.mode):""},getDate(){return this.date||""},onBeforeHide(){this.hidePicker()},onPickerChangeDate(e,t,i){const n=this;!1!==i&&n.picker.hide(),n.initDate(t),n.changeInputValue()},onInput(){const t=this,i=t.input.dom.value,n=t.acceptedValue;"Invalid Date"!==e.Date.parse(i,t.format.edit,t.format.mode).toString()&&(t.initDate(i,t.format.edit),t.fire("input",i),t.fire("change",i,n))},isValid(){return"Invalid Date"!==e.Date.parse(this.get(),this.format.edit,this.format.mode).toString()},set(e){const t=this;switch(e){case"":case void 0:return delete t.value,delete t.date,void t.changeInputValue()}t.initDate(e),t.changeInputValue()},isEqual(t){const i=this,n=e.Date.parse(t,i.format.read,i.format.mode),s=i.input.dom.value;return(t=e.Date.format(n,i.format.edit,void 0,i.format.mode))===s},onEnter(){const e=this,t=e.input.dom.value,i=e.acceptedValue;""===t&&(e.initDate(),e.fire("input",t),e.fire("change",t,i))}})}(),function(){const e=Fancy;e.define(["Fancy.form.field.DateRange","Fancy.DateRangeField"],{extend:e.Widget,type:"field.daterange",picker:!0,format:"m/d/Y",dateImage:!0,theme:"default",constructor:function(t){e.apply(this,t),this.Super("const",arguments)},init(){this.addEvents("changedatefrom","changedateto","change"),this.preRender(),this.render(),this.initDateFields()},fieldCls:e.cls+" fancy-date-range",width:100,render(){const t=this.renderTo||document.body,i=e.newEl("div");i.addCls(this.cls),this.el=e.get(e.get(t).dom.appendChild(i.dom))},preRender(){},initDateFields(){var t,i,n=this,s=n.theme;e.isArray(n.value)&&(t=new Date(Number(n.value[0])),i=new Date(Number(n.value[1]))),n.dateField1=new e.DateField({renderTo:n.el.dom,label:!1,dateImage:n.dateImage,width:n.width/2,padding:!1,theme:s,value:t,style:{position:"absolute",bottom:"3px",left:"3px"},format:n.format,events:[{showpicker:n.onShowPicker1,scope:n},{change:n.onChangeDate1,delay:1,scope:n},{empty:n.onChangeDate1,delay:1,scope:n},{focus:n.onFocus1,scope:n},{enter:n.onEnter,scope:n}]}),n.dateField1.setInputSize({width:n.width/2}),n.dateField2=new e.DateField({renderTo:n.el.dom,label:!1,dateImage:n.dateImage,width:n.width/2,padding:!1,theme:s,value:i,style:{position:"absolute",bottom:"3px",right:"2px"},format:n.format,events:[{showpicker:n.onShowPicker2,scope:n},{change:n.onChangeDate2,scope:n,delay:1},{empty:n.onChangeDate2,scope:n,delay:1},{focus:n.onFocus2,scope:n},{keydown:n.onEnter,scope:n}]}),n.dateField2.setInputSize({width:n.width/2})},onFocus1(){this.dateField2.hidePicker()},onFocus2(){this.dateField1.hidePicker()},onShowPicker1(){this.dateField2.hidePicker()},onShowPicker2(){this.dateField1.hidePicker()},onChangeDate1(t,i){i&&(i=e.Date.parse(i,t.format.edit,t.format.mode)),this.fire("changedatefrom",i),this.fire("change")},onChangeDate2(t,i){i=void 0===i?"":e.Date.parse(i,t.format.edit,t.format.mode),this.fire("changedateto",i),this.fire("change")},onEnter(){this.dateField1.hidePicker(),this.dateField2.hidePicker()}})}(),Fancy.define(["Fancy.form.field.Text","Fancy.TextField"],{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.text",constructor:function(e){Fancy.apply(this,e),this.Super("const",arguments)},init(){const e=this;e.Super("init",arguments),e.preRender(),e.render(),e.hidden&&e.css("display","none"),e.style&&e.css(e.style)},fieldCls:Fancy.FIELD_CLS+" fancy-field-field-text",value:"",width:100,emptyText:"",tpl:['<div class="fancy-field-label" style="{labelWidth}{labelDisplay}">',"{label}","</div>",'<div class="fancy-field-text">','<div class="fancy-field-text-value">{value}</div>','<div class="fancy-field-error" style="{errorTextStyle}"></div>',"</div>",'<div class="fancy-clearfix"></div>'],set(e){this.el.select(".fancy-field-text-value").item(0).update(e)}}),Fancy.define(["Fancy.form.field.Empty","Fancy.EmptyField"],{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.empty",constructor:function(e){Fancy.apply(this,e),this.Super("const",arguments)},init(){const e=this;e.addEvents(),e.Super("init",arguments),e.preRender(),e.render(),e.style&&e.css(e.style)},ons(){},fieldCls:Fancy.FIELD_CLS+" "+Fancy.FIELD_EMPTY_CLS,width:100,tpl:['<div class="fancy-field-label" style="{labelWidth}{labelDisplay}">',"{label}","</div>",'<div class="fancy-field-text">','<div class="fancy-field-error" style="{errorTextStyle}"></div>',"</div>",'<div class="fancy-clearfix"></div>']}),function(){const e=Fancy,t=e.FIELD_CLS,i=e.FIELD_TEXTAREA_CLS,n=e.FIELD_LABEL_CLS,s=e.FIELD_TEXTAREA_TEXT_CLS,r=e.FIELD_TEXTAREA_TEXT_INPUT_CLS,o=e.FIELD_ERROR_CLS,a=e.CLEARFIX_CLS;e.define(["Fancy.form.field.TextArea","Fancy.TextArea"],{mixins:[e.form.field.Mixin],extend:e.Widget,type:"field.textarea",constructor:function(){this.Super("const",arguments)},init(){const e=this;e.addEvents("change","key"),e.Super("init",arguments),e.preRender(),e.render(),e.ons()},fieldCls:t+" "+i,value:"",width:250,height:100,labelWidth:60,inputWidth:180,minHeight:100,maxHeight:210,lineHeight:12.5,emptyText:"",tpl:['<div class="'+n+'" style="{labelWidth}{labelDisplay}">',"{label}","</div>",'<div class="'+s+'">','<textarea autocomplete="off" placeholder="{emptyText}" type="text" class="'+r+'" style="{inputWidth}height:{inputHeight}px;">{value}</textarea>','<div class="'+o+'" style="{errorTextStyle}"></div>',"</div>",'<div class="'+a+'"></div>'],ons(){const e=this,t=e.el,i=e.el.getByTag("textarea");e.input=i,i.on("blur",e.onBlur,e),i.on("focus",e.onFocus,e),i.on("input",e.onInput,e),i.on("keydown",e.onKeyDown,e),e.on("key",e.onKey,e),e.autoHeight&&i.on("input",e.onChange,e),i.on("mousedown",function(t){e.disabled&&t.preventDefault()}),t.on("mouseenter",e.onMouseOver,e),t.on("mouseleave",e.onMouseOut,e),e.tip&&t.on("mousemove",e.onMouseMove,e)},preRender(){const t=this;t.tpl&&(t.tpl=new e.Template(t.tpl)),t.initHeight(),t.calcSize()},initHeight(){let e,t=this;if(t.height)e=t.height,t.maxHeight<t.height&&setTimeout(()=>{t.input.css({"overflow-y":"scroll"})},1);else if(t.value){let i=t.value.match(/\n/g);e=(i=i?i.length:1)*t.lineHeight}else e=t.height;e<t.minHeight||e>t.maxHeight&&setTimeout(()=>{t.input.css({"overflow-y":"scroll"})},1),t.height=e,t.inputHeight=e},calcSize(){let t,i,n,s,r,o=this,a=o.padding;if(e.isString(a))switch((a=(a=a.replace(/px/g,"")).split(" ")).length){case 1:a=[i=Number(a[0]),i,i,i];break;case 2:a=[n=Number(a[0]),s=Number(a[1]),n,s];break;case 3:a=[n=Number(a[0]),s=Number(a[1]),r=Number(a[2]),n];break;case 4:a=[Number(a[0]),Number(a[1]),Number(a[2]),Number(a[3])]}else e.isNumber(a)?a=[a,a,a,a]:!1===a&&(a=[0,0,0,0]);"top"===o.labelAlign&&(o.inputHeight-=40),t=o.width,"top"!==o.labelAlign&&o.label&&(t-=o.labelWidth),o.height===o.inputHeight&&!1!==o.padding&&(o.inputHeight-=a[0]+a[2]),o.inputWidth=t-a[1]-a[3],o.height=o.inputHeight+a[0]+a[2]},onChange(){let e=this,t=e.input.dom.value,i=e.el.getByTag("textarea"),n=t.match(/\n/g).length*e.lineHeight;n<e.minHeight?(n=e.minHeight,i.css({"overflow-y":"hidden"})):n>e.maxHeight?(n=e.maxHeight,i.css({"overflow-y":"scroll"})):i.css({"overflow-y":"hidden"}),e.height=n}})}(),function(){const e=Fancy.CLEARFIX_CLS,t=Fancy.FIELD_CLS,i=Fancy.FIELD_LABEL_CLS,n=Fancy.FIELD_TEXT_CLS,s=Fancy.FIELD_CHECKBOX_CLS,r=Fancy.FIELD_CHECKBOX_INPUT_CLS,o=Fancy.FIELD_INPUT_LABEL_CLS,a=Fancy.FIELD_CHECKBOX_ON_CLS;Fancy.define(["Fancy.form.field.CheckBox","Fancy.CheckBox"],{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.checkbox",middle:!1,disabled:!1,constructor:function(e){Fancy.applyConfig(this,e),this.Super("const",arguments)},init(){const e=this;e.addEvents("focus","blur","input","up","down","beforechange","change","key"),e.Super("init",arguments),e.preRender(),e.render({labelWidth:e.labelWidth,labelDisplay:e.labelText?"":"none",label:e.label}),e.expander&&e.addCls("fancy-checkbox-expander"),e.acceptedValue=e.value,e.set(e.value,!1),e.checkMiddle(),e.ons()},labelText:"",labelWidth:60,value:!1,editable:!0,stopIfCTRL:!1,checkedCls:a,fieldCls:`${t} ${s}`,tpl:['<div class="'+i+'" style="{labelWidth}{labelDisplay}">',"{label}","</div>",'<div class="'+n+'">','<div class="'+r+'"></div>',"</div>",'<div class="'+o+'" style="{inputLabelDisplay}">',"{inputLabel}","</div>",'<div class="'+e+'"></div>'],ons(){const e=this,t=e.el;t.on("click",e.onClick,e),t.on("mousedown",e.onMouseDown,e),t.on("mouseenter",e.onMouseOver,e),t.on("mouseleave",e.onMouseOut,e),e.tip&&t.on("mousemove",e.onMouseMove,e)},onClick(e){const t=this,i=t.el;if(t.disabled)return;if(t.fire("beforechange"),e.ctrlKey&&t.stopIfCTRL)return;if(!1===t.editable)return;if(!0===t.canceledChange)return void(t.canceledChange=!1);i.toggleCls(t.checkedCls);const n=t.value;t.value=i.hasCls(t.checkedCls),t.fire("change",t.value,n),!0===t.middle&&(t.middle=!1,t.checkMiddle())},onMouseDown(e){e.preventDefault()},set(e,t){const i=this,n=i.el;if(""===e&&(e=!1),!0===e||1===e)n.addCls(i.checkedCls),e=!0;else if(!1===e||0===e)n.removeClass(i.checkedCls),e=!1;else{if(void 0!==e)throw new Error(`[FancyGrid Error] - not right value for checkbox ${e}`);e=!1}i.value=e,!1!==t&&i.fire("change",i.value)},setValue(e,t){this.set(e,t)},getValue(){return this.value},get(){return this.getValue()},clear(){this.set(!1)},toggle(){this.set(!this.value)},destroy(){this.Super("destroy",arguments)},checkMiddle(){const e=this;e.middle?e.el.addCls("fancy-checkbox-middle"):e.el.removeCls("fancy-checkbox-middle")},setMiddle(e){this.middle=e,this.checkMiddle()}})}(),Fancy.define(["Fancy.form.field.Switcher","Fancy.Switcher"],{extend:Fancy.CheckBox,type:"field.switcher",constructor:function(e){Fancy.applyConfig(this,e),this.Super("const",arguments)},init(){this.Super("init",arguments)},checkedCls:"fancy-switcher-on",fieldCls:`${Fancy.FIELD_CLS} fancy-field-switcher`,tpl:['<div class="fancy-field-label" style="{labelWidth}{labelDisplay}">',"{label}","</div>",'<div class="fancy-field-text">',"</div>",'<div class="fancy-field-input-label" style="{inputLabelDisplay}">',"{inputLabel}","</div>",'<div class="fancy-clearfix"></div>']}),function(){const e=Fancy,t=e.FIELD_CLS,i=e.FIELD_COMBO_RESULT_LIST_CLS,n=e.FIELD_COMBO_CLS,s=e.FIELD_COMBO_SELECTED_ITEM_CLS,r=e.FIELD_COMBO_FOCUSED_ITEM_CLS,o=e.FIELD_LABEL_CLS,a=e.FIELD_TEXT_CLS,l=e.CLEARFIX_CLS,d=e.FIELD_ERROR_CLS,c=e.FIELD_TEXT_INPUT_CLS,h=e.FIELD_DISABLED_CLS,u=e.FIELD_COMBO_DROPDOWN_BUTTON_CLS,g=e.FIELD_COMBO_INPUT_CONTAINER_CLS,p=e.FIELD_COMBO_LEFT_EL_CLS,m=e.FIELD_LABEL_ALIGN_TOP_CLS,f=e.FIELD_LABEL_ALIGN_RIGHT_CLS,y=e.FIELD_CHECKBOX_INPUT_CLS,C=e.FIELD_COMBO_LIST_VALUE_CLS;e.define("Fancy.combo.Manager",{singleton:!0,opened:[],add(e){this.hideLists(),this.opened.push(e)},hideLists(){e.each(this.opened,e=>{e.hideList(),e.hideAheadList()}),this.opened=[]}}),e.define(["Fancy.form.field.Combo","Fancy.Combo"],{type:"field.combo",mixins:[e.form.field.Mixin],extend:e.Widget,selectedItemCls:s,focusedItemCls:r,fieldCls:t+" "+n,width:250,labelWidth:60,listRowHeight:28,dropButtonWidth:27,leftWidth:20,maxListRows:9,emptyText:"",editable:!0,typeAhead:!0,readerRootProperty:"data",valueKey:"value",displayKey:"text",multiSelect:!1,itemCheckBox:!1,listCls:"",tpl:['<div class="'+o+'" style="{labelWidth}{labelDisplay}">',"{label}","</div>",'<div class="'+a+'">','<div class="'+g+'" style="{inputWidth}{inputHeight}">','<div class="'+p+'" style="{inputHeight}cursor:default;">&nbsp;</div>','<input autocomplete="off" placeholder="{emptyText}" class="'+c+'" style="{inputHeight}cursor:default;" value="{value}">','<div class="'+u+'">&nbsp;</div>',"</div>","</div>",'<div class="'+d+'" style="{errorTextStyle}"></div>','<div class="'+l+'"></div>'],constructor:function(){this.tags=this.tags||[],this.Super("const",arguments)},init(){const e=this;e.addEvents("focus","blur","input","up","down","change","key","enter","esc","empty","load","add-new-value"),e.Super("init",arguments),e.subSearch&&(e.editable=!1),e.loadListData()||(e.data=e.configData(e.data),e.data=Fancy.Array.copy(e.data)),e.multiSelect&&e.data.length&&e.initMultiSelect(),e.preRender(),e.render(),e.ons(),e.applyStyle(),e.applyTheme(),setTimeout(()=>{e.applyTheme()},1)},loadListData(){const t=this;if(!e.isObject(t.data))return!1;let i=t.data.proxy,n=t.readerRootProperty;if(!i||!i.url)throw new Error("[FancyGrid Error]: combo data url is not defined");return i.reader&&i.reader.root&&(n=i.reader.root),e.Ajax({url:i.url,params:i.params||{},method:i.method||"GET",getJSON:!0,success:e=>{if(t.data=t.configData(e[n]),t.renderList(),t.onsList(),t.multiSelect)t.initMultiSelect(),t.value&&t.updateInput();else if(t.value){const e=t.getDisplayValue(t.value);e&&(t.input.dom.value=e)}t.fire("load")}}),!0},configData(t){if(e.isObject(t)||0===t.length)return t;if(!e.isObject(t[0])){for(var i=[],n=0,s=t.length;n<s;n++)i.push({text:t[n],value:n});return i}return t},applyStyle(){const e=this;e.hidden&&e.css("display","none"),e.style&&e.css(e.style)},applyTheme(){const e=this;e.theme&&"default"!==e.theme&&(e.addCls(Fancy.getThemeCSSCls(e.theme)),e.list.addCls(Fancy.getThemeCSSCls(e.theme)),e.aheadList&&e.aheadList.addCls(Fancy.getThemeCSSCls(e.theme)))},ons(){const e=this,t=e.el,i=e.el.select(`.${u}`);e.input=e.el.getByTag("input"),e.inputContainer=e.el.select(`.${g}`),e.drop=i,e.onsList(),e.input.on("blur",e.onBlur,e),e.input.on("mousedown",e.onInputMouseDown,e),e.input.on("click",e.onInputClick,e),i.on("mousedown",e.onDropMouseDown,e),i.on("click",e.onDropClick,e),e.on("key",e.onKey,e),e.typeAhead&&e.editable&&e.input.on("keydown",e.onKeyDown,e),e.on("esc",e.onEsc,e),e.on("enter",e.onEnter,e),e.on("up",e.onUp,e),e.on("down",e.onDown,e),t.on("mouseenter",e.onMouseOver,e),t.on("mouseleave",e.onMouseOut,e),e.tip&&t.on("mousemove",e.onMouseMove,e)},onSubSearchKeyDown(t){const i=this,n=t.keyCode,s=e.key;switch(n){case s.ESC:i.fire("esc",t);break;case s.ENTER:i.fire("enter",t);break;case s.UP:i.fire("up",t);break;case s.DOWN:i.fire("down",t)}},onKeyDown(t){const i=this,n=t.keyCode,s=e.key;switch(n){case s.ESC:i.fire("esc",t);break;case s.ENTER:i.fire("enter",t);break;case s.UP:i.fire("up",t);break;case s.DOWN:i.fire("down",t);break;case s.TAB:break;case s.BACKSPACE:setTimeout(()=>{if(0===i.input.dom.value.length)i.value=-1,i.valueIndex=-1,i.hideAheadList(),i.multiSelect&&(i.values=[],i.clearListActive()),i.fire("empty");else{if(i.multiSelect&&(i.input.dom.value.split(",").length,i.valuesIndex.length),0===i.generateAheadData().length)return void i.hideAheadList();i.renderAheadList(),i.showAheadList()}},100);break;default:setTimeout(()=>{0!==i.generateAheadData().length?(i.renderAheadList(),i.showAheadList()):i.hideAheadList()},1)}setTimeout(()=>{i.fire("key",i.input.dom.value,t)},1)},onInputClick(){const e=this,t=e.list;e.disabled||!0!==e.editable&&("none"===t.css("display")?e.showList():e.hideList())},onDropClick(){const t=this,i=t.list;t.disabled||("none"===i.css("display")?(e.combo.Manager.add(this),t.showList()):t.hideList(),!0===t.editable&&t.input.focus())},showList(){const t=this,i=t.list,n=t.input.parent().parent(),s=n.$dom.offset(),r=[s.left,s.top+n.$dom.height()],o=e.get(document),a=t.selectedItemCls,l=t.focusedItemCls;if(t.hideAheadList(),!t.list||0===t.data.length)return;if(!t.isListInsideViewBox(n)){const e=this.calcListHeight();r[1]=s.top-e}let d;i.css({display:"",left:r[0]+"px",top:r[1]+3+"px",opacity:0,width:t.getListWidth(),"z-index":2e3+e.zIndex++}),t.listCls&&i.addCls(t.listCls),i.animate({opacity:1,top:r[1]},e.ANIMATE_DURATION),t.clearFocused();const c=i.select(`.${a}`);0===c.length?t.multiSelect&&t.values.length?t.valuesIndex.each(function(e,t,n){void 0===d&&(d=e),i.select("li").item(e).addCls(a)}):d=0:(t.multiSelect&&c.length!==t.valuesIndex.length&&(i.select(`.${a}`).removeCls(a),t.valuesIndex.each((e,t,n)=>{void 0===d&&(d=e),i.select("li").item(e).addCls(a)})),d=c.item(0).index()),-1===d&&(d=0),i.select("li").item(d).addCls(l),t.scrollToListItem(d),t.docSpy||(t.docSpy=!0,o.on("click",t.onDocClick,t)),!1!==t.subSearch&&t.subSearchField&&(t.subSearchField.setInputSize({width:t.getListWidth()-6,height:25}),t.subSearchField.input.focus())},showAheadList(){var t=this,i=t.aheadList,n=t.input.parent().parent(),s=n.$dom.offset(),r=[s.left,s.top+n.$dom.height()],o=e.get(document);t.hideList(),i&&0!==t.data.length&&(i.css({display:"",left:r[0]+"px",top:r[1]+"px",width:t.getListWidth(),"z-index":2e3+e.zIndex++}),t.docSpy2||(t.docSpy2=!0,o.on("click",t.onDocClick,t)))},onDocClick(e){const t=this;if(!1===t.input.parent().parent().within(e.target)){if(!0===t.list.within(e.target))return;t.hideList(),t.hideAheadList()}},hideList(){const t=this;if(t.list&&(t.list.css("display","none"),t.docSpy)){const i=e.get(document);t.docSpy=!1,i.un("click",t.onDocClick,t)}},hideAheadList(){const t=this;if(t.aheadList&&(t.aheadList.css("display","none"),t.docSpy)){const i=e.get(document);t.docSpy=!1,i.un("click",t.onDocClick,t)}},onInputMouseDown(e){this.disabled?e.preventDefault():!1===this.editable&&e.preventDefault()},onDropMouseDown(e){this.disabled&&e.stopPropagation(),e.preventDefault()},onsList(){const e=this;e.list.on("mousedown",e.onListItemMouseDown,e,"li"),e.list.on("click",e.onListItemClick,e,"li"),e.list.on("mouseenter",e.onListItemOver,e,"li"),e.list.on("mouseleave",e.onListItemLeave,e,"li"),e.selectAllText&&e.list.select(".fancy-combo-list-select-all").on("click",e.onSelectAllClick,e)},onsAheadList(){this.aheadList.on("click",this.onAHeadListItemClick,this,"li")},onListItemOver(t){if(this.disabled)return;const i=e.get(t.target);"li"===i.prop("tagName").toLocaleLowerCase()&&i.addCls(this.focusedItemCls)},onListItemLeave(){this.disabled||this.clearFocused()},onListItemMouseDown(){const e=this;e.listItemClicked=!0,setTimeout(()=>{delete e.listItemClicked},1e3)},onListItemClick(t){var i=this,n=e.get(t.currentTarget),s=n.attr("value"),r=i.selectedItemCls,o=i.focusedItemCls;i.disabled||(e.nojQuery&&0===s&&(s=""),i.multiSelect?(0===i.values.length&&i.clearListActive(),i.clearFocused(),"list"===i.getTypeActiveList()&&n.toggleCls(r),n.hasCls(r)?(i.addValue(s),n.addCls(o)):(i.removeValue(s),i.clearFocused(),i.selectAllText&&i.list.select(".fancy-combo-list-select-all").removeCls("fancy-combo-item-selected")),i.updateInput()):(i.set(s),i.hideList()),i.editable?i.input.focus():i.onBlur())},onAHeadListItemClick(t){var i=this,n=e.get(t.currentTarget),s=n.attr("value"),r=i.focusedItemCls;i.disabled||(e.nojQuery&&0===s&&(s=""),i.multiSelect?(0===i.values.length&&i.clearListActive(),i.clearFocused(),i.addValue(s),n.addCls(r),i.updateInput()):(i.set(s),i.hideList()),i.editable?i.input.focus():i.onBlur())},set(t,i){let n,s=this,r="";if(s.multiSelect&&!e.isArray(t)&&(t=-1===t?[]:[t]),e.isArray(t)&&s.multiSelect){const i=[];s.valuesIndex.removeAll(),e.each(t,function(e,n){const o=s.getIndex(e);-1!==o&&(s.valuesIndex.add(o,t[n]),i.push(s.data[o][s.displayKey]),r=i.join(", "))}),s.values=t,n=s.getIndex(t[0]),s.value=t[0],s.valueIndex=n}else-1!==(n=s.getIndex(t))?(s.valueIndex=n,r=s.data[n][s.displayKey],s.selectItem(n)):-1!==t&&t&&t.length>0?(r="",s.value=-1,s.valueIndex=-1):r="",s.value=t;s.input.dom.value=r,!1!==i&&s.onInput(),s.left&&s.updateLeft(),Fancy.isObject(s.data)||s.validate(r)},addValue(e){const t=this,i=t.getIndex(e);-1===i||t.valuesIndex.get(i)||(t.value=e,t.values.push(e),t.valuesIndex.add(i,e))},removeValue(t){let i=this,n=-1;e.each(i.values,(e,i)=>{String(e).toLocaleLowerCase()===String(t).toLocaleLowerCase()&&(n=i)}),-1!==n&&(i.values.splice(n,1),i.valuesIndex.remove(i.getIndex(t))),i.values.length?i.value=i.values[i.values.length-1]:(i.value=-1,i.valueIndex=-1)},updateInput(e){const t=this,i=[];t.valuesIndex.each((e,n,s)=>{i.push(t.data[e][t.displayKey])}),t.input.dom.value=i.join(", "),!1!==e&&t.onInput()},selectItem(e){const t=this;t.list&&(t.multiSelect||t.clearListActive(),t.clearFocused(),t.list.select("li").item(e).addCls(t.focusedItemCls,t.selectedItemCls))},render(){var t=this,i=e.get(t.renderTo||document.body).dom,n=e.newEl("div"),s=t.value,r=-1;n.attr("id",t.id),void 0===s?s="":t.multiSelect&&e.isArray(t.data)&&t.data.length>0?(s="",t.valuesIndex.each((e,i)=>{-1===r&&(r=e,t.valueIndex=e),t.data[e]&&(s+=t.data[e][t.displayKey]+", ")}),s=s.replace(/, $/,"")):-1!==(r=t.getIndex(s))?(t.valueIndex=r,s=t.data[r][t.displayKey]):s="",t.fire("beforerender"),n.addCls(e.cls,t.cls,t.fieldCls);let l="";t.labelWidth&&(l=`width:${t.labelWidth}px;`);let d=t.label;""===t.label?d="&nbsp;":void 0===t.label?d="&nbsp;":"right"!==t.labelAlign&&(d+=":"),n.update(t.tpl.getHTML({labelWidth:l,labelDisplay:!1===t.label?"display: none;":"",label:!1===d?"":d,emptyText:t.emptyText,inputHeight:"height:"+t.inputHeight+"px;",value:s})),t.el=n,t.setStyle(),t.input=t.el.getByTag("input"),t.inputContainer=t.el.select(`.${g}`),t.drop=t.el.select(`.${u}`),t.leftTpl&&(t.left=t.el.select("."+p),t.left.css({display:"block",width:t.leftWidth})),t.setSize(),i.appendChild(n.dom),"top"===t.labelAlign?t.el.addCls(m):"right"===t.labelAlign&&(t.el.addCls(f),e.$(n.dom).find(`.${o}`).insertAfter(e.$(n.dom).find(`.${a}`))),t.valueIndex&&(t.acceptedValue=t.value),t.editable?t.input.css("cursor","auto"):t.input&&t.input.attr("tabIndex",-1),t.disabled&&(t.addCls(h),t.input&&t.input.attr("tabIndex",-1)),t.renderList(),t.leftTpl&&(setTimeout(()=>{t.updateLeft()},1),setTimeout(()=>{t.updateLeft()},500),setTimeout(()=>{t.updateLeft()},1e3)),t.fire("afterrender"),t.fire("render")},renderList(){const t=this,n=e.newEl("div"),s=[];t.selectAllText&&s.push('<div class="fancy-combo-list-select-all"><div class="fancy-field-checkbox-input" style=""></div><span class="fancy-combo-list-select-all-text">'+t.selectAllText+"</span></div>"),!1===t.editable&&!1!==t.subSearch&&"checkbox"!==t.type&&s.push('<div class="fancy-combo-list-sub-search-container"></div>'),t.list&&t.list.destroy(),s.push(['<ul style="position: relative;">']),e.each(t.data,function(i,n){var r="",o=i[t.displayKey],a=i[t.valueKey];if(String(t.value).toLocaleLowerCase()===String(a).toLocaleLowerCase()&&(r=t.selectedItemCls),""===o||" "===o)o="&nbsp;";else if(t.listItemTpl){o=new e.Template(t.listItemTpl).getHTML(i)}t.multiSelect&&t.itemCheckBox?s.push('<li value="'+a+'" class="'+r+'"><div class="'+y+'" style=""></div><span class="'+C+'">'+o+"</span></li>"):s.push('<li value="'+a+'" class="'+r+'"><span class="'+C+'">'+o+"</span></li>")}),s.push("</ul>"),n.addCls(e.cls,i),n.update(s.join("")),n.css({display:"none",left:"0px",top:"0px",width:t.getListWidth()}),t.data.length>t.maxListRows&&n.select("ul").item(0).css({height:t.listRowHeight*t.maxListRows+"px",overflow:"auto"}),document.body.appendChild(n.dom),t.list=n,!1===t.editable&&"checkbox"!==t.type&&!1!==t.subSearch&&(t.subSearchField=new e.StringField({renderTo:t.list.select(".fancy-combo-list-sub-search-container").item(0).dom,label:!1,style:{padding:"2px 2px 0px 2px"},events:[{change:t.onSubSearchChange,scope:t}]}),t.subSearchField.setInputSize({width:t.getListWidth()-6,height:25}),t.subSearchField.input.on("keydown",t.onSubSearchKeyDown,t)),t.applyTheme()},getListWidth(){let e,t=this,i=t.inputWidth+14,n=t.minListWidth;return t.input&&(i=(e=t.input.parent().parent()).width()),n&&n>i&&(i=n),i},generateAheadData(){let t=this,i=t.input.dom.value.toLocaleLowerCase(),n=[];if(t.multiSelect){var s=i.split(", "),r=t.getInputSelection(),o=0;e.each(i,function(e,t){if(r.start<=t)return!0;","===i[t]&&o++}),i=s[o]}return e.each(t.data,function(e){var s=i;s&&(s=s.replace(/\(/g,"").replace(/\)/,"")),new RegExp("^"+s).test(e[t.displayKey].toLocaleLowerCase())&&n.push(e)}),t.data.length===n.length&&(n=[]),t.aheadData=n,n},renderAheadList(){var t,n=this,s=['<ul style="position: relative;">'],r=!1;n.getDisplayValue();n.aheadList?(n.aheadList.firstChild().destroy(),t=n.aheadList,r=!0):t=e.newEl("div"),e.each(n.aheadData,(t,i)=>{var r="",o=t[n.displayKey],a=t[n.valueKey];if(0===i&&(r=n.selectedItemCls),""===o||" "===o)o="&nbsp;";else if(n.listItemTpl){o=new e.Template(n.listItemTpl).getHTML(t)}s.push('<li value="'+a+'" class="'+r+'"><span class="'+C+'">'+o+"</span></li>")}),s.push("</ul>"),t.update(s.join("")),t.css({display:"none",left:"0px",top:"0px",width:n.getListWidth()}),t.css({"max-height":n.listRowHeight*n.maxListRows+"px",overflow:"auto"}),!1===r&&(t.addClass(e.cls,i),document.body.appendChild(t.dom),n.aheadList=t,n.onsAheadList()),n.applyTheme()},hide(){this.css("display","none"),this.hideList(),this.hideAheadList()},clear(){const e=this;e.multiSelect?e.set([],!1):e.set(-1,!1)},clearListActive(){const e=this.selectedItemCls,t=this.focusedItemCls;this.list.select(`.${t}`).removeCls(t),this.list.select(`.${e}`).removeCls(e)},clearFocused(){const e=this,t=e.focusedItemCls;e.list&&e.list.select(`.${t}`).removeCls(t),e.aheadList&&e.aheadList.select(`.${t}`).removeCls(t)},onInput(){const e=this,t=e.getValue(),i=e.acceptedValue;e.acceptedValue=e.get(),e.fire("change",t,i),e.left&&e.updateLeft()},setValue(e,t){this.set(e,t)},getDisplayValue(e,t){const i=this,n=i.getIndex(e);return t?n:i.data[n]?i.data[n][i.displayKey]:""},getValueKey(e,t){let i=this,n=0,s=i.data.length;for(;n<s;n++)if(String(i.data[n][i.displayKey]).toLocaleLowerCase()===String(e).toLocaleLowerCase())return t?n:i.data[n][i.valueKey]},get(){return this.getValue()},getValue(){const e=this;return e.multiSelect?e.values:-1===e.value||void 0===e.value?-1===e.value&&e.input.dom.value?e.input.dom.value:"":(e.valueKey,e.value)},size(e){var t=this,i=e.width,n=e.height,s=t.input,r=t.inputContainer,o=t.drop;"top"!==t.labelAlign&&(t.inputHeight=n),void 0!==n&&(t.height=n),void 0!==i&&(t.width=i),t.calcSize(),"top"===t.labelAlign?t.css({height:1.5*t.height,width:t.width}):t.css({height:t.height,width:t.width});let a=t.inputWidth,l=2;"dark"===t.theme&&(l=0);let d=a-l;t.left&&(d-=t.leftWidth),s.css({width:d,height:t.inputHeight,"margin-left":t.left?t.leftWidth:0}),r.css({width:a,height:t.inputHeight}),o.css("height",t.inputHeight)},onEnter(e,t){let i;var n,s=this,r=s.getActiveList(),o=s.focusedItemCls,a=s.selectedItemCls;if(s.multiSelect){if(!r)return;if((i=r.select(`.${o}`))&&i.dom||(i=r.select(`.${a}`).last()),i&&i.dom){n=i.attr("value"),s.addValue(n);var l=s.getDisplayValue(n,!0);s.selectItem(l),s.updateInput()}}else if(r)(i=r.select(`.${o}`))&&i.dom||(i=r.select(`.${a}`)),n=i.attr("value"),s.set(n);else if(""===s.input.dom.value)s.set(s.input.dom.value);else{let e=s.input.dom.value;s.detectedNewValue(e)}s.hideList(),s.hideAheadList()},onEsc(e,t){this.hideList(),this.hideAheadList()},onUp(e,t){var i=this,n=i.getActiveList(),s=i.focusedItemCls,r=i.selectedItemCls;if(n){n=i.getActiveList().select("ul"),t.preventDefault();let e=n.select(`.${s}`),d=!1;e.dom||(e=n.select(`.${r}`)),e.dom||(d=!0,e=n.lastChild()),e.length>1&&(e=e.item(0));var o=e.index(),a=n.select("li"),l=parseInt(n.css("height"));0===o||d?o=a.length-1:o--;const c=a.item(o),h=c.dom.offsetTop;h-n.dom.scrollTop>l?n.dom.scrollTop=1e4:h-n.dom.scrollTop<0&&(n.dom.scrollTop=h),i.clearFocused(),c.addClass(s)}},onDown(e,t){var i=this,n=i.getActiveList(),s=i.focusedItemCls,r=i.selectedItemCls;if(n){n=i.getActiveList().select("ul"),t.preventDefault();var o=n.select("."+s),a=!1;o.dom||(o=n.select("."+r)),o.dom||(a=!0,o=n.firstChild()),o.length>1&&(o=o.item(0));var l=parseInt(o.css("height")),d=o.index(),c=n.select("li"),h=parseInt(n.css("height"));d===c.length-1||a?d=0:d++;var u=c.item(d),g=u.dom.offsetTop,p=parseInt(u.css("height"));g-n.dom.scrollTop<0?n.dom.scrollTop=0:g+p+3-n.dom.scrollTop>h&&(n.dom.scrollTop=g-h+l+p),i.clearFocused(),u.addClass(s)}else i.showList()},scrollToListItem(e){const t=this.getActiveList().select("ul"),i=t.select("li"),n=i.item(e).dom.offsetTop;0===e?t.dom.scrollTop=0:e===i.length-1?t.dom.scrollTop=1e4:t.dom.scrollTop=n},getActiveList(){let e=this,t=!1;return e.list&&"none"!==e.list.css("display")?t=e.list:e.aheadList&&"none"!==e.aheadList.css("display")&&(t=e.aheadList),t},getTypeActiveList(){return this.list&&"none"!==this.list.css("display")?"list":this.aheadList&&"none"!==this.aheadList.css("display")?"ahead":void 0},initMultiSelect(){const t=this,i=t.value;t.values=[],t.valuesIndex=new e.Collection,void 0!==t.value&&null!==i&&""!==i&&(e.isArray(i)?(t.values=i,t.value=i[0]):t.values=[t.value],e.each(t.values,function(e){t.valuesIndex.add(t.getIndex(e),e)}))},getIndex(e){for(var t=this.data,i=0,n=t.length;i<n;i++)if(String(t[i][this.valueKey]).toLocaleLowerCase()==String(e).toLocaleLowerCase())return i;return-1},getFromInput(){const t=this,i=t.input.dom.value.split(","),n=[];return e.each(i,function(e){const i=e.replace(/ $/,"").replace(/^ /,""),s=t.getValueKey(i);s&&n.push(s)}),n},updateLeft(){const t=this,i=t.data[t.getIndex(t.getValue())];t.left.update(new e.Template(t.leftTpl).getHTML(i))},setData(t){const i=this;i.data=t,i.multiSelect&&(i.values=[],i.valuesIndex=new e.Collection,i.clearListActive()),i.clear(),i.renderList(),i.onsList()},onSelectAllClick(){const e=this.list.select("li"),t=this.list.select(".fancy-combo-list-select-all").item(0),i=t.hasClass("fancy-combo-item-selected");setTimeout(()=>{i?t.removeCls("fancy-combo-item-selected"):t.addCls("fancy-combo-item-selected")},100),e.each((e,t)=>{i?e.hasClass("fancy-combo-item-selected")&&e.dom.click():e.hasClass("fancy-combo-item-selected")||e.dom.click()})},onSubSearchChange(t,i){var n=this,s=n.list.select("li"),r=0,o=n.listRowHeight*n.maxListRows;i=i.toLocaleLowerCase(),e.each(n.data,(e,t)=>{new RegExp("^"+i).test(e[n.displayKey].toLocaleLowerCase())?(s.item(t).css("display","block"),r+=parseInt(s.item(t).css("height"))):s.item(t).css("display","none")});const a=n.list.select("ul").item(0);r>o?a.css("height",o):a.css("height",r)},isListInsideViewBox(t){const i=t.$dom.offset(),n=this.calcListHeight()+t.$dom.height();return!(i.top+n>e.getViewSize()[0]+Fancy.getScroll()[0])},calcListHeight(){let e=this,t=e.data.length*e.listRowHeight;return e.data.length>e.maxListRows&&(t=e.maxListRows*e.listRowHeight),t},detectedNewValue(t){const i=this;i.data.push({text:t,value:t}),i.multiSelect&&(i.values=[],i.valuesIndex=new e.Collection,i.clearListActive()),i.renderList(),i.onsList(),i.set(t),this.fire("add-new-value",t)}})}(),function(){const e=Fancy,t=e.CLEARFIX_CLS,i=e.FIELD_CLS,n=e.FIELD_LABEL_CLS,s=e.FIELD_TEXT_CLS,r=e.FIELD_BUTTON_CLS;e.define(["Fancy.form.field.Button","Fancy.ButtonField"],{mixins:[e.form.field.Mixin],extend:e.Widget,type:"field.button",pressed:!1,constructor:function(t){e.apply(this,t),this.Super("const",arguments)},init(){const e=this;e.addEvents("click"),e.Super("init",arguments),e.preRender(),e.render(),e.renderButton(),e.ons(),e.hidden&&e.css("display","none"),e.style&&e.css(e.style)},fieldCls:`${i} ${r}`,value:"",width:100,emptyText:"",tpl:['<div class="'+n+'" style="{labelWidth}{labelDisplay}">',"{label}","</div>",'<div class="'+s+'">',"</div>",'<div class="'+t+'"></div>'],renderButton(){const t=this;t.button=new e.Button({renderTo:t.el.select(`.${s}`).item(0).dom,text:t.buttonText,disabled:t.disabled,pressed:t.pressed,enableToggle:t.enableToggle,imageCls:t.imageCls,handler:function(){t.disabled||(t.scope?t.handler.apply(t.scope,[t]):t.handler(t))}})},ons(){const e=this,t=e.el;e.button.on("pressedchange",function(t,i){e.fire("pressedchange",i)}),t.on("mouseenter",e.onMouseOver,e),t.on("mouseleave",e.onMouseOut,e),e.tip&&t.on("mousemove",e.onMouseMove,e)},onClick(){const e=this;e.disabled||(e.fire("click"),e.handler&&e.handler())},setPressed(e){this.button.setPressed(e)}})}(),Fancy.define(["Fancy.form.field.SegButton","Fancy.SegButtonField"],{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.button",allowToggle:!0,constructor:function(e){Fancy.apply(this,e),this.Super("const",arguments)},init(){const e=this;e.addEvents("click","change"),e.Super("init",arguments),e.preRender(),e.render(),e.renderButton(),e.ons(),e.hidden&&e.css("display","none"),e.style&&e.css(e.style)},fieldCls:"fancy fancy-field fancy-field-button",value:"",width:100,emptyText:"",tpl:['<div class="fancy-field-label" style="{labelWidth}{labelDisplay}">',"{label}","</div>",'<div class="fancy-field-text">',"</div>",'<div class="fancy-clearfix"></div>'],renderButton(){const e=this;e.button=new Fancy.SegButton({renderTo:e.el.select(".fancy-field-text").item(0).dom,items:e.items,disabled:e.disabled,multiToggle:e.multiToggle,allowToggle:e.allowToggle})},ons(){const e=this,t=e.el;e.button.on("toggle",function(){e.disabled||e.fire("toggle")}),t.on("mouseenter",e.onMouseOver,e),t.on("mouseleave",e.onMouseOut,e),e.tip&&t.on("mousemove",e.onMouseMove,e)},onClick(){const e=this;e.disabled||(e.fire("click"),e.handler&&e.handler())},get(){const e=[];return Fancy.each(this.items,(t,i)=>{t.pressed&&(t.value?e.push(t.value):e.push(i))}),e.toString()},clear(e){this.allowToggle&&Fancy.each(this.items,t=>{t.setPressed(!1,e)})},setValue(e){const t=this.items;switch(this.clear(!1),Fancy.typeOf(e)){case"array":Fancy.each(e,e=>{switch(Fancy.typeOf(e)){case"string":Fancy.each(t,t=>{t.value===e&&t.setPressed(!0,!0)});break;case"number":t[e].setPressed(!0,!0)}});break;case"string":Fancy.each(t,t=>{t.value===e&&t.setPressed(!0,!0)});break;case"number":const i=t[e];i&&i.setPressed(!0,!0)}}}),Fancy.define(["Fancy.form.field.Line","Fancy.FieldLine"],{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.line",constructor:function(e){Fancy.apply(this,e),this.Super("const",arguments)},init(){const e=this;e.Super("init",arguments);var t,i=0,n=e.items.length,s=Fancy.id(null,"fancy-line-");if(e.parentSet)var r=e.width/e.items.length;for(;i<n;i++){var o=e.items[i];void 0===o.width&&(o.width=r),o.style=o.style||{},o.lineName=s,"top"===o.labelAlign?(t=!0,e.parentSet&&(o.style.padding="0px"),o.label&&(o.labelWidth=o.width-16,100===o.labelWidth&&(o.labelWidth=7*(o.label.length+1+1)),o.width<o.labelWidth&&(o.labelWidth=7*(o.label.length+1+1)))):(o.style["padding-top"]="0px",!o.labelWidth&&o.label&&(o.labelWidth=7*(o.label.length+1+1))),0===i&&(o.style["padding-left"]="0px")}e.preRender(),e.render(),t&&e.css("height","48px")},fieldCls:"fancy fancy-field fancy-field-line",value:"",width:100,emptyText:"",tpl:['<div class="fancy-field-text fancy-field-line-items">',"</div>"]}),Fancy.define(["Fancy.form.field.Set","Fancy.SetField"],{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.set",padding:"8px 11px 0px 8px",constructor:function(e){Fancy.apply(this,e),this.Super("const",arguments)},init(){const e=this;e.addEvents("beforecollapse","collapse","expanded","expand","beforeexpand","beforeexpanded"),e.Super("init",arguments),Fancy.each(e.items,(e,t)=>{"top"===e.labelAlign&&0===t&&(e.style={"padding-left":"0px"}),"line"===e.type&&(e.padding=!1,e.parentSet=!0)}),e.preRender(),e.render(),void 0!==e.checkbox&&e.initCheckBox(),e.on("beforecollapse",e.onBeforeCollapsed,e),e.on("expanded",e.onExpanded,e)},fieldCls:"fancy-field-set",value:"",width:100,emptyText:"",tpl:["<fieldset>","<legend>",'<div class="fancy-field-checkbox-input" style="float:left;margin-top: 4px;display: none;"></div>','<div class="fancy-field-set-label" style="float:left;">{label}</div>','<div class="fancy-clearfix"></div>',"</legend>",'<div class="fancy-field-text fancy-field-set-items">',"</div>","</fieldset>"],initCheckBox(){const e=this,t=e.el.select(".fancy-field-checkbox-input");t.css("display",""),!0===e.checkbox&&e.addCls("fancy-checkbox-on");const i=e.el.select(".fancy-field-set-items");setTimeout(()=>{!0===e.checkbox||e.fire("collapse")},1),!0===e.checkbox?(i.css("display",""),e.removeCls("fancy-set-collapsed")):(i.css("display","none"),e.addCls("fancy-set-collapsed")),t.on("click",function(){e.toggleCls("fancy-checkbox-on");const t=e.el.hasCls("fancy-checkbox-on"),i=e.el.select(".fancy-field-set-items");t?(e.fire("beforeexpanded"),e.fire("beforeexpand"),i.css("display",""),e.removeCls("fancy-set-collapsed"),e.fire("expanded"),e.fire("expand")):(e.fire("beforecollapse"),i.css("display","none"),e.addCls("fancy-set-collapsed"),e.fire("collapse"))})},onBeforeCollapsed(){const e=this.form,t=this.el.select(".fancy-field-set-items"),i=parseInt(t.css("height"));e.setHeight(e.getHeight()-i)},onExpanded(){const e=this.form,t=this.el.select(".fancy-field-set-items"),i=parseInt(t.css("height"));e.setHeight(e.getHeight()+i)}}),Fancy.define("Fancy.form.field.Tab",{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.tab",constructor:function(e){Fancy.apply(this,e),this.Super("const",arguments)},init(){const e=this;e.addEvents("collapsed","expanded"),e.Super("init",arguments);let t=0,i=e.items.length;for(;t<i;t++){const i=e.items[t];"top"===i.labelAlign&&0===t&&(i.style={"padding-left":"0px"})}e.preRender(),e.render()},fieldCls:"fancy fancy-field-tab",value:"",width:100,emptyText:"",tpl:['<div class="fancy-field-tab-items">',"</div>"]}),Fancy.define(["Fancy.form.field.HTML","Fancy.HTMLField"],{mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,type:"field.html",constructor:function(e){Fancy.apply(this,e),this.Super("const",arguments)},init(){const e=this;e.addEvents("focus","blur","input","enter","up","down","esc","change","key"),e.Super("init",arguments),e.preRender(),e.render(),e.hidden&&e.css("display","none"),e.style&&e.css(e.style)},fieldCls:"fancy-field-html",value:"",width:100,emptyText:"",tpl:['<div class="" style="">',"{value}","</div>"],render(){const e=this,t=e.renderTo||document.body,i=F.newDomEl("div");e.fire("beforerender"),i.innerHTML=e.tpl.getHTML({value:e.value,height:e.height}),e.el=t.appendChild(i),e.el=Fancy.get(e.el),e.el.addCls(e.cls,Fancy.cls,e.fieldCls),e.acceptedValue=e.value,e.fire("afterrender"),e.fire("render")},set(e,t){const i=this;i.el.firstChild().update(e),!1!==t&&i.onInput()},get(){return this.el.firstChild().dom.innerHTML}}),Fancy.define(["Fancy.form.field.ReCaptcha","Fancy.ReCaptcha"],{type:"field.recaptcha",mixins:[Fancy.form.field.Mixin],extend:Fancy.Widget,constructor:function(e){Fancy.apply(this,e),this.Super("const",arguments)},init(){const e=this;e.addEvents("focus","blur","input","enter","up","down","esc","change","key"),e.Super("init",arguments),e.tpl=new Fancy.Template(e.tpl),e.render(),e.name="recaptcha",e.hidden&&e.css("display","none"),e.style&&e.css(e.style);const t=document.createElement("script");t.type="text/javascript",t.src="https://www.google.com/recaptcha/api.js",Fancy.get(document.head).append(t)},get(){const e=this,t=e.el.select("form");return e.value?e.value:(e.value="wait",t.one("submit",function(t){t.preventDefault(),e.value=Fancy.$(this).serialize().replace("g-recaptcha-response=","")}),t.submit(),e.value)},fieldCls:Fancy.FIELD_CLS,value:"",width:100,tpl:['<form method="POST">','<div class="g-recaptcha" data-sitekey="{key}"></div>',"</form>"]}),function(){const e=Fancy,t=e.CLEARFIX_CLS,i=e.FIELD_CLS,n=e.FIELD_RADIO_CLS,s=e.FIELD_RADIO_COLUMN_CLS,r=e.FIELD_TEXT_CLS,o=e.FIELD_RADIO_ON_CLS,a=e.FIELD_RADIO_INPUT_CLS,l=e.FIELD_LABEL_CLS,d=e.FIELD_ERROR_CLS;e.define(["Fancy.form.field.Radio","Fancy.Radio"],{mixins:[e.form.field.Mixin],extend:e.Widget,type:"field.radio",radioRows:1,constructor:function(){this.Super("const",arguments)},init:function(){const t=this;t.addEvents("focus","blur","input","up","down","change","key"),t.Super("init",arguments);let i="";t.column&&(t.cls+=" "+s,i+='<div style="margin-left: '+t.labelWidth+'px;">'),e.each(t.items,(e,n)=>{let s="",l=r;t.column||0===n||(s="margin-left:10px;"),e.value===t.value&&(l+=" "+o),i+=['<div class="'+l+'" value='+e.value+">",'<div class="'+a+'" style="float:left;'+s+'"></div>','<div style="float:left;margin:7px 0 0 0;">'+e.text+"</div>","</div>"].join("")}),t.column&&(i+="</div>"),t.itemsHTML=i,t.preRender(),t.render(),t.setColumnsStyle(),t.acceptedValue=t.value,t.set(t.value),t.ons()},labelText:"",labelWidth:60,value:!1,checkedCls:o,fieldCls:i+" "+n,tpl:['<div class="'+l+'" style="{labelWidth}{labelDisplay}">',"{label}",'<div class="'+d+'" style="{errorTextStyle}"></div>',"</div>","{itemsHTML}",'<div class="'+t+'"></div>'],ons(){const t=this,i=this.el;i.$dom.delegate(`.${r}`,"click",function(){t.disabled||t.set(e.get(this).attr("value"))}),i.on("mousedown",t.onMouseDown,t),i.on("mouseenter",t.onMouseOver,t),i.on("mouseleave",t.onMouseOut,t),t.tip&&i.on("mousemove",t.onMouseMove,t)},onClick(){const e=this,t=e.checkedCls;e.disabled||(e.addCls(t),e.toggleCls(t),e.value=e.hasCls(t),e.fire("change",e.value))},onMouseDown(e){this.disabled&&e.stopPropagation(),e.preventDefault()},set(e,t){const i=this,n=i.el,s=i.checkedCls;n.select(`.${r}`).removeCls(s),n.select("[value="+e+"]").addCls(s),i.value=e,!1!==t&&i.fire("change",i.value)},setValue(e,t){this.set(e,t)},getValue(){return this.value},get(){return this.getValue()},clear(){this.set(!1)},calcColumns(){var t=this,i=0,n=t.width;"top"!==t.labelAlign&&t.label&&(n-=t.labelWidth,n-=20),e.Array.each(t.items,function(e){e.text.length>i&&(i=e.text.length)});let s=Math.floor(n/(7*i+30));t.columns&&t.columns<=s?s=t.columns:t.columns=s,t.columnWidth=Math.ceil(n/s),t.rows=Math.ceil(t.items.length/s)},setColumnsStyle(){const e=this;if(!e.columns||1===e.rows)return;const t=e.el.select(`.${r}`),i=e.el.select(`.${r} .${a}`);t.each((t,n)=>{n%e.columns==0&&i.item(n).css("margin-left","0px"),t.css("width",e.columnWidth)})}})}(),Fancy.vtypes={},Fancy.addValid=((e,t)=>{Fancy.vtypes[e]=t}),Fancy.isValid=((e,t)=>{let i;if(Fancy.isString(e)?i=Fancy.vtypes[e]:Fancy.isObject(e)&&(e.type?(i=Fancy.vtypes[e.type],Fancy.applyIf(e,i)):i=e),i.before){let n=i.before,s=[e];Fancy.isString(n)?s.push(n):Fancy.isArray(n)&&(s=s.concat(n)),s.reverse();let r=0,o=s.length;for(;r<o;r++)if((i=Fancy.isObject(s[r])?s[r]:Fancy.vtypes[s[r]]).re){if(!1===i.re.test(t))return i}else if(i.fn&&!1===i.fn.apply(i,[t]))return i}else if(i.re){if(!1===i.re.test(t))return i}else if(!1===i.fn.apply(i,[t]))return i;return!0}),Fancy.addValid("notempty",{text:"Must be present",fn:e=>null!==e&&void 0!==e&&0!==String(e).length}),Fancy.addValid("notnan",{text:"Must be numeric",fn:e=>!isNaN(e)}),Fancy.addValid("min",{before:["notempty","notnan"],text:"Must be must be at least {param}",fn(e){return e>=this.param}}),Fancy.addValid("max",{before:["notempty","notnan"],text:"Must be no more than {param}",fn(e){return e<=this.param}}),Fancy.addValid("range",{before:["notempty","notnan"],text:"Must be between {min} and {max}",fn(e){return e>=this.min&&e<=this.max}}),Fancy.addValid("email",{before:"notempty",re:/^(")?(?:[^\."])(?:(?:[\.])?(?:[\w\-!#$%&'*+\/=?\^_`{|}~]))*\1@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/,text:"Is not a valid email address"}),Fancy.modules.grid=!0,Fancy.Mixin("Fancy.grid.mixin.PrepareConfig",{prepareConfig(e,t){const i=this;return e._plugins=e._plugins||[],e.renderOuter&&(e.renderTo=e.renderOuter),e=i.generateColumnsFromData(e,t),e=i.copyColumns(e,t),e=i.prepareConfigScroll(e,t),e=i.prepareConfigData(e,t),e=i.prepareConfigTheme(e,t),e=i.prepareConfigLang(e,t),e=i.prepareConfigSpark(e,t),e=i.prepareConfigPaging(e,t),e=i.prepareConfigInfinite(e,t),e=i.prepareConfigBars(e),e=i.prepareConfigTBar(e),e=i.prepareConfigSubTBar(e),e=i.prepareConfigExpander(e),e=i.prepareConfigColumnMinMaxWidth(e),e=i.prepareConfigGrouping(e),e=i.prepareConfigGroupHeader(e),e=i.prepareConfigSorting(e),e=i.prepareConfigEdit(e),e=i.prepareConfigSelection(e),e=i.prepareConfigLoadMask(e,t),e=i.prepareConfigDefaults(e),e=i.prepareConfigFilter(e,t),e=i.prepareConfigSearch(e),e=i.prepareConfigSummary(e),e=i.prepareConfigState(e,t),e=i.prepareConfigExporter(e),e=i.prepareConfigSmartIndex(e),e=i.prepareConfigActionColumn(e),e=i.prepareConfigWidgetColumn(e),e=i.prepareConfigChart(e,t),e=i.prepareConfigCellTip(e),e=i.prepareConfigHeaderCellTip(e),e=i.prepareConfigColumnsWidth(e),e=i.prepareConfigSize(e,t),e=i.prepareConfigContextMenu(e,t),e=i.prepareConfigColumns(e),e=i.prepareConfigColumnsResizer(e),e=i.prepareConfigFooter(e),e=i.prepareConfigDD(e)},copyColumns:(e,t)=>(e.columns&&(e.columns=Fancy.Array.copy(e.columns,!0)),t.columns&&(t.columns=Fancy.Array.copy(t.columns)),e),generateColumnsFromData(e,t){if(!e.columns&&e.data&&e.data.length&&Fancy.isArray(e.data[0])){const i=e.data[0]||e.data[0],n=[],s=[];Fancy.each(i,(e,t)=>{n.push({index:"autoIndex"+t}),s.push("autoIndex"+t)}),e.columns=n,e.data={items:e.data,fields:s},t.data=e.data}return e},prepareConfigScroll:(e,t)=>(Fancy.isIE&&!1!==t.nativeScroller&&(e.nativeScroller=!0),e),prepareConfigSpark(e){const t=this;return Fancy.each(e.columns,i=>{const n=i.sparkConfig;if(n&&n.legend)switch(n.legend.type){case"tbar":case"bbar":case"buttons":var s=n.legend.type,r=i.index;e[s]=e[s]||[],e[s]=e[s].concat(t._generateLegendBar(n.title,r,n.legend.style,i))}}),e},_generateLegendBar(e,t,i,n){var s=0,r=e.length,o=[],a=this;const l={length:0},d=function(t){var i,n=a;Fancy.each(a.columns,(e,t)=>{e.index===a.columns[t].index&&(i=t)}),(t.hasCls("fancy-legend-item-disabled")||e.length-1!==l.length)&&(t.toggleCls("fancy-legend-item-disabled"),t.hasCls("fancy-legend-item-disabled")?(l[t.index]=!0,n.disableLegend(i,t.index),l.length++):(n.enableLegend(i,t.index),delete l[t.index],l.length--))};for(;s<r;s++){var c=t[s];Fancy.isString(n.index)&&(c=n.index+"."+s);const r={handler:d,index:c,imageColor:Fancy.COLORS[s],text:e[s]};0===s&&i&&(r.style=i),o.push(r)}return o},prepareConfigData(e){if(e.data||(e.data=[]),Fancy.isArray(e.data)&&0===e.data.length&&e.columns){const t=[],i={};Fancy.each(e.columns,e=>{if(e.index)if(/\./.test(e.index)){var n=e.index.split(".");i[n[0]]||(t.push(n[0]),i[n[0]]=!0)}else t.push(e.index||e.key);e.columns&&Fancy.each(e.columns,e=>{e.index&&t.push(e.index||e.key)})}),e.data={fields:t,items:[]}}return e},prepareConfigLoadMask(e){var t,i=!1!==e.loadMask;return Fancy.isString(e.loadMask)&&(t=e.loadMask),e._plugins.push({type:"grid.loadmask",showOnWaitingServer:i,loadText:t}),e},reConfigStore(e){const t=this.store,i=this.getFieldsFromData(e),n="Fancy.model."+Fancy.id();Fancy.define(n,{extend:Fancy.Model,fields:i}),this.model=n,t.model=n,this.fields=i,t.fields=i,t.setModel()},prepareConfigDefaults:e=>(e.defaults=e.defaults||{},void 0===e.defaults.type&&(e.defaults.type="string"),Fancy.each(e.defaults,(t,i)=>{Fancy.each(e.columns,t=>{switch(t.type){case"select":case"order":case"expand":case"rowdrag":return}void 0===t[i]&&(t[i]=e.defaults[i]),"width"===i&&t.flex&&delete t.width})}),e),prepareConfigColumnMinMaxWidth:e=>(Fancy.each(e.columns,e=>{void 0===e.width&&!e.flex&&e.minWidth&&(e.width=e.minWidth)}),e),prepareConfigCellTip:e=>(Fancy.each(e.columns,t=>{if(t.cellTip)return e._plugins.push({type:"grid.celltip"}),!0}),e),prepareConfigHeaderCellTip:e=>(Fancy.each(e.columns,t=>{if(t.headerCellTip)return e._plugins.push({type:"grid.headercelltip"}),!0}),e),prepareConfigDD(e){if(e.gridToGrid){var t={type:"grid.dragdrop"};Fancy.apply(t,e.gridToGrid),e._plugins.push(t)}if(e.rowDragDrop||e.droppable){t={type:"grid.rowdragdrop"};Fancy.apply(t,e.rowDragDrop),e._plugins.push(t)}return e},prepareConfigColumns(e,t){for(var i=e.columns,n=[],s=[],r=0,o=i.length,a=!1,l=!1,d=!1;r<o;r++){const c=i[r];if(c.draggable&&(a=!0),"tree"===c.type&&(l=!0),"rowdrag"!==c.type&&!c.rowdrag||e.rowDragDrop||(e.rowDragDrop=!0),c.headerCheckBox&&!0!==c.sortable&&(c.sortable=!1),c.autoHeight&&(d=!0),c.select&&(this.checkboxRowSelection=!0,this.multiSelect=!0,0),!1!==t&&void 0===c.id&&(c.index?c.id=this.getColumnId(c.index):c.id=Fancy.id(null,"col-id-")),!c.title&&c.index&&!Fancy.isArray(c.index))switch(c.type){case"string":case"number":case"currency":case"date":case"combo":case"checkbox":case"text":c.title=Fancy.String.upFirstChar(c.index)}switch(c.type){case"select":this.checkboxRowSelection=!0,this.multiSelect=!0,i[r].index="$selected",i[r].editable=!0,0;break;case"order":i[r].editable=!1,i[r].sortable=!1,i[r].index="$order",i[r].cellAlign="right",0;break;case"rowdrag":i[r].editable=!1,i[r].sortable=!1,i[r].resizable=!1,i[r].width=30,i[r].index="$rowdrag",0;break;case"checkbox":void 0===c.cellAlign&&(c.cellAlign="center");break;case"currency":void 0===c.format&&(c.format="number"),!1!==c.ellipsis&&(c.ellipsis=!0),c.editFormat||(c.editFormat="currency"),c.beforeSaveFormat||(c.beforeSaveFormat="currency");break;case"string":case"number":case"text":case"date":case"combo":case"tree":!1!==c.ellipsis&&(c.ellipsis=!0)}!1!==t&&(c.locked?(n.push(c),i.splice(r,1),r--,o--):c.rightLocked&&(s.push(c),i.splice(r,1),r--,o--))}if(!1===t)return e;if(d&&e._plugins.push({type:"grid.rowheight"}),a&&e._plugins.push({type:"grid.columndrag"}),l){var c={type:"grid.tree"};e.singleExpand&&(c.singleExpand=e.singleExpand),e._plugins.push(c),e.isTreeData=!0}return e.leftColumns=n,e.rightColumns=s,e},prepareConfigColumnsWidth(e){var t,i=this,n=e.columns,s=e.width,r=[],o=[],a=100,l=0,d=!1,c=!1,h=!1,u=Fancy.get(e.renderTo||document.body);if((e.width<1||void 0===e.width)&&"body"!==u.prop("tagName").toLocaleLowerCase()&&(h=u.closest(".tab-pane"))&&h.css({display:"block",visibility:"hidden"}),void 0!==s&&"fit"!==s||(s=Fancy.get(e.renderTo||document.body).width()),s-=2*e.panelBorderWidth,!1!==e.flexScrollSensitive)s-=e.bottomScrollHeight;else{var g=this.theme;Fancy.isString(e.theme)?g=e.theme:Fancy.isObject(e.theme)&&e.theme.name&&(g=e.theme.name),"bootstrap-no-borders"!==g&&(s-=1)}Fancy.each(n,(t,n)=>{switch(t.autoWidth&&(e.autoColumnWidth=!0),t.flex&&(e.hasFlexColumns=!0),t.type){case"select":void 0===t.width&&(t.width=35);break;case"order":void 0===t.width&&(t.width=40);break;case"rowdrag":void 0===t.width&&(t.width=30);break;case"expand":void 0===t.width&&(t.width=38);break;case"combo":t.data||(t.data=[],setTimeout(()=>{i.on("init",()=>{const e=i.store.getColumnUniqueData(t.index);i.setColumnComboData(t.index,e)})},1))}t.locked&&(d=!0),t.rightLocked&&(c=!0),t.hidden?void 0===t.width&&(t.width=100):void 0===t.width?(t.flex&&(l+=t.flex,o.push(n)),r.push(n)):Fancy.isNumber(t.width)&&(s-=t.width)}),e.hasFlexColumns&&e._plugins.push({type:"grid.columnresizer"}),d&&c&&(s-=2);var p=parseInt(s/r.length);p<50&&(p=50),p>100&&(a=100),p<50&&(a=50);var m=!1,f=s;if(Fancy.each(r,e=>{void 0===(t=n[e]).flex&&(f-=a)}),l){const e=parseInt(f/l);Fancy.each(o,t=>{f-=e*n[t].flex})}return f<0&&(m=!0),Fancy.each(r,e=>{void 0===(t=n[e]).flex&&(t.width=a,s-=a)}),l&&(Fancy.each(o,e=>{(t=n[e]).width=m?a*t.flex:s/l*t.flex,t.width=parseInt(t.width),t.minWidth&&t.width<t.minWidth&&(t.width=t.minWidth)}),f>=1&&Fancy.each(o,e=>{if(f<1)return!0;(t=n[e]).width+=1,f-=1})),h&&h.css({display:"",visibility:""}),e},prepareConfigActionRender:e=>(function(t){return Fancy.each(e.items,e=>{const i=e.text||"",n=Fancy.styleToString(e.style),s=e.cls||"";t.value+=['<div class="fancy-grid-column-action-item '+s+'" style="'+n+'">',i,"</div>"].join(" "),e.render&&(t=e.render(t))}),t}),prepareConfigSmartIndex:e=>(Fancy.each(e.columns,e=>{if(/\+|\-|\/|\*|\[|\./.test(e.index)){var t=e.index;switch(t){case"xAxis.categories":case"yAxis.categories":case"zAxis.categories":return}t="return "+(t=t.replace(/(\w+)/g,function(e,t,i,n){return"."===n[i-1]?t:isNaN(Number(t))?"data."+t:t}))+";",e.smartIndexFn=new Function("data",t)}}),e),prepareConfigActionColumn(e){for(var t=this,i=e.columns,n=0,s=i.length;n<s;n++){const e=i[n];if("action"===e.type){e.sortable=!1,e.editable=!1,e.render=t.prepareConfigActionRender(e);var r=e.items;if(void 0!==r&&0!==r.length)for(var o,a=0,l=r.length;a<l;a++)switch((o=r[a]).action){case"remove":void 0===o.handler&&(o.handler=function(e,t){e.remove(t)});break;case"dialog":!function(e){if(void 0===e.handler){for(var n=[],s=0,r=i.length,o=87;s<r;s++){const e=i[s];switch(e.type){case"action":continue}n.push({label:e.title||"",type:e.type,name:e.index}),o+=38}e.handler=function(i,s){e.dialog?(e.dialog.show(),e.dialog.set(s.data)):e.dialog=new FancyForm({window:!0,draggable:!0,modal:!0,title:{text:"Edit",tools:[{text:"Close",handler(){this.hide()}}]},width:300,height:o,items:n,buttons:["side",{text:"Clear",handler(){this.clear()}},{text:"Save",handler(){const e=this.get();e.id&&(t.getById(e.id).set(e),t.update())}}],events:[{init(){this.show(),this.set(s.data)}}]})}}}(o)}}}return e},prepareConfigWidgetColumn(e){for(var t=this,i=e.columns,n=0,s=i.length;n<s;n++){const e=i[n];e.widget&&(e.render=function(e){var i,n=e.cell.select("."+Fancy.FIELD_CLS),s=e.cell.dom;const r={vtype:(o=e.column).vtype,style:{padding:"0px","margin-top":"-10px","margin-left":"-1px"},label:!1,renderTo:s,value:e.value,emptyText:o.emptyText};if(n.length)(i=Fancy.getWidget(n.dom.id)).get()!=e.value&&i.set(e.value);else{var o,a=e.column.width,l=(o=e.column).index;switch(e.column.type){case"number":case"currency":Fancy.apply(r,{spin:o.spin,min:o.min,max:o.max,events:[{change(i,n){t.set(e.rowIndex,l,n),t.updater.updateRow()}}]}),i=new Fancy.NumberField(r);break;case"string":case"image":Fancy.apply(r,{events:[{change(i,n){t.set(e.rowIndex,l,n),t.updater.updateRow()}}]}),i=new Fancy.StringField(r);break;case"combo":Fancy.apply(r,{displayKey:e.column.displayKey,valueKey:e.column.displayKey,padding:!1,checkValidOnTyping:!0,data:e.column.data,events:[{change(i,n){t.set(e.rowIndex,l,n),t.updater.updateRow()}}]}),i=new Fancy.Combo(r)}switch(e.column.type){case"number":case"string":case"currency":case"image":i.setInputSize({width:a+1,height:33});break;case"combo":i.size({width:a+1,height:33})}}return e})}return e},prepareConfigSorting:e=>(e.defaults||{}).sortable?(e._plugins.push({type:"grid.sorter"}),e):(Fancy.each(e.columns,function(t){t.sortable&&e._plugins.push({type:"grid.sorter"})}),e),prepareConfigSelection(e){var t=!1,i={type:"grid.selection"},n=!1;if((e.trackOver||e.columnTrackOver||e.cellTrackOver)&&(t=!0),e.selModel){t=!0;var s=!1,r=!1,o=!1,a=!0,l=!1,d=!0,c=!1,h=!1,u=!1,g=!1,p=!1,m=!1,f=!1;if(Fancy.isObject(e.selModel)){s=!!e.selModel.checkOnly,f=!!e.selModel.activeCell,("cell"===e.selModel.type||"cells"===e.selModel.type||f)&&(e.selModel.selectBottomCellAfterEdit&&(c=!0),e.selModel.selectRightCellOnEnd&&(h=!0),e.selModel.selectLeftCellOnLeftEnd&&(u=!0),e.selModel.selectUpCellOnUp&&(g=!0),e.selModel.selectBottomCellOnDown&&(p=!0),e.selModel.continueEditOnEnter&&(m=e.selModel.continueEditOnEnter));var y=!1,C=!1;if(Fancy.each(e.columns,e=>{"tree"===e.type&&(y=!0),e.select&&(C=!0),"select"===e.type&&(C=!0)}),y&&C&&(s=!0),!e.selModel.type)throw new Error("[FancyGrid Error 5]: Type for selection is not set");void 0!==e.selModel.mouseMoveSelection&&(d=e.selModel.mouseMoveSelection),r=!0===e.selModel.memory,e.selModel.disabled&&(n=!0),e.selModel.selectLeafsOnly&&(o=!0),void 0!==e.selModel.allowDeselect&&(l=!0),void 0!==e.selModel.keyNavigation&&(a=e.selModel.keyNavigation),e.selModel=e.selModel.type}"rows"===e.selModel&&(e.multiSelect=!0),e.selection=e.selection||{},e.selection.selModel=e.selModel,e.selection[e.selModel]=!0,e.selection.checkOnly=s,e.selection.memory=r,e.selection.memoryPerformance=!0,e.selection.disabled=n,e.selection.selectLeafsOnly=o,e.selection.keyNavigation=a,e.selection.allowDeselect=l,e.selection.mouseMoveSelection=d,e.selection.selectBottomCellAfterEdit=c,e.selection.selectRightCellOnEnd=h,e.selection.selectLeftCellOnLeftEnd=u,e.selection.selectUpCellOnUp=g,e.selection.selectBottomCellOnDown=p,e.selection.continueEditOnEnter=m,e.selection.activeCell=f}return e.selection&&(t=!0,Fancy.isObject(e.selection)&&Fancy.apply(i,e.selection)),!0===t&&e._plugins.push(i),e},prepareConfigEdit(e){var t={type:"grid.edit"},i=!1,n=(e.defaults||{}).editable;return void 0!==e.clicksToEdit&&(t.clicksToEdit=e.clicksToEdit),n&&(i||e._plugins.push(t),e._plugins.push({type:"grid.celledit"}),i=!0),e.rowEdit&&e._plugins.push({type:"grid.rowedit"}),Fancy.each(e.columns,n=>{switch(void 0===n.index&&void 0===n.key&&(n.editable=!1),n.type){case"image":n.sortable=!1;break;case"sparklineline":case"sparklinebar":case"sparklinetristate":case"sparklinediscrete":case"sparklinebullet":case"sparklinepie":case"sparklinebox":n.editable=!1,n.sortable=!1}n.editable&&!1===i&&(e._plugins.push(t),e._plugins.push({type:"grid.celledit"}))}),e},prepareConfigExpander(e){if(e.expander){const t=e.expander;Fancy.apply(t,{type:"grid.expander"}),e.expanded={},e.grouping&&(t.expanded=!1),e._plugins.push(t)}return e},prepareConfigGrouping(e){if(e.grouping){var t=e.grouping;!0===t&&(t={}),Fancy.apply(t,{type:"grid.grouping"}),e.expanded={},e._plugins.push(t)}return e},prepareConfigSummary(e){if(e.summary){var t=e.summary;!0===t&&(t={}),Fancy.apply(t,{type:"grid.summary"}),e._plugins.push(t)}return e},prepareConfigContextMenu(e){if(e.contextmenu){var t=e.contextmenu;Fancy.isArray(e.contextmenu)&&Fancy.each(e.contextmenu,function(t){"export"===t&&(e.exporter=!0)}),!0===t&&(t={}),Fancy.isArray(t)&&(t={items:t}),Fancy.apply(t,{type:"grid.contextmenu"}),e._plugins.push(t)}return e},prepareConfigExporter(e){if(e.exporter){var t=e.exporter;!0===t&&(t={}),Fancy.apply(t,{type:"grid.exporter"}),e._plugins.push(t)}return e},prepareConfigFilter(e){var t=e.columns,i=!1,n=!1,s=!1,r={type:"grid.filter"};return e.filter&&(!0===e.filter&&(i=!0,e.filter={}),Fancy.apply(r,e.filter)),Fancy.each(t,e=>{e.filter&&(i=!0,e.filter.header&&(n=!0,e.grouping&&(s=!0)))}),r.header=n,r.groupHeader=s,i&&(e._plugins.push(r),e.filterable=!0),e},prepareConfigSearch(e){var t={type:"grid.search"},i=!1;return e.searching&&(i=!0,Fancy.apply(t,e.searching)),i&&e._plugins.push(t),e},prepareConfigGroupHeader(e){var t=e.columns,i=0,n=t.length,s=[],r=!1,o=[];if(t.forEach(e=>{e.columns&&(r=!0,s.push(e))}),r){for(i=0;i<n;i++){var a=t[i];if(a.columns){for(var l=0,d=a.columns.length,c=a.text||a.title||"  ";l<d;l++)a.locked&&(a.columns[l].locked=!0),a.rightLocked&&(a.columns[l].rightLocked=!0),a.columns[l].grouping=c,a.defaults&&(Fancy.applyIf(a.columns[l],a.defaults),a.defaults.width&&a.columns[l].flex&&delete a.columns[l].width);o=o.concat(a.columns)}else o=o.concat(t.slice(i,i+1))}const r={};Fancy.each(s,e=>{r[e.title||e.text||""]=e}),e.columns=o,e._plugins.push({type:"grid.groupheader",groups:s,groupsMap:r}),e.isGroupedHeader=!0}return e},prepareConfigPaging(e,t){var i=e.lang,n=e.paging,s="bbar",r="last";if(!n)return e;if(void 0!==n.barType)switch(n.barType){case"bbar":case"tbar":case"both":s=n.barType;break;case!1:case"none":s="none";break;default:throw new Error("[FancyGrid Error]: - not supported bar type for paging")}return n.pageOverFlowType&&(r=n.pageOverFlowType),e._plugins.push({i18n:t.i18n,type:"grid.paging",barType:s,pageOverFlowType:r}),"both"===s?(e.tbar=this.generatePagingBar(n,i),e.bbar=this.generatePagingBar(n,i)):"none"===s||(e[s]=this.generatePagingBar(n,i)),e},prepareConfigInfinite:e=>e.infinite?(e.nativeScroller=!1,e._plugins.push({type:"grid.infinite"}),e):e,generatePagingBar(e,t){var i=this,n=[],s="fancy-bar-button-disabled",r="material"===i.theme?8:3,o={float:"left","margin-right":"5px","margin-top":r+"px"};if(n.push({imageCls:"fancy-paging-first",disabledCls:s,role:"first",handler:function(){i.paging.firstPage()},style:{float:"left","margin-left":"5px","margin-right":"5px","margin-top":r+"px"}}),n.push({imageCls:"fancy-paging-prev",disabledCls:s,role:"prev",handler:function(){i.paging.prevPage()},style:o}),n.push("|"),n.push({type:"text",text:t.paging.page}),n.push({type:"number",label:!1,padding:!1,style:{float:"left","margin-left":"-1px","margin-right":"8px","margin-top":r+1+"px"},role:"pagenumber",min:1,width:e.inputWidth||30,listeners:[{enter(e){0===parseInt(e.getValue())&&e.set(1);var t=parseInt(e.getValue())-1,n=i.paging.setPage(t);t!==n&&e.set(n)}},{up(e,t){var n=i.store.pages;(t=Number(t)+1)>n&&(t=n),e.set(t)}},{down(e,t){i.store.pages;(t=Number(t)-1)<1&&(t=1),e.set(t)}}]}),n.push({type:"text",text:"",role:"ofText"}),n.push("|"),n.push({imageCls:"fancy-paging-next",disabledCls:s,role:"next",style:o,handler(){i.paging.nextPage()}}),n.push({imageCls:"fancy-paging-last",disabledCls:s,role:"last",style:o,handler(){i.paging.lastPage()}}),Fancy.isObject(e)&&!0===e.refreshButton&&(n.push("|"),n.push({imageCls:"fancy-paging-refresh",disabledCls:s,role:"refresh",style:o,handler(){i.paging.refresh()}})),e&&Fancy.isArray(e.pageSizeData)){for(var a=e.pageSizeData,l=[],d=0,c=a.length,h=0;d<c;d++)l.push({index:d,value:a[d]}),e.pageSize===a[d]&&(h=d);var u=Fancy.Object.copy(o);u["margin-top"]=r+1+"px",n.push({editable:!1,width:50,type:"combo",role:"size",style:u,data:l,displayKey:"value",valueKey:"index",value:h,subSearch:!1,events:[{change(e,t){i.scroll(0,0),i.paging.setPageSize(a[t])}},{render:function(e){i.store.on("changepages",()=>{var t;i.store.pageSize!==Number(e.input.dom.value)&&(Fancy.each(e.data,e=>{if(e.value===i.store.pageSize)return t=e.index,!0}),void 0!==t&&e.setValue(t,!1))})}}]})}return n.push("side"),n.push({type:"text",role:"info",text:""}),n},prepareConfigState(e){const t=this;if(e.stateful){var i={};Fancy.isObject(e.stateful)&&(i=e.stateful);const o=e.state||{};var n=e.stateId||this.getStateName(),s=localStorage.getItem(n);if(s||(t.memoryInitialColumns(n,e.columns),e.defaults&&t.memoryInitialDefaults(n,e.defaults)),s&&(t.wasColumnsCodeChanged(n,e.columns)||t.wasDefaultChanged(n,e.defaults))&&(localStorage.clear(n),localStorage.clear(n+"memory-columns"),s=null,t.memoryInitialColumns(n,e.columns),e.defaults&&t.memoryInitialDefaults(n,e.defaults)),s){for(var r in s=JSON.parse(s))Fancy.isString(s[r])&&(s[r]=JSON.parse(s[r]));const t=s.columns;for(var r in t&&(Fancy.each(t,t=>{Fancy.each(t,(i,n)=>{if("FUNCTION"===i||"OBJECT"===i||"ARRAY"===i){var s=t.index;Fancy.each(e.columns,e=>{if(e.index===s)return t[n]=e[n],!0})}})}),e.columns=t),s)"columns"!==r&&void 0===o[r]&&(o[r]=s[r])}e._plugins.push({type:"grid.state",stateful:!0,startState:o,log:i})}else e.state&&e._plugins.push({type:"grid.state",startState:e.state});return e},prepareConfigColumnsResizer(e){if((e.defaults||{}).resizable)return e._plugins.push({type:"grid.columnresizer"}),e;var t=[].concat(e.columns).concat(e.leftColumns).concat(e.rightColumns);return Fancy.each(t,t=>{if(t.resizable||t.autoWidth)return e._plugins.push({type:"grid.columnresizer"}),!0}),e},prepareConfigBars(e){const t=function(t){for(var i=0,n=t.length;i<n;i++)switch(t[i].type){case"date":if(!t[i].format){var s=e.lang.date;t[i].format={read:s.read,write:s.write,edit:s.edit}}e.i18n&&(t[i].i18n=e.i18n)}};return t(e.tbar||[]),t(e.subTBar||[]),t(e.bbar||[]),t(e.buttons||[]),e},prepareConfigTBar(e){const t=this,i=e.tbar;if(i)for(var n=0,s=i.length;n<s;n++){switch(i[n].type){case"columns":i[n].text=i[n].text||"Columns",i[n].type="button",i[n].menuIcon=!1;var r=[];Fancy.each(e.columns,e=>{e.title&&r.push({text:e.title,index:e.index,column:e,checked:!e.hidden,handler(i,n){!0!==n.checked||n.checkbox.get()||n.checkbox.set(!0),n.checked&&1===i.el.select(".fancy-checkbox-on").length?n.checkbox.set(!0):(n.checked=!n.checked,n.checkbox.set(n.checked),n.checked?t.showColumn(t.side,n.index,e):t.hideColumn(t.side,n.index,e),t.responsive&&t.onWindowResize())}})}),i[n].menu=r;break;case"search":e.searching=e.searching||{},e.filter=e.filter||!0;break;case"date":e.i18n&&(i[n].i18n=e.i18n)}switch(i[n].action){case"add":void 0===i[n].handler&&(i[n].handler=function(){t.insert(0,{}),t.scroll(0)});break;case"undo":void 0===i[n].handler&&(i[n].handler=function(){t.undo()});break;case"undoall":void 0===i[n].handler&&(i[n].handler=function(){t.undoAll()});break;case"redo":void 0===i[n].handler&&(i[n].handler=function(){t.redo()});break;case"remove":void 0===i[n].handler&&(i[n].disabled=!0,i[n].handler=function(){Fancy.each(t.getSelection(),function(e){t.remove(e)}),t.selection.clearSelection()},i[n].events=[{render:function(){const e=this;setTimeout(()=>{const t=Fancy.getWidget(e.el.parent().parent().parent().select("."+Fancy.GRID_CLS).dom.id);t.on("select",()=>{0===t.getSelection().length?e.disable():e.enable()}),t.on("clearselect",()=>{e.disable()})},10)}}])}}return e},prepareConfigSubTBar(e){const t=e.subTBar;if(t)for(var i=0,n=t.length;i<n;i++)switch(t[i].type){case"search":e.searching=e.searching||{},e.filter=e.filter||!0}return e},prepareConfigChart(e){var t=e.data,i=t.chart;return Fancy.isObject(i)&&(i=[i]),t&&t.chart&&(e._plugins.push({type:"grid.chartintegration",chart:i,toChart:!!t.items||!!t.proxy}),Fancy.each(i,function(t){var i=t.type;switch(i){case"highchart":case"highcharts":e._plugins.push({type:"grid.highchart"});break;case void 0:throw new Error("[FancyGrid Error] - type of chart is undefined");default:throw new Error("[FancyGrid Error] - type of chart "+i+" does not exist")}})),e},prepareConfigSize(e){var t,i,n,s=this,r=e.renderTo,o=!!(e.title||e.subTitle||e.tbar||e.bbar||e.buttons||e.panel),a=e.panelBodyBorders,l=e.gridWithoutPanelBorders,d=e.gridBorders;if(void 0===e.width){if(r){if(e.responsive=!0,e.responsiveWidth=!0,i=Fancy.get(r),e.width=parseInt(i.width()),e.width<1&&"body"!==i.prop("tagName").toLocaleLowerCase()){const t=i.closest(".tab-pane");t?(t.css({display:"block",visibility:"hidden"}),e.width=parseInt(i.width()),t.css({display:"",visibility:""})):e.width=i.parent().width()}0===e.width&&(e.width=parseInt(i.parent().width()))}}else if("fit"===e.width){var c=0,h=!1;this.fitWidth=!0,Fancy.each(e.columns,e=>{e.hidden||(c+=e.width),e.locked&&(h=!0)}),e.title||e.subTitle?c+=a[1]+a[3]+d[1]+d[3]:c+=l[1]+l[3]+d[1]+d[3],h&&c--,e.width=c}if(void 0===e.height)r&&(e.responsiveHeight=!0,(n=parseInt(i.height()))<50&&(n=parseInt(i.parent().css("height"))),e.height=n);else if("fit"===e.height){var u=1;t=0,Fancy.each(e.columns,e=>{e.grouping&&(u<2&&(u=2),e.filter&&e.filter.header&&u<3&&(u=3)),e.filter&&e.filter.header&&u<2&&(u=2)}),Fancy.isArray(e.data)?t=e.data.length:e.data&&Fancy.isArray(e.data.items)&&(t=e.data.items.length),n=t*e.cellHeight,e.title&&(n+=e.titleHeight),e.tbar&&(n+=e.tbarHeight||e.barHeight),e.tabs&&(n+=e.barHeight),e.bbar&&(n+=s.bbarHeight||e.barHeight),e.buttons&&(n+=e.buttonsHeight||e.barHeight),e.subTBar&&(n+=e.subTBarHeight||e.barHeight),e.footer&&(n+=e.barHeight),!1!==e.header&&(n+=e.cellHeaderHeight*u),n+=o?a[0]+a[2]+d[0]+d[2]:l[0]+l[2]+d[0]+d[2],e.minHeight&&n<e.minHeight&&(n=e.minHeight),e.heightFit=!0,e.height=n}return o&&!e.title&&(e.panelBodyBorders=[0,0,0,0],setTimeout(function(){s.panel&&s.panel.css("border-bottom-width",0)},1)),e},wasDefaultChanged(e,t){e+="-memory-defaults";const i=JSON.parse(localStorage.getItem(e));if(!i||!t)return!1;for(var n in i){switch(Fancy.typeOf(i[n])){case"number":case"string":case"boolean":break;default:continue}if(t[n]!==i[n])return!0}for(var n in t){switch(Fancy.typeOf(t[n])){case"number":case"string":case"boolean":break;default:continue}if(void 0===i[n])return!0}return!1},wasColumnsCodeChanged(e,t){e+="-memory-columns";const i=JSON.parse(localStorage.getItem(e));if(!i)return!1;if(t.length!==i.length)return!0;var n=!1;return Fancy.each(i,(e,i)=>{for(const s in e)if(e[s]!==t[i][s]){if("width"===s&&e.autoWidth)continue;return n=!0,!0}}),Fancy.each(t,(e,t)=>{for(const s in e)switch(Fancy.typeOf(e[s])){case"number":case"string":case"boolean":if(void 0===i[t][s])return n=!0,!0}}),n},memoryInitialDefaults(e,t){e+="-memory-defaults";const i={};for(var n in t)switch(Fancy.typeOf(t[n])){case"string":case"number":case"boolean":i[n]=t[n]}localStorage.setItem(e,JSON.stringify(i))},memoryInitialColumns(e,t){e+="-memory-columns";const i=[];Fancy.each(t,e=>{const t={};for(const i in e)switch(Fancy.typeOf(e[i])){case"string":case"number":case"boolean":t[i]=e[i]}i.push(t)}),localStorage.setItem(e,JSON.stringify(i))}}),Fancy.Mixin("Fancy.grid.mixin.ActionColumn",{initActionColumnHandler(){this.on("cellclick",this.onCellClickColumnAction,this)},onCellClickColumnAction(e,t){var i,n,s=t.column,r=s.items;"action"===s.type&&(i=this.getActiveActionColumnItem(t),r&&void 0!==i&&(n=r[i]).handler&&n.handler(this,t))},getActiveActionColumnItem(e){for(var t=Fancy.get(e.cell),i=e.e.target,n=t.select(`.${Fancy.GRID_COLUMN_ACTION_ITEM_CLS}`),s=0,r=n.length;s<r;s++)if(n.item(s).within(i))return s}}),Fancy.Mixin("Fancy.grid.mixin.Edit",{remove(e,t,i){let n=this,s=n.store,r="remove";if(n.store){if(t&&(r="removeAt"),Fancy.isArray(e))for(var o=0,a=e.length;o<a;o++)s[r](e[o],i);else s[r](e);!1!==i&&n.setSidesHeight(),clearInterval(n.removeInt),n.removeInt=setTimeout(()=>{n.update(),delete n.removeInt},1)}else setTimeout(()=>{n.remove(e,t)},100)},removeAt(e){this.remove(e,!0)},removeRow(e){this.remove(e,!0)},removeRowById(e){this.remove(e)},removeRowByID(e){this.remove(e)},removeAll(){const e=this;e.store.removeAll(),e.update(),e.scroller.update(),e.paging&&e.paging.updateBar(),e.isGroupable()&&e.grouping.reGroup()},add(e){const t=this;if(t.store)if(Fancy.isArray(e))for(var i=0,n=e.length;i<n;i++)t.add(e[i]);else t.store.add(e),t.setSidesHeight(),clearInterval(t.addInt),t.addInt=setTimeout(()=>{t.update(),delete t.addInt},1);else setTimeout(()=>{t.add(e)},100)},insert(e,t,i){var n,s=this,r=s.store;if(s.store)if(Fancy.isArray(t)){if(t.length){var o=t[0],a=Fancy.Object.keys(o);r.addField(a)}for(n=t.length-1;-1!==n;n--)s.insert(t[n],e,i);!1!==i&&s.setSidesHeight()}else if(Fancy.isArray(e)){if(e.length){o=e[0],a=Fancy.Object.keys(o);r.addField(a)}for(n=e.length-1;-1!==n;n--)s.insert(e[n],0,i);!1!==i&&s.setSidesHeight()}else{if(Fancy.isObject(e)&&void 0===t)r.addField(Fancy.Object.keys(e)),t=e,e=0;else if(Fancy.isObject(e)&&Fancy.isNumber(t)){r.addField(Fancy.Object.keys(e));const i=t;t=e,e=i}s.paging&&"server"!==r.pageType&&(e+=r.showPage*r.pageSize),r.insert(e,t,i),!1!==i&&s.setSidesHeight(),clearInterval(s.addInt),s.addInt=setTimeout(()=>{s.update(),delete s.addInt},1)}else setTimeout(()=>{s.insert(e,t,i)},100)},set(e,t,i){const n=this,s=n.store;n.store?Fancy.isObject(t)&&void 0===i?s.setItemData(e,t,i):s.set(e,t,i):setTimeout(()=>{n.set(e,t,i)},100)},setById(e,t,i){var n=this,s=n.store,r=s.getRow(e);if(void 0===r){if(void 0===s.getById(e))return!1;r=-1}if(!n.store)return setTimeout(()=>{-1===r?n.setById(r,t,i):n.set(r,t,i)},100),r;if(Fancy.isObject(t)&&void 0===i)for(const o in t){const a=n.getColumnByIndex(o);if(a&&"date"===a.type){const i=a.format,n=Fancy.Date.parse(t[o],i.read,i.mode),r=Fancy.Date.parse(s.getById(e).get(o),i.edit,i.mode);+n==+r&&delete t[o]}s.setItemData(r,t,i,e),-1===r&&s.getById(e).set(t)}else-1===r?s.getById(e).set(t,i):s.set(r,t,i,e);return r},undo(){const e=this,t=e.store,i=t.undoActions.splice(t.undoActions.length-1,1)[0];if(i)switch(i.type){case"edit":e.setById(i.id,i.key,i.oldValue);const n=i.value;i.value=i.oldValue,i.oldValue=n,t.redoActions.push(i),e.fire("undo");break;case"insert":t.undoStoppped=!0,e.remove(i.id),t.undoStoppped=!1,t.redoActions.push(i);break;case"remove":t.undoStoppped=!0,e.insert(i.rowIndex,i.data),t.undoStoppped=!1,t.redoActions.push(i)}},redo(){const e=this,t=e.store,i=t.redoActions.splice(t.redoActions.length-1,1)[0];switch(t.redoing=!0,i.type){case"edit":e.setById(i.id,i.key,i.oldValue);break;case"insert":e.insert(i.rowIndex,i.data);break;case"remove":e.remove(i.id)}delete t.redoing},undoAll(){let e=this,t=0,i=e.store.undoActions.length;for(;t<i;t++)e.undo()},editCell(e){const t=this,i={side:t.getSideByCell(e),rowIndex:Number(e.attr("index")),columnIndex:Number(e.parent().attr("index"))},n=t.getColumns(i.side);if(i.column=n[i.columnIndex],!0!==i.column.editable)return;switch(i.column.type){case"string":case"number":case"combo":case"currency":case"date":case"image":case"text":case"tree":break;default:return}i.cell=e.dom;const s=t.get(i.rowIndex);i.item=s,i.data=s.data,i.column.smartIndexFn?i.value=i.column.smartIndexFn(i.data):i.value=t.store.get(i.rowIndex,i.column.index),t.celledit.edit(i)},getCell(e){var t,i,n=this;if(void 0!==e.id&&void 0!==e.index){const s=n.getColumnOrderByKey(e.index),r=s.order,o=n.getRowById(e.id);if(t=s.side,!(i=n.getBody(t).getCell(o,r)).dom)return;return i}if(void 0!==e.rowIndex&&void 0!==e.columnIndex){if(t=e.side||"center",(i=n.getBody(t).getCell(e.rowIndex,e.columnIndex)).dom||(i=n.getBody("center").getCell(e.rowIndex,e.columnIndex)),i.dom||(i=n.getBody("left").getCell(e.rowIndex,e.columnIndex)),i.dom||(i=n.getBody("right").getCell(e.rowIndex,e.columnIndex)),!i.dom)return;return i}}}),function(){const e=Fancy,t=e.TOUCH_CLS,i=e.HIDDEN_CLS,n=e.GRID_CLS,s=e.GRID_STATE_SORTED_CLS,r=e.GRID_STATE_FILTERED_CLS,o=e.GRID_CENTER_CLS,a=e.GRID_LEFT_CLS,l=e.GRID_RIGHT_CLS,d=e.GRID_HEADER_CLS,c=e.GRID_BODY_CLS,h=e.PANEL_BODY_INNER_CLS,u=e.GRID_UNSELECTABLE_CLS,g=e.GRID_LEFT_EMPTY_CLS,p=e.GRID_RIGHT_EMPTY_CLS,m=e.GRID_COLUMN_SORT_ASC,f=e.GRID_COLUMN_SORT_DESC,y=e.GRID_ROW_GROUP_CLS,C=e.GRID_ROW_GROUP_COLLAPSED_CLS,v=e.PANEL_CLS,w=e.PANEL_TBAR_CLS,b=e.PANEL_SUB_TBAR_CLS,S=e.PANEL_BBAR_CLS,x=e.PANEL_BUTTONS_CLS,I=e.PANEL_GRID_INSIDE_CLS,E=e.ANIMATE_DURATION;e.GRID_ANIMATION_CLS;let T;e.Mixin("Fancy.grid.mixin.Grid",{tabScrollStep:80,waitingForFilters:!1,tpl:['<div class="'+a+" "+g+'"></div>','<div class="'+o+'"></div>','<div class="'+l+" "+p+'"></div>','<div class="fancy-grid-editors"></div>'],initStore(){var t,i,n,s=this,r=s.getFieldsFromData(s.data),o="Fancy.model."+e.id(),a=s.data,l=!1,d=s.state;s.data.items&&(a=s.data.items),t=s.data.remoteSort,i=s.data.remoteFilter,(n=s.data.remotePage)&&(n="server"),e.define(o,{extend:e.Model,fields:r}),s.isGroupable()&&void 0!==s.grouping.collapsed&&(l=s.grouping.collapsed);const c={widget:s,model:o,data:a,paging:s.paging,remoteSort:t,remoteFilter:i,pageType:n,collapsed:l,multiSort:s.multiSort};s.multiSortLimit&&(c.multiSortLimit=s.multiSortLimit),s.infinite&&(c.infinite=!0),d&&d.filters&&(c.filters=d.filters),!0!==s.filterable||c.filters||(c.filters={}),a.pageSize&&(c.pageSize=a.pageSize),s.store=new e.Store(c),s.model=o,s.fields=r},initDebug(){const t=this;e.DEBUG&&(t.panel?t.panel.addCls("fancy-debug"):t.addCls("fancy-debug"))},initTouch(){const i=this;e.isTouch&&window.FastClick&&(i.panel?(FastClick.attach(i.panel.el.dom),i.panel.addCls(t)):(FastClick.attach(i.el.dom),i.addCls(t)))},initElements(){const t=this;!1!==t.header&&(t.leftHeader=new e.grid.Header({widget:t,side:"left"}),t.header=new e.grid.Header({widget:t,side:"center"}),t.rightHeader=new e.grid.Header({widget:t,side:"right"})),t.leftBody=new e.grid.Body({widget:t,side:"left"}),t.body=new e.grid.Body({widget:t,side:"center"}),t.rightBody=new e.grid.Body({widget:t,side:"right"}),t.leftEl=t.el.select(`.${a}`),t.centerEl=t.el.select(`.${o}`),t.rightEl=t.el.select(`.${l}`)},getFieldsFromData(t){const i=this,n=t.items||t;if(t.fields)return i.isTreeData&&(t.fields.push("$deep"),t.fields.push("leaf"),t.fields.push("parentId"),t.fields.push("expanded"),t.fields.push("child"),t.fields.push("filteredChild")),t.fields;n||e.error("Data is empty and not set fields of data to build model",4);const s=n[0],r=[];for(var o in s)r.push(o);return i.isTreeData&&(r.push("$deep"),r.push("leaf"),r.push("parentId"),r.push("expanded"),r.push("child")),r},render(){var t=this,i=Fancy.get(t.renderTo||document.body),n=e.newEl("div"),s=t.panelBodyBorders;t.renderOuter&&(n=i),i.dom||e.error(`Could not find renderTo element: ${t.renderTo}`,1),n.addCls(e.cls,t.widgetCls,t.cls),Fancy.loadingStyle&&(t.panel?(t.panel.el.css("opacity",0),t.intervalStyleLoad=setInterval(()=>{Fancy.loadingStyle||(clearInterval(t.intervalStyleLoad),t.panel.el.animate({opacity:1,force:!0}))},100)):(n.css("opacity",0),t.intervalStyleLoad=setInterval(()=>{Fancy.loadingStyle||(clearInterval(t.intervalStyleLoad),t.el.animate({opacity:1,force:!0}))},100))),n.attr("role","grid"),n.attr("id",t.id),void 0===t.panel&&t.shadow&&n.addCls("fancy-panel-shadow"),!1===t.columnLines&&n.addCls("fancy-grid-disable-column-lines"),!1===t.rowLines&&n.addCls("fancy-grid-disable-row-lines"),"default"===t.theme||t.panel||n.addCls(Fancy.getThemeCSSCls(t.theme)),t.treeFolder&&n.addCls("fancy-grid-tree-folder");var r=0;t.panel&&(r=s[1]+s[3]),n.css({width:t.width-r+"px",height:t.height-0+"px"}),t.initTpl(),n.update(t.tpl.getHTML({})),t.renderOuter?t.el=n:t.el=e.get(i.dom.appendChild(n.dom)),t.setHardBordersWidth(),setTimeout(()=>{Fancy.nojQuery&&t.el.addCls(Fancy.GRID_ANIMATION_CLS)},100),t.rendered=!0},setHardBordersWidth(){var e=this,t=e.panel?e.gridBorders:e.gridWithoutPanelBorders;e.wrapped&&(t=e.gridBorders),e.css({"border-top-width":t[0],"border-right-width":t[1],"border-bottom-width":t[2],"border-left-width":t[3]})},update(e){const t=this;if(!t.store.loading){t.expander&&t.expander.reSet();var i="default";if(e&&e.type&&(i=e.type),t.updater.update(i),t.fire("update"),t.heightFit&&t.fitHeight(),t.setBodysHeight(),t.paging&&t.paging.update(),e&&e.flash){const i=t.store.changed;for(const n in i){const s=i[n],r=t.getRowById(n);if(void 0!==r)for(const i in s)switch(i){case"length":break;default:const n=t.getColumnOrderByKey(i);switch(e.flash){case!0:t.flashCell(r,n.order,n.side);break;case"plusminus":t.flashCell(r,n.order,n.side,{type:"plusminus",delta:s[i].value-s[i].originValue})}}}t.clearDirty()}else t.scroller.update();t._setColumnsAutoWidth()}},lightStartUpdate(){const e=this;e.rowheight&&e.rowheight.onUpdate(),e.bugFixReFreshChartColumns("left"),e.bugFixReFreshChartColumns("center"),e.bugFixReFreshChartColumns("right")},bugFixReFreshChartColumns(e){const t=this.getBody(e);this.getColumns(e).forEach((e,i)=>{switch(e.type){case"grossloss":t.renderGrossLoss(i);break;case"hbar":t.renderHBar(i)}})},getColumnsWidth(e){const t=this;switch(e){case"center":case void 0:return t.getCenterFullWidth();case"left":return t.getLeftFullWidth();case"right":return t.getRightFullWidth()}},setSides(){var e=this,t=e.leftColumns,i=e.rightColumns,n=e.getLeftFullWidth(),s=e.getCenterFullWidth(),r=e.getRightFullWidth(),h=e.gridBorders,u=e.panelBodyBorders,m=e.gridWithoutPanelBorders;t.length>0&&e.leftEl.removeCls(g),i.length>0&&e.rightEl.removeCls(p),s=e.wrapped?e.width-h[1]-h[3]:e.panel?e.width-h[1]-h[3]-u[1]-u[3]:e.width-m[1]-m[3],0===n&&0===r||(0===r?s-=n:0===n?s-=r:e.width>n+s+r?s-=n:s-=n+r),e.leftEl.css({width:n+"px"}),e.centerEl.css({left:n+"px",width:s+"px"}),e.header&&(e.el.select(`.${a} .${d}`).css({width:n+"px"}),e.el.select(`.${o} .${d}`).css({width:s+"px"})),e.el.select(`.${o} .${c}`).css({width:s+"px"}),e.width>n+s+r?e.rightEl.css({right:"0px"}):e.rightEl.css({left:"",right:"0px"}),e.rightEl.css({width:r}),e.header&&e.el.select(`.${l} .${d}`).css({width:r+"px"}),e.startWidths={center:s,left:n,right:r}},setColumnsPosition(){this.body.setColumnsPosition(),this.leftBody.setColumnsPosition(),this.rightBody.setColumnsPosition()},setSidesHeight(e){var t=this,i=t.store,n=1,s=t.cellHeaderHeight;!1!==t.header&&(n+=s,t.filter&&t.filter.header&&(t.groupheader?t.filter.groupHeader&&(n+=s):n+=s),t.groupheader&&(t.filter&&t.filter.header,n+=s)),t.isGroupable()&&(n+=t.grouping.groups.length*t.groupRowHeight),t.expander&&(n+=t.expander.plusHeight),t.summary&&(n+=t.summary.topOffSet),t.rowheight&&t.rowheight.totalHeight&&(e=t.rowheight.totalHeight),n+=e||i.getLength()*t.cellHeight-1,t.paging&&t.summary&&"bottom"===t.summary.position&&(n=t.height),t.leftEl.css({height:n+"px"}),t.centerEl.css({height:n+"px"}),t.rightEl.css({height:n+"px"})},setBodysHeight(){this.body.setHeight(),this.leftBody.setHeight(),this.rightBody.setHeight()},preRender(){const e=this;(e.title||e.subTitle||e.tbar||e.bbar||e.buttons||e.panel)&&e.renderPanel()},renderPanel(){const t=this,i={renderTo:t.renderTo,renderOuter:t.renderOuter,title:t.title,subTitle:t.subTitle,width:t.width,height:t.height,titleHeight:t.titleHeight,subTitleHeight:t.subTitleHeight,barHeight:t.barHeight,subTBarHeight:t.subTBarHeight||t.barHeight,tbarHeight:t.tbarHeight||t.barHeight,bbarHeight:t.bbarHeight||t.barHeight,buttonsHeight:t.buttonsHeight||t.barHeight,theme:t.theme,shadow:t.shadow,style:t.style||{},window:t.window,modal:t.modal,frame:t.frame,items:[t],draggable:t.draggable,resizable:t.resizable,minWidth:t.minWidth,minHeight:t.minHeight,panelBodyBorders:t.panelBodyBorders,barContainer:t.barContainer,barScrollEnabled:t.barScrollEnabled,tabScrollStep:t.tabScrollStep},n=t.panelBodyBorders;t.bbar&&(i.bbar=t.bbar,t.bbarHidden?i.bbarHidden=!0:t.height-=t.bbarHeight||t.barHeight),t.tbar&&(i.tbar=t.tbar,t.tbarHidden?i.tbarHidden=!0:t.height-=t.tbarHeight||t.barHeight),t.subTBar&&(i.subTBar=t.subTBar,t.subTBarHidden?i.subTBarHidden=!0:t.height-=t.subTBarHeight||t.barHeight),t.buttons&&(i.buttons=t.buttons,t.buttonsHidden?i.buttonsHidden=!0:t.height-=t.buttonsHeight||t.barHeight),t.footer&&(i.footer=t.footer,t.height-=t.barHeight),t.panel=new e.Panel(i),t.bbar=t.panel.bbar,t.tbar=t.panel.tbar,t.subTBar=t.panel.subTBar,t.buttons=t.panel.buttons,t.wrapped||t.panel.addCls(I),t.title&&(t.height-=t.titleHeight),t.subTitle&&(t.height-=t.subTitleHeight,t.height+=n[2]),t.height-=n[0]+n[2],t.renderTo=t.panel.el.select(`.${h}`).dom,t.resizable&&t.panel.on("resize",()=>t.setBodysHeight())},getBodyHeight(){let e=this,t=e.height,i=1,n=e.gridBorders,s=e.gridWithoutPanelBorders;return e.groupheader&&(i=2),e.filter&&e.filter.header&&(e.groupheader?(e.filter.groupHeader&&!e.subHeaderFilter&&i++,e.subHeaderFilter&&(t-=e.cellHeight)):e.subHeaderFilter?t-=e.cellHeight:i++),!1!==e.header&&(t-=e.cellHeaderHeight*i),e.panel?t-=n[0]+n[2]:t-=s[0]+s[2],e.summary&&(t-=e.summary.topOffSet,t-=e.summary.bottomOffSet),t},ons(){const t=this,i=t.store,n=e.get(document);i.on("set",t.onSetStore,t),i.on("insert",t.onInsertStore,t),i.on("remove",t.onRemoveStore,t),i.on("beforesort",t.onBeforeSortStore,t),i.on("sort",t.onSortStore,t),i.on("beforeload",t.onBeforeLoadStore,t),i.on("load",t.onLoadStore,t),n.on("mouseup",t.onDocMouseUp,t),n.on("click",t.onDocClick,t),n.on("mousemove",t.onDocMove,t),i.on("servererror",t.onServerError,t),i.on("serversuccess",t.onServerSuccess,t),t.responsive&&t.once("render",t.initResponsiveness,t),t.on("activate",t.onActivate,t),t.on("deactivate",t.onDeActivate,t),t.on("filter",t.onFilter,t),t.on("sort",t.onSort,t)},onServerError(e,t,i,n){this.fire("servererror",t,i,n)},onServerSuccess(e,t,i){this.fire("serversuccess",t,i)},onBeforeLoadStore(){this.fire("beforeload")},onRemoveStore(e,t,i){this.fire("remove",t,i)},onInsertStore(e,t){this.fire("insert",t)},onLoadStore(){const e=this;setTimeout(()=>{e.fire("load"),e.stateIsWaiting||(e.UPDATING_AFTER_LOAD=!0,e.store.changeDataView({reSort:!0}),e.update(),e.setSidesHeight(),delete e.UPDATING_AFTER_LOAD)},1)},onSetStore(e,t){this.fire("set",t),this.fire("change",t),this.fire("edit",t)},onBeforeSortStore(e,t){this.fire("beforesort",t)},onSortStore(e,t){this.fire("sort",t)},getCellsViewHeight(){var e=this,t=e.store,n=0,s=0;return e.isGroupable()&&(e.grouping.calcPlusScroll(),n+=e.grouping.plusScroll),e.expander&&(n+=e.expander.plusScroll),!e.scroller.scrollBottomEl||e.scroller.scrollBottomEl.hasCls(i)||(s=e.scroller.cornerSize),(e.rowheight?e.rowheight.totalHeight:e.cellHeight*t.dataView.length)+s+n},onDocMouseUp(){this.fire("docmouseup")},onDocClick(e){this.fire("docclick",e)},onDocMove(e){this.fire("docmove",e)},getCenterViewWidth(){const e=this,t=e.centerEl.width();if(0===t){let t=0;return e.columns.forEach(e=>{e.hidden||(t+=e.width)}),t}return t},getCenterFullWidth(){let e=0;return this.columns.forEach(t=>{t.hidden||(e+=t.width)}),e},getLeftFullWidth(){let e=0;return this.leftColumns.forEach(t=>{t.hidden||(e+=t.width)}),e},getRightFullWidth(){let e=0;return this.rightColumns.forEach(t=>{t.hidden||(e+=t.width)}),e},getColumns(e){const t=this;let i=[];switch(e){case"left":i=t.leftColumns;break;case"center":i=t.columns;break;case"right":i=t.rightColumns;break;case void 0:i=i.concat(t.leftColumns).concat(t.columns).concat(t.rightColumns)}return i},setColumnsLinksToSide(e,t){const i=this;switch(t){case"left":i.leftColumns=e;break;case"center":case void 0:i.columns=e;break;case"right":i.rightColumns=e}},getBody(e){let t,i=this;switch(e){case"left":t=i.leftBody;break;case"center":t=i.body;break;case"right":t=i.rightBody}return t},getHeader(e){let t,i=this;switch(e){case"left":t=i.leftHeader;break;case"center":t=i.header;break;case"right":t=i.rightHeader}return t},getHeaderCell(t,i){let n,s,r=this;if(e.isString(t)){const e=r.getColumnOrderByKey(t);if(!(s=r.getHeader(e.side)))return;n=s.getCell(e.order)}else{if(i=i||"center",!(s=r.getHeader(i)))return;n=s.getCell(t)}return n},getDomRow(e){const t=this,i=t.leftBody,n=t.body,s=t.rightBody,r=[];return t.leftColumns.forEach((t,n)=>{r.push(i.getDomCell(e,n))}),t.columns.forEach((t,i)=>{r.push(n.getDomCell(e,i))}),t.rightColumns.forEach((t,i)=>{r.push(s.getDomCell(e,i))}),r},initTextSelection(){const e=this;!1===e.textSelection&&e.addCls(u)},setTrackOver(e,t){const i=this;switch(e){case"cell":i.cellTrackOver=t;break;case"column":i.columnTrackOver=t;break;case"row":i.trackOver=t}},setSelModel(e){const t=this.selection;t.cell=!1,t.cells=!1,t.row=!1,t.rows=!1,t.column=!1,t.columns=!1,t[e]=!0,t.selModel=e,this.multiSelect="rows"===e,t.clearSelection()},getSelection(e){return this.selection.getSelection(e)},selectCell(e){return this.selection.selectCell(e)},selectCellLeft(){return this.selection.moveLeft()},selectCellRight(){return this.selection.moveRight()},selectCellDown(){return this.selection.moveDown()},selectCellUp(){return this.selection.moveUp()},clearSelection(){const e=this.selection;e&&e.clearSelection()},destroy(e){const t=this,i=t.store;if(t.panel?t.panel.hide():t.el.hide(),t.el&&t.el.dom)if(t.body.destroy(),t.leftBody.destroy(),t.rightBody.destroy(),t.header.destroy(),t.leftHeader.destroy(),t.rightHeader.destroy(),t.scroller.destroy(),!1===e){const e=t.panel?t.panel.el.child():t.el.child();Fancy.each(e,e=>e.destroy())}else t.el.destroy(),t.panel&&t.panel.el.destroy();i.destroy(),t.responsiveOverver&&t.responsiveOverver.stop&&(t.responsiveOverver.stop(),delete t.responsiveOverver)},clearData(){this.setData([]),this.update(),this.scroller.update()},showAt(){const e=this;e.panel&&e.panel.showAt.apply(e.panel,arguments)},show(){const e=this;setTimeout(()=>{e.panel?e.panel.show.apply(e.panel,arguments):e.el.show()},30)},hide(){const e=this;if(e.panel?e.panel.hide.apply(e.panel,arguments):e.el.hide(),e.celledit){const t=e.celledit.activeEditor;t&&t.hide()}},initDateColumn(){const t=this,i=function(i){return i.forEach(i=>{if("date"===i.type){i.format=i.format||{};const n={type:"date"};e.applyIf(n,t.lang.date),e.applyIf(i.format,n)}}),i};t.columns=i(t.columns),t.leftColumns=i(t.leftColumns),t.rightColumns=i(t.rightColumns)},stopEditor(){this.edit.stopEditor()},stopSaving(){this.store.stopSaving=!0},getById(e){return this.store.getById(e)},get(e,t){const i=this.store;return void 0!==t?i.get(e,t):void 0===e?i.get():i.getItem(e)},getRowById(e){return this.store.getRow(e)},getTotal(){return this.store.getTotal()},getViewTotal(){return this.store.getLength()},getDataView(){return this.store.getDataView()},getData(){return this.store.getData()},selectRow(e,t,i,n){this.selection.selectRow(e,t,i,n)},deSelectRow(e){this.selection.selectRow(e,!1,!0)},selectById(e,t,i){this.selection.selectById(e,t,i)},selectColumn(e){let t,i,n=this,s=n.leftColumns||[],r=n.columns||[],o=n.rightColumns||[];const a=t=>{let n=0,s=t.length;for(;n<s;n++){if(t[n].index===e)return i=n,!0}return!1};a(s)?t="left":a(r)?t="center":a(o)&&(t="right"),t&&n.selection.selectColumn(i,t)},getColumnByIndex(e){let t=this.getColumns(),i=0,n=t.length;for(;i<n;i++){const n=t[i];if(n.index===e)return n}},getColumn(e){return this.getColumnByIndex(e)},getColumnById(e){let t=this.getColumns(),i=0,n=t.length;for(;i<n;i++){const n=t[i];if(n.id===e)return n}},getColumnOrderByKey(e){let t,i=this.leftColumns||[],n=this.columns||[],s=this.rightColumns||[],r="";return n.forEach((i,n)=>{i.index===e&&(r="center",t=n)}),r||(i.forEach((i,n)=>{i.index===e&&(r="left",t=n)}),r||s.forEach((i,n)=>{i.index===e&&(r="right",t=n)})),{side:r,order:t}},getColumnOrderById(t){var i,n=this.leftColumns||[],s=this.columns||[],r=this.rightColumns||[],o="";return e.each(s,(e,n)=>{e.id===t&&(o="center",i=n)}),o||(e.each(n,(e,n)=>{e.id===t&&(o="left",i=n)}),o||e.each(r,(e,n)=>{e.id===t&&(o="right",i=n)})),{side:o,order:i}},load(e){this.store.loadData(e)},save(){this.store.save()},onWindowResize(){var t,i=this,s=i.renderTo;i.panel&&(s=i.panel.renderTo),((t=i.responsive?e.get(s):i.panel?i.panel.el:e.get(s)).hasClass(v)||t.hasClass(n))&&(t=t.parent());let r=t.width();if(void 0!==t.dom){if(0===r&&(r=t.parent().width()),i.responsive?i.setWidth(r):i.fitWidth,i.responsiveHeight){let e=parseInt(t.height());0===e&&(e=parseInt(t.parent().height())),i.setHeight(e)}i.setBodysHeight(),i.updateColumnsWidth(),i.scroller.scrollDelta(0),i.scroller.update()}},updateColumnsWidth(){const e=this,t=function(e,t,i){Fancy.each(e,(e,i)=>{if(!e.hidden&&e.flex)t.getCell(i)})};t(e.columns,e.header),t(e.leftColumns,e.leftHeader),t(e.rightColumns,e.rightHeader)},setWidth(e){const t=this,i=t.el,n=t.gridBorders,s=t.gridWithoutPanelBorders,r=t.panelBodyBorders,a=t.body,l=t.header,d=e=>{let t=0;return e.forEach(e=>{e.hidden||(t+=e.width)}),t};let c,h=d(t.leftColumns),u=d(t.rightColumns),g=e-h-u-r[1]-r[3];t.wrapped?(c=e,g=e-h-u,g-=n[1]+n[3],t.css({width:c})):t.panel?(g=e-h-u-r[1]-r[3],t.panel.el.width(e),g-=n[1]+n[3],c=e-r[1]-r[3],t.css({width:c})):(g=e-h-u-s[1]-s[3],i.css("width",e)),g<100&&(g=100),i.select(`.${o}`).css("width",g),l.css("width",g),a.css("width",g),t.hasFlexColumns&&(t.reCalcColumnsWidth(),t.columnresizer.updateColumnsWidth()),t.scroller.setScrollBars(),t.fire("changewidth",e)},getWidth(){let e,t=this;return e=t.panel?parseInt(t.panel.css("width")):parseInt(t.css("width"))},getHeight(){let e,t=this;return e=t.panel?parseInt(t.panel.css("height")):parseInt(t.css("height"))},setHeight(e,t){const i=this,n=e,s=i.gridBorders;i.panelBodyBorders;i.panel&&!1!==t&&i.panel.setHeight(e),i.title&&(e-=i.titleHeight),i.subTitle&&(e-=i.subTitleHeight),i.footer&&(e-=i.barHeight),i.bbar&&!i.bbarHidden&&(e-=i.bbarHeight||i.barHeight),i.tbar&&!i.tbarHidden&&(e-=i.tbarHeight||i.barHeight),i.subTBar&&!i.subTBarHidden&&(e-=i.subTBarHeight||i.barHeight),i.buttons&&!i.buttonsHidden&&(e-=i.buttonsHeight||i.barHeight);let r=e;i.header&&(r-=i.cellHeaderHeight,i.groupheader&&(r-=i.cellHeaderHeight)),i.panel?r-=2:r-=s[0]+s[2],i.summary&&(i.summary.el?r-=i.summary.el.dom.clientHeight:r-=i.cellHeight),i.body&&i.body.css("height",r),i.leftBody&&i.leftBody.css("height",r),i.rightBody&&i.rightBody.css("height",r),i.el.css("height",e),i.height=e,i.scroller.update(),i.fire("changeheight",n)},find(e,t,i){return this.store.find(e,t,i)},findItem(e,t){return this.store.findItem(e,t)},each(e,t){this.store.each(e,t)},onActivate(){const t=this,i=e.get(document);T&&T.id!==t.id&&T.fire("deactivate"),setTimeout(()=>{i.on("click",t.onDeactivateClick,t)},100),T=t},onDeActivate(){const t=this,i=e.get(document);t.activated=!1,i.un("click",t.onDeactivateClick,t),t.selection&&t.selection.activeCell&&t.selection.clearActiveCell()},onDeactivateClick(t){for(var i=0,n=e.get(t.target);i<20;i++){if(!n.dom)return;if(!n.dom.tagName||"body"===n.dom.tagName.toLocaleLowerCase())return void this.fire("deactivate");if(void 0===n.hasCls)return void this.fire("deactivate");if(n.hasCls(c))return;n=n.parent()}},search(e,t){this.searching.search(e,t)},stopSelection(){const e=this;e.selection&&e.selection.stopSelection()},enableSelection(e){const t=this;t.selection&&t.selection.enableSelection(e)},hideColumn(t,i,n){const s=this;void 0!==i||e.isArray(i)||e.isArray(t)||(i=t,(t=this.getSideByColumnIndex(i))||((r=s.getColumnOrderById(i)).side||e.error("Column does not exist"),n=s.getColumnById(i),t=r.side));if(void 0===i&&(i=t,t=void 0),e.isArray(i))e.each(i,e=>{t?s.hideColumn(t,e):s.hideColumn(e)});else{if(n){var r=s.getColumnOrderById(n.id);if(t=r.side,n.hidden)return}var o,a=s.getBody(t),l=s.getHeader(t),d=s.getColumns(t),c=0,h=d.length,u=s.centerEl,g=s.leftEl,p=s.leftHeader,m=s.rightEl,f=s.rightHeader;if(n)o=r.order,n.hidden=!0;else if(e.isNumber(i)){if((n=d[i]).hidden)return;o=i,n.hidden=!0}else for(;c<h;c++)if((n=d[c]).index===i){if(n.hidden)return;o=c,n.hidden=!0;break}if(l.hideCell(o),a.hideColumn(o),s.rowedit&&s.rowedit.hideField(o,t),s.leftColumns.length||s.rightColumns.length){var y=s.calcCurrentLeftWidth(),C=s.calcCurrentRightWidth(),v=parseInt(s.el.css("width"))-y-C;s.panel?v-=s.gridBorders[1]+s.gridBorders[3]:v-=s.gridWithoutPanelBorders[1]+s.gridWithoutPanelBorders[3],g.animate({width:y},E),p.el.animate({width:y},E),u.animate({left:y},E),u.animate({width:v},E),s.body.el.animate({width:v},E),s.header.el.animate({width:v},E),m.animate({width:C},E),f.el.animate({width:C},E),0===C&&setTimeout(function(){m.css("display","none")},E)}s.isGroupable()&&s.grouping.updateGroupRows(),"right"!==t&&"left"!==t||(clearInterval(s.intervalScrollUpdate),s.intervalScrollUpdate=setTimeout(()=>{s.scroller.update(),delete s.intervalScrollUpdate},E)),s.onWindowResize(),s.fire("columnhide",{column:n,side:t,orderIndex:o})}},showColumn(t,i,n){const s=this;void 0!==i||e.isArray(i)||e.isArray(t)||(i=t,(t=this.getSideByColumnIndex(i))||((r=s.getColumnOrderById(i)).side||e.error(`Column ${i} does not exist`),n=s.getColumnById(i),t=r.side));if(void 0===i&&(i=t,t=void 0),e.isArray(i))e.each(i,e=>{t?s.showColumn(t,e):s.showColumn(e)});else{if(n){var r=s.getColumnOrderById(n.id);if(t=r.side,!n.hidden)return}var o,a=s.getBody(t),l=s.getHeader(t),d=s.getColumns(t),c=0,h=d.length,u=s.centerEl,g=s.leftEl,p=s.leftHeader,m=s.rightEl,f=s.rightHeader;if(n)o=r.order,n.hidden=!1;else if(e.isNumber(i)){if(!(n=d[i]).hidden)return;o=i,n.hidden=!1}else for(;c<h;c++)if((n=d[c]).index===i){if(!n.hidden)return;o=c,delete n.hidden;break}if(l.showCell(o,n.width),a.showColumn(o,n.width),s.rowedit&&s.rowedit.showField(o,t),s.leftColumns.length||s.rightColumns.length){var y=s.calcCurrentLeftWidth(),C=s.calcCurrentRightWidth(),v=parseInt(s.el.css("width"))-y-C;s.panel?v-=s.gridBorders[1]+s.gridBorders[3]:v-=s.gridWithoutPanelBorders[1]+s.gridWithoutPanelBorders[3],"none"===m.css("display")&&m.show(),g.animate({width:y},E),p.el.animate({width:y},E),u.animate({left:y},E),u.animate({width:v},E),s.body.el.animate({width:v},E),s.header.el.animate({width:v},E),m.animate({width:C},E),f.el.animate({width:C},E)}s.isGroupable()&&s.grouping.updateGroupRows(),"right"!==t&&"left"!==t||(clearInterval(s.intervalScrollUpdate),s.intervalScrollUpdate=setTimeout(()=>{s.scroller.update(),delete s.intervalScrollUpdate},E)),s.onWindowResize(),s.fire("columnshow",{column:n,side:t,orderIndex:o})}},removeColumn(t,i){var n,s=this,r=s.leftEl,o=s.leftHeader,a=s.leftBody,l=s.centerEl,d=s.body,c=s.header,h=s.rightEl,u=s.rightBody,g=s.rightHeader;if(void 0===i&&(i="center"),e.isString(t))if((m=s.getColumnOrderById(t)).side)t=m.order,i=m.side;else{var p=s.getColumns(i);e.each(p,(e,i)=>{if(e.index===t)return t=i,!0}),e.isString(t)&&"center"===i&&(p=s.getColumns("left"),e.each(p,(e,n)=>{if(e.index===t)return t=n,i="left",!0}),e.isString(t)&&(p=s.getColumns("right"),e.each(p,(e,n)=>{if(e.index===t)return t=n,i="right",!0}),e.isString(t)&&e.error("Column was not found for method removeColumn",7)))}else if(e.isObject(t)){var m=s.getColumnOrderById(t.id);n=t,t=m.order,i=m.side}switch(i){case"left":n=s.leftColumns[t],s.leftColumns.splice(t,1),o.removeCell(t),a.removeColumn(t),r.css("width",parseInt(r.css("width"))-n.width),l.css("left",parseInt(l.css("left"))-n.width),l.css("width",parseInt(l.css("width"))+n.width),d.css("width",parseInt(d.css("width"))+n.width),c.css("width",parseInt(c.css("width"))+n.width),0===s.leftColumns.length&&s.leftEl.addCls(Fancy.GRID_LEFT_EMPTY_CLS);break;case"center":n=s.columns[t],s.columns.splice(t,1),c.removeCell(t),d.removeColumn(t);break;case"right":var f=0;n=s.rightColumns[t],s.rightColumns.splice(t,1),g.removeCell(t),u.removeColumn(t),h.css("width",parseInt(h.css("width"))-n.width),l.css("width",parseInt(l.css("width"))+n.width),c.css("width",parseInt(c.css("width"))+n.width),0===s.rightColumns.length&&(s.rightEl.addCls(Fancy.GRID_RIGHT_EMPTY_CLS),e.nojQuery&&(f=2)),d.css("width",parseInt(d.css("width"))+n.width-f)}return n.grouping&&delete n.grouping,s.summary&&s.summary.removeColumn(t,i),s.fire("columnremove"),clearInterval(s.removeColumnScrollInt),s.removeColumnScrollInt=setTimeout(()=>{delete s.removeColumnScrollInt,s.scroller.update()},Fancy.ANIMATE_DURATION),n.index===n.id?delete s.columnsIdsSeed[n.index]:new RegExp(n.index).test(n.id)&&(1===s.columnsIdsSeed[n.index]?delete s.columnsIdsSeed[n.index]:s.columnsIdsSeed[n.index]--),n},insertColumn(t,i,n,s){var r=this,o=r.store,a=r.leftEl,l=r.leftBody,d=r.leftHeader,c=r.centerEl,h=r.body,u=r.header,m=r.rightEl,f=r.rightBody,y=r.rightHeader,C=0;switch(t.index&&o.addField(t.index),n=n||"center"){case"center":delete t.rightLocked,delete t.locked,r.columns.splice(i,0,t),u.insertCell(i,t),h.insertColumn(i,t);break;case"left":t.locked=!0,C=0;var v=0,w=0;0===r.leftColumns.length?(e.nojQuery||(C=1,w=2),r.leftEl.removeCls(g)):w=2,e.nojQuery||(v=0);var b=a.dom.clientWidth+t.width+w;b-parseInt(a.css("width"))-t.width<-10&&(b=parseInt(a.css("width"))+t.width),r.leftColumns.splice(i,0,t),d.insertCell(i,t),d.css("width",parseInt(d.css("width"))+v),l.insertColumn(i,t),a.css("width",b),c.css("width",parseInt(c.css("width"))-t.width),c.css("left",parseInt(c.css("left"))+t.width+C),h.el.css("width",parseInt(h.el.css("width"))-t.width),u.el.css("width",parseInt(u.el.css("width"))-t.width);break;case"right":t.rightLocked=!0;w=0;0===r.rightColumns.length&&(e.nojQuery||(C=1,w=2),r.rightEl.removeCls(p)),r.rightColumns.splice(i,0,t),y.insertCell(i,t),f.insertColumn(i,t),m.css("width",parseInt(m.css("width"))+t.width),c.css("width",parseInt(c.css("width"))-t.width-C),h.css("width",parseInt(h.css("width"))-t.width-w),u.css("width",parseInt(u.css("width"))-t.width-w)}if(t.menu)if(t._menu)t.menu=t._menu;else{var S=!0;e.each(t.menu,t=>{e.isString(t)||e.isObject(t)&&t._isConfigApplied&&(S=!1)}),S||(t.menu=!0)}if(r.isGroupable()){switch(n){case"left":1===r.leftColumns.length&&r.grouping.softRenderGroupedRows("left");break;case"right":1===r.rightColumns.length&&r.grouping.softRenderGroupedRows("right")}r.grouping.updateGroupRows(),r.grouping.setCellsPosition(i,n)}t.rowEditor&&("left"===n&&i--,r.rowedit.moveEditor(t,i,n,s)),r.summary&&r.summary.insertColumn(i,n),r.header.destroyMenus(),r.leftHeader.destroyMenus(),r.rightHeader.destroyMenus(),r.sorter&&r.sorter.updateSortedHeader(),r.filter&&(clearInterval(r.intFilterFieldsUpdate),r.intFilterFieldsUpdate=setTimeout(()=>{r.filter.updateFields(),delete r.intFilterFieldsUpdate},e.ANIMATE_DURATION))},addColumn(e,t,i,n){const s=this;!1!==n?setTimeout(()=>{s._addColumn(e,t,i)},1):s._addColumn(e,t,i)},_addColumn(t,i="center",n){const s=this;if(t.type||(t.type="string"),t.width||(t.width=s.defaultColumnWidth),void 0===n){n=s.getColumns(i).length}const r={$selected:!0,$order:!0,$rowdrag:!0};void 0===t.id&&(t.index&&!r[t.index]?t.id=s.getColumnId(t.index):t.id=Fancy.id(null,"col-id-")),s.defaults&&e.applyIf(t,s.defaults),s.insertColumn(t,n,i),s.scroller.update(),s.fire("columnadd")},disableLegend(e,t){this.columns[e].disabled=this.columns[e].disabled||{},this.columns[e].disabled[t]=!0,this.update()},enableLegend(e,t){this.columns[e].disabled=this.columns[e].disabled||{},delete this.columns[e].disabled[t],this.update()},fitHeight(){var e=this,t=e.store,i=e.panelBodyBorders,n=e.gridBorders,s=t.getLength()*e.cellHeight,r=1,o=e.columns.concat(e.leftColumns||[]).concat(e.rightColumns||[]);Fancy.each(o,e=>{e.grouping&&(r<2&&(r=2),e.filter&&e.filter.header&&r<3&&(r=3)),e.filter&&e.filter.header&&r<2&&(r=2)}),e.getCenterFullWidth()>e.getCenterViewWidth()&&!e.nativeScroller&&!Fancy.isIE&&(s+=e.bottomScrollHeight),e.title&&(s+=e.titleHeight),e.tbar&&(s+=e.tbarHeight||e.barHeight),e.summary&&(s+=e.cellHeight),e.bbar&&(s+=e.bbarHeight||e.barHeight),e.buttons&&(s+=e.buttonsHeight||e.barHeight),e.subTBar&&(s+=e.subTBarHeight||e.barHeight),e.footer&&(s+=e.barHeight),!1!==e.header&&(s+=e.cellHeaderHeight*r),e.isGroupable()&&(s+=e.grouping.groups.length*e.groupRowHeight),e.panel?s+=i[0]+i[2]+n[0]+n[2]:s+=n[0]+n[2],e.setHeight(s)},addFilter(t,i,n,s){var r=this,o=r.store.filters[t],a=!1===r.waitingForFilters;if(e.isFunction(i)&&(n="fn"),n=n||"",void 0===o&&(o={}),e.isDate(i)){const e=this.getColumnByIndex(t).format;o.type="date",o.format=e,i=Number(i)}o[n]=i,r.store.filters[t]=o,a&&(clearInterval(r.intervalUpdatingFilter),r.intervalUpdatingFilter=setTimeout(()=>{r.WAIT_FOR_STATE_TO_LOAD?r.filter.updateStoreFilters(!1):r.filter.updateStoreFilters(),delete r.intervalUpdatingFilter},1)),!1!==s?r.filter.addValuesInColumnFields(t,i,n):r.searching},clearFilter(t,i,n){const s=this,r=s.store,o=!1===s.waitingForFilters;s.isRequiredChangeAllMemorySelection()&&(s.selection.memory.selectAllFiltered(),setTimeout(()=>{s.selection.updateHeaderCheckBox()},1)),void 0===t||null===t?r.filters={}:void 0===i||null===i?r.filters&&r.filters[t]&&delete r.filters[t]:s.filter&&r.filters&&r.filters[t]&&void 0!==r.filters[t][i]&&(delete r.filters[t][i],e.Object.isEmpty(r.filters[t])&&delete r.filters[t]),e.Object.isEmpty(r.filter)&&(delete r.filteredData,delete r.filterOrder,delete r.filteredDataMap),s.searching&&void 0===t&&void 0===i&&(s.searching.clearBarField(),s.search(""),s.expander&&s.expander.reSet()),o&&(clearInterval(s.intervalUpdatingFilter),s.intervalUpdatingFilter=setTimeout(()=>{if(r.remoteFilter)return r.once("serversuccess",()=>{s.fire("filter",r.filters),delete s.intervalUpdatingFilter}),void r.serverFilter();if(r.grouping&&r.grouping.by){const e=s.grouping;r.isFiltered()?(r.changeDataView(),e.initGroups("filteredData")):e.initGroups(),e.reFreshExpanded(),e.initOrder(),r.changeDataView(),e.updateGroupRows(),e.setCellsPosition(),e.setPositions(),e.reFreshGroupTexts(),e.update()}else r.changeDataView();r.grouping&&r.grouping.by||s.update(),s.setSidesHeight(),delete s.intervalUpdatingFilter},100)),s.filter&&!1!==n&&s.filter.clearColumnsFields(t,i),o&&(s.fire("filter",r.filters),s.setSidesHeight())},isRequiredChangeAllMemorySelection(){const e=this.store,t=this.selection;return e.hasFilters()&&t&&t.memory&&t.memory.all},updateFilters(){delete this.waitingForFilters,this.filter.updateStoreFilters()},updateFilter(){this.updateFilters()},showLoadMask(e){this.loadmask.show(e)},clearSorter(){this.sorter&&this.sorter.clearSort()},hideLoadMask(){this.loadmask.hide()},prevPage(){this.paging.prevPage()},nextPage(){this.paging.nextPage()},setPage(e,t){--e<0&&(e=0),this.paging.setPage(e,t)},firstPage(){this.paging.firstPage()},lastPage(){this.paging.lastPage()},setPageSize(e){this.paging.setPageSize(e)},getPage(){return this.store.showPage+1},getPages(){return this.store.pages},getPageSize(){return this.store.pageSize},refresh(){this.paging.refresh()},scroll(e,t,i){const n=this,s=n.scroller;void 0!==t&&t>0&&(t=-t);const r=s.getScrollHeight();e>r&&(e=r,n.nativeScroller&&s.isRightScrollable()&&(e+=17));const o=s.getScrollWidth();Math.abs(t)>o&&(t=-o),!1===s.isBottomScrollable()?t=0:n.nativeScroller&&s.isRightScrollable()&&(t-=17),s.scroll(e,t,i),s.scrollBottomKnob(),s.scrollRightKnob()},getDataFiltered(){return this.store.filteredData},reCalcColumnsWidth(){const e=this;if(e.hasFlexColumns){var t,i,n=e.scroller,s=e.getCenterViewWidth(),r=e.columns,o=0,a=0,l=r.length,d=s;for(!1!==e.flexScrollSensitive&&n.isRightScrollable()&&!n.nativeScroller&&(d-=e.bottomScrollHeight);a<l;a++)(i=r[a]).hidden||(i.flex?o+=i.flex:d-=i.width);if(0!==o)for(t=d/o,a=0;a<l;a++)(i=r[a]).hidden||i.flex&&(i.width=Math.floor(i.flex*t),i.minWidth&&i.width<i.minWidth&&(i.width=i.minWidth),i.minWidth&&i.width<i.minWidth?i.width=i.minWidth:i.width<e.minColumnWidth&&(i.width=e.minColumnWidth))}},getDisplayedData(t,i,n,s,r){var o=this,a=o.getViewTotal(),l=[],d=0,c=o.leftColumns,h=o.columns,u=o.rightColumns,g={};r&&(r=this.getSelection()),n&&e.each(n,e=>{g[e]=!0}),t&&(a=o.getTotal());const p=function(e){if(!(void 0===e.index||"$selected"===e.index||e.hidden||s&&!1===e.exportable)){if(/spark/.test(e.type))return!1;switch(e.type){case"select":case"action":case"expand":case"grossloss":case"hbar":case"rowdrag":break;case"order":m.push(d+1);break;default:if(r)var t=(n=r[d])[e.index];else{var n=o.get(d);t=o.get(d,e.index)}e.exportFn&&s?(n&&n.data&&(n=n.data),m.push(e.exportFn({value:t,data:n}).value)):e.render&&!0!==i?(n&&n.data&&(n=n.data),t=e.render({value:t,data:n}).value.replace(/<\/?[^>]+(>|$)/g,""),m.push(t)):r?m.push(t):m.push(o.get(d,e.index))}}};for(r&&(d=0,a=r.length);d<a;d++){var m=[];if(n){var f=o.get(d);if(!f||!g[f.id])continue}e.each(c,p),e.each(h,p),e.each(u,p),l.push(m)}return l},getAllDisplayedData(){var t=this,i=t.getViewTotal(),n=[],s=0,r=t.leftColumns,o=t.columns,a=t.rightColumns;const l=function(e){if(void 0!==e.index&&"$selected"!==e.index&&!e.hidden)switch(e.type){case"order":d.push(s+1);break;default:if(e.render){var i=t.get(s),n=t.get(s,e.index);d.push(e.render({value:n,data:i}).value)}else d.push(t.get(s,e.index))}};for(;s<i;s++){var d=[];e.each(r,l),e.each(o,l),e.each(a,l),n.push(d)}return n},setData(e){const t=this,i=t.store;i.isTree?i.initTreeData(e):i.setData(e),t.isGroupable()&&i.orderDataByGroup(),i.sorters&&i.reSort(),i.filterOrder&&t.filter.updateStoreFilters(!1),i.clearDirty(),(i.sorters||i.filterOrder)&&i.changeDataView({doNotFired:!0}),t.setSidesHeight(),t.filter&&t.filter.waitForComboData&&t.filter.updateFilterComboData(),t.isGroupable()&&(t.grouping.reGroup(),t.update())},exportToExcel(e){const t=this;t.exporter&&t.exporter.exportToExcel(e)},getDataAsCsv(e){const t=this;if(t.exporter)return t.exporter.getDataAsCsv(e)},getDataAsCSV(e){return this.getDataAsCsv(e)},exportToCSV(e){const t=this;if(t.exporter)return t.exporter.exportToCSV(e)},exportToCsv(e){return this.exportToCSV(e)},disableSelection(){this.selection.disableSelection()},setParams(t){const i=this.store;i.proxy&&(i.proxy.params=i.proxy.params||{},e.apply(i.proxy.params,t))},setUrl(t){const i=this.store;if(e.isString(t)){if(i.proxy&&i.proxy.api)if("rest"===i.proxy.type)for(var n in i.proxy.api)i.proxy.api[n]=t;else i.proxy.api.read=t}else i.proxy&&i.proxy.api&&e.apply(i.proxy.api,t)},getSideByCell(e){var t;return this.centerEl.within(e)?t="center":this.leftEl.within(e)?t="left":this.rightEl.within(e)&&(t="right"),t},getSideEl(e){const t=this;switch(e){case"left":return t.leftEl;case"center":return t.centerEl;case"right":return t.rightEl}},addChild(t,i){const n=this,s=n.store;if(void 0===i)t.$deep=1,void 0===t.child&&(t.child=[]),n.add(t);else{e.isNumber(t)&&(t=n.getById(t));var r=!1;!0===t.get("leaf")&&(t.set("leaf",!1),t.set("expanded",!0),t.set("child",[]),r=!0);const o=t.get("$deep"),a=t.get("child"),l=n.getRowById(t.id)+a.length+1;if(i.$deep=o+1,i.parentId=t.id,r){const s=t.get("parentId");if(s){const r=n.getById(s);e.each(r.data.child,e=>{if(e.id===t.id)return e.leaf=!1,e.expanded=!0,e.child=[i],!0})}}a.push(new s.model(i)),t.set("child",a),!0===t.get("expanded")&&n.insert(l,i)}},expand(t,i){var n,s=this;switch(e.typeOf(t)){case"number":case"string":n=s.getById(t)}if(n)if(!0!==n.get("expanded")){if(s.tree&&s.tree.expandRow(n),s.expander){if(i&&this.expander._expandedIds[t])return void this.collapse(t);var r=s.getRowById(t);s.expander.expand(r)}}else i&&this.collapse(t)},toggleExpand(e){this.expand(e,!0)},collapse(t,i){var n,s=this;switch(e.typeOf(t)){case"number":case"string":n=s.getById(t)}if(!1!==n.get("expanded")){if(s.tree&&s.tree.collapseRow(n),s.expander){var r=!this.expander._expandedIds[t];if(!r&&this.expander._expandedIds[t].hidden&&(r=!0),i&&r)return void this.expand(t);var o=s.getRowById(t);s.expander.collapse(o)}}else i&&this.expand(t)},toggleCollapse(e){this.collapse(e,!0)},collapseAll(){const t=this;if(t.tree){const i=t.findItem("$deep",1);e.each(i,e=>{t.collapse(e.id)})}else t.expander&&t.expander.collapseAll()},expandAll(){let t=this,i=t.findItem("expanded",!1);e.each(i,e=>{t.expand(e.id)}),(i=t.findItem("expanded",!1)).length&&t.expandAll()},copy(e){const t=this;t.selection&&t.selection.copy(e)},sort(t,i,n){var s,r,o=this.getColumnByIndex(t),a=this.getColumnOrderByKey(t);if(void 0===n&&(n=!0),a.side)if(r=(s=this.getHeader(a.side)).getCell(a.order),i){switch(i=i||"ASC",r=s.getCell(a.order),i=i.toLocaleLowerCase()){case"asc":r.removeCls(f),r.addCls(m);break;case"desc":r.removeCls(m),r.addCls(f);break;case"drop":r.removeCls(m),r.removeCls(f);break;default:e.error("sorting type is not right - "+i)}this.sorter.sort(i,t,a.side,o,r,n)}else r.dom.click()},flashRow(t){const i=this.getDomRow(t);i.forEach(t=>{(t=e.get(t)).addCls("fancy-grid-cell-flash")}),setTimeout(()=>{i.forEach(t=>{(t=e.get(t)).addCls("fancy-grid-cell-animation")})},200),setTimeout(()=>{i.forEach(t=>{(t=e.get(t)).removeCls("fancy-grid-cell-flash"),t.removeCls("fancy-grid-cell-animation")})},700)},flashCell(e,t,i="center",n){var s=this.getBody(i),r=700,o=Fancy.isObject(e)?e:s.getCell(e,t);if(n)switch(n.duration&&(r=n.duration),n.type){case"plusminus":n.delta>0?(o.addCls("fancy-grid-cell-flash-plus"),setTimeout(()=>{o.removeCls("fancy-grid-cell-flash-plus"),o.removeCls("fancy-grid-cell-animation")},r)):(o.addCls("fancy-grid-cell-flash-minus"),setTimeout(()=>{o.removeCls("fancy-grid-cell-flash-minus"),o.removeCls("fancy-grid-cell-animation")},r))}else o.addCls("fancy-grid-cell-flash"),setTimeout(()=>{o.removeCls("fancy-grid-cell-flash"),o.removeCls("fancy-grid-cell-animation")},700);setTimeout(()=>{o.addCls("fancy-grid-cell-animation")},200)},scrollToRow(e){const t=this.body.getCell(e,0);this.scroller.scrollToCell(t.dom,!1,!0),this.scroller.update(),this.flashRow(e)},getStateSorters(){const t={},i=JSON.parse(localStorage.getItem(this.getStateName()));if(!i)return;if(!i.sorters)return{};const n=JSON.parse(i.sorters);return e.each(n,e=>{t[e.key]=e}),t},getStateName(){const e=this,t=e.id,i=location.host+"-"+location.pathname;return e.stateId?e.stateId:t+"-"+i},setWidthFit(){var e=this,t=e.panelBodyBorders,i=e.gridWithoutPanelBorders,n=e.gridBorders,s=0,r=!1,o=[].concat(e.leftColumns).concat(e.columns).concat(e.rightColumns);Fancy.each(o,e=>{e.hidden||(s+=e.width),e.locked&&(r=!0)}),e.panel?s+=t[1]+t[3]+n[1]+n[3]:s+=i[1]+i[3]+n[1]+n[3],r&&s--,e.setWidth(s)},setColumnTitle(e,t,i="center"){var n,s=this.getHeader(i),r=s.getColumns();Fancy.isString(e)&&(e=this.getColumnOrderByKey(e).order),(n=r[e]).title=t,s.getCell(e).select(`.${Fancy.GRID_HEADER_CELL_TEXT_CLS}`).item(0).update(t),this.fire("columntitlechange",{orderIndex:e,index:n.index,value:t,side:i})},clearDirty(){this.store.clearDirty(),this.body.clearDirty(),this.leftBody.clearDirty(),this.rightBody.clearDirty()},isDirty(){return this.store.isDirty()},hideBar(t){var i,n,s=this;s.barHeight;switch(t){case"tbar":i=w,s.tbarHidden=!0,s.tbarHeight&&s.tbarHeight;break;case"subtbar":i=b,s.subTBarHidden=!0,s.subTBarHeight&&s.subTBarHeight;break;case"bbar":i=S,s.bbarHidden=!0,s.bbarHeight&&s.bbarHeight;break;case"buttons":i=x,s.buttonsHidden=!0,s.buttonsHeight&&s.buttonsHeight;break;default:e.error("Bar does not exist")}if("none"!==(n=s.panel.el.select(`.${i}`)).css("display")){n.hide();const e=parseInt(s.panel.el.css("height"));s.setHeight(e)}},showBar(t){var i,n,s=this;s.barHeight;switch(t){case"tbar":i=w,delete s.tbarHidden,s.tbarHeight&&s.tbarHeight;break;case"subtbar":i=b,delete s.subTBarHidden,s.subTBarHeight&&s.subTBarHeight;break;case"bbar":i=S,delete s.bbarHidden,s.bbarHeight&&s.bbarHeight;break;case"buttons":i=x,delete s.buttonsHidden,s.buttonsHeight&&s.buttonsHeight;break;default:e.error("Bar does not exist")}if("none"==(n=s.panel.el.select(`.${i}`)).css("display")){n.show();const e=parseInt(s.panel.el.css("height"));s.setHeight(e)}},initResponsiveness(){const t=this,i=function(){t.onWindowResize(),clearInterval(t.intWindowResize),t.intWindowResize=setTimeout(()=>{t.onWindowResize(),delete t.intWindowResize,setTimeout(()=>{t.onWindowResize()},300)},30)};"ResizeObserver"in window?(setTimeout(()=>{var n,s;t.nativeResizeObserver?n=new ResizeObserver(i):(n=new e.ResizeObserver(i),t.responsiveOverver=n),(s=t.panel?t.panel.el.parent().dom:t.el.parent().dom)&&n.observe(s)},100),e.$(window).bind("resize",i)):(setTimeout(()=>{const n=new e.ResizeObserver(i),s=t.el.parent().dom;s&&(t.responsiveOverver=n,n.observe(s))},100),e.$(window).bind("resize",i))},getNumOfVisibleCells(){const e=this;if(!e.numOfVisibleCells)try{e.numOfVisibleCells=Math.ceil(e.getBodyHeight()/e.cellHeaderHeight)}catch(t){e.numOfVisibleCells=0}return e.numOfVisibleCells},getSideByColumnIndex(t){var i;return e.each(this.columns,e=>{e.index===t&&(i="center")}),e.each(this.leftColumns,e=>{e.index===t&&(i="left")}),e.each(this.rightColumns,e=>{e.index===t&&(i="right")}),i},setColumnWidth(t,i,n="center"){const s=this;if(e.isArray(t))e.each(t,e=>{s.setColumnWidth(e.index,e.width,e.side)});else{const r=s.getColumns(n);e.isNumber(t)?r[t].width=i:s.getColumnByIndex(t).width=i}clearInterval(s.intervalUpdateColumnsWidth),s.intervalUpdateColumnsWidth=setTimeout(()=>{s.columnresizer&&(s.columnresizer.updateColumnsWidth("all"),delete this.intervalUpdateColumnsWidth,setTimeout(()=>{s.scroller.update()},Fancy.ANIMATE_DURATION))},100)},isLoading(){return this.store.loading},getChanges(){const e=this.store,t={};return t.changed=e.changed,t.removed=e.removed,t.inserted=e.inserted,t},autoSizeColumn(t,i,n){var s,r=this;if(e.isBoolean(i)?i=(s=r.getColumnOrderById(t)).side:(s=r.getColumnOrderByKey(t))&&void 0!==s.order||(i=(s=r.getColumnOrderById(t)).side),s&&void 0!==s.order){i=i||s.side;var o,a=r.getBody(i),l=e.get(a.getDomColumn(s.order)),d=l.css("width");if(d>500&&(d=100),l.css("width",""),o=l.dom.offsetWidth+2,n&&n.maxWidth&&n.maxWidth<o?o=n.maxWidth:n&&n.minWidth&&n.minWidth>o?o=n.minWidth:n&&n.maxAutoWidth&&n.maxAutoWidth<o&&(o=n.maxAutoWidth),l.css("width",d),r.header){const e=r.getHeaderCell(s.order,i);d=e.css("width"),e.css("width","");const t=e.dom.offsetWidth+25;e.css("width",d),t>o&&(o=t)}r.setColumnWidth(s.order,o,i)}else e.error("Column index was not found")},autoSizeColumns(){const t=this,i=t.getColumns();e.each(i,e=>{t.isServiceColumn(e)||e.id&&t.autoSizeColumn(e.id,!0,e)})},onFilter(){const e=this;e.store.hasFilters()?e.addCls(r):e.removeCls(r)},onSort(){const e=this,t=e.store;t.sorters&&t.sorters.length?e.addCls(s):e.removeCls(s)},isServiceColumn(e){switch(e.type){case"order":case"select":case"expand":case"rowdrag":return!0}return!1},getFilter(e,t){const i=this;if(void 0===e&&void 0===t)return i.store.filters;const n=i.store.filters[e];return void 0===t?n||void 0:n&&n[t]?n[t]:void 0},getSorter(t){const i=this;if(void 0!==t){let n;return e.each(i.store.sorters,e=>{if(e.key===t)return n=e,!0}),n}return i.store.sorters},setColumnComboData(t,i){const n=this.getColumns();e.each(n,n=>{if(n.index===t||n.id===t){if(n.data=i,n.editor&&delete n.editor,n.filterField){var s=[];e.isObject(i[0])?s=i:e.each(i,(e,t)=>{s.push({value:t,text:e})}),n.filterField.setData(s)}if(n.rowEditor){s=[];e.isObject(i[0])?s=i:e.each(i,(e,t)=>{s.push({value:t,text:e})}),n.rowEditor.setData(s)}}})},clearGroup(){const e=this,t=e.store;t.clearGroup(),e.grouping.clearGroup(),t.changeDataView(),e.update(),e.setSidesHeight(),e.scroller.update()},addGroup(e,t){const i=this,n=i.store,s=!i.grouping.by;n.addGroup(e),n.sorters&&n.reSort(),n.filterOrder,i.grouping.addGroup(s),i.setSidesHeight(),t&&i.expandGroup(),i.scroller.update(),i.scroll(0,0)},isGroupable(){return this.grouping&&this.grouping.by},expandGroup(t){const i=this,n=i.store,s=i.grouping,r=s.groups;t?(i.el.select("."+y+'[group="'+t+'"]').removeCls(C),s.expand(s.by,t)):(e.each(r,function(e){i.el.select("."+y+'[group="'+e+'"]').removeCls(C)}),s.expand(s.by,r)),(n.sorters||n.filterOrder)&&n.changeDataView({doNotFired:!0}),n.filterOrder&&n.grouping&&n.grouping.by&&i.filter.reGroupAccordingToFilters(),s.update()},collapseGroup(t){const i=this,n=i.grouping,s=n.groups;t?(i.el.select("."+y+'[group="'+t+'"]').addCls(C),n.collapse(n.by,t)):e.each(s,function(e){i.el.select("."+y+'[group="'+e+'"]').addCls(C),n.collapse(n.by,e)}),n.update()},calcCurrentLeftWidth(){var t=this.getColumns("left"),i=0;return e.each(t,e=>{e.hidden||(i+=e.width)}),i},calcCurrentRightWidth(){var t=this.getColumns("right"),i=0;return e.each(t,e=>{e.hidden||(i+=e.width)}),i},setColumns(e){const t=this;e=Fancy.Array.copy(e,!0),e=t.prepareConfigColumnMinMaxWidth({columns:e}).columns,t.defaults&&(e=t.prepareConfigDefaults({defaults:t.defaults,columns:e}).columns),t.refreshcolumns.setColumns(e),t._setColumnsAutoWidth(),setTimeout(()=>{Fancy.each(["left","center","right"],e=>{const i=t.getHeader(e),n=t.getBody(e);i.reSetColumnsAlign(),i.reSetColumnsCls(),n.reSetColumnsAlign(),n.reSetColumnsCls(),n.reSetIndexes()})},1)}}),e.ResizeObserver=function(e){this.fn=e},e.ResizeObserver.prototype.observe=function(e){this.el=e,this.init()},e.ResizeObserver.prototype.init=function(){const e=this;e.width=e.el.clientWidth,e.height=e.el.clientHeight,e.interval=setInterval(()=>{const t=e.el.clientWidth,i=e.el.clientHeight;t===e.width&&i===e.height||(e.fn(),e.width=e.el.clientWidth,e.height=e.el.clientHeight)},100)},e.ResizeObserver.prototype.stop=function(){clearInterval(this.interval),delete this.width,delete this.height}}(),Fancy.define(["Fancy.Grid","FancyGrid"],{extend:Fancy.Widget,mixins:["Fancy.grid.mixin.Grid",Fancy.panel.mixin.PrepareConfig,Fancy.panel.mixin.methods,"Fancy.grid.mixin.PrepareConfig","Fancy.grid.mixin.ActionColumn",Fancy.grid.mixin.Edit],plugins:[{type:"grid.updater"},{type:"grid.scroller"},{type:"grid.licence"},{type:"grid.refreshcolumns"}],type:"grid",theme:"default",i18n:"en",emptyText:"",prefix:"fancy-grid-",cls:"",widgetCls:Fancy.GRID_CLS,header:!0,shadow:!0,striped:!0,columnLines:!0,rowLines:!0,textSelection:!1,width:200,height:200,minWidth:200,minHeight:200,minColumnWidth:30,defaultColumnWidth:100,emptyValue:"&nbsp;",frame:!0,draggable:!1,activated:!1,multiSort:!1,tabEdit:!0,dirtyEnabled:!0,barScrollEnabled:!0,startResizing:!1,startEditByTyping:!1,filterCaseSensitive:!0,nativeResizeObserver:!1,dropOutSideActions:!0,constructor:function(e,t){const i=this;Fancy.isDom(e)?(t=t||{}).renderTo=e:t=e,t=t||{};const n=function(e){if(e){const i=t.lang;Fancy.apply(t,e),i&&Fancy.apply(t.lang,i)}t.id&&(i.id=t.id),i.initId(),i.initColumnsIdSeedByIndex(),t=i.prepareConfig(t,i),Fancy.applyConfig(i,t),i.Super("const",arguments)},s=function(){const e=t.i18n||i.i18n;!0===Fancy.loadLang(e,n)&&n({})};Fancy.modules.grid||Fancy.fullBuilt||!1===Fancy.MODULELOAD||!1===Fancy.MODULESLOAD?s():Fancy.nojQuery?Fancy.loadModule("dom",function(){Fancy.loadModule("grid",function(){s()})}):Fancy.loadModule("grid",function(){s()})},init(){const e=this;e.addEvents("beforerender","afterrender","render","show","hide","destroy"),e.addEvents("headercellclick","headercellmousemove","headercellmousedown","headercellenter","headercellleave","docmouseup","docclick","docmove","beforeinit","init","columnresize","columnclick","columndblclick","columnenter","columnleave","columnmousedown","columntitlechange","cellclick","celldblclick","cellenter","cellleave","cellmousedown","beforecellmousedown","rowclick","rowdblclick","rowenter","rowleave","rowtrackenter","rowtrackleave","beforecolumndrag","columndrag","columnhide","columnshow","columnremove","columnadd","scroll","nativescroll","remove","insert","set","change","edit","update","beforesort","sort","beforeload","load","servererror","serversuccess","select","selectrow","deselectrow","clearselect","activate","deactivate","beforeedit","startedit","beforeendedit","endedit","beforesaving","changepage","changepagesize","dropitems","dragstart","dragrows","collapse","expand","treecollapse","treeexpand","lockcolumn","rightlockcolumn","unlockcolumn","filter","contextmenu","statechange","changewidth","changeheight"),Fancy.loadStyle(),!0===Fancy.fullBuilt||!1===Fancy.MODULELOAD||!1===Fancy.MODULESLOAD||!0===e.fullBuilt||!0===e.neededModules||"datepicker"===e.wtype||"monthpicker"===e.wtype?Fancy.stylesLoaded?(e.initStore(),e.initPlugins(),e.ons(),e.initDateColumn(),e.fire("beforerender"),e.preRender(),e.render(),e.initElements(),e.initActionColumnHandler(),e.fire("render"),e.fire("afterrender"),e.setSides(),e.setSidesHeight(),e.setColumnsPosition(),e.lightStartUpdate(),e.initTextSelection(),e.initTouch(),e.initDebug(),e.fire("beforeinit"),setTimeout(()=>{e.inited=!0,e.fire("init"),e.setBodysHeight(),e.state||e._setColumnsAutoWidth()},100)):e.intWaitForStyle=setInterval(function(){Fancy.stylesLoaded&&(clearInterval(e.intWaitForStyle),e.init())},100):e.loadModules()},loadModules(){var e=this,t={},i=e.columns||[],n=e.leftColumns||[],s=e.rightColumns||[];Fancy.modules=Fancy.modules||{},Fancy.nojQuery&&(t.dom=!0),Fancy.isTouch&&(t.touch=!0),e.summary&&(t.summary=!0,e.summary.options&&(t.menu=!0)),e.exporter&&(t.exporter=!0,t.excel=!0),e.paging&&(t.paging=!0),(e.filter||e.searching)&&(t.filter=!0),e.data&&e.data.proxy&&(t.edit=!0),e.clicksToEdit&&(t.edit=!0),e.defaults&&e.defaults.editable&&(t.edit=!0),(e.stateful||e.state)&&(t.state=!0),Fancy.isObject(e.data)&&(e.data.proxy&&(t["server-data"]=!0,Fancy.nojQuery&&(t.ajax=!0)),e.data.chart&&(t["chart-integration"]=!0)),e.expander&&(t.expander=!0),e.isGroupedHeader&&(t["grouped-header"]=!0),e.grouping&&(t.grouping=!0),e.summary&&(t.summary=!0),e.exporter&&(t.exporter=!0,t.excel=!0),(e.trackOver||e.columnTrackOver||e.cellTrackOver||e.selection)&&(t.selection=!0),e.contextmenu&&(t.menu=!0),e.infinite&&(t.infinite=!0);const r=e=>{if(e.menu)return t.menu=!0,!0};Fancy.each(e.events,e=>{for(const i in e)"contextmenu"===i&&(t.menu=!0)}),Fancy.each(e.controls,e=>{"contextmenu"===e.event&&(t.menu=!0)}),Fancy.each(e.tbar,r),Fancy.each(e.bbar,r),Fancy.each(e.buttons,r),Fancy.each(e.subTBar,r);const o=i.concat(n).concat(s);for(var a in Fancy.each(o,i=>{switch(!0===i.draggable&&(t["column-drag"]=!0),!0===i.sortable&&(t.sort=!0),!0===i.editable&&(t.edit=!0),i.menu&&(t.menu=!0),i.filter&&(t.filter=!0),i.type){case"select":e.checkboxRowSelection=!0,t.selection=!0;break;case"combo":i.data&&i.data.proxy&&(t.ajax=!0);break;case"progressbar":case"progressdonut":case"grossloss":case"hbar":t.spark=!0;break;case"tree":t.tree=!0;break;case"date":t.date=!0,t.selection=!0}}),Fancy.isArray(e.tbar)&&Fancy.each(e.tbar,e=>{switch(e.action){case"add":case"remove":t.edit=!0}}),e.gridToGrid&&(t.dd=!0),e.rowDragDrop&&(t.dd=!0),e.neededModules={length:0},t)void 0===Fancy.modules[a]&&(e.neededModules[a]=!0,e.neededModules.length++);if(0===e.neededModules.length)return e.neededModules=!0,void e.init();const l=function(t){delete e.neededModules[t],e.neededModules.length--,0===e.neededModules.length&&(e.neededModules=!0,e.init())};if(e.neededModules.dom)Fancy.loadModule("dom",function(t){if(delete e.neededModules[t],e.neededModules.length--,0===e.neededModules.length)e.neededModules=!0,e.init();else for(var i in e.neededModules)"length"!==i&&Fancy.loadModule(i,l)});else for(var a in e.neededModules)"length"!==a&&Fancy.loadModule(a,l)},lockColumn(e,t){const i=this;if(1===i.columns.length)return!1;Fancy.isString(e)&&Fancy.each(i.columns,(t,i)=>{if(t.index===e)return e=i,!0});const n=i.removeColumn(e,t);i.insertColumn(n,i.leftColumns.length,"left"),i.header&&(i.leftHeader.reSetCheckBoxes(),i.groupheader&&(i.header.fixGroupHeaderSizing(),i.leftHeader.fixGroupHeaderSizing())),i.body.reSetIndexes(),i.leftBody.reSetIndexes(),i.fire("lockcolumn",{column:n}),i.update()},rightLockColumn(e,t){const i=this;if(1===i.columns.length)return!1;Fancy.isString(e)&&Fancy.each(i.columns,function(t,i){if(t.index===e)return e=i,!0});const n=i.removeColumn(e,t);i.insertColumn(n,0,"right"),i.header&&(i.rightHeader.reSetCheckBoxes(),i.groupheader&&(i.header.fixGroupHeaderSizing(),i.rightHeader.fixGroupHeaderSizing())),i.body.reSetIndexes(),i.rightBody.reSetIndexes(),i.fire("rightlockcolumn",{column:n}),i.update()},unLockColumn(e,t){const i=this;let n;switch(void 0===t&&(Fancy.isString(e)?(Fancy.each(i.leftColumns,function(i,n){if(i.index===e)return t="left",e=n,!0}),void 0===t&&Fancy.each(i.rightColumns,function(i,n){if(i.index===e)return t="right",e=n,!0})):t="left"),t){case"left":Fancy.isString(e)&&Fancy.each(i.leftColumns,function(t,i){if(t.index===e)return e=i,!0}),n=i.removeColumn(e,t),i.insertColumn(n,0,"center","left"),0===i.leftColumns.length&&(i.leftEl.addCls(Fancy.GRID_LEFT_EMPTY_CLS),i.centerEl.css("left","0px"));break;case"right":if(Fancy.isString(e)&&Fancy.each(i.rightColumns,function(t,i){if(t.index===e)return e=i,!0}),n=i.removeColumn(e,t),i.insertColumn(n,i.columns.length,"center","right"),0===i.rightColumns.length){i.rightEl.addCls(Fancy.GRID_RIGHT_EMPTY_CLS);const e=parseInt(i.body.el.css("width"));i.body.el.css("width",e+2)}}"left"===t&&i.isGroupable()&&0===i.leftColumns.length&&i.grouping.insertGroupEls(),i.header&&i.groupheader&&(i.header.fixGroupHeaderSizing(),i.rightHeader&&i.rightHeader.fixGroupHeaderSizing(),i.leftHeader&&i.leftHeader.fixGroupHeaderSizing()),i.body.reSetIndexes(),i.leftBody.reSetIndexes(),i.rightBody.reSetIndexes(),i.fire("unlockcolumn",{column:n})},moveColumn(e,t,i,n,s){const r=this;let o;if(s){for(var a=0,l=s.end-s.start+1,d=s.cell.attr("index"),c=r.getHeader(t),h=s.cell.dom.outerHTML;a<l;a++)r.moveColumn(e,t,s.end-a,n);const i=r.getColumns(t),o=c.el.select("."+Fancy.GRID_HEADER_CELL_CLS);for(l=(a=n)+(s.end-s.start+1);a<l;a++){const e=i[a],t=o.item(a);e.grouping=d,t.attr("group-index",d)}return c.el.append(h),void c.fixGroupHeaderSizing()}if("center"===e)switch(o=r.removeColumn(i,"center"),t){case"left":r.insertColumn(o,n,"left","center");break;case"right":r.insertColumn(o,n,"right","center")}else if("left"===e)switch(o=r.removeColumn(i,"left"),t){case"center":r.insertColumn(o,n,"center","left");break;case"right":r.insertColumn(o,n,"right","left")}else if("right"===e)switch(o=r.removeColumn(i,"right"),t){case"center":r.insertColumn(o,n,"center","right");break;case"left":r.insertColumn(o,n,"left","right")}r.groupheader&&(r.header.fixGroupHeaderSizing(),r.leftColumns&&r.leftHeader.fixGroupHeaderSizing(),r.rightColumns&&r.rightHeader.fixGroupHeaderSizing()),r.getHeader(e).reSetCheckBoxes(),r.getHeader(t).reSetCheckBoxes(),r.update()},updateColumnsVisibility(){const e=this;e.columns&&(e.header&&e.header.updateCellsVisibility(),e.body.updateColumnsVisibility()),e.leftColumns&&(e.leftHeader&&e.leftHeader.updateCellsVisibility(),e.leftBody.updateColumnsVisibility()),e.rightColumns&&(e.rightHeader&&e.rightHeader.updateCellsVisibility(),e.rightBody.updateColumnsVisibility())},initColumnsIdSeedByIndex(){this.columnsIdsSeed={}},getColumnId(e){const t=this;return void 0===t.columnsIdsSeed[e]?t.columnsIdsSeed[e]=0:t.columnsIdsSeed[e]++,t.columnsIdsSeed[e]?e+"-"+t.columnsIdsSeed[e]:e},isGroupable(){return this.grouping&&this.grouping.by},_setColumnsAutoWidth(){const e=this;if(!e.autoColumnWidth)return;if(e.state&&!Fancy.Object.isEmpty(e.state.getState())&&!e.allowAutoWidthStateIsEmpty)return;if(e._firstTimeAutoColumnWidth)return;const t=e.getColumns();Fancy.each(t,function(t){t.autoWidth&&!t.hidden&&(t.index||t.smartIndexFn||t.render)&&e.autoSizeColumn(t.id,!0,t)}),setTimeout(()=>{e._firstTimeAutoColumnWidth=!0,delete e.allowAutoWidthStateIsEmpty},1e3)}}),FancyGrid.get=(e=>{const t=Fancy.get(e);if(!t.dom)return;const i=t.select(`.${Fancy.GRID_CLS}`).item(0);if(!i.dom)return;const n=i.dom.id;return Fancy.getWidget(n)}),FancyGrid.defineTheme=Fancy.defineTheme,FancyGrid.defineController=Fancy.defineController,FancyGrid.addValid=Fancy.addValid,!Fancy.nojQuery&&Fancy.$&&(Fancy.$.fn.FancyGrid=function(e){return this.selector?e.renderTo=Fancy.$(this.selector)[0].id:e.renderTo=this.attr("id"),new Fancy.Grid(e)}),Fancy.define("Fancy.grid.plugin.Updater",{extend:Fancy.Plugin,ptype:"grid.updater",inWidgetName:"updater",constructor:function(e){Fancy.applyConfig(this,e),this.Super("const",arguments)},init(){},update(e=""){const t=this.widget;t.leftColumns&&t.leftColumns.length&&t.leftBody.update(e),t.body.update(e),t.rightColumns&&t.rightColumns.length&&t.rightBody.update(e)},updateRow(e){const t=this.widget;t.leftBody.updateRows(e),t.body.updateRows(e),t.rightBody.updateRows(e)}}),function(){const e=Fancy,t=e.HIDDEN_CLS,i=e.GRID_COLUMN_CLS,n=e.GRID_CENTER_CLS;e.define("Fancy.grid.plugin.Scroller",{extend:e.Plugin,ptype:"grid.scroller",inWidgetName:"scroller",rightKnobDown:!1,bottomKnobDown:!1,minRightKnobHeight:35,minBottomKnobWidth:35,cornerSize:12,scrollLeft:0,scrollTop:0,constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){const t=this,i=t.widget,n=e.getMouseWheelEventName();i.once("render",()=>{t.render(),i.leftBody.el.on(n,t.onMouseWheel,t),i.nativeScroller&&(i.leftBody.el.on(n,t.onMouseWheelLeft,t),i.rightBody.el.on(n,t.onMouseWheelRight,t)),i.body.el.on(n,t.onMouseWheel,t),i.rightBody.el.on(n,t.onMouseWheel,t),i.once("init",t.onGridInit,t),i.nativeScroller?(i.body.el.on("scroll",t.onNativeScrollBody,t),i.leftBody.el.on("scroll",t.onNativeScrollLeftBody,t),i.rightBody.el.on("scroll",t.onNativeScrollRightBody,t)):(i.panel&&i.panel.on("resize",t.onPanelResize,t),i.body.el.on("scroll",t.onScrollBodyBugFix,t))}),t.on("render",t.onRender,t),i.store.on("change",t.onChangeStore,t)},destroy(){const t=this,i=t.widget,n=i.leftBody,s=i.body,r=i.rightBody,o=e.getMouseWheelEventName();n.el.un(o,t.onMouseWheel,t),s.el.un(o,t.onMouseWheel,t),r.el.un(o,t.onMouseWheel,t),i.nativeScroller||(t.scrollBottomEl.un("mousedown",t.onMouseDownBottomSpin,t),t.scrollRightEl.un("mousedown",t.onMouseDownRightSpin,t)),e.isTouch&&(n.el.un("touchstart",t.onBodyTouchStart,t),n.el.un("touchmove",t.onBodyTouchMove,t),s.el.un("touchstart",t.onBodyTouchStart,t),s.el.un("touchmove",t.onBodyTouchMove,t),r.el.un("touchstart",t.onBodyTouchStart,t),r.el.un("touchmove",t.onBodyTouchMove,t))},onGridInit(){const t=this,i=t.widget,n=i.store,s=e.get(document);t.setScrollBars(),s.on("mouseup",t.onMouseUpDoc,t),s.on("mousemove",t.onMouseMoveDoc,t),i.on("columnresize",t.onColumnResize,t),i.on("lockcolumn",t.onLockColumn,t),i.on("rightlockcolumn",t.onRightLockColumn,t),i.on("unlockcolumn",t.onUnLockColumn,t),n.on("changepages",t.onChangePages,t),i.on("columndrag",t.onColumnDrag,t),setTimeout(()=>{t.update()},1)},render(){const i=this,n=i.widget,s=n.body,r=e.newEl("div"),o=e.newEl("div"),a=e.newEl("div");n.nativeScroller?n.el.addCls("fancy-grid-native-scroller"):(r.addCls("fancy-scroll-right"),o.addCls("fancy-scroll-bottom",t),r.update(['<div class="fancy-scroll-right-inner"></div>'].join(" ")),r.select(".fancy-scroll-right-inner").css("margin-top",n.knobOffSet),o.update(['<div class="fancy-scroll-bottom-inner"></div>'].join(" ")),e.get(s.el.append(r.dom)),i.scrollRightEl=s.el.select(".fancy-scroll-right"),e.get(s.el.append(o.dom)),i.scrollBottomEl=s.el.select(".fancy-scroll-bottom"),n.doubleHorizontalScroll&&(a.addCls("fancy-scroll-top",t),a.update(['<div class="fancy-scroll-top-inner"></div>'].join(" ")),e.get(s.el.append(a.dom)),i.scrollTopEl=s.el.select(".fancy-scroll-top"))),i.fire("render")},onMouseWheel(t){const i=this,n=i.widget,s=n.store,r=e.getWheelDelta(t.originalEvent||t);if(n.infinite){let e;return t.preventDefault(),(e=r<0?s.infiniteScrolledToRow+1:s.infiniteScrolledToRow-1)>s.getNumOfInfiniteRows()-(n.numOfVisibleCells-1)&&(e=s.getNumOfInfiniteRows()-(n.numOfVisibleCells-1)),e<0&&(e=0),s.infiniteScrolledToRow=e,n.update(),void(n.selection&&n.selection.updateSelection())}0!=i.isRightScrollable()&&(n.stopProp&&t.stopPropagation(),n.nativeScroller||(i.scrollDelta(r)&&t.preventDefault(),i.scrollRightKnob()))},onRender(){const t=this,i=t.widget,{bottomKnobDown:n,rightKnobDown:s}=t;!0!==i.nativeScroller&&(t.scrollRightEl.hover(()=>{!0!==n&&t.scrollRightEl.addCls("fancy-scroll-right-hover")},()=>{t.scrollRightEl.removeCls("fancy-scroll-right-hover")}),t.scrollBottomEl.hover(()=>{!0!==s&&t.scrollBottomEl.addCls("fancy-scroll-bottom-hover")},()=>{t.scrollBottomEl.removeCls("fancy-scroll-bottom-hover")}),i.doubleHorizontalScroll&&t.scrollTopEl.hover(()=>{!0!==n&&t.scrollTopEl.addCls("fancy-scroll-top-hover")},()=>{!0!==n&&t.scrollTopEl.removeCls("fancy-scroll-top-hover")}),t.initRightScroll(),t.initBottomScroll()),e.isTouch&&t.initTouch()},initTouch(){const t=this,i=t.widget,n=i.leftBody,s=i.body,r=i.rightBody,o=e.get(document);n.el.on("touchstart",t.onBodyTouchStart,t),n.el.on("touchmove",t.onBodyTouchMove,t),s.el.on("touchstart",t.onBodyTouchStart,t),s.el.on("touchmove",t.onBodyTouchMove,t),r.el.on("touchstart",t.onBodyTouchStart,t),r.el.on("touchmove",t.onBodyTouchMove,t),o.on("touchend",t.onBodyTouchEnd,t)},onBodyTouchStart(e){e=e.originalEvent||e;const t=this,i=t.widget,n=e.changedTouches[0];i.nativeScroller||(Fancy.nojQuery&&(i.panel?i.panel.el.select("."+Fancy.GRID_ANIMATION_CLS).removeCls(Fancy.GRID_ANIMATION_CLS):i.el.removeCls(Fancy.GRID_ANIMATION_CLS)),e.preventDefault(),t.rightKnobDown=!0,t.bottomKnobDown=!0,t.mouseDownXY={x:n.pageX,y:n.pageY},t.rightKnobTop=parseInt(t.rightKnob.css("margin-top")),t.scrollRightEl.addCls("fancy-scroll-right-active"),t.bottomKnobLeft=parseInt(t.bottomKnob.css("margin-left")),t.scrollBottomEl.addCls("fancy-scroll-bottom-active"),i.doubleHorizontalScroll&&t.scrollTopEl.addCls("fancy-scroll-top-active"))},onBodyTouchEnd(){const e=this,t=e.widget;if(e.onMouseUpDoc(),!0!==t.nativeScroller&&e.spyOnSwipe){const t=e.spyOnSwipe.swipedX,i=e.spyOnSwipe.swipedY;i&&t?"top"===e.touchScrollDirection?e.swipeTop():"left"===e.touchScrollDirection&&e.swipeLeft():i?e.swipeTop():t&&e.swipeLeft()}delete e.spyOnSwipe,delete e.touchScrollDirection},swipeTop(){let e=this.widget,t=this.scrollTop+10*this.spyOnSwipe.swipedY;this.isRightScrollable()&&(t<0&&(t=0),e.scroll(t,!1,!0))},swipeLeft(){let e=this.widget,t=this.scrollLeft+10*this.spyOnSwipe.swipedX;this.isBottomScrollable()&&(t<0&&(t=0),e.scroll(!1,t,!0))},onBodyTouchMove(t){var i=this,n=i.widget,s=(t=t.originalEvent||t).changedTouches[0],r=!0;if(n.nativeScroller){if(e.isTouch)return;i.onMouseMoveDoc({pageX:s.pageX,pageY:s.pageY})}else{var o=i.scrollLeft,a=i.scrollTop;i.onMouseMoveDoc({pageX:s.pageX,pageY:s.pageY}),r=o!==i.scrollLeft||a!==i.scrollTop,t.preventDefault()}!0===i.rightKnobDown&&r&&t.preventDefault(),!0===i.bottomKnobDown&&r&&t.preventDefault()},initRightScroll(){const e=this;e.rightKnob=e.scrollRightEl.select(".fancy-scroll-right-inner"),e.scrollRightEl.on("mousedown",e.onMouseDownRightSpin,e)},initBottomScroll(){const e=this,t=e.widget;e.bottomKnob=e.scrollBottomEl.select(".fancy-scroll-bottom-inner"),e.scrollBottomEl.on("mousedown",e.onMouseDownBottomSpin,e),t.doubleHorizontalScroll&&(e.topKnob=e.scrollTopEl.select(".fancy-scroll-top-inner"),e.scrollTopEl.on("mousedown",e.onMouseDownBottomSpin,e))},onMouseDownRightSpin(t){const i=this,n=i.widget;e.isTouch||(Fancy.nojQuery&&(n.panel?n.panel.el.select("."+Fancy.GRID_ANIMATION_CLS).removeCls(Fancy.GRID_ANIMATION_CLS):n.el.removeCls(Fancy.GRID_ANIMATION_CLS)),t.preventDefault(),i.rightKnobDown=!0,i.mouseDownXY={x:t.pageX,y:t.pageY},i.rightKnobTop=parseInt(i.rightKnob.css("margin-top")),i.scrollRightEl.addCls("fancy-scroll-right-active"))},onMouseDownBottomSpin(t){const i=this,n=i.widget,s=e.get(t.target);t.preventDefault(),Fancy.nojQuery&&(n.panel?n.panel.el.select("."+Fancy.GRID_ANIMATION_CLS).removeCls(Fancy.GRID_ANIMATION_CLS):n.el.removeCls(Fancy.GRID_ANIMATION_CLS)),i.bottomKnobDown=!0,i.mouseDownXY={x:t.pageX,y:t.pageY},i.bottomKnobLeft=parseInt(i.bottomKnob.css("margin-left")),i.scrollBottomEl.addCls("fancy-scroll-bottom-active"),s.hasClass()&&i.scrollTopEl.addCls("fancy-scroll-top-inner")},onMouseUpDoc(){const e=this,t=e.widget;e.mouseDownXY={},delete e.mouseMoveInitXY,!1!==e.rightKnobDown||!1!==e.bottomKnobDown?(Fancy.nojQuery&&t.addCls(Fancy.GRID_ANIMATION_CLS),e.scrollRightEl.removeCls("fancy-scroll-right-active"),e.scrollBottomEl.removeCls("fancy-scroll-bottom-active"),e.rightKnobDown=!1,e.bottomKnobDown=!1,t.doubleHorizontalScroll&&e.scrollTopEl.removeCls("fancy-scroll-top-active","fancy-scroll-top-hover")):t.nativeScroller&&Fancy.nojQuery&&t.addCls(Fancy.GRID_ANIMATION_CLS)},onMouseMoveDoc(t){var i,n,s,r,o=this,a=o.widget,l=!1,d=!1,c=a.knobOffSet,h=t.pageX,u=t.pageY;if(!e.isTouch||o.mouseMoveInitXY){if(e.isTouch&&!o.touchScrollDirection){if(i=o.mouseMoveInitXY.x-h,n=o.mouseMoveInitXY.y-u,!o.touchScrollDirection&&Math.abs(n)<5&&Math.abs(i)<5)return;Math.abs(n)>Math.abs(i)?o.touchScrollDirection="top":o.touchScrollDirection="left"}clearInterval(o.scrollInterval),o.spyOnSwipe?(Math.abs(o.spyOnSwipe.x-h)>1?o.spyOnSwipe.swipedX=o.spyOnSwipe.x-h:delete o.spyOnSwipe.swipedX,Math.abs(o.spyOnSwipe.y-u)>1?o.spyOnSwipe.swipedY=o.spyOnSwipe.y-u:delete o.spyOnSwipe.swipedY,o.spyOnSwipe.x=h,o.spyOnSwipe.y=u):o.spyOnSwipe={x:h,y:u},o.scrollInterval=setTimeout(()=>{if(o.rightKnobDown&&"left"!==o.touchScrollDirection&&(e.isTouch?(n=o.mouseDownXY.y-u,s=n+Math.ceil(o.rightKnobTop*o.rightScrollScale)):(n=u-o.mouseDownXY.y,s=n+o.rightKnobTop),e.isTouch?o.bodyViewHeight<s/o.rightScrollScale+o.rightKnobHeight&&(s=o.bodyFullViewHeight-o.bodyViewHeight):o.bodyViewHeight<s+o.rightKnobHeight&&(s=o.bodyViewHeight-o.rightKnobHeight),s<0&&(s=0),e.isTouch?(l=s,o.rightKnob.css("margin-top",s/o.rightScrollScale+c+"px")):(l=o.rightScrollScale*s,o.rightKnob.css("margin-top",s+c+"px")),a.doubleHorizontalScroll&&"none"!==o.scrollBottomEl.css("display")&&s<o.cornerSize&&(s=o.cornerSize),a.infinite&&a.selection&&(a.selection.updateSelection(),a.selection.clearActiveCell())),o.bottomKnobDown&&"top"!==o.touchScrollDirection&&(e.isTouch?(i=o.mouseDownXY.x-h,n=o.mouseDownXY.y-u,r=i+Math.ceil(o.bottomKnobLeft*Math.abs(o.bottomScrollScale))):(i=h-o.mouseDownXY.x,n=u-o.mouseDownXY.y,r=i+o.bottomKnobLeft),r<1&&(r=1),e.isTouch?o.bodyViewWidth-2<Math.abs(r/o.bottomScrollScale)+o.bottomKnobWidth&&(r=o.bodyFullViewWidth-o.bodyViewWidth-2):o.bodyViewWidth-2<r+o.bottomKnobWidth&&(r=o.bodyViewWidth-o.bottomKnobWidth-2),o.bottomScrollScale<0&&r<0&&(r=0,o.bottomScrollScale=0),e.isTouch?(d=-r-1,o.bottomKnob.css("margin-left",Math.abs(r/o.bottomScrollScale)+"px")):(d=Math.ceil(o.bottomScrollScale*(r-1)),o.bottomKnob.css("margin-left",r+"px")),a.doubleHorizontalScroll&&o.topKnob.css("margin-left",r+"px")),e.isTouch)switch(o.touchScrollDirection){case"top":o.scroll(l);break;case"left":o.scroll(!1,d)}else!1!==l&&!1!==d?o.scroll(l,d):!1!==l?o.scroll(l):!1!==d&&o.scroll(!1,d)},1)}else o.mouseMoveInitXY={x:h,y:u}},setScrollBars(e){const t=this,i=t.widget;i.rowheight&&void 0===e||(setTimeout(()=>{t.checkRightScroll(e)},1),t.checkBottomScroll()||t.scrollTop&&!i.infinite&&i.scroll(!1,0),i.nativeScroller||setTimeout(()=>{t.checkCorner(),t.setRightKnobSize(e),t.setBottomKnobSize()},1))},checkRightScroll(e){const i=this,n=i.widget,s=n.body,r=n.gridBorders,o=n.getBodyHeight(),a=(e||n.getCellsViewHeight())-r[0]-r[2];n.nativeScroller?o>=a?s.el.css("overflow-y","hidden"):s.el.css("overflow-y","scroll"):o>=a?i.scrollRightEl.addCls(t):i.scrollRightEl.removeCls(t)},isRightScrollable(){const e=this.widget;return e.nativeScroller?"scroll"===e.body.el.css("overflow-y"):!this.scrollRightEl.hasCls(t)},isBottomScrollable(){const e=this.widget;return e.nativeScroller?"scroll"===e.body.el.css("overflow-x"):!this.scrollBottomEl.hasCls(t)},setRightKnobSize(e){const t=this,i=t.widget;if(!i.nativeScroller){var n=i.getBodyHeight()-(t.corner?t.cornerSize:0)-2,s=(e||i.getCellsViewHeight())-(t.corner?t.cornerSize:0),r=n*((100-(s-n)/(n/100))/100),o=i.knobOffSet;r<t.minRightKnobHeight&&(r=t.minRightKnobHeight,i.doubleHorizontalScroll&&(r+=t.minRightKnobHeight)),!1===t.corner&&(n-=o),t.rightKnob.css({height:r}),t.rightKnobHeight=r,t.bodyViewHeight=n,t.bodyFullViewHeight=s,t.rightScrollScale=(s-n)/(n-r)}},checkBottomScroll(){var e,i=this,n=i.widget,s=n.body,r=n.getCenterViewWidth(),o=n.getCenterFullWidth()-2;return n.nativeScroller?r>o?(e=!1,s.el.css("overflow-x","hidden")):(e=!0,s.el.css("overflow-x","scroll")):r>o?(e=!1,i.scrollBottomEl.addCls(t),n.doubleHorizontalScroll&&i.scrollTopEl.addCls(t)):(e=!0,i.scrollBottomEl.removeCls(t),n.doubleHorizontalScroll&&i.scrollTopEl.removeCls(t)),e},checkCorner(){this.widget.nativeScroller||(this.corner=!this.scrollRightEl.hasCls(t)&&!this.scrollBottomEl.hasCls(t))},setBottomKnobSize(){const t=this,i=t.widget;if(!i.nativeScroller){var n=i.getCenterViewWidth()-(t.corner?t.cornerSize:0),s=i.getCenterFullWidth()-(t.corner?t.cornerSize:0),r=n*((100-(s-n)/(s/100))/100)-2;r<t.minBottomKnobWidth&&(r=t.minBottomKnobWidth),t.bottomKnob.css({width:r}),i.doubleHorizontalScroll&&t.topKnob.css({width:r},e.ANIMATE_DURATION),t.bottomKnobWidth=r,t.bodyViewWidth=n,t.bottomScrollScale=(n-s)/(n-r-2-1),t.bodyFullViewWidth=s}},scroll(t,i,n){var s,r=this.widget;if(i>0&&(i=0),r.nativeScroller)return null!==t&&void 0!==t&&(r.body.el.dom.scrollTop=t),null!==i&&void 0!==i&&(r.body.el.dom.scrollLeft=Math.abs(i),r.header&&r.header.scroll(i,!0)),void r.fire("scroll");n&&(r.el.addCls("fancy-grid-columns-animation"),setTimeout(()=>{r.el.removeCls("fancy-grid-columns-animation")},e.ANIMATE_DURATION+150)),r.leftBody.scroll(t),s=r.body.scroll(t,i,n),r.rightBody.scroll(t),void 0!==s.scrollTop&&(this.scrollTop=Math.abs(s.scrollTop)),void 0!==s.scrollLeft&&(this.scrollLeft=Math.abs(s.scrollLeft)),r.fire("scroll"),e.isTouch&&(r._preventTouchDown=!0)},scrollDelta(e){var t,i=this.widget;if(i.leftBody.wheelScroll(e),t=i.body.wheelScroll(e),i.rightBody.wheelScroll(e),void 0!==t)return this.scrollTop=Math.abs(t.newScroll),i.fire("scroll"),t.scrolled},scrollRightKnob(){var e=this,t=e.widget,i=(t.store,e.getScroll()/e.rightScrollScale+t.knobOffSet);e.rightKnob&&(t.doubleHorizontalScroll&&(i+=e.cornerSize),t.infinite,e.rightKnob.css("margin-top",i+"px"))},scrollBottomKnob(){var e=this,t=e.widget,i=e.getBottomScroll(),n=i/e.bottomScrollScale+t.knobOffSet;0===i&&(n=-1),e.bottomKnob&&(e.bottomKnob.css("margin-left",-n+"px"),t.doubleHorizontalScroll&&e.topKnob.css("margin-left",-n+"px"))},getScroll(){const e=this.widget,t=e.store;if(e.nativeScroller)return e.body.el.dom.scrollTop;if(e.infinite)return Math.abs(t.infiniteScrolledToRow*e.cellHeight);if(0===e.columns.length){if(e.leftColumns.length)return Math.abs(parseInt(e.leftBody.el.select("."+i).item(0).css("top")));if(e.rightColumns.length)return Math.abs(parseInt(e.rightBody.el.select("."+i).item(0).css("top")))}const n=e.body.el.select("."+i);return 0===n.length?0:Math.abs(parseInt(n.item(0).css("top")))},getBottomScroll(){const e=this.widget;if(e.nativeScroller)return e.body.el.dom.scrollLeft;if(0===e.columns.length){if(e.leftColumns.length)return Math.abs(parseInt(e.leftBody.el.select("."+i).item(0).css("left")));if(e.rightColumns.length)return Math.abs(parseInt(e.rightBody.el.select("."+i).item(0).css("left")))}const t=e.body.el.select("."+i);return 0===t.length?0:Math.abs(parseInt(t.item(0).css("left")))},update(e){this.setScrollBars(e),this.checkScroll(e),this.scrollRightKnob(),this.scrollBottomKnob()},onChangeStore(){this.update()},onColumnResize(){const e=this;e.setScrollBars(),setTimeout(()=>{e.setScrollBars()},Fancy.ANIMATE_DURATION+20)},getScrollHeight(){const e=this,t=e.widget,i=t.getBodyHeight()-(e.corner?e.cornerSize:0),n=t.getCellsViewHeight()-(e.corner?e.cornerSize:0);return i>n?i:n-i},getScrollWidth(){const e=this,t=e.widget,i=t.getCenterViewWidth()-(e.corner?e.cornerSize:0),n=t.getCenterFullWidth()-(e.corner?e.cornerSize:0);return i>n?i:n-i},checkScroll(t){var i=this,n=i.widget,s=i.getScroll(),r=n.getBodyHeight()-(i.corner?i.cornerSize:0),o=(t||n.getCellsViewHeight())-(i.corner?i.cornerSize:0),a=n.getCenterFullWidth(),l=n.getCenterViewWidth(),d=i.getScrollTop(),c=i.getScrollLeft();a<c+l?setTimeout(function(){d=i.getScrollTop(),c=i.getScrollLeft();const e=a-(c+l);c+e<0?n.scroll(d,0):n.scroll(d,c+e)},e.nojQuery?10:e.ANIMATE_DURATION):s&&o<r&&(i.scroll(0),n.nativeScroller||i.scrollRightKnob())},scrollToCell(t,i,s){if(void 0!==t){var r=this,o=r.widget,a=o.store,l=o.cellHeight,d=e.get(t),c=d.parent(),h=Number(d.attr("index")),u=Number(c.attr("index")),g=r.getScroll(),p=l*(h+1),m=o.getBodyHeight(),f=r.getBottomScroll(),y=o.getSideByCell(t),C=o.getColumnsWidth(y),v=parseInt(o.body.el.css("width")),w=0,b=c.parent().parent().hasCls(n);if(o.rowheight&&(p=o.rowheight.rowIndexesSum[h]),!o.nativeScroller||i){if(o.infinite&&(h+=a.infiniteScrolledToRow,p+=l*a.infiniteScrolledToRow),0===h&&0===u){if(0===r.scrollLeft||"row"!==o.selModel&&"rows"!==o.selModel||o.selection&&o.selection.activeCell)if(o.selection&&o.selection.activeCell){"center"!==o.selection.getActiveCellInfo().side?r.scroll(0):r.scroll(0,0)}else r.scroll(0,0);else r.scroll(0);return r.scrollBottomKnob(),void r.scrollRightKnob()}if(0!==h||0===r.scrollTop){if(o.isGroupable()&&(p+=o.grouping.getSpecialRowsAbove(h)*o.groupRowHeight),o.expander&&(p+=o.expander.getBeforeHeight(h)),s){const e=o.getCellsViewHeight();e-(g=p-l)<m&&(g-=Math.abs(e-g-m)),r.scroll(g)}else if(p-g>m){var S=5;o.nativeScroller&&(S=20),g=p-m+S,r.scroll(g)}else p-g<o.cellHeight&&((g=p-l-5)<0&&(g=0),r.scroll(g));if(b){for(var x=o.columns,I=0;I<=u;I++)x[I].hidden||(w+=x[I].width);w-f>v?x[I]?r.scroll(g,-(f+(w-f)-v)):r.scroll(g,-(C-v)):w-f<x[u].width?((f=-(w-x[u].width))>0&&(f=0),r.scroll(g,f)):0!==f&&0===u&&r.scroll(g,0),r.scrollBottomKnob()}r.scrollRightKnob()}else r.scroll(0)}}},onNativeScrollBody(){const t=this.widget,i=t.body.el.dom.scrollTop,n=t.body.el.dom.scrollLeft;t.header&&t.header.scroll(-n),t.leftBody&&(t.leftBody.el.dom.scrollTop=i),t.rightBody&&(t.rightBody.el.dom.scrollTop=i),t.leftColumns.length&&t.leftBody.el.dom.scrollTop!==t.body.el.dom.scrollTop?t.body.el.dom.scrollTop=t.leftBody.el.dom.scrollTop:t.rightColumns.length&&t.rightBody.el.dom.scrollTop!==t.body.el.dom.scrollTop&&(t.body.el.dom.scrollTop=t.rightBody.el.dom.scrollTop),Fancy.nojQuery&&(t.panel?t.panel.el.select("."+Fancy.GRID_ANIMATION_CLS).removeCls(Fancy.GRID_ANIMATION_CLS):t.el.removeCls(Fancy.GRID_ANIMATION_CLS)),t.summary&&t.summary.scrollLeft(-n),t.subHeaderFilter&&t.filter.scrollLeft(-n),t.fire("nativescroll"),e.isTouch&&(t._preventTouchDown=!0)},onNativeScrollLeftBody(){const e=this.widget;e.leftBody.el.dom.scrollTop!==e.body.el.dom.scrollTop&&this.onNativeScrollBody()},onNativeScrollRightBody(){const e=this.widget;e.rightBody.el.dom.scrollTop!==e.body.el.dom.scrollTop&&this.onNativeScrollBody()},onMouseWheelLeft(t){const i=this.widget,n=e.getWheelDelta(t.originalEvent||t)*i.cellHeight;i.leftBody.el.dom.scrollTop-=n,i.body.el.dom.scrollTop-=n,i.rightBody.el.dom.scrollTop-=n},onMouseWheelRight(t){const i=this.widget,n=e.getWheelDelta(t.originalEvent||t)*i.cellHeight;i.leftBody.el.dom.scrollTop-=n,i.body.el.dom.scrollTop-=n,i.rightBody.el.dom.scrollTop-=n},onLockColumn(){const t=this;t.update(),t.widget.setColumnsPosition(),setTimeout(()=>{t.update(),t.widget.setColumnsPosition()},e.ANIMATE_DURATION)},onColumnDrag(){const t=this;e.nojQuery&&setTimeout(()=>{t.update()},e.ANIMATE_DURATION)},onRightLockColumn(){const t=this;t.update(),t.widget.setColumnsPosition(),setTimeout(()=>{t.update(),t.widget.setColumnsPosition()},e.ANIMATE_DURATION)},onUnLockColumn(){const t=this;t.update(),t.widget.setColumnsPosition(),setTimeout(()=>{t.update(),t.widget.setColumnsPosition()},e.ANIMATE_DURATION+100)},onPanelResize(){this.widget.scroll(0,0)},onChangePages(){var e=this;!e.widget.nativeScroller&&e.scrollTop&&setTimeout(()=>{e.scrollDelta(0)},1)},onScrollBodyBugFix(){const e=this.widget,t=e.body,i=t.el.dom.scrollLeft;t.el.dom.scrollLeft=this.scrollLeft,e.scroll(this.scrollTop,-this.scrollLeft-i)},getScrollTop(){const e=this.widget;return e.nativeScroller?e.body.el.dom.scrollTop:this.scrollTop},getScrollLeft(){const e=this.widget;return e.nativeScroller?e.body.el.dom.scrollLeft:this.scrollLeft}})}(),function(){const e=Fancy;let t;const i={title:function(e,t,i,n){e.setColumnTitle(i,t,n)},width:function(e,t,i,n){e.setColumnWidth(i,t,n)},hidden:function(e,t,i,n,s){t?e.hideColumn(s):e.showColumn(s)},render:function(e,i,n,s,r){clearInterval(t),e.getColumnById(r).render=i,t=setTimeout(function(){e.update()},1)}};e.define("Fancy.grid.plugin.RefreshColumn",{extend:e.Plugin,ptype:"grid.refreshcolumns",inWidgetName:"refreshcolumns",constructor:function(){this.Super("const",arguments)},setColumns(t){const i=this.widget;this.applyChanges(t),t=i.prepareConfigColumnsWidth({columns:t,width:i.width}).columns,t=i.prepareConfigColumns({columns:t},!1).columns,this.setColumnsByOrder(t),i.filter&&(clearInterval(i.intFilterFieldsUpdate),i.intFilterFieldsUpdate=setTimeout(()=>{delete i.intFilterFieldsUpdate,i.filter.updateFields()},e.ANIMATE_DURATION))},applyChanges(t){const i={},n=[];e.each(t,e=>{e.id?i[e.id]=e:e.index?i[e.index]=e:n.push(e)}),this.setChangesByIds(i),this.setChangesWithoutIds(n),this.setChangesToNotCheckedColumns(t)},setChangesByIds(t){const n=this.widget,s=n.getColumns();e.each(s,e=>{!e.id||/col-id-/.test(e.id)||t[e.id]||n.removeColumn(e.id)});for(const e in t){const s=n.getColumnById(e),r=n.getColumnOrderById(e),o=t[e];if(s){for(const t in i)void 0!==o[t]&&s[t]!==o[t]&&i[t](n,o[t],r.order,r.side,e);o.$checked=!0,s.$checked=!0}}},setChangesWithoutIds(t){const n=this.widget,s=n.getColumns();e.each(t,t=>{if(t.render){const r=[],o=t.render.toString();if(e.each(s,e=>{e.render&&o===e.render.toString()&&r.push(e)}),1===r.length){const e=r[0],s=n.getColumnOrderById(e.id);for(const r in i)void 0!==t[r]&&e[r]!==t[r]&&i[r](n,t[r],s.order,s.side,e.id);t.$checked=!0,e.$checked=!0}}})},setChangesToNotCheckedColumns(t){var i=this.widget,n=i.getColumns(),s=[],r={},o={};for(var a in e.each(n,e=>{e.$checked||(s.push(e),r[e.type]=r[e.type]||[],r[e.type].push(e))}),e.each(t,e=>{e.$checked||(o[e.type]=o[e.type]||[],o[e.type].push(e))}),r){var l=r[a];e.each(l,t=>{var i=o[a];e.each(i,e=>{var n=!0;for(const i in e)if(e[i]!==t[i]){n=!1;break}n&&(i.$checked=!0,t.$checked=!0)})})}s=[],e.each(n,e=>{e.$checked||s.push(e)}),e.each(s,e=>i.removeColumn(e.id)),e.each(t,e=>{delete e.$checked}),e.each(n,e=>{delete e.$checked})},setColumnsByOrder(t){const i=[],n=[],s=[];e.each(t,e=>{e.locked?i.push(e):e.rightLocked?n.push(e):s.push(e)}),this.setColumnsByOrderInSide(s,"center"),this.setColumnsByOrderInSide(i,"left"),this.setColumnsByOrderInSide(n,"right")},setColumnsByOrderInSide(t,i){const n=this.widget,s=n.getColumns(i);e.each(t,(e,t)=>{var r=!0,o=s[t];if(void 0!==o)for(const t in e){if(void 0!==e.id&&e.id===o.id)break;switch(t){case"width":case"hidden":continue}if(e[t]!==o[t]){r=!1;break}}else r=!1;if(!r)if(o&&o.index===e.index)n.removeColumn(o.id),n.addColumn(e,i,t,!1);else if(!e.id){const s=n.getColumnByIndex(e.index);s&&n.removeColumn(s.id),n.addColumn(e,i,t,!1)}})}})}(),function(){const e=Fancy,t=e.GRID_COLUMN_SORT_ASC,i=e.GRID_COLUMN_SORT_DESC,n=e.GRID_COLUMN_RESIZER_CLS,s=e.FIELD_CLS,r=e.GRID_CENTER_CLS,o=e.GRID_LEFT_CLS,a=e.GRID_RIGHT_CLS;e.define("Fancy.grid.plugin.Sorter",{extend:e.Plugin,ptype:"grid.sorter",inWidgetName:"sorter",constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){const e=this;e.widget.once("render",()=>e.onsHeaders())},onsHeaders(){this.widget.on("headercellclick",this.onHeaderCellClick,this)},onHeaderCellClick(r,o){var a,l,d,c,h=this.widget,u=h.columndrag,g=e.get(o.cell),p=o.side,m=o.index,f=o.e.target;if(u&&"dragging"===u.status)return;if("input"===f.tagName.toLocaleLowerCase())return;const y=g.select(`.${s}`);y.length>0&&!0===y.item(0).within(f)||g.hasCls(n)||h.startResizing||(l=h.getColumns(p),a=g.hasCls(t)?"desc":g.hasCls(i)?h.multiSort?"asc":"drop":"asc",c=(d=l[m]).index,!1!==d.headerClickSort&&this.sort(a,c,p,d,g))},sort(n,s,r,o,a,l){var d,c=this.widget,h=c.store,u=c.getColumns(r),g=0,p=u.length,m=c.getHeader(r);if(c.sorting=!0,!o||!a)for(;g<p;g++)if(u[g].index===s){o=u[g],a=m.getCell(g);break}if(!0!==o.sortable)return;if(c.multiSort?this.clearHeaderMultiSortCls(n,a):this.clearHeaderSortCls(),!o.headerCheckBox)switch(n){case"asc":a.addCls(t);break;case"desc":a.addCls(i)}let f,y;if(d=o.type,o.format)if(e.isString(o.format))switch(o.format){case"date":f=c.lang.date.read,o.format.mode&&(y=o.format.mode)}else switch(o.type){case"date":f=o.format.read,o.format.mode&&(y=o.format.mode)}c.grouping&&c.grouping.by&&h.remoteSort&&h.once("load",()=>{c.grouping.reGroup()}),h.sort(n,d,s,{smartIndexFn:o.smartIndexFn,format:f,mode:y,sorter:o.sorter,update:!1!==l}),!1!==l&&c.update(),delete c.sorting},clearSort(){const e=this.widget,t=e.store;this.clearHeaderSortCls(),e.sorting=!0,delete t.order,t.changeDataView(),delete e.sorting},clearHeaderMultiSortCls(e,n){let s;var l,d,c=this.widget,h=c.store;switch(e.toLocaleUpperCase()){case"ASC":n.removeCls(i);break;case"DESC":n.removeCls(t)}if(l=c.el.select(`.${t}`),d=c.el.select(`.${i}`),l.length+d.length<h.multiSortLimit)return;let u=0,g=l.length;for(var p;u<g;u++){var m=(y=l.item(u)).parent().parent(),f=y.attr("index");m.hasCls(r)?C="center":m.hasCls(o)?C="left":m.hasCls(a)&&(C="right"),v=c.getColumns(C)[f].index,(s=h.sorters[0]).key===v&&(p=y)}for(u=0,g=d.length;u<g;u++){var y,C,v;m=(y=d.item(u)).parent().parent(),f=y.attr("index");m.hasCls(r)?C="center":m.hasCls(o)?C="left":m.hasCls(a)&&(C="right"),v=c.getColumns(C)[f].index,(s=h.sorters[0]).key===v&&(p=y)}p.removeCls(t,i)},clearHeaderSortCls(){const e=this.widget.el;e.select(`.${t}`).removeCls(t),e.select(`.${i}`).removeCls(i)},updateSortedHeader(){var n=this.widget,s=n.store;this.clearHeaderSortCls(),e.each(s.sorters,e=>{const s=n.getColumnOrderByKey(e.key),r="ASC"===e.dir?t:i;if(!s.side)return;const o=n.getHeader(s.side).getCell(s.order);o&&o.addCls(r)})}})}(),function(){const e=Fancy,t=e.PANEL_TBAR_CLS,i=e.PANEL_BBAR_CLS,n=e.PANEL_BAR_PAGING_CLS;Fancy.define("Fancy.grid.plugin.Paging",{extend:Fancy.Plugin,ptype:"grid.paging",inWidgetName:"paging",barType:"bbar",constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){const e=this,t=e.widget,i=t.store;i.on("change",e.onChangeStore,e),i.on("remove",e.onChangeStore,e),i.on("filter",e.onChangeStore,e),t.on("render",e.onRenderGrid,e),t.on("docmove",e.onDocMouseMove,e),t.on("render",()=>e.setCls())},setPageSize(e){this.widget.store.setPageSize(e),this.widget.update()},nextPage(){this.widget.store.nextPage(),this.widget.update()},lastPage(){this.widget.store.lastPage(),this.widget.update()},prevPage(){this.widget.store.prevPage(),this.widget.update()},firstPage(){this.widget.store.firstPage(),this.widget.update()},onChangeStore(e){var t=this,i=t.widget,n=i.store,s=i.panel;switch(t.barType){case"both":s._bbar.roles.pagenumber.setValue(n.showPage+1),s._tbar.roles.pagenumber.setValue(n.showPage+1),t.updateBar("tbar"),t.updateBar("bbar");break;case"none":case!1:break;default:s["_"+t.barType].roles.pagenumber.setValue(n.showPage+1),t.updateBar()}i.setSidesHeight(),void 0===t.$prevPage?i.fire("changepage",e.showPage):t.$prevPage!==e.showPage&&i.fire("changepage",e.showPage),t.$prevPage=e.showPage},setPage(e,t){const i=this.widget,n=i.store;return e<0?e=0:e>n.pages&&(e=n.pages),n.setPage(e,t),i.update(),e},refresh(){const e=this.widget,t=e.store;e.showLoadMask(),setTimeout(()=>{t.refresh(),"server"!==t.pageType&&e.hideLoadMask()},200)},updateBar(e){e=e||this.barType;var t=this.widget,i=t.store,n=i.showPage,s=i.pageSize,r=i.pages,o=t.panel["_"+e],a=o.roles,l=a.pagenumber,d=a.ofText,c=a.info,h=a.first,u=a.prev,g=a.next,p=a.last,m=n*s+1,f=m+s-1,y=i.getTotal()||0,C=t.lang;f>y&&(f=y),0===f&&(m=0),m>f&&(f=m),l.setValue(i.showPage+1),d.el.update(Fancy.String.format(C.paging.of,[r||1])),c.el.update(Fancy.String.format(C.paging.info,[m,f,y])),0===n?(h.disable(),u.disable()):(h.enable(),u.enable()),r-1===n||0===r?(p.disable(),g.disable()):(p.enable(),g.enable()),parseInt(t.el.css("width"))<350&&(c.hide(),o.checkScroll())},onRenderGrid(){const e=this;switch(e.barType){case"both":e.updateBar("tbar"),e.updateBar("bbar");break;case"none":case!1:break;default:e.updateBar()}},onDocMouseMove(){const e=this,t=e.widget;"none"===t.el.css("display")||t.panel&&t.panel.el&&"none"===t.panel.el.css("display")?e.wasHidden||(Fancy.combo.Manager.hideLists(),e.wasHidden=!0):e.wasHidden=!1},update(){const e=this.widget.store;e.calcPages(),this.onChangeStore(e)},setCls(){const e=this,s=e.widget;switch(e.barType){case"bbar":s.panel.el.select("."+i).addCls(n);break;case"tbar":s.panel.el.select("."+t).addCls(n);break;case"both":s.panel.el.select("."+i).addCls(n),s.panel.el.select("."+t).addCls(n)}}})}(),Fancy.define("Fancy.grid.plugin.LoadMask",{extend:Fancy.Plugin,ptype:"grid.loadmask",inWidgetName:"loadmask",cls:"fancy-loadmask",innerCls:"fancy-loadmask-inner",imageCls:"fancy-loadmask-image",textCls:"fancy-loadmask-text",constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){const e=this,t=e.widget,i=t.store;t.once("render",()=>{e.render(),i.loading&&e.onBeforeLoad(),t.on("beforeload",e.onBeforeLoad,e),t.on("load",e.onLoad,e)})},render(){var e,t,i=this,n=i.widget,s=n.el,r=Fancy.newEl("div"),o=n.lang;n.panel&&(s=n.panel.el),e=s.width(),t=s.height(),r.addCls(i.cls),"default"!==n.theme&&r.addCls(Fancy.getThemeCSSCls(n.theme)),r.css({width:e,height:t,opacity:0}),i.loadText?r.update(['<div class="'+i.innerCls+'"><div class="'+i.textCls+'">'+i.loadText+"</div></div>"].join(" ")):r.update(['<div class="'+i.innerCls+'"><div class="'+i.imageCls+'"></div><div class="'+i.textCls+'">'+o.loadingText+"</div></div>"].join(" ")),i.el=Fancy.get(s.dom.appendChild(r.dom)),i.innerEl=i.el.select("."+i.innerCls),i.textEl=i.el.select("."+i.textCls);var a=i.innerEl.width(),l=i.innerEl.height(),d=e/2-a/2;d<10&&(i.intLeft=setInterval(function(){"none"===i.el.css("display")&&clearInterval(i.intLeft),a=i.innerEl.width(),l=i.innerEl.height(),(d=e/2-a/2)<10||(i.innerEl.css({left:d}),clearInterval(i.intLeft))},100)),i.innerEl.css({left:d,top:t/2-l/2}),!0!==n.store.loading?r.css("display","none"):!1===i.showOnWaitingServer?r.css("display","none"):r.css("display","block")},onBeforeLoad(){this.showOnWaitingServer&&this.show()},onLoad(){const e=this,t=e.widget;e.showOnWaitingServer&&t.once("update",()=>e.hide())},show(e){const t=this,i=t.el,n=t.widget.lang;if(i.stop(),i.css("opacity",1),t.el.css("display","block"),t.updateSize(),e)return t.textEl.update(e),void t.el.css("display","block");t.loaded=!1,setTimeout(()=>{!0!==t.loaded&&(t.textEl.update(t.loadText||n.loadingText),t.el.css("display","block"))},50)},hide(){const e=this,t=e.el;t.stop(),t.css("opacity",1),t.animate({opacity:0,force:!0},{complete(){e.loaded=!0,t.css("display","none")}})},updateSize(){const e=this,t=e.widget,i=t.getWidth(),n=t.getHeight();e.el.css({height:n,width:i});const s=i/2-Math.abs(e.innerEl.width())/2,r=n/2-Math.abs(e.innerEl.height())/2;e.innerEl.css({left:s,top:r})}}),function(){const e=Fancy,t=e.get,i=e.FIELD_CLS,n=e.GRID_RESIZER_LEFT_CLS,s=e.GRID_RESIZER_RIGHT_CLS,r=e.GRID_HEADER_CELL_TRIGGER_CLS,o=e.GRID_HEADER_CELL_TRIGGER_IMAGE_CLS,a=e.GRID_HEADER_CELL_CLS,l=e.GRID_COLUMN_RESIZER_CLS,d=e.GRID_COLUMN_CLS,c=e.GRID_HEADER_CELL_GROUP_LEVEL_2_CLS,h=e.GRID_STATE_RESIZE_COLUMN_CLS,u=e.ANIMATE_DURATION,g=`.${a}`;e.define("Fancy.grid.plugin.ColumnResizer",{extend:e.Plugin,ptype:"grid.columnresizer",inWidgetName:"columnresizer",constructor:function(){this.Super("const",arguments)},init(){const e=this,t=e.widget;e.Super("init",arguments),t.header&&t.on("render",function(){e.render(),e.ons()})},ons(){const e=this,t=e.widget;t.on("headercellmousemove",e.onCellMouseMove,e),t.on("headercellmousedown",e.onHeaderCellMouseDown,e),t.on("docclick",e.onDocClick,e),t.on("docmove",e.onDocMove,e),t.on("docmouseup",e.onDocMouseUp,e)},onCellMouseMove(e,n){var s=this,a=s.widget,l=n.e,d=t(n.cell),c=l.offsetX,h=d.width(),u=t(l.target),g=u.hasCls(r),p=u.hasCls(o),m=d.select("."+r).item(0),f=d.select("."+o).item(0),y=t(l.target).closest("."+i).hasCls(i),C=parseInt(m.css("width")),v=parseInt(f.css("width")),w=h,b=7;if(g&&(w=C),p&&(w=v),!a.startResizing)if(p)s.removeCellResizeCls(n.cell);else if("left"===n.side&&n.index===a.leftColumns.length-1&&w-c<b+2&&(b+=2),!g&&!p&&"right"===n.side&&0===n.index&&c<b)s.isColumnResizable(n)&&(y||s.addCellResizeCls(n.cell));else if(!g&&!p&&c<b&&"center"===n.side&&0===n.index&&a.leftColumns.length)n.side="left",n.index=a.leftColumns.length-1,s.isColumnResizable(n)&&(y||s.addCellResizeCls(n.cell));else if(g||p||!(w-c<b||c<b)||0===n.index)w-c<b?p?v-c>2?s.removeCellResizeCls(n.cell):s.addCellResizeCls(n.cell):s.isColumnResizable(n)&&s.addCellResizeCls(n.cell):s.removeCellResizeCls(n.cell);else{const e=c<b;s.isColumnResizable(n,e)&&(y||s.addCellResizeCls(n.cell))}},addCellResizeCls(e){const i=this.widget.columndrag;i&&"dragging"===i.status||(t(e).addCls(l),t(e).select("."+r).addCls(l))},removeCellResizeCls(e){t(e).removeClass(l),t(e).select("."+r).item(0).removeClass(l)},onHeaderCellMouseDown(n,s){n=s.e;var a=this,l=a.widget,d=t(n.target),c=t(s.cell),h=n.offsetX,u=c.width(),g=c.select("."+i),p=d.hasCls(r),m=d.hasCls(o),f=c.select("."+r).item(0),y=c.select("."+o).item(0),C=parseInt(f.css("width")),v=parseInt(y.css("width")),w=u,b=7;p&&(w=C),m?w=v:g.length>0&&g.item(0).within(d.dom)||("left"===s.side&&s.index===l.leftColumns.length-1&&w-h<b+2&&(b+=2),!p&&!m&&"right"===s.side&&0===s.index&&h<b?(l.startResizing=!0,e.apply(a,{cell:s.cell,activeSide:s.side,clientX:n.clientX,columnIndex:s.index,moveLeftResizer:!0})):h<7&&"center"===s.side&&0===s.index&&l.leftColumns.length?(l.startResizing=!0,s.side="left",s.index=l.leftColumns.length-1,e.apply(a,{cell:a.getCell(s),activeSide:s.side,clientX:n.clientX,columnIndex:s.index})):!p&&!m&&h<b&&0!==s.index?(l.startResizing=!0,e.apply(a,{cell:a.getPrevCell(s),activeSide:s.side,clientX:n.clientX,columnIndex:s.index-1})):w-h<b&&(l.startResizing=!0,e.apply(a,{cell:s.cell,activeSide:s.side,clientX:n.clientX,columnIndex:s.index})),l.startResizing&&a.isColumnResizable())},isColumnResizable(e,t){var i,n,s,r=this,o=r.widget;if(e){if(i=o.getColumns(e.side),s=e.index,t&&(n=i[--s],s>0&&i[s].hidden&&s--),isNaN(s))return;return n=i[s],!(0===s&&n.hidden&&("center"!==e.side||!o.leftColumns))&&(!n.hidden&&!0===n.resizable)}!0!==(i=o.getColumns(r.activeSide))[r.columnIndex].resizable&&(o.startResizing=!1,delete r.cell,delete r.activeSide,delete r.clientX,delete r.columnIndex)},getMinColumnWidth(){var e,t=this.widget,i=t.minCellWidth;return void 0===this.columnIndex?i:(e=t.getColumns(this.activeSide)[this.columnIndex]).minWidth?e.minWidth:i},getMaxColumnWidth(){var e,t=this.widget;return void 0!==this.columnIndex&&(!!(e=t.getColumns(this.activeSide)[this.columnIndex]).maxWidth&&e.maxWidth)},onDocClick(){this.widget.startResizing=!1},onDocMove(e,t){this.widget.startResizing&&this.moveResizeEls(t)},render(){const i=this.widget,r=e.newEl("div"),o=e.newEl("div");r.addCls(n),o.addCls(s),this.leftEl=t(i.el.dom.appendChild(r.dom)),this.rightEl=t(i.el.dom.appendChild(o.dom))},moveResizeEls(i){var n=this,s=n.widget,r=t(n.cell),o=parseInt(r.css("left")),a=n.getMinColumnWidth(),l=n.getMaxColumnWidth();switch(s.header.hideMenu&&s.header.hideMenu(),s.el.addCls(h),e.get(document.body).addCls(h),n.activeSide){case"left":break;case"center":o+=parseInt(s.leftEl.css("width"));break;case"right":o+=parseInt(s.leftEl.css("width")),o+=parseInt(s.centerEl.css("width"))}var d=i.clientX,c=d-n.clientX,u=r.width()+c;u<a&&(u=a),l&&u>l&&(u=l),n.deltaWidth=r.width()-u,n.moveLeftResizer?(c=d-n.clientX,(u=r.width()-c)<a&&(u=a),n.deltaWidth=r.width()-u,n.leftEl.css({display:"block",left:o+c+"px"}),n.rightEl.css({display:"block",left:o+r.width()-1+"px"})):(n.leftEl.css({display:"block",left:o+"px"}),n.rightEl.css({display:"block",left:o+u+"px"})),n.cellWidth=u},onDocMouseUp(){const t=this,i=t.widget;!1!==i.startResizing&&(i.el.removeCls(h),e.get(document.body).removeCls(h),t.leftEl.css({display:"none"}),t.rightEl.css({display:"none"}),t.fixSidesWidth(),i.startResizing=!1,t.moveLeftResizer=!1,delete t.cellWidth,i.scroller.update())},fixSidesWidth(){var i,n,s,r,o=this,a=o.widget,l=o.cellWidth,h=o.columnIndex,p=o.deltaWidth,m=a.leftEl,f=a.centerEl,y=a.rightEl,C=a.leftHeader.el,v=a.header.el,w=a.rightHeader.el,b=a.body.el,S={},x={},I=o.minCenterWidth;if(void 0!==l){var E=1;switch(e.nojQuery&&(E=0),o.activeSide){case"left":if((r=parseInt(f.css("width"))+p+E)<I)return;s=a.leftColumns[h],a.leftColumns[o.columnIndex].width=l,i=a.leftBody.el.select("."+d),n=a.leftHeader.el.select(g),(A=i.item(h)).animate({width:l},u),A.css("overflow","");for(var T=o.columnIndex+1,F=n.length,L=0,_=T;L<_;L++){(B=(k=n.item(L)).attr("group-index"))&&(x[B]=!0)}for(;T<F;T++){var D=i.item(T),k=n.item(T);D.animate({left:parseInt(D.css("left"))-p-E},u),k.hasCls(c)&&x[k.attr("index")]||k.animate({left:parseInt(k.css("left"))-p-E},u)}m.animate({width:parseInt(m.css("width"))-p-E},u),C.animate({width:parseInt(C.css("width"))-p-E+"px"},u),a.columns.length&&(f.animate({left:parseInt(f.css("left"))-p-E,width:r},u),v.animate({width:parseInt(v.css("width"))+p+E},u),b.animate({width:parseInt(b.css("width"))+p+E},u));break;case"center":s=a.columns[h],a.columns[o.columnIndex].width=l,i=a.body.el.select("."+d),n=a.header.el.select(g),(A=i.item(h)).animate({width:l},u),A.css("overflow","");for(T=o.columnIndex+1,F=n.length,L=0,_=T;L<_;L++){(B=(k=n.item(L)).attr("group-index"))&&(x[B]=!0)}for(;T<F;T++){D=i.item(T),k=n.item(T);var R=parseInt(D.css("left"))-p-E,M=parseInt(k.css("left"))-p-E;k.attr("group-index")&&(S[k.attr("group-index")]={}),D.animate({left:R},u),k.hasCls(c)&&x[k.attr("index")]||k.animate({left:M},u)}break;case"right":if((r=parseInt(f.css("width"))+p+E)<I)return;var A;s=a.rightColumns[h],a.rightColumns[o.columnIndex].width=l,i=a.rightBody.el.select("."+d),n=a.rightHeader.el.select(g),(A=i.item(h)).animate({width:l+"px"},u),A.css("overflow","");for(T=o.columnIndex+1,F=n.length,L=0,_=T;L<_;L++){var B;(B=(k=n.item(L)).attr("group-index"))&&(x[B]=!0)}for(;T<F;T++){D=i.item(T),k=n.item(T);D.animate({left:parseInt(D.css("left"))-p-E},u),k.hasCls(c)&&x[k.attr("index")]||k.animate({left:parseInt(k.css("left"))-p-E},u)}y.animate({width:parseInt(y.css("width"))-p-E},u),w.animate({width:parseInt(w.css("width"))-p-E+"px"},u),a.columns.length&&(f.animate({width:r},u),v.animate({width:parseInt(v.css("width"))+p+E},u),b.animate({width:parseInt(b.css("width"))+p+E},u))}var O,N=t(o.cell),H=N.attr("group-index");if(N.animate({width:l+"px"},u),H)(O=a.el.select("[index='"+H+"']")).animate({width:parseInt(O.css("width"))-p-E},u);else for(var P in S)(O=a.el.select("[index='"+P+"']")).css("left",parseInt(O.css("left"))-(S[P].delta||0)-E);if(a.fire("columnresize",{cell:N.dom,width:l,column:s,side:o.activeSide}),/sparkline/.test(s.type))switch(o.activeSide){case"left":a.leftBody.updateRows(void 0,h);break;case"center":a.body.updateRows(void 0,h);break;case"right":a.rightBody.updateRows(void 0,h)}else switch(s.type){case"progressbar":case"hbar":a.update()}}},getPrevCell(t){var i,n=this.widget;switch(t.side){case"left":i=n.leftHeader;break;case"center":i=n.header;break;case"right":i=n.rightHeader}const s=i.el.select(g).item(t.index-1).dom;return"none"===e.get(s).css("display")&&0!==t.index?(t.cell=s,t.index--,this.getPrevCell(t)):s},getCell(e){var t,i=this.widget;switch(e.side){case"left":t=i.leftHeader;break;case"center":t=i.header;break;case"right":t=i.rightHeader}return t.el.select(g).item(e.index).dom},updateColumnsWidth:function(t){if("all"===t)return this.updateColumnsWidth("left"),this.updateColumnsWidth("right"),void this.updateColumnsWidth("center");var i=1;e.nojQuery&&(i=0);for(var n=this.widget,s=(t=t||"center",n.getHeader(t)),r=n.getBody(t),o=n.getColumns(t),a=0,l=o.length,d=0,c=n.leftEl,h=n.rightEl,g=n.leftHeader.el,p=n.rightHeader.el;a<l;a++){const e=o[a];e.hidden||(d+=e.width,this.setColumnWidth(a,e.width,t))}switch(n.header&&(s.setCellsPosition(),s.updateCellsSizes()),r.updateColumnsSizes(),t){case"center":break;case"left":var m=parseInt(c.css("width")),f=parseInt(g.css("width")),y=m-d;c.animate({width:m-y-i},u),g.animate({width:f-y-i},u),n.columns.length&&this.updateCenterSideWidth();break;case"right":var C=parseInt(c.css("width"));f=parseInt(g.css("width")),y=C-d;h.animate({width:C-y},u),p.animate({width:f-y},u),n.columns.length&&this.updateCenterSideWidth()}},updateCenterSideWidth(){var t=this.widget,i=t.centerEl,n=t.header.el,s=t.body.el,r=0,o=0,a=t.getColumns("left"),l=t.getColumns("right"),d=t.width;t.panel?(d-=t.panelBodyBorders[1],d-=t.panelBodyBorders[3],d-=t.gridBorders[1],d-=t.gridBorders[3]):(d-=t.gridWithoutPanelBorders[1],d-=t.gridWithoutPanelBorders[3]);var c=1;e.nojQuery&&(c=0),e.each(a,e=>{e.hidden||(r+=e.width)}),e.each(l,e=>{e.hidden||(o+=e.width)}),d-=r,d-=o,d+=c,i.animate({left:r-c,width:d},u),i.animate({width:d},u),n.animate({width:d},u),s.animate({width:d},u)},setColumnWidth(e,i,n="center"){var s,r,o=this.widget,a=o.getColumns(n),l=o.getBody(n),d=t(l.getDomColumn(e));(o.header&&(s=o.getHeader(n).getCell(e)),parseInt(d.css("width"))!==i)&&(o.header&&(r=s.dom),o.fire("columnresize",{cell:r,width:i,column:a[e],side:n}))},getNextVisibleIndex(e,t){for(var i=this.widget.getColumns(t),n=e+1,s=i.length;n<s;n++){if(!i[n].hidden)return n}}})}(),Fancy.modules["column-drag"]=!0,function(){const e=Fancy,t=e.get(document),i=e.HIDDEN_CLS,n=e.GRID_HEADER_CELL_CLS,s=e.GRID_HEADER_CELL_TEXT_CLS,r=e.GRID_HEADER_CELL_TRIGGER_CLS,o=e.GRID_HEADER_CELL_TRIGGER_IMAGE_CLS,a=e.GRID_HEADER_CELL_GROUP_LEVEL_1_CLS,l=e.GRID_HEADER_CELL_GROUP_LEVEL_2_CLS,d=e.GRID_STATE_DRAG_COLUMN_CLS,c=e.FIELD_TEXT_INPUT_CLS,h=e.FIELD_CHECKBOX_INPUT_CLS,u=`div.${n}`;e.define("Fancy.grid.plugin.ColumnDrag",{extend:e.Plugin,ptype:"grid.columndrag",inWidgetName:"columndrag",activeSide:void 0,activeCell:void 0,activeIndex:void 0,activeColumn:void 0,inCell:void 0,inIndex:void 0,inSide:void 0,ok:!1,status:"none",constructor:function(){this.Super("const",arguments)},init(){const e=this,t=e.widget;e.Super("init",arguments),t.on("render",()=>{e.ons(),e.initHint()})},ons(){this.widget.el.on("mousedown",this.onMouseDownCell,this,u)},onMouseDownCell(i){const n=this,s=n.widget,d=Fancy.get(i.currentTarget),g=Number(d.attr("index")),p=s.getSideByCell(d),m=s.getColumns(p),f=m[g],y=e.get(i.target);f&&f.titleEditable||y.hasCls(r)||y.hasCls(o)||y.hasCls(c)||y.hasCls(h)||(d.hasCls(l)&&(n.activeCellTopGroup=n.getGroupStartEnd(d,p),n.activeCellTopGroup.cell=d),s.startResizing||(n.activeCellTopGroup||!1!==f.draggable)&&(d.hasCls(a)&&(n.activeUnderGroup=!0),n.activeSide=p,n.inSide=p,n.activeCell=d,n.inCell=d,n.activeIndex=Number(d.attr("index")),n.inIndex=n.activeIndex,n.activeColumn=m[n.activeIndex],n.mouseDownX=i.pageX,n.mouseDownY=i.pageY,t.once("mouseup",n.onMouseUp,n),t.on("mousemove",n.onMouseMove,n),s.el.on("mouseleave",n.onMouseLeave,n),s.el.on("mouseenter",n.onMouseEnterCell,n,u),s.el.on("mousemove",n.onMouseMoveCell,n,u)))},onMouseLeave(){this.hideHint()},onMouseUp(){var i,n=this,s=n.widget,r=!1;t.un("mousemove",n.onMouseMove,n),s.el.un("mouseleave",n.onMouseLeave,n),s.el.un("mouseenter",n.onMouseEnterCell,n,u),s.el.un("mousemove",n.onMouseMoveCell,n,u),n.ok&&(n.fire("beforecolumndrag"),n.inSide===n.activeSide?n.dragColumn(n.inSide):(n.activeSide,i=n.inIndex,"right"===n.okPosition&&i++,s.moveColumn(n.activeSide,n.inSide,n.activeIndex,i,n.activeCellTopGroup)),r=!0);const o={column:n.activeColumn,fromSide:n.activeSide,toSide:n.inSide};delete n.inUpGroupCell,delete n.inUnderGroup,delete n.activeCellTopGroup,delete n.activeUnderGroup,delete n.activeSide,delete n.inSide,delete n.inCell,delete n.inIndex,delete n.activeCell,delete n.activeIndex,delete n.activeColumn,delete n.mouseDownX,delete n.mouseDownY,n.ok=!1,delete n.okPosition,e.tip.hide(),setTimeout(function(){n.status="none"},1),n.removeDragState(),"dragging"===n.status&&setTimeout(()=>{n.status="none",r&&(s.fire("columndrag",o),s.sorter&&s.sorter.updateSortedHeader(),n.updateColumnHeaderLImages(),n.clearColumnMenus())},10),n.hideHint(),setTimeout(()=>{s.updateColumnsVisibility()},100),s.scroller.update()},onMouseMove(t){const i=this,n=i.widget,a=n.header,l=n.leftHeader,d=n.rightHeader,c=t.pageX,h=t.pageY,u=n.getColumns(i.activeSide),g=e.get(t.target);if(!g.hasCls(r)&&!g.hasCls(o)&&(Math.abs(c-i.mouseDownX)>10||Math.abs(h-i.mouseDownY))){if(i.activeCellTopGroup?(e.tip.update(i.activeCellTopGroup.cell.select("."+s).item(0).dom.innerHTML||"&nbsp;"),i.status="dragging",i.addDragState()):(e.tip.update(i.activeColumn.title||"&nbsp;"),i.status="dragging",i.addDragState()),1===u.length&&"center"===i.activeSide)return e.tip.hide(),setTimeout(()=>{i.status="none"},1),void i.removeDragState();e.tip.show(t.pageX+15,t.pageY+15),a.hideMenu&&(a.hideMenu(),n.leftColumns&&l.hideMenu()&&l.hideMenu(),n.rightColumns&&d.hideMenu()&&d.hideMenu())}},addDragState(){this.widget.el.addClass(d)},removeDragState(){this.widget.el.removeClass(d)},onMouseEnterCell(e){const t=this,i=t.widget,n=Fancy.get(e.currentTarget),s=i.getSideByCell(n);var r;(t.hideHint(),n.hasCls(a)?t.inUnderGroup=!0:delete t.inUnderGroup,n.hasCls(l)?t.inUpGroupCell=n:delete t.inUpGroupCell,t.inSide=s,t.inCell=n,t.inUpGroupCell)?(i.getHeader(s).el.select('[group-index="'+n.attr("index")+'"]').each(e=>{"none"!==e.css("display")&&void 0===r&&(r=Number(e.attr("index")))}),t.inIndex=r):t.inIndex=Number(n.attr("index"))},onMouseMoveCell(e){const t=this,i=t.widget,n=t.inCell,s=parseInt(n.css("width")),o=n.select(`.${r}`);if(!o.dom)return;const a=Fancy.get(e.target),l=o.within(a)||a.hasClass(r),d=t.activeUnderGroup!==t.inUnderGroup&&!0===t.inUnderGroup,c=t.activeUnderGroup!==t.inUnderGroup&&!0===t.activeUnderGroup,h=i.getColumns(t.activeSide);if(1===h.length&&"center"===t.activeSide)return t.ok=!1,void t.hideHint();if(t.activeCellTopGroup)if(t.inUpGroupCell);else{var u=t.activeCellTopGroup.start,g=t.activeCellTopGroup.end;t.activeSide!==t.inSide?(t.ok=!0,e.offsetX>s/2||l?t.showHint("right"):t.showHint("left")):isNaN(t.inIndex)?t.hideHint():t.inIndex<u?e.offsetX>s/2?t.inIndex+1===u?t.hideHint():(t.ok=!0,t.showHint("right")):(t.ok=!0,t.showHint("left")):t.inIndex>g?e.offsetX<s/2?t.inIndex===g+1?t.hideHint():(t.ok=!0,t.showHint("left")):(t.ok=!0,t.showHint("right")):t.hideHint()}else if(t.inUpGroupCell){var p=t.getGroupStartEnd();u=p.start,g=p.end;t.activeSide!==t.inSide?(t.ok=!0,e.offsetX>s/2||l?t.showHint("right"):t.showHint("left")):e.offsetX>s/2?t.activeIndex>g&&t.activeIndex-1===g?t.hideHint():(t.ok=!0,t.showHint("right")):t.activeIndex<u&&t.activeIndex+1===u?t.hideHint():(t.ok=!0,t.showHint("left"))}else if(t.activeSide!==t.inSide)t.ok=!0,e.offsetX>s/2||l?t.showHint("right"):t.showHint("left");else if(t.activeIndex===t.inIndex)t.ok=!1;else if(t.activeIndex<t.inIndex){if(e.offsetX>s/2||l)h[t.inIndex].disallowAfterDrop||(t.ok=!0,t.showHint("right"));else e.offsetX<s/2&&t.activeIndex+1!==t.inIndex?(t.ok=!0,t.showHint("left")):t.activeIndex+1===t.inIndex&&(d||c)?(t.ok=!0,t.showHint("left")):(t.ok=!1,t.hideHint())}else t.activeIndex>t.inIndex&&(e.offsetX<s/2?l?d||c?(t.ok=!0,t.showHint("right")):t.activeIndex-1===t.inIndex||t.inUpGroupCell?(t.ok=!1,t.hideHint()):(t.ok=!0,t.showHint("right")):(t.ok=!0,t.showHint("left")):e.offsetX>s/2?t.activeIndex-1===t.inIndex&&(d||c)?(t.ok=!0,t.showHint("right")):t.activeIndex-1!==t.inIndex||t.activeUnderGroup?(t.ok=!0,t.showHint("right")):(t.ok=!1,t.hideHint()):(t.ok=!1,t.hideHint()))},showHint(t){const n=this,s=n.widget,r=s.cellHeaderHeight,o=n.inCell,a=n.topEl,l=n.bottomEl,d=o.offset(),c=parseInt(o.css("width")),h=parseInt(o.css("height"));n.okPosition=t,a.removeCls(i),l.removeCls(i);var u=0;"right"===t&&(u+=c),a.css({left:d.left+u-Math.ceil(parseInt(a.css("width"))/2),top:d.top-parseInt(a.css("height"))});var g=d.top+h;if(n.inUpGroupCell){const e=s.header.calcRows();g=d.top+e*r}if(l.css({left:d.left+u-Math.ceil(parseInt(l.css("width"))/2),top:g}),s.window){const t=1e3+e.zIndex++;a.css("z-index",t),l.css("z-index",t)}},hideHint(){this.topEl.addCls(i),this.bottomEl.addCls(i)},initHint(){const t=this.widget,n=Fancy.getThemeCSSCls(t.theme),s=e.get(document.body).dom,r=e.newEl("div"),o=e.newEl("div");r.addCls("fancy-drag-hint-top",i,n),o.addCls("fancy-drag-hint-bottom",i,n),this.topEl=e.get(s.appendChild(r.dom)),this.bottomEl=e.get(s.appendChild(o.dom))},dragColumn(e){var t=this,i=t.widget,n=i.getHeader(e),s=i.getBody(e),r=t.activeIndex,o=t.inIndex,a=t.okPosition,l=i.getColumns(e),d=l[r],c=n.calcRows();if(t.activeCellTopGroup){const n=t.activeCellTopGroup.start,s=t.activeCellTopGroup.end,r=l.splice(n,s-n+1);o=t.inIndex,"right"===a&&o++,l=t.inIndex<n?Fancy.Array.insert(l,o,r):Fancy.Array.insert(l,o-r.length,r),i.setColumnsLinksToSide(l,e)}else if(t.inUpGroupCell){const e=t.getGroupStartEnd();o=e.start,"right"===a&&(o=e.end+1)}else if("right"===a)if(t.inUnderGroup){const e=l[o].grouping,t=l[o+1];t&&t.grouping===e&&o++}else o++;if(i.groupheader&&!t.activeCellTopGroup){const e=l[o];e&&e.grouping&&t.inUnderGroup?(d.grouping=e.grouping,d.filter&&d.filter.header&&c<3&&delete d.filter):delete d.grouping}t.activeCellTopGroup||(l.splice(r,1),r<o&&o--,l.splice(o,0,d)),s.clearColumnsStyles(),n.updateTitles(),n.updateCellsSizes(),n.reSetCheckBoxes(),setTimeout(()=>{i.groupheader&&(i.header.fixGroupHeaderSizing(),i.leftColumns&&i.leftHeader.fixGroupHeaderSizing(),i.rightColumns&&i.rightHeader.fixGroupHeaderSizing(),n.reSetGroupIndexes()),n.reSetColumnsAlign(),n.reSetColumnsCls(),s.reSetColumnsAlign(),s.reSetColumnsCls(),s.updateColumnsSizes()},100),i.update()},getGroupStartEnd(t,i){const n=this.widget.getHeader(i||this.inSide),s=(t||this.inUpGroupCell).attr("index"),r=[];return n.el.select(`[group-index="${s}"]`).each(e=>{r.push(Number(e.attr("index")))}),{start:e.Array.min(r),end:e.Array.max(r)}},clearColumnMenus(){const t=this.widget;e.each(t.columns,t=>{e.isObject(t.menu)&&t._menu&&(t.menu=t._menu,delete t._menu)})},updateColumnHeaderLImages(){const e=this.widget;e.header&&(e.header.updateLImages(),e.leftColumns.length&&e.leftHeader.updateLImages(),e.rightColumns.length&&e.rightHeader.updateLImages())}})}(),Fancy.modules["chart-integration"]=!0,Fancy.define("Fancy.grid.plugin.ChartIntegration",{extend:Fancy.Plugin,ptype:"grid.chartintegration",inWidgetName:"chartintegration",constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.initKeys(),this.initBind(),this.ons()},initKeys(){for(var e=this.chart,t=0,i=e.length;t<i;t++){var n,s=e[t].fields,r=0,o={};if(Fancy.isString(s))o=s;else for(n=s.length;r<n;r++)o[s[r]]=!0;e[t].keys=o}},ons(){const e=this,t=e.widget,i=t.store;t.once("render",()=>{e.toChart?e.renderToChart():e.readDataFromChart(),i.on("set",e.onSet,e),i.on("sort",e.onSort,e)})},renderToChart(){for(var e=this.widget,t=this.chart,i=0,n=t.length;i<n;i++){const n=t[i];switch(n.type){case"highchart":case"highcharts":e.highchart.setData(n)}}},onSet(e,t){for(var i=this.widget,n=this.chart,s=0,r=n.length,o=t.key;s<r;s++){const e=n[s],r=e.type;if(!0===e.keys[o])switch(r){case"highchart":case"highcharts":i.highchart.set(e,t)}}},onSort(e,t){for(var i=this.widget,n=this.chart,s=0,r=n.length;s<r;s++){const e=n[s];switch(e.type){case"highchart":case"highcharts":if(!1!==e.sortBind){const r=i.highchart.sort(e,t);n[s].categories=r.original}}}},readDataFromChart(){var e,t=this.widget,i=t.store,n=this.chart[0];switch(n.type){case"highchart":case"highcharts":e=t.highchart.getData(n)}t.reConfigStore(e),i.setData(e)},initBind(){for(var e,t=this.chart,i=0,n=t.length;i<n;i++)(e=t[i]).bind&&this.chartBind(e)},chartBind(e){const t=this.widget,i=e.bind;t.on(i.event,this.onBindEvent,{chart:e})},onBindEvent(e,t){const i=e,n=this.chart,s=n.bind,r=s.series,o=t.data,a=n.id;switch(s.action){case"add":var l=i.highchart.doesSeriesExist(a,o[r.name]),d=i.highchart.getNumberSeries(a);if(!1!==l&&1!==d)return void i.highchart.removeSeries(a,l);n.maxToShow&&n.maxToShow<=d&&i.highchart.removeLastSeries(a),i.highchart.isTreeMap(a)?i.highchart.setSeriesData(a,{data:o[r.data]}):i.highchart.addSeries(a,{name:o[r.name],data:o[r.data]})}}}),Fancy.define("Fancy.grid.plugin.HighChart",{extend:Fancy.Plugin,ptype:"grid.highchart",inWidgetName:"highchart",constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){},setData(e){var t=this.widget.store.getDataView(),i=e.fields,n=0,s=t.length,r=0,o=i.length,a=this.getChart(e.id).series,l=e.read;if(l&&void 0!==l.rowIndex&&(t=[t[l.rowIndex]],o=1),Fancy.isString(i))for(;r<o;r++){var d=t[r][i],c=a[r],h=[];n=0,s=d.length;if(e.names)for(;n<s;n++){var u={name:e.names[n],value:d[n]};h.push(u)}else for(;n<s;n++)h.push(d[n]);if(!c)break;c.setData(h),e.name&&c.update({name:t[r][e.name]})}else for(;r<o;r++){var g=i[r];c=a[r],h=[];for(n=0;n<s;n++)h.push(t[n][g]);c.setData(h)}},setSeriesData(e,t){this.getChart(e).series[0].setData(t.data)},set(e,t){var i=this.getFieldsMap(e);this.getChart(e.id).series[i[t.key]].data[t.rowIndex].update(Number(t.value))},sort(e){var t=this.widget.store,i=this.getChart(e.id),n=e.categories?e.categories:i.xAxis[0].categories,s=t.order,r=[],o=0,a=s?s.length:n.length;if(s)for(;o<a;o++)r.push(n[s[o]]);else for(;o<a;o++)r.push(n[o]);return i.xAxis[0].update({categories:r},!0),this.update(e),{original:n,newCategories:r}},update(e){for(var t,i=this.widget.store.getDataView(),n=e.fields,s=0,r=i.length,o=0,a=this.getChart(e.id),l=a.series,d=[],c=0,h=n.length;c<h;c++){const e=n[c];s=0;const t=[];for(;s<r;s++)t.push(i[s][e]);d.push(t)}for(t=l.length;o<t;o++){l[o].setData(d[o],!1)}a.redraw()},getData(e){for(var t=this.getChart(e.id),i=i=e.fields,n=0,s=i.length,r=t.series,o=r[0].data.length,a=[];n<s;n++)for(var l=i[n],d=0,c=r[n];d<o;d++)void 0===a[d]&&(a[d]={}),a[d][l]=c.data[d].y;const h=this.getColumnsChartIndexes();for(n=0,s=h.length;n<s;n++){const e=h[n],i=e.split("."),s=t[i[0]][0][i[1]];for(d=0,o=s.length;d<o;d++)a[d][e]=s[d]}return a},getColumnsChartIndexes(){for(var e=[],t=this.widget.columns,i=0,n=t.length;i<n;i++){const n=t[i].index;/xAxis\../.test(n)&&e.push(n)}return e},getFieldsMap(e){for(var t={},i=e.fields,n=0,s=i.length;n<s;n++)t[i[n]]=n;return t},addSeries(e,t){this.getChart(e).addSeries(t)},getNumberSeries(e){return this.getChart(e).series.length},removeLastSeries(e){const t=this.getChart(e);t.series[t.series.length-1].remove()},removeSeries(e,t){this.getChart(e).series[t].remove()},doesSeriesExist(e,t){for(var i=this.getChart(e),n=0,s=i.series.length;n<s;n++)if(i.series[n].name===t)return n;return!1},isTreeMap(e){const t=this.getChart(e);return void 0!==t.series[0]&&"treemap"===t.series[0].type},getChart(e){var t;return Highcharts.charts.forEach((i,n)=>{i.renderTo.id===e&&(t=i)}),t}}),Fancy.modules.edit=!0,Fancy.define("Fancy.grid.plugin.Edit",{extend:Fancy.Plugin,ptype:"grid.edit",inWidgetName:"edit",clicksToEdit:2,tabColumnsSupport:{date:!0,combo:!0,image:!0,number:!0,string:!0,text:!0},constructor:function(){this.Super("const",arguments)},init(){const e=this,t=e.widget,i=t.store;e.addEvents("tab"),e.Super("init",arguments),t.once("render",()=>{e.ons(),i.on("beforeupdate",e.onStoreCRUDBeforeUpdate,e),i.on("update",e.onStoreCRUDUpdate,e),i.on("beforedestroy",e.onStoreCRUDBeforeDestroy,e),i.on("destroy",e.onStoreCRUDDestroy,e),i.on("create",e.onCreate,e)})},ons(){const e=this,t=e.widget,i=t.store,n="cell"+e.getClickEventName();t.on("cellclick",e.onClickCell,e),i.on("set",e.onStoreSet,e),e.on("tab",e.onTab,e),t.once("init",()=>{"cell"!==n&&t.on(n,e.onClickCellToEdit,e)}),t.on("activate",e.onGridActivate,e),t.on("deactivate",e.onGridDeActivate,e)},onGridActivate(){Fancy.get(document).on("keydown",this.onKeyDown,this)},onGridDeActivate(){Fancy.get(document).un("keydown",this.onKeyDown,this)},onKeyDown(e){const t=this.widget,i=e.keyCode,n=Fancy.key;switch(i){case n.TAB:this.fire("tab",e);break;case n.Z:t.undo()}},onTab(e,t){const i=e.widget;if(!e.activeCellEditParams)return;t.preventDefault();const n=e.getNextCellEditParam();i.celledit&&(i.celledit.hideEditor(),!1!==i.tabEdit&&setTimeout(()=>{i.celledit.edit(n)},100))},getNextCellEditParam(){const e=this,t=e.widget,i=t.store,n=e.activeCellEditParams,s=t.leftColumns;for(var r,o,a,l=n.columnIndex,d=n.rowIndex,c=n.side,h=t.getColumns(c),u=h[l+1],g=0;g<20;g++){const i=e.getNextCellInfo({side:c,columnIndex:l,rowIndex:d});if(c=i.side,l=i.columnIndex,d=i.rowIndex,u=(h=t.getColumns(c))[i.columnIndex],e.tabColumnsSupport[u.type]&&!0===u.editable&&!u.hidden)break}return(r=t.getBody(c).getCell(d,l).dom)||(c="center",s.length&&(c="left"),d=0,l=0,r=t.getBody(c).getCell(d,l).dom),o=u.index,{id:a=i.getId(d),side:c,column:u,cell:r,columnIndex:l,rowIndex:d,value:i.get(d,o),data:i.get(d),item:i.getById(a)}},getNextCellInfo(e){var t=this.widget,i=e.side,n=t.getColumns(i),s=e.columnIndex,r=e.rowIndex,o=n[s+1],a=t.rightColumns,l=t.leftColumns;if(o)s++;else switch(i){case"left":i="center",s=0;break;case"center":a.length?(i="right",s=0):l.length?(i="left",s=0,r++):(s=0,r++);break;case"right":l.length?(i="left",s=0,r++):(i="center",s=0,r++)}return{side:i,rowIndex:r,columnIndex:s}},getClickEventName(){switch(this.clicksToEdit){case 1:return"click";case 2:return"dblclick";case!1:return""}},stopEditor(){this.stopped=!0},onClickCell(e,t){const i=this.widget,n=t.column;n.editable&&("checkbox"===n.type||"switcher"===n.type)&&i.celledit&&i.celledit.onCheckBoxChange(t)},onClickCellToEdit(e,t){const i=this.widget,n=t.column;i.rowedit||i.celledit&&i.celledit.hideEditor(),i.rowedit?i.rowedit.edit(t):n.editable&&"checkbox"!==n.type&&"switcher"!==n.type&&i.celledit&&i.celledit.edit(t)},onStoreSet(e,t){this.widget.updater.updateRow(t.rowIndex)},onStoreCRUDBeforeUpdate(){const e=this.widget,t=this.activeCellEditParams;t&&e.updater.updateRow(t.rowIndex)},onStoreCRUDUpdate(e,t){delete e.changed[t],this.clearDirty()},onStoreCRUDBeforeDestroy(){},onStoreCRUDDestroy(){const e=this;clearInterval(e.intCrudDestroy),e.intCrudDestroy=setTimeout(()=>{e.widget.store.loadData(),e.clearDirty()},100)},clearDirty(){const e=this.widget;setTimeout(()=>{e.leftBody.clearDirty(),e.body.clearDirty(),e.rightBody.clearDirty()},500)},onCreate(e,t){const i=this.widget;i.updater.update(),i.fire("insert",t),this.clearDirty()}}),function(){const e=Fancy,t=e.GRID_CELL_CLS,i=e.GRID_ACTIVE_CELL_ENABLED;e.define("Fancy.grid.plugin.CellEdit",{extend:e.Plugin,ptype:"grid.celledit",inWidgetName:"celledit",editorsCls:"fancy-grid-editors",constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){const e=this,t=e.widget;t.once("render",()=>{e.initEditorContainer(),e.checkAutoInitEditors(),t.on("scroll",e.onScroll,e),t.on("nativescroll",e.onNativeScroll,e),t.on("docclick",e.onDocClick,e),t.on("headercellmousedown",e.onHeaderCellMouseDown,e)})},onDocClick(i,n){var s=this.activeCellEditParams,r=this.activeEditor,o=!0,a=n.target,l=e.get(a);if(void 0!==r&&"date"!==s.column.type)if("combo"===s.column.type)!1===r.el.within(a)&&!1===r.list.within(a)&&!0!==this.comboClick&&(o=!1),!1===o&&r.hide(),this.comboClick=!1;else{l.closest(`.${t}`).dom||r.el.within(a)||r.hide()}},initEditorContainer(){const e=this.widget;this.editorsContainer=e.el.select(`.${this.editorsCls}`)},edit(e){const t=this.widget,n=t.store,s=e.column;"$selected"!==s.index&&(t.selection&&t.selection.activeCell&&t.el.removeCls(i),this.activeCellEditParams=e,t.edit.activeCellEditParams=e,s.editor=this.generateEditor(s),n.infiniteScrolledToRow||t.scroller.scrollToCell(e.cell),this.showEditor(e))},generateEditor(t){let i,n,s=this,r=s.widget,o={position:"absolute",left:"0px",top:"0px",display:"none",padding:"0px"},a=t.type,l=t.vtype,d=r.theme;if(t.editor)return t.editor;const c={renderTo:n=s.editorsContainer.dom,label:!1,style:o,checkValidOnTyping:!0,column:t};switch(a){case"combo":var h="text",u="text",g=t.data,p=[{change:s.onComboChange,scope:s},{esc:s.onComboEsc,scope:s},{beforekey:s.onBeforeKey,scope:s},{"add-new-value":s.onComboAddNewValue,scope:s}];if(t.editorEvents)for(var m=0,f=t.editorEvents.length;m<f;m++)p.push(t.editorEvents[m]);void 0!==t.displayKey&&(h=t.displayKey,u=t.valueKey||h),"default"===d&&(d=void 0),t.minListWidth&&(c.minListWidth=t.minListWidth),t.subSearch&&(c.subSearch=t.subSearch),Fancy.apply(c,{theme:d,data:g,displayKey:h,valueKey:u,value:0,padding:!1,vtype:l,events:p}),t.emptyText&&(c.emptyText=t.emptyText),t.displayTpl&&(c.displayTpl=t.displayTpl),t.listItemTpl&&(c.listItemTpl=t.listItemTpl),t.leftTpl&&(c.leftTpl=t.leftTpl),t.leftWidth&&(c.leftWidth=t.leftWidth),i=new e.Combo(c);break;case"text":i=new e.TextArea({renderTo:n,label:!1,style:o,vtype:l,checkValidOnTyping:!0,events:[{enter:s.onEditorEnter,scope:s},{esc:s.onEditorEsc,scope:s},{beforehide:s.onEditorBeforeHide,scope:s},{blur:s.onBlur,scope:s},{beforekey:s.onBeforeKey,scope:s}]});break;case"image":case"string":case"tree":case"color":i=new e.StringField({renderTo:n,label:!1,style:o,vtype:l,format:t.format,checkValidOnTyping:!0,events:[{enter:s.onEditorEnter,scope:s},{esc:s.onEditorEsc,scope:s},{beforehide:s.onEditorBeforeHide,scope:s},{blur:s.onBlur,scope:s},{beforekey:s.onBeforeKey,scope:s}]});break;case"number":case"currency":e.apply(c,{vtype:l,format:t.format,events:[{enter:s.onEditorEnter,scope:s},{esc:s.onEditorEsc,scope:s},{beforehide:s.onEditorBeforeHide,scope:s},{blur:s.onBlur,scope:s},{beforekey:s.onBeforeKey,scope:s}]}),void 0!==t.spin&&(c.spin=t.spin),void 0!==t.step&&(c.step=t.step),void 0!==t.min&&(c.min=t.min),void 0!==t.max&&(c.max=t.max),i=new e.NumberField(c);break;case"date":i=new e.DateField({renderTo:n,label:!1,style:o,format:t.format,lang:r.lang,i18n:r.i18n,vtype:l,theme:d,checkValidOnTyping:!0,events:[{enter:s.onEditorEnter,scope:s},{esc:s.onEditorEsc,scope:s},{beforehide:s.onEditorBeforeHide,scope:s},{blur:s.onBlur,scope:s},{beforekey:s.onBeforeKey,scope:s}]});break;case"checkbox":case"switcher":break;default:e.error("Type "+a+" editor does not exit")}return i},showEditor(e){const t=this,i=t.widget,n=e.column,s=n.type,r=n.editor,o=e.cell,a=t.getCellPosition(o),l=t.getCellSize(o);if(i.fire("beforeedit",e),!0!==i.edit.stopped){if("combo"===s&&(t.comboClick=!0),r)t.activeEditor=r,t.setEditorValue(e),""===e.value&&setTimeout(()=>{var e=r.get();""===e&&r.input&&(e=r.input.dom.value),r.validate(e)},1),0===e.rowIndex&&l.height++,n.minEditorWidth&&l.width<n.minEditorWidth&&(l.width=n.minEditorWidth),t.setEditorSize(l),r.show(),r.el.css(a),"combo"===s&&r.subSearch||r.focus(),r.input&&n.cellAlign&&(r.input.css("text-align",n.cellAlign),"date"===n.type&&"right"===n.cellAlign&&r.input.css("padding-right","23px")),"combo"===s&&(void 0!==e.value&&r.set(e.value,!1),r.subSearch&&r.showList()),i.fire("startedit",e);else if(!1!==n.editable&&n.index)switch(s){case"checkbox":case"switcher":i.setById(e.item.id,n.index,!e.value)}}else i.edit.stopped=!1},setEditorSize(e){const t=this;"field.combo"===t.activeEditor.wtype?t.activeEditor.size(e):t.activeEditor.setInputSize({width:e.width,height:e.height})},hideEditor(){var t,n,s,r=this,o=r.widget,a=o.store,l=r.activeCellEditParams,d=r.activeEditor;if(d&&d.isVisible()){if(o.fire("beforeendedit",l),o.selection&&o.selection.activeCell&&o.el.addCls(i),d){if(s=l.column,n=d.get(),l.column.beforeSaveFormat)switch(e.typeOf(l.column.beforeSaveFormat)){case"string":n=this.getBeforeSaveFormat(l.column.beforeSaveFormat)(n,l);break;case"function":n=l.column.beforeSaveFormat(n,l)}"server"===a.proxyType&&"combo"!==s.type&&(t=r.getActiveColumnKey(),""===(n=r.prepareValue(n))&&null===a.get(l.rowIndex,t)||a.set(l.rowIndex,t,n)),d.getValue()!==n&&d.setValue(n),d.hide(),d.hideErrorTip()}setTimeout(()=>{delete r.activeEditor,o.fire("endedit",l)},1),o.el.dom.scrollTop&&(o.el.dom.scrollTop=0)}},getCellPosition(t){const i=this.widget,n=e.get(t).offset(),s=i.el.offset(),r=parseInt(i.el.css("border-left-width")),o=parseInt(getComputedStyle(i.el.dom)["border-top-width"]),a=(i.panel&&e.nojQuery,1);return{left:parseInt(n.left)-parseInt(s.left)-1-r+"px",top:parseInt(n.top)-parseInt(s.top)-a-o+"px"}},getCellSize(t){const i=e.get(t);return{width:i.dom.clientWidth+2,height:i.dom.clientHeight+2}},setEditorValue(t){const i=this,n=i.activeEditor;if(t.column.editFormat)switch(e.typeOf(t.column.editFormat)){case"function":t.value=t.column.editFormat(t.value,t);break;case"string":t.value=i.getEditFormat(t.column.editFormat)(t.value,t)}switch(t.column.type){case"combo":-1!==n.valueIndex&&n.set(n.getValueKey(t.value),!1);break;case"date":t.value||(t.value="");const i=t.column.format,s=e.Date.parse(t.value,i.read,i.mode);n.set(s);break;default:n.set(t.value)}},onEditorEsc(){this.hideEditor()},onComboEsc(e){e.list&&"block"===e.list.css("display")||e.aheadList&&"block"===e.aheadList.css("display")||this.hideEditor()},onEditorEnter(){const t=this.widget,i=t.selection||{};if(this.hideEditor(),i.selectBottomCellAfterEdit){var n=t.selectCellDown();setTimeout(()=>{t.el.select(`.${e.GRID_CELL_OVER_CLS}`).removeCls(e.GRID_CELL_OVER_CLS)},1)}switch(i.continueEditOnEnter){case"right":(n=i.moveRight())&&setTimeout(()=>{t.editCell(n)},100);break;case"bottom":(n=i.moveDown())&&setTimeout(()=>{t.editCell(n)},100)}},onHeaderCellMouseDown(){this.hideEditor()},setValue(e){var t,i=this,n=i.widget,s=n.store,r=i.activeCellEditParams,o=i.activeEditor;void 0!==o&&!1!==o.isValid()&&"server"!==s.proxyType&&(n.rowheight&&setTimeout(function(){n.update()},1),t=i.getActiveColumnKey(),e=i.prepareValue(e),"field.date"===o.type&&o.isEqual(s.get(r.rowIndex,t))||s.set(r.rowIndex,t,e))},onEditorBeforeHide(e){e.isValid()&&this.setValue(e.getValue())},onScroll(){this.hideEditor()},onNativeScroll(){this.hideEditor()},onBlur(e){const t=this;if(!t.activeEditor||e.id===t.activeEditor.id){if(!0===e.mouseDownSpinUp||e.mouseDownSpinDown)return;t.hideEditor()}},prepareValue(t){const i=this,n=i.getActiveColumnType(),s=i.activeCellEditParams.column,r=s.format;if(r&&r.beforeSaveFn){return t=i.activeEditor.input.dom.value,r.beforeSaveFn(t)}switch(n){case"number":case"currency":if(r&&r.inputFn){var o="",a=0,l=t.length;if(e.isNumber(t))return t;for(;a<l;a++)isNaN(Number(t[a]))||(o+=t[a]);t=o}else""!==t&&(t=Number(t));break;case"date":if(s.format&&s.format.read){const i=s.editor.getDate();t&&(t=e.Date.format(i,s.format.read,void 0,s.format.mode))}}return t},getActiveColumnType(){return this.activeCellEditParams.column.type},getActiveColumnKey(){return this.activeCellEditParams.column.index},onCheckBoxChange(e){const t=this,i=t.widget,n=e.column.index,s=i.store,r=t.checkBoxChangedValue;t.activeEditor&&t.hideEditor(),void 0!==t.checkBoxChangedValue&&(delete t.checkBoxChangedValue,t.activeCellEditParams=e,i.edit.activeCellEditParams=e,s.set(e.rowIndex,n,r))},onComboChange(e,t){const i=this.widget.store,n=this.activeCellEditParams,s=this.getActiveColumnKey();i.set(n.rowIndex,s,t),this.hideEditor()},checkAutoInitEditors(){const e=this;this.widget.columns.forEach(t=>{t.editorAutoInit&&(t.editor=e.generateEditor(t))})},onBeforeKey(t,i,n){const s=this,r=s.widget,o=r.selection||{},a=e.key;switch(n.keyCode){case a.UP:o.selectUpCellOnUp&&(s.hideEditor(),r.selectCellUp(),setTimeout(()=>{r.el.select(`.${e.GRID_CELL_OVER_CLS}`).removeCls(e.GRID_CELL_OVER_CLS)},1));break;case a.DOWN:o.selectBottomCellOnDown&&(s.hideEditor(),r.selectCellDown(),setTimeout(()=>{r.el.select(`.${e.GRID_CELL_OVER_CLS}`).removeCls(e.GRID_CELL_OVER_CLS)},1));break;case a.LEFT:if(o.selectLeftCellOnLeftEnd)0===(l=t.getInputSelection()).start&&0===l.end&&(s.hideEditor(),r.selectCellLeft(),setTimeout(()=>{r.el.select(`.${e.GRID_CELL_OVER_CLS}`).removeCls(e.GRID_CELL_OVER_CLS)},1));break;case a.RIGHT:if(o.selectRightCellOnEnd){var l=t.getInputSelection(),d=t.input.dom.value.length;l.start===d&&l.end===d&&(s.hideEditor(),r.selectCellRight(),setTimeout(()=>{r.el.select(`.${e.GRID_CELL_OVER_CLS}`).removeCls(e.GRID_CELL_OVER_CLS)},1))}}},getEditFormat(t){const i=this.widget.lang,n=i.decimalSeparator,s=i.thousandSeparator;switch(t){case"currency":return function(t,r){const o=r.column.currency||i.currencySign,a=r.column.precision||0;return""!==(t=e.Number.currencyFormat(t,n,s,a))&&(t=o+t),t}}},getBeforeSaveFormat(e){const t=this.widget.lang,i=t.thousandSeparator;switch(e){case"currency":return function(e,n){const s=n.column.currency||t.currencySign;return""!==(e=e.replace(s,"").replace(i,""))&&(e=Number(e)),e}}},onComboAddNewValue(t,i){const n=this.widget,s=t.column,r=s.index,o=s.data;e.isObject(o[0])?o.push({text:i,value:i}):o.push(i),n.setColumnComboData(r,o)}})}(),function(){const e=Fancy,t=e.each,i=e.GRID_CELL_CLS,n=e.FIELD_CLS,s=e.GRID_ROW_EDIT_CLS,r=e.GRID_ROW_EDIT_BUTTONS_CLS,o=e.GRID_ROW_EDIT_BUTTON_UPDATE_CLS,a=e.GRID_ROW_EDIT_BUTTON_CANCEL_CLS,l=e.GRID_ACTIVE_CELL_ENABLED,d=e.ANIMATE_DURATION,c=`.${i}[index="0"]`;e.define("Fancy.grid.plugin.RowEdit",{extend:e.Plugin,ptype:"grid.rowedit",inWidgetName:"rowedit",rendered:!1,constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){const e=this,t=e.widget;t.on("scroll",e.onScroll,e),t.on("columnresize",e.onColumnResize,e),t.on("lockcolumn",e.onLockColumn,e),t.on("rightlockcolumn",e.onRightLockColumn,e),t.on("unlockcolumn",e.onUnLockColumn,e),t.on("beforecolumndrag",e.onBeforeColumnDrag,e),t.on("columndrag",e.onColumnDrag,e),t.on("columnhide",e.onColumnHide,e),t.on("columnshow",e.onColumnShow,e),t.grouping&&t.grouping.by&&(t.on("collapse",e.onCollapse,e),t.on("expand",e.onExpand,e))},onCollapse(){this.hide()},onExpand(){this.hide()},edit(e){const t=this.widget,i=e.column;i&&"$selected"===i.index||(this.activeCellEditParams=e,t.scroller.scrollToCell(e.cell),this.showEditor(e))},showEditor(t){const i=this,n=i.widget;if(n.selection&&n.selection.activeCell&&n.el.removeCls(l),n.fire("beforeedit",t),!0!==n.edit.stopped){for(var s in i.changed={},t.data)null===t.data[s]&&(t.data[s]="");if(i.rendered){const n="none"===i.el.css("display");i.show(),i.changePosition(t.rowIndex,!n),n?i.setValues(t):setTimeout(function(){i.setValues(t)},e.ANIMATE_DURATION)}else i.render(),i.changePosition(t.rowIndex,!1),i.setValues(t);i.setSizes(t)}else n.edit.stopped=!1},render(){const e=this,t=e.widget;t.leftColumns&&(e.leftEl=e.renderTo(t.leftBody.el,t.leftColumns)),t.columns&&(e.el=e.renderTo(t.body.el,t.columns)),t.rightColumns&&(e.rightEl=e.renderTo(t.rightBody.el,t.rightColumns)),e.renderButtons(),e.rendered=!0},renderTo(t,i,r,o,a){const l=t.select(`.${n}`);var d,c,h,u,g=this,p=g.widget,m=e.newEl("div"),f=0,y=i.length,C=p.theme,v={float:"left",margin:"0px",padding:"0px"};if(o)switch(f=r,y=r+1,o){case"right":l.length&&(u=l.item(r));break;case"left":l.length&&(h=l.item(r));break;case"center":switch(a){case"left":u=l.item(0);break;case"right":h=l.item(l.length-1)}}else m.addCls(s),d=e.get(t.dom.appendChild(m.dom));for(-1===f&&(f=0,y=1);f<y;f++){const n=(c=i[f]).width,s={index:c.index,label:!1,style:v,width:n,vtype:c.vtype,format:c.format,stopPropagation:!0,theme:C,checkValidOnTyping:!0,events:[{change:g.onFieldChange,delay:100,scope:g},{empty:g.onFieldEmpty,delay:100,scope:g},{enter:g.onFieldEnter,scope:g}]};switch(o){case"left":h?s.renderAfter=h:s.renderTo=t.dom;break;case"right":u?s.renderBefore=u:s.renderTo=t.dom;break;case"center":switch(a){case"left":s.renderBefore=l.item(0);break;case"right":s.renderAfter=l.item(l.length-1)}break;default:s.renderTo=d.dom}var w;if(!1===c.editable)switch(c.type){case"string":case"number":w=new e.TextField(s);break;default:w=new e.EmptyField(s)}else switch(c.type){case"date":c.format&&(s.format=c.format),w=new e.DateField(s);break;case"image":case"string":case"text":case"color":w=new e.StringField(s);break;case"number":case"currency":c.spin&&(s.spin=c.spin),c.step&&(s.step=c.step),c.min&&(s.min=c.min),c.max&&(s.max=c.max),w=new e.NumberField(s);break;case"combo":e.apply(s,{data:c.data,value:-1,padding:!1}),c.displayKey?(s.displayKey=c.displayKey,s.valueKey=c.valueKey||c.displayKey):(s.displayKey="text",s.valueKey="text"),c.minListWidth&&(s.minListWidth=c.minListWidth),c.subSearch&&(s.subSearch=c.subSearch),w=new e.Combo(s);break;case"checkbox":switch(c.cellAlign){case"left":b=7;break;case"center":b=(c.width-20-2)/2;break;case"right":b=(c.width-20)/2+11}e.apply(s,{renderId:!0,value:!1,style:{padding:"0px",display:"inline-block","padding-left":b,float:"left",margin:"0px"}}),w=new e.CheckBox(s);break;case"switcher":var b;switch(c.cellAlign){case"left":case void 0:b=7;break;case"center":b=(c.width-20-2)/2;break;case"right":b=(c.width-20)/2+11}e.apply(s,{renderId:!0,value:!1,style:{padding:"0px",display:"inline-block","padding-left":b,float:"left",margin:"0px"}}),w=new e.Switcher(s);break;default:w=new e.EmptyField(s)}w.input&&c.cellAlign&&w.input.css("text-align",c.cellAlign),c.rowEditor=w,c.hidden&&w.hide()}return d},renderButtons(){var t,i=this,n=i.widget,s=n.lang,l=e.newEl("div");l.addCls(r),t=e.get(n.body.el.dom.appendChild(l.dom)),i.buttonsEl=t,i.buttonUpdate=new e.Button({cls:o,renderTo:t.dom,text:s.update,events:[{click:i.onClickUpdate,scope:i}]}),i.buttonCancel=new e.Button({cls:a,renderTo:t.dom,text:s.cancel,events:[{click:i.onClickCancel,scope:i}]})},setSizes(e){const t=this,i=t.widget;i.leftColumns&&t._setSizes(i.leftBody.el.select(c),i.leftColumns,"left"),i.columns&&t._setSizes(i.body.el.select(c),i.columns),i.rightColumns&&t._setSizes(i.rightBody.el.select(c),i.rightColumns,"right"),t.setElSize(e)},setElSize(e){var t,i=this,n=i.widget,s=n.getCenterViewWidth(),r=n.getCenterFullWidth();s<r&&i.el.css("width",r+2),e&&e.cell&&(t=e.cell.clientHeight+3,i.el.css("height",t+"px"),n.leftColumns&&i.leftEl.css("height",t+"px"),n.rightColumns&&i.rightEl.css("height",t+"px"))},_setSizes(e,t,i){for(var n,s,r,o,a=0,l=t.length;a<l;a++)n=t[a],r=e.item(a).dom,s=this.getCellSize(r),(o=n.rowEditor)&&("left"!==i&&"right"!==i||a!==l-1||s.width--,"left"===i&&"select"===n.type&&s.width--,s.height-=1,a===l-1?o.el.css("width",s.width-2):o.el.css("width",s.width-1),o.el.css("height",s.height),s.width-=2,s.width-=4,s.height-=4,this.setEditorSize(o,s))},getCellSize(t){var i=e.get(t),n=i.width(),s=i.height(),r=2;return e.nojQuery&&(r=1),{width:n+=parseInt(i.css("border-right-width"))*r,height:s+=parseInt(i.css("border-bottom-width"))*r}},setEditorSize(e,t){"field.combo"===e.wtype?(e.size(t),e.el.css("width",t.width+5)):e.setInputSize({width:t.width,height:t.height})},changePosition(t,i){var n=this,s=n.widget,r=s.infinite?0:s.scroller.getScroll(),o=s.scroller.getBottomScroll(),a=s.cellHeight*t-1-r,l=0;s.grouping&&s.grouping.by&&(a+=l+=s.grouping.getOffsetForRow(t)),n.leftEl&&(!1!==i?n.leftEl.animate({top:a},d):n.leftEl.css("top",a)),n.el&&(!1!==i?n.el.animate({top:a},d):n.el.css("top",a)),n.rightEl&&(!1!==i?n.rightEl.animate({top:a},d):n.rightEl.css("top",a));var c=s.getViewTotal()-3<t,h=a;t<3&&(c=!1),c?s.grouping&&s.grouping.by?s.getViewTotal()-3<t-s.grouping.getSpecialRowsUnder(t)?h=a-parseInt(n.buttonsEl.css("height"))+1:(h=a+s.cellHeight,c=!1):h=a-parseInt(n.buttonsEl.css("height"))+1:h=a+s.cellHeight,e.nojQuery&&(h+=1),!1!==i?n.buttonsEl.animate({top:h},d):n.buttonsEl.css("top",h),n.el.css("left",-o),n.changeButtonsLeftPos(),n.activeRowIndex=t},changeButtonsLeftPos(){const e=this.widget.getCenterViewWidth(),t=parseInt(this.buttonsEl.css("width"));this.buttonsEl.css("left",(e-t)/2)},setValues(e){const t=this,i=t.widget;i.leftColumns&&t._setValues(e.data,i.leftColumns),i.columns&&t._setValues(e.data,i.columns),i.rightColumns&&t._setValues(e.data,i.rightColumns),t.activeId=e.id,t.activeRowIndex=e.rowIndex},_setValues(i,n){const s=this;t(n,function(t){const n=t.rowEditor;if(n)switch(t.type){case"action":case"button":case"order":case"select":case"expand":case"rowdrag":break;default:var r=i[t.index];if(void 0===r&&(r=""),t.editFormat)switch(e.typeOf(t.editFormat)){case"function":r=t.editFormat(r,{column:t});break;case"string":r=s.getEditFormat(t.editFormat)(r,{column:t})}n.set(r,!1)}})},onScroll(){const e=this,t=e.widget;!1!==e.rendered&&(t.infinite&&e.hide(),void 0!==e.activeRowIndex&&e.changePosition(e.activeRowIndex,!1))},onColumnResize(){const t=this;!1!==t.rendered&&(e.nojQuery?setTimeout(()=>{t.setSizes()},400):setTimeout(()=>{t.setSizes()},d))},onClickUpdate(){this.saveChanges()},saveChanges(){var t=this,i=t.widget,n=i.store,s=t.prepareChanged(),r=n.getRow(t.activeId),o=t.getComboNewValues();for(const t in o){const s=n.getColumnUniqueData(t);e.isString(s[0])?s.push(o[t]):s.push({value:o[t],text:o[t]}),i.setColumnComboData(t,s)}e.apply(s,o),n.setItemData(r,s),i.update(),t.hide()},prepareChanged(){const t=this.widget,i=this.changed;for(const n in i){const s=t.getColumnByIndex(n);switch(s.type){case"date":const t=e.Date.parse(i[n],s.format.edit,s.format.mode),r=e.Date.format(t,s.format.read,s.format.mode);i[n]=r}}return i},onClickCancel(){this.hide()},hide(){const e=this,t=e.widget;t.fire("beforeendedit",e.activeCellEditParams),t.selection&&t.selection.activeCell&&t.el.addCls(l),e.el&&(e.leftEl&&e.leftEl.hide(),e.el.hide(),e.rightEl&&e.rightEl.hide(),e.buttonsEl.hide(),t.fire("endedit",e.activeCellEditParams))},show(){const e=this;e.leftEl&&("none"===e.leftEl.css("display")&&e.leftEl.css("opacity",0),e.leftEl.show(),e.leftEl.animate({opacity:1},d)),"none"===e.el.css("display")&&e.el.css("opacity",0),e.el.show(),e.el.animate({opacity:1},d),e.rightEl&&("none"===e.rightEl.css("display")&&e.rightEl.css("opacity",0),e.rightEl.show(),e.rightEl.animate({opacity:1},d)),"none"===e.buttonsEl.css("display")&&e.buttonsEl.css("opacity",0),e.buttonsEl.show(),e.buttonsEl.animate({opacity:1},d)},onFieldChange(e,t){const i=this;e.isValid()?i.changed[e.index]=t:delete i.changed[e.index]},onFieldEmpty(e){const t=this;e.vtype&&!e.isValid()?delete t.changed[e.index]:t.changed[e.index]=""},onFieldEnter(){this.saveChanges()},hideField(e,t){const i=this.widget.getColumns(t)[e];i.rowEditor&&i.rowEditor.hide()},showField(e,t){const i=this.widget.getColumns(t)[e];i.rowEditor&&i.rowEditor.show()},moveEditor(e,t,i,n){var r,o=this,a=o.widget,l=a.store,d=a.getColumns(i),c=e.rowEditor,h=a.getBody(i).el.select("."+s),u=l.getById(o.activeId).get(e.index);h.dom&&(void 0===o.activeId&&(u=l.ge1t(o.activeRowIndex)[e.index]),c.destroy(),o.renderTo(h,d,t,i,n),r=o.getField(t,i),e.rowEditor=r,r.set(u),o.setSizes(),o.changeButtonsLeftPos(),o.reSetColumnsEditorsLinks())},getField(t,i){var r=this.widget.getBody(i);switch(i){case"left":t++}return e.getWidget(r.el.select("."+s+" ."+n).item(t).attr("id"))},reSetColumnsEditorsLinks(){var i=this.widget,r=i.body.el.select("."+s+" ."+n);t(i.columns,(t,i)=>{t.rowEditor=e.getWidget(r.item(i).attr("id"))}),r=i.leftBody.el.select("."+s+" ."+n),t(i.leftColumns,(t,i)=>{t.rowEditor=e.getWidget(r.item(i).attr("id"))}),r=i.rightBody.el.select("."+s+" ."+n),t(i.rightColumns,(t,i)=>{t.rowEditor=e.getWidget(r.item(i).attr("id"))})},onBeforeColumnDrag(){this.destroyEls(),this.hide()},onColumnDrag(){this.destroyEls(),this.hide()},onColumnHide(){this.destroyEls(),this.hide()},onColumnShow(){this.destroyEls(),this.hide()},onLockColumn(){this.destroyEls(),this.hide()},onRightLockColumn(){this.destroyEls(),this.hide()},onUnLockColumn(){this.destroyEls(),this.hide()},destroyEls(){const t=this,i=t.widget;t.rendered&&(t.rendered=!1,i.leftColumns&&(e.each(i.leftColumns,e=>{e.rowEditor.destroy(),delete e.rowEditor}),t.leftEl.destroy()),i.columns&&(e.each(i.columns,e=>{e.rowEditor.destroy(),delete e.rowEditor}),t.el.destroy()),i.rightColumns&&(e.each(i.rightColumns,e=>{e.rowEditor.destroy(),delete e.rowEditor}),t.rightEl.destroy()))},isVisible(){return"none"!==this.el.css("display")},getEditFormat(t){const i=this.widget.lang,n=i.decimalSeparator,s=i.thousandSeparator;switch(t){case"currency":return function(t,r){const o=r.column.currency||i.currencySign,a=r.column.precision||0;return""!==(t=e.Number.currencyFormat(t,n,s,a))&&(t=o+t),t}}},getComboNewValues(){const t=this.widget.getColumns(),i={};return e.each(t,t=>{if("combo"===t.type&&t.editable&&t.rowEditor){const n=t.rowEditor,s=n.get();-1===n.value&&e.isString(s)&&s.length?i[t.index]=s:n.getInputValue()!==s&&(i[t.index]=n.getInputValue())}}),i}})}(),Fancy.define("Fancy.grid.plugin.Infinite",{extend:Fancy.Plugin,ptype:"grid.infinite",inWidgetName:"infinite",constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){this.widget}}),Fancy.modules.selection=!0,function(){const e=Fancy,t=e.GRID_CELL_CLS,i=e.GRID_CELL_OVER_CLS,n=e.GRID_CELL_SELECTED_CLS,s=e.GRID_CELL_ACTIVE_CLS,r=e.GRID_COLUMN_CLS,o=e.GRID_COLUMN_OVER_CLS,a=e.GRID_COLUMN_SELECT_CLS,l=e.GRID_COLUMN_SELECTED_CLS,d=e.GRID_ROW_OVER_CLS,c=e.GRID_HEADER_CELL_SELECT_CLS,h=e.GRID_HEADER_CELL_TEXT_CLS,u=e.GRID_COLUMN_TREE_EXPANDER_CLS,g=e.GRID_ACTIVE_CELL_ENABLED,p=e.FIELD_CHECKBOX_CLS,m=e.FIELD_CHECKBOX_ON_CLS,f=e.FIELD_CHECKBOX_INPUT_CLS,y=e.GRID_COPY_TEXTAREA,C=e.FIELD_CHECKBOX_MIDDLE_CLS,v=`.${n}`,w=`.${s}`;e.define("Fancy.grid.plugin.Selection",{extend:e.Plugin,ptype:"grid.selection",inWidgetName:"selection",mixins:["Fancy.grid.selection.mixin.Navigation"],enabled:!0,checkboxRow:!1,checkOnly:!1,memory:!1,disabled:!1,selectLeafsOnly:!1,keyNavigation:!0,allowDeselect:!1,constructor:function(){this.Super("const",arguments)},init(){const e=this,t=e.widget;e.Super("init",arguments),e.memory&&e.initMemory(),e.ons(),e.activeCell&&t.once("init",()=>t.el.addCls(g))},ons(){const t=this,i=t.widget;i.once("render",()=>{t.initTrackOver(),t.initColumnTrackOver(),t.initCellTrackOver(),t.initCellSelection(),t.initRowSelection(),t.initColumnSelection(),t.keyNavigation&&t.initNavigation(),t.initCopyKeys(),i.on("changepage",t.onChangePage,t),i.on("load",t.onLoad,t),e.nojQuery&&t.initFixTrackOver(),t.initCopyEl()}),i.on("sort",t.onSort,t),i.on("columndrag",t.onColumnDrag,t),i.on("lockcolumn",t.onColumnLock,t),i.on("rightlockcolumn",t.onColumnRightLock,t),i.on("unlockcolumn",t.onUnColumnLock,t),i.on("filter",t.onFilter,t),i.on("expand",t.onExpand,t),i.on("collapse",t.onCollapse,t),i.on("dragrows",t.onDragRows,t),i.on("remove",t.onRemoveRows,t),i.on("treeexpand",t.onTreeExpand,t),i.on("treecollapse",t.onTreeCollapse,t)},initMemory(){const t=this,i=t.widget,n=i.store;t.memory={all:!1,exceptedLength:0,selectedLength:0,excepted:{},selected:{},tree:{selected:{},allSelected:{},selectedLength:{}},addDirtyParent(n,s,r){if("rows"!==t.selModel)return;const o=i.getById(n).get("child");var a;o?!1!==r?(delete t.memory.tree.selected[n],s&&(t.memory.tree.allSelected[n]||t.memory.tree.selected[n]||t.memory.tree.selectedLength[s]++),t.memory.tree.allSelected[n]=!0,t.memory.tree.selectedLength[n]=o.length,t.memory.clearChild(o)):(o&&(t.memory.tree.selected[n]=!0),t.memory.tree.selectedLength[n]||(t.memory.tree.selectedLength[n]=1)):s&&(t.memory.tree.selected[s]=!0,t.memory.tree.selectedLength[s]=t.memory.tree.selectedLength[s]||0,t.memory.tree.selectedLength[s]++,(a=i.getById(s)).get("child").length===t.memory.tree.selectedLength[s]&&(t.memory.tree.allSelected[s]=!0,delete t.memory.tree.selected[s]));s&&((a=i.getById(s)).data.parentId&&t.memory.addDirtyParent(s,a.data.parentId,!1),o.length&&t.memory.addDirtyParent(s,a.data.parentId,!1));if(o){var l=0;e.each(o,e=>{const i=e.id;if(!i)return!0;t.memory.tree.allSelected[i]&&l++}),o.length===l&&(delete t.memory.tree.selected[n],t.memory.tree.allSelected[n]=!0)}},removeDirtyParent(e,n){if("rows"===t.selModel){var s,r=i.getById(n);if(r&&(s=r.get("child")),t.memory.tree.allSelected[e]&&(delete t.memory.tree.allSelected[e],delete t.memory.tree.selectedLength[e]),t.memory.selected[e]&&(delete t.memory.selected[e],t.memory.selectedLength--),delete t.memory.tree.selected[e],t.memory.tree.allSelected[n]&&(delete t.memory.tree.allSelected[n],t.memory.tree.selectedLength[n]=s.length,1!==s.length?t.memory.tree.selected[n]=!0:delete t.memory.tree.selected[n]),t.memory.tree.selectedLength[n]&&t.memory.tree.selectedLength[n]--,0===t.memory.tree.selectedLength[n]){delete t.memory.tree.selected[n],delete t.memory.tree.selectedLength[n];const e=r.get("parentId");e&&t.memory.removeDirtyParent(n,e)}}},clearChild(i){e.Array.each(i,e=>{const i=e.id;if(t.memory.tree.selectedLength[i]){t.memory.selected[i]=!0,delete t.memory.tree.allSelected[i],delete t.memory.tree.selected[i],delete t.memory.tree.selectedLength[i];const n=e.get("child");n&&t.memory.clearChild(n)}})},setAll(){const n=i.store.filteredDataMap;if(n){for(const e in n)t.memory.add(e);t.memory.all=!0}else e.apply(t.memory,{all:!0,exceptedLength:0,selectedLength:0,excepted:{},selected:{}})},clearAll(){n.hasFilters&&n.hasFilters()?t.memory.all=!1:e.apply(t.memory,{all:!1,exceptedLength:0,selectedLength:0,excepted:{},selected:{}})},selectAllFiltered(){t.memory.clearAll();const n=i.getDataFiltered();e.each(n,e=>t.memory.add(e.id))},add(e){const n=i.getById(e);n&&n.set("$selected",!0),t.row&&t.memory.clearAll(),t.memory.selected[e]||(t.memory.selected[e]=n.data,t.memory.selectedLength++),!0===t.memory.excepted[e]&&(delete t.memory.excepted[e],t.memory.exceptedLength--)},remove(e){const n=i.getById(e);n&&n.set("$selected",!1),t.memory.selected[e]&&(delete t.memory.selected[e],t.memory.selectedLength--),!0===t.memory.all&&(t.memory.excepted[e]||(t.memory.excepted[e]=!0,t.memory.exceptedLength++));const s=i.getTotal();t.memory.exceptedLength===s&&t.memory.clearAll()},has:e=>!!t.memory.selected[e]&&!t.memory.excepted[e]}},initTrackOver(){const e=this,t=e.widget;t.on("rowenter",e.onRowEnter,e),t.on("rowleave",e.onRowLeave,e)},initCellTrackOver(){const e=this,t=e.widget;t.on("cellenter",e.onCellEnter,e),t.on("cellleave",e.onCellLeave,e)},initColumnTrackOver(){const e=this,t=e.widget;t.on("columnenter",e.onColumnEnter,e),t.on("columnleave",e.onColumnLeave,e)},onCellEnter(t,n){const s=this.widget;!s.cellTrackOver||s.startResizing||e.isTouch||e.get(n.cell).addCls(i)},onCellLeave(t,n){const s=this.widget;s.cellTrackOver&&!s.startResizing&&e.get(n.cell).removeCls(i)},onColumnEnter(t,i){const n=this.widget,s=n.columndrag,r=n.scroller;s&&"dragging"===s.status||e.isTouch||n.startResizing||!n.columnTrackOver||r.bottomKnobDown||r.rightKnobDown||!1===i.column.trackOver||this.keyNavigating||e.get(i.columnDom).addCls(o)},onColumnLeave(t,i){const n=this.widget;n.startResizing||n.columnTrackOver&&e.get(i.columnDom).removeCls(o)},onRowEnter(t,i){const n=this.widget,s=n.columndrag,r=n.scroller;if(s&&"dragging"===s.status)return;if(e.isTouch)return;if(n.startResizing)return;if(!1===this.enabled)return;if(!n.trackOver||r.bottomKnobDown||r.rightKnobDown||this.keyNavigating)return;const o=n.getDomRow(i.rowIndex);e.each(o,t=>e.get(t).addCls(d)),n.fire("rowtrackenter",i)},onRowLeave(t,i){const n=this.widget;if(n.startResizing)return;if(!1===this.enabled)return;if(!n.trackOver)return;const s=n.getDomRow(i.rowIndex);e.each(s,t=>e.get(t).removeCls(d)),n.fire("rowtrackleave",i)},onChangePage(){this.memory||this.clearSelection()},onLoad(){this.memory||this.clearSelection()},initCellSelection(){const e=this,t=e.widget;t.on("cellclick",e.onCellClick,e),t.on("cellmousedown",e.onCellMouseDownCells,e),t.on("cellenter",e.onCellEnterSelection,e)},initRowSelection(){const e=this,t=e.widget;t.checkboxRowSelection&&(e.checkboxRow=!0,setTimeout(()=>{"rows"===e.selModel&&e.renderHeaderCheckBox()},1)),t.on("rowclick",e.onRowClick,e),t.on("cellmousedown",e.onCellMouseDownRows,e),t.on("cellclick",e.onCellClickRows,e),t.on("rowenter",e.onRowEnterSelection,e),t.on("columndrag",e.onColumnDrag,e)},onCellMouseDownRows(t,i){const r=this,o=r.widget,a=o.store,l=e.get(i.e.target),d=i.column,c=a.isTree&&r.memory,h=e.get(document.body);if(o._preventTouchDown)return void delete o._preventTouchDown;if(r.stopOneTick&&delete r.stopOneTick,r.checkOnly&&!e.get(i.e.target).hasClass(f))return void(r.activeCell&&(r.clearActiveCell(),e.get(i.cell).addCls(s)));if(r.disabled)return;if(r.selectLeafsOnly&&!i.data.leaf)return void(r.stopOneTick=!0);if(!r.rows||!r.enabled)return;if(r.checkOnly&&"$selected"!==i.column.index&&!i.column.select)return;if("tree"===d.type&&l.hasCls(u))return;if(!r.selectLeafsOnly&&!i.data.leaf&&l.hasClass(f)){const t=!e.getWidget(l.parent().parent().attr("id")).get();r.selectNodesChilds(i.id,t)}document.activeElement&&document.activeElement.blur();const g=i.e,m=g.target,y=g.ctrlKey,C=i.rowIndex,v=o.getDomRow(C);if((y||r.allowDeselect)&&o.multiSelect)e.get(v[0]).hasCls(n)?(r.domDeSelectRow(C),r.checkboxRow&&r.deSelectCheckBox(C),c&&(r.memory.removeDirtyParent(i.id,i.data.parentId),h.once("mouseup",()=>{setTimeout(()=>r.updateSelectCheckBoxes(),100)}))):(r.domSelectRow(C),r.checkboxRow&&r.selectCheckBox(C),c&&r.memory.addDirtyParent(i.id,i.data.parentId));else if("$selected"===i.column.index||i.column.select){const t=e.getWidget(e.get(i.cell).select(`.${p}`).attr("id"));t.el.within(m)?!0===t.get()?(r.domDeSelectRow(C),c&&(r.memory.removeDirtyParent(i.id,i.data.parentId),h.once("mouseup",()=>{setTimeout(()=>r.updateSelectCheckBoxes(),100)}))):(r.domSelectRow(C),c&&r.memory.addDirtyParent(i.id,i.data.parentId)):(r.clearSelection(),r.domSelectRow(C),r.checkboxRow&&r.selectCheckBox(C),c&&r.memory.addDirtyParent(i.id,i.data.parentId))}else r.clearSelection(),r.domSelectRow(C),r.checkboxRow&&r.selectCheckBox(C),c&&r.memory.addDirtyParent(i.id,i.data.parentId);r.isMouseDown=!0,r.startRowSelection=C,e.$(document).one("mouseup",function(){delete r.isMouseDown,delete r.startCellSelection}),r.clearActiveCell(),e.get(i.cell).addCls(s),o.fire("select",r.getSelection()),c&&r.updateTreeSelection()},selectCheckBox(i){const n=this,s=n.widget;s.el.select("."+a+" ."+t+'[index="'+i+'"] .'+p).each(t=>{e.getWidget(t.attr("id")).set(!0)}),"rows"===s.selModel&&n.updateHeaderCheckBox()},deSelectCheckBox(i){const n=this,s=n.widget,r=s.store,o=s.el.select("."+a+" ."+t+'[index="'+i+'"] .'+p),l=r.get(i,"id");l&&(n.memory&&n.memory.remove(l),o.each(function(t){e.getWidget(t.attr("id")).set(!1)}),n.updateHeaderCheckBox())},domSelectRow(t){if(this.widget.inited){var i,s=this.widget,r=s.store.get(t,"id"),o=!1;s.startResizing||(this.memory&&(s.sorting||s.filtering||this.deselectingAll||s.draggingRows||this.memory.add(r)),i=s.getDomRow(t),e.each(i,t=>{(t=e.get(t)).hasClass(n)?o=!0:t.addCls(n)}),!1===o&&s.fire("selectrow",t,s.get(t)))}},domDeSelectRow(t){if(this.widget.inited){var i,s=this.widget,r=s.store.get(t,"id"),o=!0;this.memory&&(s.filtering||this.deselectingAll||s.draggingRows||s.sorting||this.memory.remove(r)),i=s.getDomRow(t),e.each(i,t=>{(t=e.get(t)).hasClass(n)?t.removeCls(n):o=!1}),o&&s.fire("deselectrow",t,s.get(t))}},onColumnEnterSelection(e,t){const i=this,n=i.widget;if(!i.columns||!0!==i.isMouseDown)return;const s={columnIndex:i.startColumnColumnIndex,side:i.startColumnSide},r={columnIndex:t.columnIndex,side:t.side};if(s.side===r.side){switch(s.side){case"center":i.clearSelection("right"),i.clearSelection("left");break;case"left":i.clearSelection("center"),i.clearSelection("right");break;case"right":i.clearSelection("center"),i.clearSelection("left")}i.selectColumns(s.columnIndex,r.columnIndex,s.side)}else"center"===s.side&&"right"===r.side?(i.selectColumns(s.columnIndex,n.columns.length,"center"),i.selectColumns(0,r.columnIndex,"right")):"center"===s.side&&"left"===r.side?(i.selectColumns(0,s.columnIndex,"center"),i.selectColumns(r.columnIndex,n.leftColumns.length,"left")):"left"===s.side&&"center"===r.side?(i.clearSelection("right"),i.selectColumns(s.columnIndex,n.leftColumns.length,"left"),i.selectColumns(0,r.columnIndex,"center")):"left"===s.side&&"right"===r.side?(i.selectColumns(s.columnIndex,n.leftColumns.length,"left"),i.selectColumns(0,n.columns.length,"center"),i.selectColumns(0,r.columnIndex,"right")):"right"===s.side&&"center"===r.side?(i.clearSelection("left"),i.selectColumns(0,s.columnIndex,"right"),i.selectColumns(r.columnIndex,n.columns.length,"center")):"right"===s.side&&"left"===r.side&&(i.selectColumns(0,s.columnIndex,"right"),i.selectColumns(0,n.columns.length,"center"),i.selectColumns(r.columnIndex,n.leftColumns.length,"left"));i.clearActiveCell()},onRowEnterSelection(t,i){const n=this,r=n.widget;if(!1!==i&&!r.startResizing&&!1!==n.enabled&&n.rows&&!0===n.isMouseDown&&n.mouseMoveSelection){var o=n.startRowSelection,a=i.rowIndex,l={};o>a&&(o=i.rowIndex,a=n.startRowSelection);for(var d=o,c=a+1;d<c;d++)l[d]=!0;var h=n.getSelectedRowByColumn(i.columnIndex,i.side),u={},g={};for(var p in l)!0!==h[p]&&(u[p]=!0);for(var p in h)!0!==l[p]&&(g[p]=!0);for(var p in u)n.domSelectRow(p),n.checkboxRow&&n.selectCheckBox(p);for(var p in g)n.domDeSelectRow(p),n.checkboxRow&&n.deSelectCheckBox(p);n.clearActiveCell(),e.get(i.cell).addCls(s),r.fire("select",n.getSelection())}},getSelectedRowByColumn(e,t){var i,n=this.widget;switch(t){case"left":i=n.leftBody;break;case"center":i=n.body;break;case"right":i=n.rightBody}const s={};return i.el.select(`.${r}[index="${e}"][grid="${n.id}"]`).select(v).each(e=>{s[Number(e.attr("index"))]=!0}),s},getSelectedRow(){const e=this.widget.body.el.select(v);return 0===e.length?-1:Number(e.item(0).attr("index"))},getSelectedRows(){const e=this.widget,t=[];return e.body.el.select("."+r+'[index="0"][grid="'+e.id+'"]').select(v).each(function(e){t.push(Number(e.attr("index")))}),t},initColumnSelection(){const e=this,t=e.widget;e.selectedColumns=[],t.on("columnclick",e.onColumnClick,e),t.on("columnmousedown",e.onColumnMouseDown,e),t.on("columnenter",e.onColumnEnterSelection,e)},onColumnClick(t,i){const n=this;if(!n.column||!1===i.column.selectable)return;const r=e.get(i.columnDom);n.column&&(n.selectedColumns[0]=i),n.clearSelection(),r.addCls(l),e.get(i.cell).addCls(s)},onRowClick(t,i){const r=this,o=r.widget,a=i.rowIndex,l=e.get(i.e.target);if(r.disabled)return;if(!r.row||!1===i)return;if(r.checkOnly&&"$selected"!==i.column.index&&!i.column.select)return;if(r.selectLeafsOnly&&!i.data.leaf)return;var d=i.column,c=!0;if("tree"===d.type&&l.hasCls(u))return;"action"===d.type&&d.items&&e.each(d.items,e=>{"remove"===e.action&&(c=!1)});const h=e.get(i.cell).hasClass(n);if("$selected"===i.column.index||i.column.select){const t=e.getWidget(e.get(i.cell).select("."+p).attr("id")),n=t.get();if(t.el.within(l))r.clearSelection(),!0===n?(r.selectCheckBox(a),r.domSelectRow(a)):r.deSelectCheckBox(a);else{if(r.checkOnly)return;r.clearSelection(),!0!==n?(r.selectCheckBox(a),r.domSelectRow(a)):r.deSelectCheckBox(a)}o.fire("select",r.getSelection())}else c&&(r.clearSelection(),r.allowDeselect&&h||(r.domSelectRow(a),r.selectCheckBox(a)),o.fire("select",r.getSelection()));e.get(i.cell).addCls(s)},onCellClickRows(t,i){const n=this,s=n.widget;if(n.disabled)return;if(!n.rows||!n.enabled)return;if(n.checkOnly&&"$selected"!==i.column.index&&!i.column.select)return;const r=i.e.ctrlKey,o=i.rowIndex;if((r||n.allowDeselect)&&s.multiSelect);else if("$selected"===i.column.index||i.column.select){const t=e.getWidget(e.get(i.cell).select("."+p).attr("id"));!0!==t.middle&&(!0===t.get()?n.selectCheckBox(o):n.deSelectCheckBox(o))}},selectRow(i,n,s,o){const a=this,l=a.widget,d=l.leftBody,c=l.body,h=l.rightBody;if(void 0===n&&(n=!0),s=s||!1,!l.startResizing){if(!a.row&&!a.rows)throw new Error("[FancyGrid Error] - row selection was not enabled");s||a.clearSelection(),n?a.domSelectRow(i):a.domDeSelectRow(i),e.each(l.columns,(e,s)=>{if("select"===e.type||e.select){const e=c.el.select("."+r+'[index="'+s+'"] .'+t+'[index="'+i+'"] .'+p),o=Fancy.getWidget(e.attr("id"));o&&o.set(n)}}),e.each(l.leftColumns,(e,s)=>{if("select"===e.type||e.select){const e=d.el.select("."+r+'[index="'+s+'"] .'+t+'[index="'+i+'"] .'+p),o=Fancy.getWidget(e.attr("id"));o&&o.set(n)}}),e.each(l.rightColumns,(e,s)=>{if("select"===e.type||e.select){const e=h.el.select("."+r+'[index="'+s+'"] .'+t+'[index="'+i+'"] .'+p),o=Fancy.getWidget(e.attr("id"));o&&o.set(n)}}),!1!==o&&l.fire("select",a.getSelection())}},selectById(e,t,i){var n=this,s=n.widget,r=s.find("id",String(e))[0];void 0!==r?n.selectRow(r,t,i):void 0!==(r=s.find("id",Number(e))[0])?n.selectRow(r,t,i):n.memory&&(!0===t||void 0===t?n.memory.add(e):n.memory.remove(e))},onCellClick(t,i){const r=this.widget;this.cell&&(this.clearSelection(),e.get(i.cell).addCls(n,s),r.fire("select",this.getSelection()))},clearSelection(e){const s=this,r=s.widget;if(s.checkboxRow){const e={};r.el.select("."+a+" ."+m).each(i=>{const n=i.closest("."+t).attr("index");e[n]||(e[n]=!0,s.deSelectCheckBox(n))})}if(s.memory&&s.memory.clearAll(),e)switch(e){case"left":r.leftBody.el.select(v).removeCls(n),r.leftBody.el.select("."+l).removeCls(l),r.leftBody.el.select("."+i).removeCls(i);break;case"center":r.body.el.select(v).removeCls(n),r.body.el.select("."+l).removeCls(l),r.body.el.select("."+i).removeCls(i);break;case"right":r.rightBody.el.select(v).removeCls(n),r.rightBody.el.select("."+l).removeCls(l),r.rightBody.el.select("."+i).removeCls(i)}else r.el.select(v).removeCls(n),r.el.select("."+l).removeCls(l),r.el.select("."+i).removeCls(i);s.clearActiveCell(),r.fire("clearselect"),r.fire("select",r.getSelection())},onSort(){const e=this;e.clearActiveCell(),e.memory?e.updateSelection():e.clearSelection()},onCellEnterSelection(t,i){var n=this,r=n.widget,o=r.columndrag;if(o&&"dragging"===o.status)return;if(!n.cells||!0!==n.isMouseDown)return;n.prevCellsSelection=i.cell,n.prevCellRowIndex=i.rowIndex,n.prevCellColumnIndex=i.columnIndex,n.prevCellSide=i.side;const a={rowIndex:n.startCellRowIndex,columnIndex:n.startCellColumnIndex,side:n.startCellSide},l={rowIndex:i.rowIndex,columnIndex:i.columnIndex,side:i.side};i.rowIndex<n.startCellRowIndex&&(a.rowIndex=i.rowIndex,l.rowIndex=n.startCellRowIndex),n.startCellSide===i.side?(i.columnIndex<n.startCellColumnIndex&&(a.columnIndex=i.columnIndex,l.columnIndex=n.startCellColumnIndex),n.selectCells(a,l,a.side),"left"===n.startCellSide?(n.clearSelection("center"),n.clearSelection("right")):"center"===n.startCellSide?(n.clearSelection("left"),n.clearSelection("right")):"right"===n.startCellSide&&(n.clearSelection("left"),n.clearSelection("center"))):"left"===n.startCellSide?(n.selectCells(a,{rowIndex:i.rowIndex,columnIndex:r.leftColumns.length-1},"left"),"center"===i.side?(n.selectCells({columnIndex:0,rowIndex:a.rowIndex},l,"center"),n.clearSelection("right")):"right"===i.side&&(n.selectCells({columnIndex:0,rowIndex:a.rowIndex},{columnIndex:r.columns.length-1,rowIndex:l.rowIndex},"center"),n.selectCells({columnIndex:0,rowIndex:a.rowIndex},l,"right"))):"center"===n.startCellSide?"left"===i.side?(n.selectCells({columnIndex:0,rowIndex:a.rowIndex},{rowIndex:l.rowIndex,columnIndex:a.columnIndex},"center"),n.selectCells({columnIndex:l.columnIndex,rowIndex:a.rowIndex},{rowIndex:l.rowIndex,columnIndex:r.leftColumns.length-1},"left")):"right"===i.side&&(n.selectCells({columnIndex:a.columnIndex,rowIndex:a.rowIndex},{columnIndex:r.columns.length-1,rowIndex:l.rowIndex},"center"),n.selectCells({columnIndex:0,rowIndex:a.rowIndex},{columnIndex:l.columnIndex,rowIndex:l.rowIndex},"right")):"right"===n.startCellSide&&(n.selectCells({columnIndex:0,rowIndex:a.rowIndex},{columnIndex:a.columnIndex,rowIndex:l.rowIndex},"right"),"center"===i.side?(n.selectCells({columnIndex:l.columnIndex,rowIndex:a.rowIndex},{columnIndex:r.columns.length-1,rowIndex:l.rowIndex},"center"),n.clearSelection("left")):"left"===i.side&&(n.selectCells({columnIndex:0,rowIndex:a.rowIndex},{columnIndex:r.columns.length-1,rowIndex:l.rowIndex},"center"),n.selectCells({columnIndex:l.columnIndex,rowIndex:a.rowIndex},{columnIndex:r.leftColumns.length-1,rowIndex:l.rowIndex},"left"))),n.endCellRowIndex=l.rowIndex,n.clearActiveCell(),e.get(i.cell).addCls(s),r.fire("select",n.getSelection())},onColumnMouseDown(t,i){const n=this,r=n.widget;if(!n.columns||!1===i.column.selectable||!n.enabled)return;document.activeElement&&document.activeElement.blur();const o=e.get(i.columnDom);n.isMouseDown=!0,n.startColumnColumnIndex=i.columnIndex,n.startColumnSide=i.side,n.clearSelection(),o.addCls(l),e.$(document).one("mouseup",function(){delete n.isMouseDown}),e.get(i.cell).addCls(s),r.fire("select",n.getSelection())},onCellMouseDownCells(t,i){const r=this,o=r.widget;if(o.celledit&&o.celledit.hideEditor(),!r.cells||!r.enabled)return;document.activeElement&&document.activeElement.blur();const a=e.get(i.cell);r.clearSelection(),o.el.select(w).removeCls(s),a.addCls(n,s),r.isMouseDown=!0,r.startCellSelection=i.cell,r.startCellRowIndex=i.rowIndex,r.startCellColumnIndex=i.columnIndex,r.startCellSide=i.side,e.$(document).one("mouseup",function(){delete r.isMouseDown,delete r.startCellSelection}),o.fire("select",r.getSelection())},selectCell(t){const i=this.widget,r=t.id,o=t.index,a=i.getRowById(r),l=i.getColumnOrderByKey(o),d=l.order,c=i.getBody(l.side).getCell(a,d);i.clearSelection(),this.clearActiveCell(),e.get(t.cell).addCls(s),c.addCls(n),i.scroller.scrollToCell(c.dom,!0,t.firstRow)},selectCells(e,t,i){var s,r,o,a=this.widget,l=a.body,d=a.leftBody,c=a.rightBody,h=e.rowIndex,u=t.rowIndex,g=this.getSelectedCells(i||"center"),p={},m={},f={};for(h=e.rowIndex,u=t.rowIndex+1;h<u;h++)for(p[h]=p[h]||{},r=e.columnIndex,o=t.columnIndex+1;r<o;r++)p[h][r]=!0;for(var y in p)if(void 0===g[y])m[y]=p[y];else for(var C in p[y])!0!==g[y][C]&&(m[y]=m[y]||{},m[y][C]=!0);for(var y in g)if(void 0===p[y])f[y]=g[y];else for(var C in g[y])!0!==p[y][C]&&(f[y]=f[y]||{},f[y][C]=!0);switch(i){case"left":s=d;break;case"center":s=l;break;case"right":s=c;break;default:s=l}for(var y in m)for(var C in m[y]){s.getCell(y,C).addCls(n)}for(var y in f)for(var C in f[y]){s.getCell(y,C).removeCls(n)}},getSelectedCells(e="center"){for(var t=this.widget.getBody(e).el.select(v),i={},n=0,s=t.length;n<s;n++){var r=t.item(n),o=Number(r.parent().attr("index")),a=Number(r.attr("index"));i[a]=i[a]||{},i[a][o]=!0}return i},getNumberSelectedCells(){return this.widget.el.select(v).length},getSelectedColumns(e){for(var t={},i=this.widget.getBody(e).el.select("."+l),n=0,s=i.length;n<s;n++)t[i.item(n).attr("index")]=!0;return t},selectColumns(e,t,i){var n=this.getSelectedColumns(i||"center"),s={},r={},o={},a=e,l=t;for(l<a&&(a=t,l=e),l++;a<l;a++)s[a]=!0;for(var d in s)!0!==n[d]&&(r[d]=!0);for(var d in n)!0!==s[d]&&(o[d]=!0);for(var d in r)this.selectColumn(d,i);for(var d in o)this.deselectColumn(d,i)},selectColumn(t,i="center"){const n=this.widget.getBody(i);e.get(n.getDomColumn(t)).addCls(l)},deselectColumn(t,i="center"){const n=this.widget.getBody(i);e.get(n.getDomColumn(t)).removeCls(l)},getSelection(t){var i,n=this,s=n.widget,r=s.store,o={};switch(n.selModel){case"row":o.row=n.getSelectedRow(),-1!==o.row?(o.items=[r.get(o.row)],o.rows=[o.row]):(o.items=[],o.rows=[]);break;case"rows":if(o.rows=n.getSelectedRows(),n.memory&&n.memory.all)i=n.memory.excepted,r.filteredDataMap?o.items=Fancy.Array.copy(r.filteredData):o.items=Fancy.Array.copy(r.data);else if(o.items=[],n.memory&&!Fancy.Object.isEmpty(n.memory.selected)){var a=n.memory.selected;if(r.filteredDataMap)for(var l in a)r.filteredDataMap[l]&&o.items.push(r.getById(l));else for(var l in a){var d=r.getById(l);d?o.items.push(d):o.items.push(n.memory.selected[l])}}else for(var c=0,h=o.rows.length;c<h;c++)o.items.push(r.get(o.rows[c]));break;case"cells":if(o.items=n.getSelectedData(),t){var u=s.el.select(v);u.length>1?(o.nodes=[],e.each(u.dom,function(t){o.nodes.push(n.getNodeInfo(new e.Element(t)))})):1===u.length?o.nodes=[this.getNodeInfo(u)]:o.nodes=[]}break;case"cell":if(o.items=n.getSelectedData(),t){var g=s.el.select(v);g.length?o.nodes=[this.getNodeInfo(g)]:o.nodes=[]}}if(i){var p=[];e.each(o.items,(t,n)=>{e.isObject(t.data)&&(o.items[n]=t.data);var s=o.items[n].id;i[s]||p.push(o.items[n])}),o.items=p}else e.each(o.items,(t,i)=>{t&&e.isObject(t.data)&&(o.items[i]=t.data)});return t?o:o.items||[]},renderHeaderCheckBox(){const e=this,t=this.widget;t.header&&(e._renderHeaderCheckBox(t.leftHeader,t.leftColumns),e._renderHeaderCheckBox(t.header,t.columns),e._renderHeaderCheckBox(t.rightHeader,t.rightColumns))},_renderHeaderCheckBox(t,i){const n=this,s=n.widget,r=n.memory,o=s.getSelection();e.each(i,(i,a)=>{if(("$selected"===i.index||i.select)&&!1!==i.headerCheckBox){const d=t.getCell(a);d.addCls(c);const u=d.firstChild(),g=!n.disabled,m=d.select("."+h);if(i.select?m.update(i.title||""):m.update(""),u.select("."+p).length)e.getWidget(u.select("."+p).item(0).attr("id")).destroy();var l=!1;n.memory?r.all&&(l=!0):o.length===s.getViewTotal()&&0!==o.length&&(l=!0),i.headerCheckBox=new e.CheckBox({renderTo:u.dom,renderBefore:i.select?m:void 0,renderId:!0,value:l,label:!1,editable:g,disabled:n.disabled,style:{padding:"0px",display:"inline-block"},events:[{change(e,t){t?(r&&r.setAll(),n.selectAll()):(r&&r.clearAll(),n.deSelectAll()),n.updateHeaderCheckBox()}}]})}})},selectAll(){var i=this,n=i.widget,s=n.store,r=n.el.select("."+c+" ."+p),o=0,l=n.getViewTotal();for(i.memory&&s.isTree&&(i.memory.tree.selected={},i.memory.tree.allSelected={},i.memory.tree.selectedLength={},i.updateTreeSelection()),i.selectingAll=!0;o<l;o++){for(var d=n.el.select("."+a+" ."+t+'[index="'+o+'"] .'+p),h=0,u=d.length;h<u;h++){e.getWidget(d.item(h).attr("id")).setValue(!0)}i.domSelectRow(o)}r.each(t=>{e.getWidget(t.attr("id")).setValue(!0,!1)}),n.fire("select",n.getSelection()),setTimeout(()=>{delete i.selectingAll},1)},deSelectAll(){var i=this,n=i.widget,s=n.store,r=0,o=n.getViewTotal();for(i.memory&&s.isTree&&(i.memory.tree.selected={},i.memory.tree.allSelected={},i.memory.tree.selectedLength={},i.updateTreeSelection()),i.deselectingAll=!0;r<o;r++){n.el.select("."+a+" ."+t+'[index="'+r+'"] .'+p).each(t=>{e.getWidget(t.attr("id")).setValue(!1)}),i.domDeSelectRow(r)}i.updateHeaderCheckBox(),n.fire("clearselect"),n.fire("select",n.getSelection()),delete i.deselectingAll},updateHeaderCheckBox(){const t=this,i=t.widget,n=i.getTotal();i.el.select(`.${c} .${p}`).each(i=>{const s=e.getWidget(i.attr("id"));t.memory?t.memory.selectedLength>0||t.memory.all?t.memory.selectedLength===n?(s.setValue(!0,!1),s.setMiddle(!1)):t.memory.all&&0===t.memory.exceptedLength?(s.setValue(!0,!1),s.setMiddle(!1)):(s.setMiddle(!0),s.setValue(!1,!1)):(s.setMiddle(!1),s.setValue(!1,!1)):t.selectingAll?s.setValue(!0,!1):s.setValue(!1,!1)})},stopSelection(){this.enabled=!1},enableSelection(e){const t=this;!0===t.disabled&&t.enableHeaderCheckBoxes(),t.disabled=!1,t.disabled=!1,this.enabled=void 0===e||e},initFixTrackOver(){const e=this,t=e.widget;t.columns&&(t.body.el.on("mouseleave",e.onBodyMouseLeave,e),t.body.el.on("mouseenter",e.onBodyMouseEnter,e)),t.leftColumns&&(t.leftBody.el.on("mouseleave",e.onLeftBodyMouseLeave,e),t.leftBody.el.on("mouseenter",e.onLeftBodyMouseEnter,e)),t.rightColumns&&(t.rightBody.el.on("mouseleave",e.onRightBodyMouseLeave,e),t.rightBody.el.on("mouseenter",e.onRightBodyMouseEnter,e))},onBodyMouseLeave(){const e=this.widget;this.clearBodyTrackCls(e.body)},onBodyMouseEnter(){const e=this;e.rowTrackFixInBody=!0,setTimeout(()=>{e.rowTrackFixInBody=!1},30)},onLeftBodyMouseLeave(){const e=this.widget;this.clearBodyTrackCls(e.leftBody)},onLeftBodyMouseEnter(){const e=this;e.rowTrackFixInBody=!0,setTimeout(()=>{e.rowTrackFixInBody=!1},30)},onRightBodyMouseLeave(){const e=this.widget;this.clearBodyTrackCls(e.rightBody)},onRightBodyMouseEnter(){const e=this;e.rowTrackFixInBody=!0,setTimeout(()=>{e.rowTrackFixInBody=!1},30)},clearBodyTrackCls(e){const t=this,n=t.widget;n.cellTrackOver&&e.el.select("."+i).removeCls(i),n.trackOver&&(delete e.prevCellOver,clearInterval(t.rowTrackFixInterval),delete t.rowTrackFixInterval,t.rowTrackFixInterval=setTimeout(()=>{t.rowTrackFixInBody||n.el.select("."+d).removeCls(d)},20))},onColumnLock(){let t,i=this,n=i.widget;i.cells||i.cell||i.column||i.columns?i.clearSelection():(t=i.getSelection(!0),e.each(t.rows,e=>{n.selectRow(e,!0,"rows"===n.selModel)},100),setTimeout(()=>{i.renderHeaderCheckBox()},100))},onColumnRightLock(){var t,i=this,n=i.widget;i.cells||i.cell||i.column||i.columns?i.clearSelection():(setTimeout(()=>{t=i.getSelection(!0),e.each(t.rows,e=>{n.selectRow(e,!0,"rows"===n.selModel)})},100),setTimeout(()=>{i.renderHeaderCheckBox()},100))},onUnColumnLock(){var t,i=this,n=i.widget;i.cells||i.cell||i.column||i.columns?i.clearSelection():(setTimeout(()=>{t=i.getSelection(!0),e.each(t.rows,e=>{n.selectRow(e,!0,"rows"===n.selModel)})},100),setTimeout(()=>{i.renderHeaderCheckBox()},100))},disableSelection(){this.disabled=!0,this.enableHeaderCheckBoxes(!1)},enableHeaderCheckBoxes(t){var i=this.widget,n=i.body,s=i.leftBody,o=i.rightBody,a="enable";!1===t&&(a="disable"),e.each(i.columns,(t,i)=>{"select"===t.type&&t.headerCheckBox&&(t.headerCheckBox[a](),n.el.select("."+r+'[index="'+i+'"] .'+p).each(function(t){e.getWidget(t.attr("id"))[a]()}))}),e.each(i.leftColumns,(t,i)=>{"select"===t.type&&t.headerCheckBox&&(t.headerCheckBox[a](),s.el.select("."+r+'[index="'+i+'"] .'+p).each(t=>{e.getWidget(t.attr("id"))[a]()}))}),e.each(i.rightColumns,(t,i)=>{"select"===t.type&&t.headerCheckBox&&(t.headerCheckBox[a](),o.el.select("."+r+'[index="'+i+'"] .'+p).each(t=>{e.getWidget(t.attr("id"))[a]()}))})},onFilter(){const t=this,i=t.widget;t.clearActiveCell(),t.memory||t.clearSelection(),"rows"===t.selModel&&(e.each(i.leftColumns,(n,s)=>{if("select"===n.type){const n=i.leftHeader.getCell(s),r=e.getWidget(n.select("."+p).attr("id"));r&&(t.memory&&t.memory.all||r.set(!1,!1))}}),e.each(i.columns,(n,s)=>{if("select"===n.type){const n=i.header.getCell(s),r=e.getWidget(n.select("."+p).attr("id"));r&&(t.memory&&t.memory.all||r.set(!1,!1))}}),e.each(i.rightColumns,(n,s)=>{if("select"===n.type){const n=i.rightHeader.getCell(s),r=e.getWidget(n.select("."+p).attr("id"));r&&(t.memory&&t.memory.all||r.set(!1,!1))}}))},onExpand(){const e=this;e.clearActiveCell(),e.memory||e.clearSelection()},onCollapse(){const e=this;e.clearActiveCell(),e.memory||e.clearSelection()},getActiveCell(){let e=this.widget,t=e.el.select(w);return t.dom||(t=(t=e.el.select(v)).dom?t.item(0):e.body.getCell(0,0)),t},getActiveCellInfo(e){var t=this.widget;e=e||this.getActiveCell();return{side:t.getSideByCell(e),rowIndex:Number(e.attr("index")),columnIndex:Number(e.parent().attr("index")),value:(e.dom?e.dom.innerHTML:e.innerHTML).replace(/(<([^>]+)>)/gi,"")}},clearActiveCell(){this.widget.el.select(w).removeCls(s)},initCopyEl(){const t=this.widget,i=e.newEl("textarea");i.addCls(y),i.attr("aria-hidden","true"),this.copyEl=e.get(t.el.dom.appendChild(i.dom))},copy(t){var i,n=this,s=n.widget,r=n.copyEl;switch(n.selModel){case"cells":case"cell":var o=n.getSelectedData(t),a="";e.each(o,e=>{a+=e.join("\t")+"\n"}),r.dom.value=a;break;case"rows":case"row":i=n.getSelection();var l=s.getColumns();a="";if(t){const t=[];e.each(l,e=>{switch(e.index){case"$selected":case"$rowdrag":return}switch(e.type){case"action":case"color":case"image":case"rowdrag":case"grossloss":case"progressbar":case"progressdonut":case"hbar":case"sparklineline":case"sparklinebar":case"sparklinetristate":case"sparklinediscrete":case"sparklinebullet":case"sparklinepie":case"sparklinebox":return}t.push(e.index||"")}),a+=t.join("\t")+"\n"}else 0===i.length&&n.activeCell&&(a=n.getActiveCellInfo().value);e.each(i,t=>{const i=[];e.each(l,e=>{switch(e.index){case"$selected":case"$rowdrag":return}switch(e.type){case"action":case"color":case"image":case"rowdrag":case"grossloss":case"progressbar":case"progressdonut":case"hbar":case"sparklineline":case"sparklinebar":case"sparklinetristate":case"sparklinediscrete":case"sparklinebullet":case"sparklinepie":case"sparklinebox":return}var n="";e.smartIndexFn?n=e.smartIndexFn(t):e.index&&(n=t[e.index]),i.push(n)}),a+=i.join("\t")+"\n"}),r.dom.value=a;break;case"columns":case"column":o=[];var d=s.getDataView();const c=function(i){const r=s.getColumns(i),a=n.getSelectedColumns(i);for(const i in a){const n=r[i];t&&(o.push([]),o[0].push(n.title||"")),n.index&&e.each(d,(e,i)=>{t&&i++,void 0===o[i]&&(o[i]=[]),o[i].push(e[n.index])})}};s.leftColumns&&c("left"),s.columns&&c("center"),s.rightColumns&&c("right");a="";e.each(o,e=>{a+=e.join("\t")+"\n"}),r.dom.value=a}r.dom.select(),r.dom.focus(),document.execCommand("copy")},initCopyKeys(){Fancy.get(document).on("keydown",this.onKeyDownCopy,this)},onKeyDownCopy(e){const t=this,i=t.widget,n=e.keyCode,s=Fancy.key;if(!1!==i.activated&&(e.ctrlKey||e.metaKey))switch(n){case s.C:if(i.celledit&&i.celledit.activeEditor)return;if(i.textSelection)return;t.copy();break;case s.V:t.copyEl.dom.value="",t.copyEl.dom.focus(),setTimeout(()=>{t.insertDataFromBuffer()},1)}},insertDataFromBuffer(){const t=this.widget,i=this.getDataFromCopyEl(),n=this.getColumnIdToInsert(i),s=this.getRowIdToInsert(i);e.each(s,(s,r)=>{e.each(n,(e,n)=>{const o=t.getColumnById(e),a=o.index,l=i[r][n];void 0!==a&&!o.smartIndexFn&&o.editable&&t.setById(s,a,l)})})},getRowIdToInsert(e){const t=this,i=t.widget,n=[];if(0===e.length)return[];var s;if(t.activeCell)s=t.getActiveCellInfo();else{const e=i.el.select(v).item(0);s=t.getActiveCellInfo(e)}for(var r=s.rowIndex,o=r+e.length;r<o;r++){const e=i.get(r);if(!e)break;n.push(e.id)}return n},getColumnIdToInsert(e){const t=this,i=t.widget,n=[];if(0===e.length)return[];var s;if(t.activeCell)s=t.getActiveCellInfo();else{const e=i.el.select(v).item(0);s=t.getActiveCellInfo(e)}for(var r=i.getColumns(s.side),o=s.columnIndex,a=o+e[0].length;o<a;o++){const e=r[o];if(void 0===e)break;e.hidden?a++:n.push(e.id)}return n},getDataFromCopyEl(){const t=[],i=this.copyEl.dom.value.split("\n");return""===i[i.length-1]&&i.pop(),e.each(i,i=>{var n=[],s=i.split("\t");1===s.length&&(s=i.split("    ")),e.each(s,e=>n.push(e)),t.push(n)}),t},onColumnDrag(){const e=this;setTimeout(()=>{e.renderHeaderCheckBox()},100)},disableSelectionMove(){this.mouseMoveSelection=!1},getSelectedData(e){const t=this,i=t.widget,n=[];var s=function(s){var r=i.getColumns(s),o=t.getSelectedCells(s),a=0,l=!1;for(var d in o){var c=i.get(d),h=o[d];if(!l&&e){for(var u in n.push([]),h){(g=r[u]).index,n[0].push(g.title||"")}a++,l=!0}for(var u in h){var g=r[u];n[a]||(n[a]=[]),g.index&&n[a].push(c.get(g.index))}a++}};return s("left"),s("center"),s("right"),n},selectNodesChilds(t,i){const n=this,s=n.widget,r=s.getById(t);!1===i&&n.memory&&n.memory.remove(t),r.set("$selected",i);const o=function(r){e.each(r,e=>{if(e.$selected=i,!e.id)return!0;const r=s.getRowById(e.id);void 0!==r&&s.selectRow(r,i,!0),!1===i&&n.memory&&n.memory.remove(t),e.data&&e.data.child&&o(e.data.child)})};o(r.data.child)},clearOverCells(){this.widget.el.select(`.${i}`).removeCls(i)},onDragRows(){this.clearActiveCell()},onRemoveRows(){const e=this;e.rows&&(clearInterval(e._interval),e._interval=setTimeout(()=>{e.updateHeaderCheckBox(),delete e._interval},1))},onTreeExpand(){const e=this,t=e.widget;e.memory?(e.updateSelection(),e.updateTreeSelection()):t.clearSelection()},onTreeCollapse(){const e=this,t=e.widget;e.memory?(e.updateSelection(),e.updateTreeSelection()):t.clearSelection()},updateSelection(){const e=this,t=e.widget,i=t.store,s=t.body;if(e.memory){s.el.select("."+r+'[index="0"] .'+n).each(n=>{var s=n.attr("index"),r=t.get(s),o=r.id;(r=t.infinite?t.get(s+i.infiniteScrolledToRow):t.get(s))?(o=r.id,e.memory.has(o)||e.domDeSelectRow(s)):e.domDeSelectRow(0)});for(const i in e.memory.selected){const n=t.getRowById(i);void 0!==n&&e.domSelectRow(n)}}else if(t.infinite)switch(e.selModel){case"row":case"rows":s.el.select(`.${r}[index="0"] .${n}`).each(t=>{const i=t.attr("index");e.domDeSelectRow(i)})}},updateSelectCheckBoxes(){const i=this,n=i.widget;i.memory&&n.el.select("."+a+" ."+m).each(s=>{const r=s.closest("."+t).attr("index"),o=n.get(r).id;if(!i.memory.has(o)){e.getWidget(s.attr("id")).set(!1,!1),i.domDeSelectRow(r)}})},updateTreeSelection(){const i=this,s=i.widget;for(var o in i.memory.tree.selected){const n=s.getRowById(o),r=s.el.select("."+a+" ."+t+'[index="'+n+'"] .'+p);i.memory.tree.allSelected[o]?r.each(t=>{const s=t.attr("id"),r=e.getWidget(s);setTimeout(()=>{r.set(!0,!1),r.setMiddle(!1),i.memory.add(o),i.domSelectRow(n)},200)}):r.each(t=>{const i=t.attr("id");e.getWidget(i).setMiddle(!0)})}s.el.select("."+r+"."+a+" ."+C).each(r=>{const o=r.closest(`.${t}`),a=o.attr("index"),l=s.get(a,"id"),d=e.getWidget(r.attr("id"));i.memory.tree.selected[l]||(d.setMiddle(!1),i.memory.tree.allSelected[l]?d.setMiddle(!1):d.set(!1,!1)),i.memory.tree.allSelected[l]&&setTimeout(()=>{d.set(!0,!1),d.setMiddle(!1),i.memory.add(l),i.domSelectRow(a)},200),d.hasCls(m)&&(d.removeCls(C),i.domSelectRow(a),i.memory.add(l),i.memory.removeDirtyParent(l)),o.hasCls(n)&&!d.hasCls(m)&&d.set(!0,!1)})},getNodeInfo(e){var t=this.widget,i=e.parent(),n=i.parent().parent(),s="";n.hasCls("fancy-grid-center")?s="center":n.hasCls("fancy-grid-left")?s="left":n.hasCls("fancy-grid-right")&&(s="right");const r=t.getColumns(s);return{side:s,columnIndex:Number(i.attr("index")),index:r[Number(i.attr("index"))].index,column:r[Number(i.attr("index"))],rowIndex:Number(e.attr("index")),cell:e,value:e.select(".fancy-grid-cell-inner").dom.innerHTML}}})}(),function(){const e=Fancy,t=e.GRID_CELL_ACTIVE_CLS,i=e.GRID_CELL_SELECTED_CLS;e.Mixin("Fancy.grid.selection.mixin.Navigation",{initNavigation(){this.addEvents("up","down","left","right"),this.onsNav()},onsNav(){Fancy.get(document).on("keydown",this.onKeyDown,this)},onKeyDown(t){const i=this,n=i.widget,s=t.keyCode,r=Fancy.key;if(!1!==n.activated){if(!i.keyNavigating){e.get(document).once("keyup",()=>delete i.keyNavigating)}if(!(n.celledit&&n.celledit.activeEditor||n.rowedit&&n.rowedit.el&&n.rowedit.isVisible()))switch(s){case r.TAB:break;case r.UP:i.keyNavigating=!0,t.preventDefault(),clearInterval(i.intervalUp),i.intervalUp=setTimeout(()=>{i.moveUp(),delete i.intervalUp},1);break;case r.DOWN:i.keyNavigating=!0,t.preventDefault(),clearInterval(i.intervalDown),i.intervalDown=setTimeout(()=>{i.moveDown(),delete i.intervalDown},1);break;case r.LEFT:i.keyNavigating=!0,t.preventDefault(),i.moveLeft();break;case r.RIGHT:i.keyNavigating=!0,t.preventDefault(),i.moveRight();break;case r.PAGE_UP:t.preventDefault(),i.scrollPageUP();break;case r.PAGE_DOWN:t.preventDefault(),i.scrollPageDOWN();break;case r.HOME:t.preventDefault(),i.scrollHome();break;case r.END:t.preventDefault(),i.scrollEnd();break;case r.SPACE:if(n.celledit&&!n.celledit.activeEditor)if(n.selection&&"cell"===n.selection.selModel||"cells"===n.selection.selModel)if(d=n.selection.getActiveCell()){var o=n.selection.getActiveCellInfo(),a=n.getColumns(o.side);if(o.column=a[o.columnIndex],!0!==o.column.editable)return;switch(o.column.type){case"checkbox":case"switcher":o.cell=d.dom;var l=n.get(o.rowIndex);o.item=l,o.data=l.data,o.column.smartIndexFn?o.value=o.column.smartIndexFn(o.data):o.value=n.store.get(o.rowIndex,o.column.index),n.celledit.edit(o)}}break;case r.ENTER:if(n.celledit&&!n.celledit.activeEditor)if(n.selection&&"cell"===n.selection.selModel||"cells"===n.selection.selModel||n.selection.activeCell)if(d=n.selection.getActiveCell()){o=n.selection.getActiveCellInfo(),a=n.getColumns(o.side);if(o.column=a[o.columnIndex],!0!==o.column.editable)return;switch(o.column.type){case"switcher":case"checkbox":return}o.cell=d.dom;l=n.get(o.rowIndex);o.item=l,o.data=l.data,o.column.smartIndexFn?o.value=o.column.smartIndexFn(o.data):o.value=n.store.get(o.rowIndex,o.column.index),n.celledit.edit(o)}break;case r.BACKSPACE:case r.DELETE:if(n.selection&&("cell"===n.selection.selModel||n.selection.activeCell))if(d=n.selection.getActiveCell()){o=n.selection.getActiveCellInfo(),a=n.getColumns(o.side);if(o.column=a[o.columnIndex],!0!==o.column.editable)return;o.cell=d.dom;l=n.get(o.rowIndex);o.item=l,o.data=l.data,o.value="",n.celledit.edit(o)}break;case r.ESC:case r.ALT:case r.CTRL:case r.SHIFT:case r.CAPS_LOCK:case r.F1:case r.F2:case r.F3:case r.F4:case r.F5:case r.F6:case r.F7:case r.F8:case r.F9:case r.F10:case r.F11:case r.F12:break;default:var d;if(n.startEditByTyping&&n.celledit&&!n.celledit.activeEditor)if(n.selection&&"cell"===n.selection.selModel||"cells"===n.selection.selModel||n.selection.activeCell)if(d=n.selection.getActiveCell()){o=n.selection.getActiveCellInfo(),a=n.getColumns(o.side);if(o.column=a[o.columnIndex],!0!==o.column.editable)return;o.cell=d.dom;l=n.get(o.rowIndex);o.item=l,o.data=l.data,o.value="",n.celledit.edit(o)}}}},moveRight(){var n,s=this,r=s.widget,o=s.getActiveCellInfo(),a=r.getBody(o.side);if(o.columnIndex++,!(n=a.getCell(o.rowIndex,o.columnIndex)).dom)switch(o.side){case"left":r.columns&&(o.columnIndex=0,a=r.getBody("center"),o.side="center",n=a.getCell(o.rowIndex,o.columnIndex));break;case"center":r.rightColumns&&r.rightColumns.length&&(e.each(r.rightColumns,(e,t)=>{if(!e.hidden)return o.columnIndex=t,a=r.getBody("right"),o.side="right",!0}),n=a.getCell(o.rowIndex,o.columnIndex));break;case"right":return}if(n.dom){switch(o.side){case"left":if(r.leftColumns[o.columnIndex].hidden){for(var l=o.columnIndex,d=r.leftColumns.length,c=!1;l<d;l++)if(!r.leftColumns[l].hidden){c=!0,o.columnIndex=l;break}if(!c){o.columnIndex--;for(l=o.columnIndex,d=r.columns.length,c=!1;l<d;l++)if(!r.columns[l].hidden){c=!0,o.columnIndex=l;break}c&&(o.side="center",a=r.getBody(o.side))}n=a.getCell(o.rowIndex,o.columnIndex)}break;case"center":if(r.columns[o.columnIndex].hidden){for(l=o.columnIndex,d=r.columns.length,c=!1;l<d;l++)if(!r.columns[l].hidden){c=!0,o.columnIndex=l;break}if(!c){c=!1;e.each(r.rightColumns,(e,t)=>{if(!e.hidden)return c=!0,o.columnIndex=t,o.side="right",!0}),c?a=r.getBody(o.side):o.columnIndex--}n=a.getCell(o.rowIndex,o.columnIndex)}break;case"right":if(r.rightColumns[o.columnIndex].hidden){for(l=o.columnIndex,d=r.rightColumns.length,c=!1;l<d;l++)if(!r.rightColumns[l].hidden){c=!0,o.columnIndex=l;break}c||o.columnIndex--,n=a.getCell(o.rowIndex,o.columnIndex)}}switch(s.selModel){case"cell":case"cells":s.clearSelection(),n.addCls(t,i),r.scroller.scrollToCell(n.dom,!0);break;case"column":case"columns":r.selection&&r.selection.activeCell?(r.selection.clearActiveCell(),n.addCls(t),r.scroller.scrollToCell(n.dom,!0)):(s.clearSelection(),s.selectColumn(o.columnIndex,o.side),n.addCls(t,i),r.scroller.scrollToCell(n.dom,!0));break;case"row":case"rows":r.selection&&r.selection.activeCell&&(r.selection.clearActiveCell(),n.addCls(t),r.scroller.scrollToCell(n.dom,!0))}return n}},moveLeft(){var e,n,s=this,r=s.widget,o=s.getActiveCellInfo(),a=r.getBody(o.side);if(o.columnIndex--,o.columnIndex<0)switch(o.side){case"left":return;case"center":if(!r.leftColumns||!r.leftColumns.length)return;if(o.columnIndex=r.leftColumns.length-1,a=r.getBody("left"),o.side="left",e=a.getCell(o.rowIndex,o.columnIndex),r.leftColumns[o.columnIndex].hidden)for(var l=o.columnIndex-1,d=!1;l>=0;l--)if(!r.leftColumns[l].hidden){d=!0,o.columnIndex=l;break}e=a.getCell(o.rowIndex,o.columnIndex);break;case"right":if(r.columns&&r.columns.length){for(l=r.columns.length,d=!1;l--;){if(!r.columns[l].hidden){o.columnIndex=l,a=r.getBody("center"),o.side="center",d=!0;break}}if(!d&&r.leftColumns.length)for(l=r.leftColumns.length;l--;){if(!r.leftColumns[l].hidden){o.columnIndex=l,a=r.getBody("left"),o.side="left",d=!0;break}}e=a.getCell(o.rowIndex,o.columnIndex)}}else{switch(o.side){case"left":if(r.leftColumns[o.columnIndex].hidden){for(l=o.columnIndex-1,d=!1;l>=0;l--)if(!r.leftColumns[l].hidden){d=!0,o.columnIndex=l;break}d||o.columnIndex++}break;case"center":if(r.columns[o.columnIndex].hidden){for(l=o.columnIndex-1,d=!1;l>=0;l--)if(!r.columns[l].hidden){d=!0,o.columnIndex=l;break}if(!d&&(o.columnIndex++,r.leftColumns)){for(l=r.leftColumns.length-1,d=!1;l>=0;l--)if(!r.leftColumns[l].hidden){d=!0,o.columnIndex=l;break}d&&(n="left",a=r.getBody(n))}}break;case"right":if(r.rightColumns[o.columnIndex].hidden){for(l=o.columnIndex-1,d=!1;l>=0;l--)if(!r.rightColumns[l].hidden){d=!0,o.columnIndex=l;break}if(!d){o.columnIndex++;l=r.columns.length-1,d=!1;for(n="center",a=r.getBody(n);l>=0;l--)if(!r.columns[l].hidden){d=!0,o.columnIndex=l;break}}}}e=a.getCell(o.rowIndex,o.columnIndex)}if(e.dom)switch(s.selModel){case"cell":case"cells":s.clearSelection(),e.addCls(t,i),r.scroller.scrollToCell(e.dom,!0);break;case"column":case"columns":r.selection&&r.selection.activeCell?(r.selection.clearActiveCell(),e.addCls(t),r.scroller.scrollToCell(e.dom,!0)):(s.clearSelection(),s.selectColumn(o.columnIndex,o.side),e.addCls(t,i),r.scroller.scrollToCell(e.dom,!0));break;case"row":case"rows":r.selection.clearActiveCell(),e.addCls(t),r.scroller.scrollToCell(e.dom,!0)}},moveUp(){var e,n=this,s=n.widget,r=s.store,o=n.getActiveCellInfo(),a=s.getBody(o.side);if(s.infinite&&0===o.rowIndex){var l=r.infiniteScrolledToRow-1;l<0&&(l=0),r.infiniteScrolledToRow=l,s.update(),s.selection&&s.selection.updateSelection()}if(o.rowIndex--,!(o.rowIndex<0)&&(e=a.getCell(o.rowIndex,o.columnIndex)).dom){switch(n.selModel){case"cell":case"cells":n.clearSelection(),e.addCls(t,i),s.infinite||s.scroller.scrollToCell(e.dom,!0);break;case"row":case"rows":s.selection&&s.selection.activeCell?(s.selection.clearActiveCell(),e.addCls(t),s.infinite||s.scroller.scrollToCell(e.dom,!0)):(n.clearSelection(),n.selectRow(o.rowIndex),e.addCls(t,i),s.infinite||s.scroller.scrollToCell(e.dom,!0),"rows"===n.selModel&&n.updateHeaderCheckBox());break;case"column":case"columns":s.selection&&s.selection.activeCell&&(s.selection.clearActiveCell(),e.addCls(t),s.infinite||s.scroller.scrollToCell(e.dom,!0))}return e}},moveDown(){var e,n=this,s=n.widget,r=s.store,o=n.getActiveCellInfo(),a=s.getBody(o.side);if(s.infinite&&o.rowIndex>s.numOfVisibleCells-3){var l=r.infiniteScrolledToRow+1;return l>r.getNumOfInfiniteRows()-(s.numOfVisibleCells-1)&&(l=r.getNumOfInfiniteRows()-(s.numOfVisibleCells-1)),r.infiniteScrolledToRow=l,s.update(),void(s.selection&&s.selection.updateSelection())}if(o.rowIndex++,(e=a.getCell(o.rowIndex,o.columnIndex)).dom){switch(n.selModel){case"cell":case"cells":n.clearSelection(),e.addCls(t,i),s.infinite||s.scroller.scrollToCell(e.dom,!0);break;case"row":case"rows":s.selection&&s.selection.activeCell?(s.selection.clearActiveCell(),e.addCls(t),s.infinite||s.scroller.scrollToCell(e.dom,!0)):(n.clearSelection(),n.selectRow(o.rowIndex),e.addCls(t,i),s.infinite||s.scroller.scrollToCell(e.dom,!0),"rows"===n.selModel&&n.updateHeaderCheckBox());break;case"column":case"columns":s.selection&&s.selection.activeCell&&(s.selection.clearActiveCell(),e.addCls(t),s.scroller.scrollToCell(e.dom,!0))}return e}},scrollPageUP(){var e,t=this.widget,i=parseInt(t.body.el.height()),n=t.scroller;(e=t.nativeScroller?t.body.el.dom.scrollTop-i:n.scrollTop-i)<0&&(e=0),t.scroll(e)},scrollPageDOWN(){var e,t=this.widget,i=t.gridBorders,n=t.getBodyHeight()-i[0]-i[2],s=t.getCellsViewHeight()-i[0]-i[2],r=t.scroller;(e=t.nativeScroller?t.body.el.dom.scrollTop+n:r.scrollTop+n)>s-n&&(e=s-n),e<0&&(e=0),t.scroll(e)},scrollHome(){this.widget.scroll(0)},scrollEnd(){this.widget.scroll(1e6)}})}(),Fancy.modules.expander=!0,function(){const e=Fancy,t=e.get,i=e.GRID_CELL_CLS,n=e.GRID_COLUMN_CLS,s=e.GRID_ROW_EXPAND_CLS,r=e.GRID_ROW_EXPAND_OVER_CLS,o=e.GRID_ROW_EXPAND_SELECTED_CLS,a=e.GRID_ROW_OVER_CLS;e.define("Fancy.grid.plugin.Expander",{extend:e.Plugin,ptype:"grid.expander",inWidgetName:"expander",plusScroll:0,enabledCollapse:!0,constructor:function(){this.Super("const",arguments)},init(){const e=this;e.Super("init",arguments),e._expanded={},e._expandedIds={},e.expandedGroups={},e.initTpl(),e.ons()},ons(){const e=this,t=e.widget,i=t.store;t.on("scroll",e.onScroll,e),t.on("beforesort",e.onBeforeSort,e),t.on("changepage",e.onChangePage,e),t.on("filter",e.onFilter,e),t.on("columnresize",e.onColumnReSize,e),t.on("rowdblclick",e.onRowDBlClick,e),t.on("rowtrackenter",e.onRowTrackOver,e),t.on("rowtrackleave",e.onRowTrackLeave,e),t.on("collapse",e.onGroupCollapse,e),t.on("expand",e.onGroupExpand,e),t.on("remove",e.onRemove,e),t.on("render",function(){t.el.on("mouseenter",e.onExpandRowMouseEnter,e,"div."+s),t.el.on("mouseleave",e.onExpandRowMouseLeave,e,"div."+s)}),t.on("select",e.onSelect,e),t.on("clearselect",e.onClearSelect,e),i.on("beforeinsert",e.onBeforeInsert,e),t.on("columndrag",e.onColumnDrag,e),t.on("lockcolumn",e.onLockColumn,e),t.on("rightlockcolumn",e.onRightLockColumn,e),t.on("unlockcolumn",e.onUnLockColumn,e),e.expanded&&(i.proxyType?t.once("load",()=>e.expandAll()):t.on("init",()=>e.expandAll()))},expand(t){const s=this,r=s.widget,o=r.get(t).id;void 0===s._expandedIds[o]?(s._expandedIds[o]={},s.expandRow(Number(t),o),s.addMargin(Number(t)+1,o)):s.showRow(Number(t),o),delete s._expandedIds[o].hidden,s.reSetTop(),s.reSetPlusScroll();for(var a=r.el.select(`.${n}[grid="${r.id}"] .${i}[index="${t}"] .fancy-checkbox-expander`),l=0,d=a.length;l<d;l++){const t=e.getWidget(a.item(l).attr("id"));!1===t.get()&&t.set(!0,!1)}s.changeSidesSize(),s.onSelect()},collapse(e){const t=this,i=t.widget,n=i.scroller,s=i.get(e).id;t.collapseRow(Number(e),s),t.clearMargin(Number(e)+1,s),t._expandedIds[s].hidden=!0,t.reSetTop(),t.reSetPlusScroll(),t.changeSidesSize(),n.scrollDelta(1),n.scrollRightKnob()},collapseRow(t,s){const r=this,o=r.widget,a=r._expandedIds[s];if(!r._expandedIds[s])return!1;r._expandedIds[s].timeOutCheckHeight1&&(clearTimeout(r._expandedIds[s].timeOutCheckHeight1),delete r._expandedIds[s].timeOutCheckHeight1),r._expandedIds[s].timeOutCheckHeight2&&(clearTimeout(r._expandedIds[s].timeOutCheckHeight2),delete r._expandedIds[s].timeOutCheckHeight2),r._expandedIds[s].timeOutCheckHeight3&&(clearTimeout(r._expandedIds[s].timeOutCheckHeight3),delete r._expandedIds[s].timeOutCheckHeight3),r._expandedIds[s].timeOutCheckHeight4&&(clearTimeout(r._expandedIds[s].timeOutCheckHeight4),delete r._expandedIds[s].timeOutCheckHeight4),a.el.hide(),a.hidden=!0,o.leftColumns&&a.leftEl.hide(),o.rightColumns&&a.rightEl.hide();for(var l=o.el.select(`.${n}[grid="${o.id}"] .${i}[index="${t}"] .fancy-checkbox-expander`),d=0,c=l.length;d<c;d++){const t=e.getWidget(l.item(d).attr("id"));!0===t.get()&&(t.set(!1,!1),t.collapsedTime=new Date)}},_hideAllSideExpandedRow(){const e=this,t=e.widget;for(const i in e._expandedIds){const n=e._expandedIds[i];n.el.hide(),n.hidden=!0,t.leftColumns&&n.leftEl.hide(),t.rightColumns&&n.rightEl.hide()}},expandAll(){let e=this.widget.getViewTotal(),t=0;for(;t<e;t++)this.expand(t)},expandRow(t,i){var n,r,o=this,a=o.widget,l=e.newEl("div"),d=a.getById(i),c=o.prepareData(d),h=-a.scroller.scrollLeft||0,u=a.getCenterFullWidth();if(o.tpl&&(n=o.tpl.getHTML(c),l.update(n)),l.addCls(s),l.css({left:h,width:u}),l.attr("index",t),a.body.el.dom.appendChild(l.dom),o.render){o.render(l.dom,c,a.getCenterFullWidth());const e=()=>{const e=parseInt(l.css("height"));r!==e&&o._expandedIds[i]&&(o._expandedIds[i].height=e,g.css("height",e),p.css("height",e),o.addMargin(Number(t)+1,i))};o._expandedIds[i].timeOutCheckHeight1=setTimeout(e,100),o._expandedIds[i].timeOutCheckHeight2=setTimeout(e,500),o._expandedIds[i].timeOutCheckHeight3=setTimeout(e,1e3),o._expandedIds[i].timeOutCheckHeight4=setTimeout(e,3e3)}if(r=parseInt(l.css("height")),o._expandedIds[i].rowIndex=t,o._expandedIds[i].el=l,o._expandedIds[i].height=r,o._expandedIds[i].width=u,a.leftColumns){var g=e.newEl("div");g.css("left","0px"),g.css("height",r),g.css("width",a.getLeftFullWidth()),g.attr("index",t),g.addCls(s),a.leftBody.el.dom.appendChild(g.dom),o._expandedIds[i].leftEl=g}if(a.rightColumns){var p=e.newEl("div");p.css("left","0px"),p.css("height",r),p.css("width",a.getRightFullWidth()),p.attr("index",t),p.addCls(s),a.rightBody.el.dom.appendChild(p.dom),o._expandedIds[i].rightEl=p}setTimeout(()=>{a.scroller.update()},100)},addMargin(e,t){const s=this.widget,r=this._expandedIds[t].height;s.el.select(`.${n}[grid="${s.id}"] .${i}[index="${e}"]`).css("margin-top",r)},clearMargin(e){const t=this.widget;t.el.select(`.${n}[grid="${t.id}"] .${i}[index="${e}"]`).css("margin-top","0")},onBeforeSort(){this.reSet()},onChangePage(){this.reSet()},onFilter(){this.reSet()},onRemove(){this.reSet()},reSet(){const e=this,t=e.widget;if(!1!==e.enabledCollapse){for(const t in e._expandedIds){const i=e._expandedIds[t];i.el.destroy(),e.clearMargin(Number(i.rowIndex)+1,t)}e._hideAllSideExpandedRow(),e._expandedIds={},e.reSetTop(),e.reSetPlusScroll(),e.changeSidesSize(),t.scroller.scrollDelta(1),t.setSidesHeight(),setTimeout(()=>{t.setSidesHeight()},100)}},showRow(e,t){const i=this.widget,n=this._expandedIds[t];n.el.show(),i.leftColumns&&n.leftEl.show(),i.rightColumns&&n.rightEl.show(),this.addMargin(e+1,t)},getBeforeHeight(e){let t=0;for(const i in this._expandedIds){const n=this._expandedIds[i];n.rowIndex<e&&!n.hidden&&"none"!==n.el.css("display")&&(t+=n.height)}return t},reSetTop(e){const t=this,i=t.widget,n=i.cellHeight,s=-i.scroller.scrollTop||0,r=-i.scroller.scrollLeft||0;if(i.isGroupable()){t.expandedGroups={};const e=i.grouping.expanded;for(var o in e)t.expandedGroups[o]=t.expandedGroups[o]||{}}for(var o in t._expandedIds){const e=t._expandedIds[o];if("none"!==e.el.css("display")){var a=t.getBeforeHeight(e.rowIndex),l=s+t.getDisplayedRowsBefore(e,o)*n+a;if(i.isGroupable()){const n=o,s=i.grouping.getGroupById(n),r=i.grouping.getGroupOrderIndex(s);"none"!==e.el.css("display")&&(t.expandedGroups[s]=t.expandedGroups[s]||{},t.expandedGroups[s][o]=e,l+=(r+1)*i.groupRowHeight)}e.el.css({top:l,left:r}),i.leftColumns&&e.leftEl.css("top",l),i.rightColumns&&e.rightEl.css("top",l)}}i.isGroupable()&&!1!==e&&(i.grouping.setPositions(),i.grouping.setExpanderCellsPosition())},getDisplayedRowsBefore(e,t){const i=this.widget;if(i.isGroupable()){let n=0;return"none"!==e.el.css("display")&&(n=i.store.getRow(t)),n+1}return e.rowIndex+1},onScroll(){this.reSetTop()},reSetPlusScroll(){const e=this.widget;this.plusScroll=this.getPlusHeight(),e.scroller.setRightKnobSize(),setTimeout(()=>{!1===e.scroller.isRightScrollable()&&e.scroller.scroll(0)},1)},getPlusHeight(){let e=this,t=0;for(const i in e._expandedIds){const n=e._expandedIds[i];n.hidden||"none"===n.el.css("display")||(t+=n.height)}return e.plusHeight=t,e.plusHeight},onColumnReSize(){const e=this,t=e.widget;for(const i in e._expandedIds){const n=e._expandedIds[i],s=t.getCenterFullWidth();n.el.css("width",s)}},prepareData(e){let t=this,i=t.widget,n=e.data;return t.dataFn&&(n=t.dataFn(i,n)),n},changeSidesSize(){const e=this.widget;e.setSidesHeight(),e.scroller.checkRightScroll()},onRowDBlClick(e,t){const i=this,n=i.widget,s=Number(t.rowIndex),r=t.id,o=i._expandedIds[r];n.edit?n.un("rowdblclick",i.onRowDBlClick,i):void 0===o?i.expand(s):!0===o.hidden&&"none"===o.el.css("display")?i.expand(s):i.collapse(s)},onRowTrackOver(e,t){const i=this.widget,n=this._expandedIds[t.id];n&&(n.el.addCls(r),i.leftColumns&&n.leftEl.addCls(r),i.rightColumns&&n.rightEl.addCls(r))},onRowTrackLeave(e,t){const i=this.widget,n=this._expandedIds[t.id];n&&(n.el.removeCls(r),i.leftColumns&&n.leftEl.removeCls(r),i.rightColumns&&n.rightEl.removeCls(r))},onExpandRowMouseEnter(e){const o=this.widget,l=o.scroller,d=t(e.currentTarget).attr("index");o.el.select(`.${s}[index="${d}"]`).addCls(r),!o.trackOver||l.bottomKnobDown||l.rightKnobDown||o.el.select(`.${n}[grid="${o.id}"] .${i}[index="${d}"]`).addCls(a)},onExpandRowMouseLeave(e){const o=this.widget,{bottomKnobDown:l,rightKnobDown:d}=o.scroller,c=t(e.currentTarget).attr("index");o.el.select(`.${s}[index="${c}"]`).removeCls(r),!o.trackOver||l||d||o.el.select(`.${n}[grid="${o.id}"] .${i}[index="${c}"]`).removeCls(a)},onSelect(){const e=this.widget,t=e.selection;t&&(t.row||t.rows)&&(this.onClearSelect(),e.getSelection(!0).rows.forEach(t=>{e.el.select(`.${s}[index="${t}"]`).addCls(o)}))},onClearSelect(){let e=this.widget,t=e.selection;if(!t.row&&!t.rows)return;let i={},n=(t=e.getSelection(!0)).rows,r=0,a=n.length;for(;r<a;r++)i[n[r]]=!0;e.el.select(`.${o}`).each(t=>{const n=t.attr("index");i[n]||e.el.select(`.${s}[index="${n}"]`).removeCls(o)})},onGroupCollapse(e,t,i){const n=this,s=n.widget,r=n.expandedGroups;if(r[i]){const e=r[i];for(const t in e){const i=e[t];n._expandedIds[t]&&delete n._expandedIds[t],i.el.hide(),i.leftEl.dom&&i.leftEl.hide(),i.rightEl.dom&&i.rightEl.hide()}}n.reSetTop(!1),n.reSetIndexes(),setTimeout(()=>{s.grouping.setExpanderCellsPosition()},1)},onGroupExpand(){const e=this.widget;this.reSetTop(!1),this.reSetIndexes(),setTimeout(()=>{e.grouping.setExpanderCellsPosition()},1)},reSetIndexes(){const e=this,t=e.widget.store;for(const i in e._expandedIds)e._expandedIds[i].rowIndex=t.getRow(i)},onAdd(){this.reSet()},onBeforeInsert(){this.reSet()},onColumnDrag(){this.reSet(),this.clearExpandedCheckBoxes()},onLockColumn(){this.reSet(),this.clearExpandedCheckBoxes()},onRightLockColumn(){this.reSet(),this.clearExpandedCheckBoxes()},onUnLockColumn(){this.reSet(),this.clearExpandedCheckBoxes()},clearExpandedCheckBoxes(){this.widget.el.select(".fancy-checkbox-expander.fancy-checkbox-on").each(e=>{const t=e.attr("id");Fancy.getWidget(t).setValue(!1,!1)})},collapseAll(){this.reSet(),this.clearExpandedCheckBoxes()}})}(),Fancy.modules["grouped-header"]=!0,function(){const e=Fancy;e.define("Fancy.grid.plugin.GroupHeader",{extend:e.Plugin,ptype:"grid.groupheader",inWidgetName:"groupheader",constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){}})}(),Fancy.modules.grouping=!0,function(){const e=Fancy,t=Fancy.each,i=e.GRID_ROW_GROUP_INNER_CLS,n=e.GRID_ROW_GROUP_CLS,s=e.GRID_ROW_GROUP_COLLAPSED_CLS,r=`.${e.GRID_CELL_CLS}`;e.define("Fancy.grid.plugin.Grouping",{extend:e.Plugin,ptype:"grid.grouping",inWidgetName:"grouping",tpl:"{text}: {number}",sortGroups:"asc",_renderFirstTime:!0,constructor:function(){this.Super("const",arguments)},init(){const e=this,t=e.widget;e.Super("init",arguments),e.initTpl(),e.by&&(e.initGroups(),e.initOrder(),e.calcPlusScroll(),e.configParams(),e.ons(),!e.collapsed&&t.store.data&&t.store.changeDataView({doNotFired:!0}))},ons(){const e=this;e.widget.once("render",()=>{e.renderGroupedRows(),e.update(),e.onGridRender()},e)},onGridRender(){const e=this,t=e.widget,i=t.store;t.el.on("click",e.onClick,e,`div.${n}`),t.el.on("mousedown",e.onMouseDown,e,`div.${n}`),t.on("scroll",e.onScroll,e),t.on("columnresize",e.onColumnResize,e),i.on("insert",e.onInsert,e),i.on("remove",e.onRemove,e),t.on("columndrag",e.onColumnDrag,e)},uns(){const e=this,t=e.widget,i=t.store;t.el.un("click",e.onClick,e,`div.${n}`),t.el.un("mousedown",e.onMouseDown,e,`div.${n}`),t.un("scroll",e.onScroll),t.un("columnresize",e.onColumnResize),i.un("insert",e.onInsert),i.un("remove",e.onRemove),t.un("columndrag",e.onColumnDrag)},onInsert(){this.reGroup()},onRemove(){const e=this,i=e.widget.store,n=e.groups;var s;(e.initGroups(),e.update(),e.updateGroupRowsText(),n.length>e.groups.length)&&(t(n,function(t,i){if(t!==e.groups[i])return s=t,!0}),delete i.expanded[s])},initGroups(e){var t;t=this.widget.store.initGroups(e),this.groups=t.groups,this.groupsCounts=t._groups},getGroupById(e){return this.store.groupMap[e]},getGroupOrderIndex(e){for(var t=this.groups,i=0,n=t.length;i<n;i++)if(t[i]===e)return i},initOrder(){var t,i=this,n=i.widget.store;if(i.order&&0!==i.order.length)switch(e.typeOf(i.order)){case"string":break;case"array":t=i.order}else t=n.sortGroupNames(i.groups);i.groups=t,n.changeOrderByGroups(t,i.by)},calcPlusScroll(){const e=this.widget;this.plusScroll=this.groups.length*e.groupRowHeight},configParams(){const e=this,t=e.widget.store;t.expanded=t.expanded||{},e.collapsed?t.collapsed=!0:e.groups.forEach(e=>{void 0===t.expanded[e]&&(t.expanded[e]=!0)})},renderGroupedRows(e){var i,n=this,s=n.widget,r=s.body,o=s.leftBody,a=s.rightBody,l=s.groupRowHeight,d=s.getCenterFullWidth(),c=s.getLeftFullWidth(),h=s.getRightFullWidth(),u=0;e=e||n.groups,t(e,e=>{var t=n.groupsCounts[e];c?((i=n.generateGroupRow(e,t,!0,u)).css("width",c),i.css("height",l),o.el.dom.appendChild(i.dom),(i=n.generateGroupRow(e,t,!1,u)).css("width",d),i.css("height",l),r.el.dom.appendChild(i.dom)):((i=n.generateGroupRow(e,t,!0,u)).css("width",d),i.css("height",l),r.el.dom.appendChild(i.dom)),h&&((i=n.generateGroupRow(e,t,!1,u)).css("width",h),i.css("height",l),a.el.dom.appendChild(i.dom)),n.collapsed&&(u+=l)})},softRenderGroupedRows(e){var r,o,a,l=this,d=l.widget,c=d.body,h=d.leftBody,u=d.rightBody;switch(e){case"left":if(h.el.select(`.${n}`).length){const e=c.el.select("."+i);return void(e.length&&e.destroy())}a=c.el.select("."+n),r=d.getLeftFullWidth(),t(l.groups,(e,t)=>{var n=l.groupsCounts[e],o=a.item(t),d=parseInt(o.css("top")),c=l.generateGroupRow(e,n,!0,d);o.hasClass(s)||c.removeCls(s),o.select("."+i).destroy(),c.css("width",r),h.el.dom.appendChild(c.dom)});break;case"right":if(u.el.select("."+n).length)return;o=d.getRightFullWidth(),a=c.el.select("."+n),t(l.groups,(e,t)=>{var i=l.groupsCounts[e],n=a.item(t),s=parseInt(n.css("top")),r=l.generateGroupRow(e,i,!1,s);r.css("width",o),u.el.dom.appendChild(r.dom)})}},removeGroupRows(){var e=this.widget,t=e.columns,i=e.leftColumns,s=e.rightColumns,r=e.body,o=e.leftBody,a=e.rightBody;t.length&&r.el.select("."+n).remove(),i.length&&o.el.select("."+n).remove(),s.length&&a.el.select("."+n).remove()},clearGroupRows(){var e=this,t=[],i={},s=[];e.widget.el.select(`.${n}`).each(n=>{const s=n.attr("group");e.groupsCounts[s]?i[s]=!0:t.push(n)}),t.forEach(e=>e.destroy()),e.groups.forEach(e=>{i[e]||s.push(e)}),e.renderGroupedRows(s)},removeLastGroupRow(){var e=this.widget,t=e.columns,i=this.groups.length,s=e.leftColumns,r=e.rightColumns,o=e.body,a=e.leftBody,l=e.rightBody;t.length&&o.el.select("."+n).item(i).remove();s.length&&a.el.select("."+n).item(i).remove(),r.length&&l.el.select("."+n).item(i).remove()},removeCells(){const e=this.widget,t=e.columns,i=e.leftColumns,n=e.rightColumns,s=e.body,o=e.leftBody,a=e.rightBody;t.length&&s.el.select(r).remove(),i.length&&o.el.select(r).remove(),n.length&&a.el.select(r).remove()},generateGroupRow(t,r,o,a){var l=this.widget.store,d=e.newEl("div");if(d.addCls(n),d.attr("group",t),o){""===t&&(t="&nbsp;");const e=this.tpl.getHTML({text:t,number:r});d.update('<div class="'+i+'"> '+e+"</div>")}return this.collapsed?(d.css("top",a+"px"),d.addCls(s)):d.css("top","0px"),l.expanded&&!1===l.expanded[t]&&d.addCls(s),d.css("visibility","hidden"),d},insertGroupEls(){var e=this,t=e.widget,s=t.leftBody,r=t.body;t.leftColumns.length?s.el.select("."+n).each((t,n)=>{var s=e.groups[n];t.update('<div class="'+i+'">'+s+"</div>")}):r.el.select("."+n).each((t,n)=>{var s=e.groups[n],r=e.groupsCounts[s],o=e.tpl.getHTML({text:s,number:r});t.update('<div class="'+i+'">'+o+"</div>")})},onClick(t){var i=this,r=i.widget,o=r.store,a=e.get(t.currentTarget),l=a.attr("group");try{r.el.select("."+n+'[group="'+l+'"]').toggleCls(s)}catch(t){a.toggleCls(s)}a.hasCls(s)?i.collapse(i.by,l):i.expand(i.by,l),o.sorters&&o.reSort(),o.filterOrder&&r.filter.updateStoreFilters(!1),(o.sorters||o.filterOrder)&&o.changeDataView({doNotFired:!0}),i.update()},fastCollapse(){},onMouseDown(e){e.preventDefault()},onScroll(){this.setPositions()},collapse(e,t){const i=this.widget;i.store.collapse(e,t),i.fire("collapse",e,t)},expand(t,i){const n=this,s=n.widget,r=s.store;e.isArray(i)?(n.initGroups(),n.initOrder(),r.expand(t,i)):r.expand(t,i),s.fire("expand",t,i)},setPositions(){var e=this,i=e.widget,s=i.store,r=-i.scroller.scrollTop||0;t(e.groups,t=>{if(i.el.select("."+n+'[group="'+t+'"]').each(e=>{e.css({top:r+"px",visibility:"visible"})}),i.expander){const e=i.expander.expandedGroups[t];for(const t in e){const i=e[t];r+=parseInt(i.el.css("height"))}}if(r+=i.groupRowHeight,!0===s.expanded[t])if(i.rowheight){const e=s.getItemsByGroup(t),n=i.rowheight.getRowsHeight(e);if(isNaN(r))return!0;r+=n}else r+=e.groupsCounts[t]*i.cellHeight})},setCellsPosition(e,i){for(var n,s=this,r=s.widget,o=r.store,a=0,l=s.groups.length,d=0,c=r.body,h=r.leftBody,u=r.rightBody,g=0,p=r.groupRowHeight,m=[],f={},y={},C=s.by;a<l;a++){const t=s.groups[a];if(!0===o.expanded[t]){if(m.push(g),f[g]=!0,void 0===i||"center"===i)if(d=0,n=r.columns.length,void 0!==e&&(d=e,n=e+1),r.expander){var v=r.get(g).get(C),w=r.expander.expandedGroups,b=s.getGroupOrderIndex(t),S=0;for(var x in w){if(b<=s.getGroupOrderIndex(x))continue;const e=w[x];for(var I in e){const t=e[I];if("none"!==t.el.css("display")&&!y[I]){var E=g-1;g<0&&(g=0),v!==(E=r.get(E)).get(C)?E.id===I&&(y[I]=!0,S+=parseInt(t.el.css("height"))):(y[I]=!0,S+=parseInt(t.el.css("height")))}}}for(p+=S,c.getCell(g,d);d<n;d++)c.getCell(g,d).css("margin-top",p+"px")}else for(;d<n;d++)c.getCell(g,d).css("margin-top",p+"px");if(void 0===i||"left"===i)for(d=0,n=r.leftColumns.length,void 0!==e&&(d=e,n=e+1);d<n;d++)h.getCell(g,d).css("margin-top",p+"px");if(void 0===i||"right"===i)for(d=0,n=r.rightColumns.length,void 0!==e&&(d=e,n=e+1);d<n;d++)u.getCell(g,d).css("margin-top",p+"px");g+=s.groupsCounts[t],p=r.groupRowHeight}else p+=r.groupRowHeight}if(s._renderFirstTime)s._renderFirstTime=!1;else{var T=[];t(s.prevRows,function(e){!0!==f[e]&&T.push(e)}),s.clearMargins(T)}s.prevRows=m},setExpanderCellsPosition(){var e,i=this.widget,n=i.store,s=n.dataView,r=i.body,o=i.leftBody,a=i.rightBody,l=i.expander.expandedGroups,d=this.groupsCounts,c=i.groupRowHeight,h=0,u=0;t(this.groups,g=>{if(!0===n.expanded[g]){const n=h+d[g];for(;h<n;h++)if(e=s[h]){var p=e.id,m=l[g]?l[g][p]:void 0;u&&(c+=u,u=0),m&&(u=parseInt(m.el.css("height"))),t(i.columns,(e,t)=>{r.getCell(h,t).css("margin-top",c+"px")}),t(i.leftColumns,(e,t)=>{o.getCell(h,t).css("margin-top",c+"px")}),t(i.rightColumns,(e,t)=>{a.getCell(h,t).css("margin-top",c+"px")}),c=0}c=i.groupRowHeight}else c+=i.groupRowHeight})},clearMargins(e){if(void 0!==(e=e||this.prevRows)){var i,n=this.widget,s=n.body,r=n.leftBody,o=n.rightBody;t(e,e=>{t(n.columns,(t,n)=>{if(void 0===(i=s.getCell(e,n)).dom)return!0;i.css("margin-top","0px")}),t(n.leftColumns,(t,n)=>{if(void 0===(i=r.getCell(e,n)).dom)return!0;i.css("margin-top","0px")}),t(n.rightColumns,(t,n)=>{if(void 0===(i=o.getCell(e,n)).dom)return!0;i.css("margin-top","0px")})})}},onColumnResize(){this.updateGroupRows()},updateGroupRows(){var e=this.widget,t=e.leftColumns,i=e.rightColumns,s=e.body,r=e.leftBody,o=e.rightBody,a=0;this.clearGroupRows(),a+=e.getCenterFullWidth(),s.el.select("."+n).css("width",a+"px"),a+=e.getLeftFullWidth(),t.length&&r.el.select("."+n).css("width",a+"px"),a+=e.getRightFullWidth(),i.length&&o.el.select("."+n).css("width",a+"px")},update(e){var t=this,i=t.widget,n=i.store;e||!0!==n.loading&&!1!==n.autoLoad||n.data.length?e&&n.data.length&&n.loadedTimes>1?t.reGroup():(t.setPositions(),i.update(),i.scroller.update(),t.setCellsPosition(),i.setSidesHeight()):n.on("load",()=>{t.initGroups(),t.initOrder(),t.calcPlusScroll(),t.configParams(),n.changeDataView({doNotFired:!0}),t.renderGroupedRows(),t.update(!0)},t)},getOffsetForRow(e){var i=this,n=i.widget,s=n.store,r=0,o=0;return t(i.groups,t=>{if(r+=n.groupRowHeight,!0===s.expanded[t]&&(o+=i.groupsCounts[t]),e<o)return!0}),r},getCollapsedRowsBefore(t){const i=this,n=i.widget,s=n.store,r=n.getById(t);if(!r)return 0;var o=r.get(i.by),a=0;return i.collapsedRowsBefore=i.collapsedRowBefore||{},void 0!==i.collapsedRowsBefore[o]?i.collapsedRowsBefore[o]:(e.each(i.groups,e=>{if(e===o)return!0;!0!==s.expanded[e]&&(a+=i.groupsCounts[e])}),i.collapsedRowsBefore[o]=a,a)},getSpecialRowsUnder:e=>{var i=this,n=i.widget.store,s=0,r=0;return t(i.groups,t=>{e<s&&r++,!0===n.expanded[t]&&(s+=i.groupsCounts[t])}),r},getSpecialRowsAbove(e){var t=this.widget.get(e),i=this.getGroupById(t.id),n=0;return Fancy.each(this.groups,e=>{if(n++,i==e)return!0}),n},reGroup(){var e=this,t=e.widget,i=t.store,n="data";t.store.expanded={},t.store.dataView=[],e.collapsed=!0,t.store.filteredData&&(n="filteredData"),e.removeGroupRows(),e.removeCells(),e.initGroups(n),i.remoteFilter&&e.initOrder(),e.calcPlusScroll(),e.configParams(),e.renderGroupedRows(),t.setSidesHeight()},addGroup(e){const t=this;t.reGroup(),e&&t.onGridRender()},clearGroup(){const e=this,t=e.widget.store;delete e.collapsed,delete t.expanded,delete e.groups,delete e.groupsCounts,delete e.by,delete e.by,delete e.plusScroll,delete e.prevRows,e.removeGroupRows(),e.removeCells(),e.uns()},scrollLeft(e){this.widget.body.el.select(`.${n}`).css("left",e)},updateGroupRowsText(){var e=this,r=e.widget,o=r.store,a=e.groups,l=r.leftBody,d=r.body,c=r.rightBody,h=l.el.select("."+i),u=d.el.select("."+i),g=l.el.select("."+n),p=d.el.select("."+n),m=c.el.select("."+n);t(a,(t,i)=>{var n,a=e.groupsCounts[t],l=e.tpl.getHTML({text:t,number:a});r.leftColumns.length?(h.item(i).update(l),(n=g.item(i)).attr("group",t),o.expanded[t]?n.removeClass(s):n.addClass(s)):(u.item(i).update(l),n=p.item(i),o.expanded[t]?n.removeClass(s):n.addClass(s)),p.item(i).attr("group",t),r.rightColumns.length&&m.item(i).attr("group",t)}),a.length<d.el.select("."+n).length&&setTimeout(()=>{e.removeLastGroupRow()},10)},onColumnDrag(){var e=this.widget,t=e.el.select("."+n),i={};if(e.el.select("."+n+":not(."+s+")").each(function(e){i[e.attr("group")]=!0}),!e.leftColumns.length&&t.length){t.destroy(),this.renderGroupedRows(),this.update();for(const t in i){e.el.select("."+n+'[group="'+t+'"]').removeCls(s)}}},getGroupRowsHeight(){var t=this.widget,i=0;return e.each(this.groupsCounts,e=>{e&&i++}),i*t.groupRowHeight},reFreshExpanded(){var t=this,i=t.widget,n=t.groups,s=i.store,r=s.expanded,o=s.memoryCollapsed||{};for(const e in r)t.groupsCounts[e]||delete r[e];for(const e in o)o[e]&&(r[e]=!1);e.each(n,e=>{void 0===r[e]&&(r[e]=!t.collapsed)}),s.expanded=r},reFreshGroupTexts(){const e=this;e.widget.el.select("."+n).each(t=>{const i=t.attr("group"),n=t.firstChild(),s=e.tpl.getHTML({text:i,number:e.groupsCounts[i]});n.dom&&n.update(s)})}})}(),Fancy.modules.summary=!0,function(){const e=Fancy,t=e.GRID_CELL_CLS,i=e.GRID_CELL_INNER_CLS,n=e.GRID_CELL_EVEN_CLS,s=e.GRID_ROW_SUMMARY_CLS,r=e.GRID_ROW_SUMMARY_CONTAINER_CLS,o=e.GRID_ROW_SUMMARY_BOTTOM_CLS,a=e.GRID_COLUMN_SPARKLINE_CLS,l=e.GRID_COLUMN_SPARKLINE_BULLET_CLS,d=e.GRID_COLUMN_SPARK_PROGRESS_DONUT_CLS,c=e.GRID_COLUMN_GROSSLOSS_CLS,h=`.${t}`;e.define("Fancy.grid.plugin.Summary",{extend:e.Plugin,ptype:"grid.summary",inWidgetName:"summary",position:"top",sumDisplayed:!0,topOffSet:0,bottomOffSet:0,striped:!1,constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){const e=this,t=e.widget;t.once("render",()=>{e.calcOffSets(),e.options&&e.initOptions()}),t.once("init",()=>{e.render(),e.update(),t.on("update",()=>e.update()),t.on("set",()=>e.update())}),t.on("columnresize",()=>e.onColumnResize(),e),t.on("columnhide",e.onColumnHide,e),t.on("columnshow",e.onColumnShow,e),e.sumDisplayed&&t.on("changepage",e.onChangePage,e),t.on("columndrag",e.onColumnDrag,e)},render(){var e,t=this,i=t.widget,n=i.centerEl,s=i.leftEl,a=i.rightEl,l=i.body,d=i.leftBody,c=i.rightBody,h=i.getCenterFullWidth(),u=i.getLeftFullWidth(),g=i.getRightFullWidth(),p="top"===t.position?"before":"after";n.select(`.${r}`).length||n.select(`.${o}`).length||((e=t.generateRow("center")).css("width",i.startWidths.center),e.firstChild().css("width",h),e.css("height",i.cellHeight),e.firstChild().css("height",i.cellHeight),t.el=e,l.el[p](e.dom)),i.leftColumns.length&&(s.select(`.${r}`).length||s.select(`.${o}`).length||(e=t.generateRow("left"),"bottom"===t.position?e.css("width",u):e.css("width",u-2),e.firstChild().css("width",u),e.css("height",i.cellHeight),t.leftEl=e,d.el[p](e.dom))),i.rightColumns.length&&(a.select(`.${r}`).length||a.select(`.${o}`).length||(e=t.generateRow("right"),"bottom"===t.position?e.css("width",g):e.css("width",g-1),e.firstChild().css("width",g),e.css("height",i.cellHeight),t.rightEl=e,c.el[p](e.dom)))},generateRow(n){var a=this.widget,l=a.cellHeight,d=a.getColumnsWidth(n),c=e.newEl("div"),h="";e.each(a.getColumns(n),(e,n)=>{h+=['<div index="'+n+'" style="width:'+e.width+"px;height:"+l+"px;"+(e.cellAlign?"text-align:"+e.cellAlign+";":"")+'" class="'+t+'">','<div class="'+i+'"></div>',"</div>"].join("")});const u=['<div style="position: relative;" class="'+s+'">',h,"</div>"].join("");return c.update(u),c.css("width",d+"px"),c.addCls(r),"bottom"===this.position&&c.addCls(o),c},calcPlusScroll(){const e=this.widget;this.plusScroll=this.groups.length*e.groupRowHeight},scrollLeft(e){this.el&&this.el.firstChild().css("left",e)},update(){const e=this,i=e.widget;if(e.updateSide("center"),i.leftColumns.length&&e.updateSide("left"),i.rightColumns.length&&e.updateSide("right"),e.striped&&"bottom"===e.position){const e=i.el.select(`.${o} .${t}`);i.getViewTotal()%2==1?e.addCls(n):e.removeCls(n)}},getEl(e){const t=this;switch(e){case"center":return t.el;case"left":return t.leftEl;case"right":return t.rightEl;default:return t.el}},updateSide(t){var n=this.widget,s=n.lang,r=n.getBody(t),o=n.store,h=this.getEl(t).select(`.${i}`),u="data";this.sumDisplayed&&(u="dataView"),e.each(n.getColumns(t),(t,i)=>{if(t.summary){var g=t.index,p=o.getColumnOriginalValues(g,{smartIndexFn:t.smartIndexFn,dataProperty:u}),m="",f=h.item(i).parent(),y={},C={};switch(e.typeOf(t.summary)){case"string":if("none"===t.summary)m="&nbsp;";else{if(m=e.Array[t.summary](p),"number"===t.type||"currency"===t.type){const e=t.precision||0;m=m.toFixed(e)}if("currency"===t.type&&""!==m){m=(t.currency||s.currencySign)+m}}break;case"object":m=e.Array[t.summary.type](p),t.summary.fn&&(m=t.summary.fn(m,t.summary.type));break;case"function":m=t.summary(p)}switch(t.type){case"sparklineline":case"sparklinebar":case"sparklinetristate":case"sparklinebullet":case"sparklinebox":case"sparklinepie":case"sparklinediscrete":f.addCls(a);var v,w=t.width,b=n.cellHeight-1,S=w-20,x=t.type.replace("sparkline","");switch(x){case"line":case"pie":case"box":v="width";break;case"bullet":v="width",b-=11,f.addCls(l);break;case"discrete":v="width",S=w,b-=2;break;case"bar":case"tristate":v="barWidth"}C=t.sparkConfig||{},y={type:x,fillColor:"transparent",height:b},e.apply(y,C),"bar"!==x&&"tristate"!==x||(S=w-20,S/=m.length),y[v]=S,h.item(i).$dom.sparkline(m,y);break;case"progressdonut":f.addCls(d),y=t.sparkConfig||{},e.apply(y,{renderTo:h.item(i).dom,value:m}),y.size||y.height||y.width||(y.size=n.cellHeaderHeight-6),e.get(y.renderTo).update(""),new e.spark.ProgressDonut(y);break;case"grossloss":f.addCls(c),(y=t.sparkConfig||{}).showOnMax&&(y.maxValue=Math.max.apply(Math,p)),m>50&&(m=50),e.apply(y,{renderTo:h.item(i).dom,value:m,column:t}),new e.spark.GrossLoss(y);break;default:t.format&&(m=r.format(m,t.format,t.precision)),h.item(i).update(m)}}else h.item(i).update("")})},onColumnResize(){const e=this,t=e.widget;e.updateSizes("center"),t.leftColumns.length&&e.updateSizes("left"),t.rightColumns.length&&e.updateSizes("right"),e.update()},onColumnHide(){const e=this,t=e.widget;e.updateSizes("center"),t.leftColumns.length&&e.updateSizes("left"),t.rightColumns.length&&e.updateSizes("right"),e.update()},onColumnShow(){const e=this,t=e.widget;e.updateSizes("center"),t.leftColumns.length&&e.updateSizes("left"),t.rightColumns.length&&e.updateSizes("right"),e.update()},updateSizes(e){var t=this,i=t.widget,n=t.getEl(e),s=n.select(h),r=0;switch(i.getColumns(e).forEach((e,t)=>{const i=s.item(t),{hidden:n,width:o}=e;r+=e.width,i.css("display",n?"none":""),i.animate({width:o},ANIMATE_DURATION)}),n.firstChild().animate({width:r},ANIMATE_DURATION),e){case"center":t.el.animate({width:r},ANIMATE_DURATION),0===r?t.el.css({display:"none"}):"none"===t.el.css("display")&&t.el.css({display:""});break;case"left":"bottom"===t.position?t.leftEl.animate({width:r},ANIMATE_DURATION):t.leftEl.animate({width:r-2},ANIMATE_DURATION),0===r?t.leftEl.css({display:"none"}):"none"===t.leftEl.css("display")&&t.leftEl.css({display:""});break;case"right":"bottom"===t.position?t.rightEl.animate({width:r},ANIMATE_DURATION):t.rightEl.animate({width:r-1},ANIMATE_DURATION),0===r?t.rightEl.css({display:"none"}):"none"===t.rightEl.css("display")&&t.rightEl.css({display:""})}},calcOffSets(){const e=this,t=e.widget;switch(e.position){case"top":e.topOffSet=t.cellHeight;break;case"bottom":e.bottomOffSet=t.cellHeight;break;case"both":e.topOffSet=t.cellHeight,e.bottomOffSet=t.cellHeight}},removeColumn(e,t){this.getEl(t).select(h).item(e).destroy(),this.updateSizes(t)},insertColumn(n,s){var r=this,o=r.widget,a=o.getColumns(s);"left"!==s&&"right"!==s||1!==a.length||r.render();var l,d=(a=o.getColumns(s))[n],c=r.getEl(s),u=c.select(h),g=e.newEl("div");0===u.length&&0===n||(l=0===n?u.item(0):u.item(n-1)),g.css({width:d.width,height:o.cellHeight}),g.addCls(t),g.update('<div class="'+i+'"></div>'),0===u.length&&0===n?c.append(g.dom):0===n?l.before(g.dom):l.after(g.dom),r.updateSizes(s),r.updateSide(s)},onChangePage(){const e=this;setTimeout(()=>{e.update()},100)},onColumnDrag(){const e=this.widget;this.updateSizes("center"),e.leftColumns.length&&this.updateSizes("left"),e.rightColumns.length&&this.updateSizes("right")},initOptions(){const i=this,n=i.widget,s=e.get(document.body);n.addCls("fancy-grid-summary-options"),n.el.on("click",i.onOptionClick,i,`.${r} .${t}`),s.on("click",t=>{const n=e.get(t.target);i.justShownSummaryMenu?delete i.justShownSummaryMenu:!n.closest(".fancy-menu").dom&&i.activeSummaryMenu&&(i.activeSummaryMenu.hide(),delete i.activeSummaryMenu)})},onOptionClick(t){var i,n=this,s=n.widget,r=e.get(t.currentTarget),o=n.getColumnBySummaryCell(r);if(n.justShownSummaryMenu=!0,n.activeSummaryMenu&&(n.activeSummaryMenu.hide(),delete n.activeSummaryMenu),o.summaryMenu)i=o.summaryMenu;else{const e=n.generateColumnSummaryItems(o);i=new Fancy.Menu({minWidth:100,width:parseInt(r.css("width"))+1,theme:s.theme,items:e})}var a=r.offset(),l=a.top+parseInt(r.css("height")),d=a.left,c=20,h=-1;if("bottom"===n.position){l=l-parseInt(i.el.css("height"))-parseInt(r.css("height")),c*=-1,h=1}let u=parseInt(r.css("width"))+1;u<100&&(u=100),i.el.css({position:"absolute",width:u,minWidth:70,top:l+c,left:d-1}),i.show(),i.el.animate({duration:200,top:l+h}),o.summaryMenu=i,n.activeSummaryMenu=i},generateColumnSummaryItems(t){var i=this,n=[],s=["None","Sum","Average","Count","Min","Max"],r=["None"],o=e.typeOf(t.summary);switch(t.type){case"number":switch(o){case"string":e.each(s,(e,s)=>{n.push({text:e,checked:e.toLocaleLowerCase()===t.summary,handler(){t.summary=e.toLocaleLowerCase(),i.update(),i.activeSummaryMenu.setChecked(s,!0),i.activeSummaryMenu.hide(),delete i.activeSummaryMenu}})});break;case"function":case"object":e.each(s,(e,s)=>{n.push({text:e,checked:!1,handler(){switch(o){case"function":t.summary={type:e.toLocaleLowerCase(),fn:t.summary};break;case"object":t.summary.type=e.toLocaleLowerCase()}i.update(),i.activeSummaryMenu.setChecked(s,!0),i.activeSummaryMenu.hide(),delete i.activeSummaryMenu}})}),"object"!==o&&n.push({text:"Custom",checked:!0,handler(){t.summary=t._summary,i.update(),i.activeSummaryMenu.hide(),i.activeSummaryMenu.setChecked(n.length-1,!0),delete i.activeSummaryMenu}})}break;case"string":switch(o){case"string":e.each(r,(e,s)=>{n.push({text:e,checked:e.toLocaleLowerCase()===t.summary,handler(){t.summary.type=e.toLocaleLowerCase(),i.update(),i.activeSummaryMenu.setChecked(s,!0),i.activeSummaryMenu.hide(),delete i.activeSummaryMenu}})});break;case"function":case"object":e.each(r,(e,s)=>{n.push({text:e,checked:!1,handler(){t._summary||(t._summary=t.summary),t.summary="none",i.update(),i.activeSummaryMenu.setChecked(s,!0),i.activeSummaryMenu.hide(),delete i.activeSummaryMenu}})}),n.push({text:"Custom",checked:!0,handler(){t.summary=t._summary,i.update(),i.activeSummaryMenu.setChecked(n.length-1,!0),i.activeSummaryMenu.hide(),delete i.activeSummaryMenu}})}}return n},getColumnBySummaryCell(e){var t,i=this.widget,n=e.attr("index");return e.closest(".fancy-grid-center").dom?t=i.columns[n]:e.closest(".fancy-grid-left").dom?t=i.leftColumns[n]:e.closest(".fancy-grid-right")&&(t=i.rightColumns[n]),t}})}(),function(){const e=Fancy.GRID_COLUMN_TREE_EXPANDER_CLS,t=function(e,i=0){const n=this,s=n.widget;return Fancy.each(e,function(e){i++;let r=e.data?e.data:e;s.store.filteredData?r.id&&s.store.map[r.id]&&(r=s.store.map[r.id].data):r=s.getById(r.id).data;const o=r.child;o&&r.expanded&&(i+=t.apply(n,[o]))}),i};Fancy.define("Fancy.grid.plugin.Tree",{extend:Fancy.Plugin,ptype:"grid.tree",inWidgetName:"tree",singleExpand:!1,constructor:function(){this.Super("const",arguments)},init(){const e=this,t=e.widget;e.expandMap={},t._tempExpandMap&&(e.expandMap=t._tempExpandMap),e.Super("init",arguments),e.ons()},ons(){const e=this,t=e.widget;t.once("init",()=>{t.on("rowdblclick",e.onRowDBLClick,e),t.on("cellclick",e.onTreeExpanderClick,e),t.on("beforesort",e.onBeforeSort,e)})},onRowDBLClick(e,t){const i=this,n=i.widget,s=t.item;s.get("leaf")||n.edit&&2===n.edit.clicksToEdit||(s.get("expanded")?i.collapseRow(t.item):i.expandRow(t.item))},onTreeExpanderClick(t,i){const n=this,s=i.item;Fancy.get(i.e.target).hasClass(e)&&(s.get("leaf")||(s.get("expanded")?n.collapseRow(i.item):n.expandRow(i.item)))},collapseRow(e){var i=this.widget,n=i.store,s=e.get("child"),r=(e.get("filteredChild"),e.get("id"));i.$onChangeUpdate=!1,this.expandMap[r]=!1,e.set("expanded",!1);var o=n.getRow(e.get("id")),a=0,l=t.apply(this,[s]);if(n.filteredData){var d,c={};c[e.get("id")]=!0;var h;for(a=0,l=n.data.length;a<l&&(e=n.data[a],!(h&&h>=e.data.$deep));a++){if(c[e.data.parentId]){h||(h=e.data.$deep-1),d||(d=a);const t=n.data.splice(d,1)[0];t.data.child&&(c[t.data.id]=!0),delete n.map[t.id],a--,l--}e.data.child&&h&&(c[e.data.id]=!0)}n.order&&(delete n.order,delete n.filterOrder,n.reSort()),n.changeDataView()}else{for(i.store.treeCollapsing=!0;a<l;a++)i.removeAt(o+1);delete i.store.treeCollapsing}delete i.$onChangeUpdate,i.update(),i.fire("treecollapse")},expandRow(e){var t,i=this,n=i.widget,s=n.store,r=e.get("child"),o=(e.get("filteredChild"),e.get("id")),a=e.get("parentId");if(n.$onChangeUpdate=!1,i.singleExpand)if(a){t=n.getById(a).get("child"),Fancy.each(t,function(e){let t=e.get("expanded");void 0!==i.expandMap[e.id]&&(t=i.expandMap[e.id]),!0===t&&i.collapseRow(n.getById(e.id))})}else t=n.findItem("parentId",""),Fancy.each(t,function(e){let t=e.get("expanded");void 0!==i.expandMap[e.id]&&(t=i.expandMap[e.id]),!0===t&&i.collapseRow(e)});i.expandMap[o]=!0,e.set("expanded",!0);var l=s.getRow(e.get("id")),d=e.get("$deep")+1,c=!1;if(s.filteredData){const t=e.get("id");Fancy.each(s.data,function(e,i){if(e.id===t)return l=i,!0})}const h=function(e,t,s,r){return r=r||o,Fancy.each(e,function(e){var o=e.data;e.data||(c=!0,o=e),o.$deep=s,o.parentId=r;var a=o.expanded;if(void 0!==i.expandMap[o.id]?(a=i.expandMap[o.id],o.expanded=a):void 0!==o.child&&(o.expanded=!1),t++,n.insert(t,o),!0===a){var l=o.child;o.filteredChild,t=h(l,t,s+1,o.id)}}),t};n.store.treeExpanding=!0,h(r,l,d),delete n.store.treeExpanding,c&&Fancy.each(e.data.child,function(t,i){const n=s.getById(t.id);void 0!==n&&(e.data.child[i]=n)}),delete n.$onChangeUpdate,s.sorters&&s.order&&(delete s.order,delete s.filterOrder,s.reSort(),s.changeDataView({doNotFired:!0})),n.update(),n.fire("treeexpand")},onBeforeSort(e,t){const i=this;"drop"===t.action&&i.onDropSort()},onDropSort(){this.widget.store.treeReBuildData()}})}(),function(){const e=Fancy;e.define("Fancy.grid.plugin.RowHeight",{extend:e.Plugin,ptype:"grid.rowheight",inWidgetName:"rowheight",cellTip:"{value}",stopped:!0,waitingForParentVisibility:!1,constructor:function(){this.Super("const",arguments),this.rows={},this.rowIndexes=[],this.rowIndexesSum=[]},init(){this.Super("init",arguments),this.ons()},ons(){const e=this,t=e.widget;t.on("init",e.onInit,e),t.on("update",e.onUpdate,e),t.on("columnresize",e.onColumnResize,e),t.on("changepage",e.onChangePage,e),t.on("sort",e.onSort,e)},onInit(){const e=this,t=e.widget;setTimeout(()=>{t.scroller.update(e.totalHeight)},50)},onUpdate(){var t=this,i=t.widget,n=i.getDataView(),s=0;e.each(n,n=>{const r=n.id,o=t.rows[r],a=i.getRowById(r),l=i.getDomRow(a);e.each(l,t=>{e.get(t).css("height",o)}),s+=o}),t.totalHeight=s,i.isGroupable()&&(t.totalHeight+=i.grouping.getGroupRowsHeight()),setTimeout(()=>{i.setSidesHeight(t.totalHeight),i.scroller.update(t.totalHeight)},50)},add(t,i,n){const s=this;s.rows[t]&&s.rows[t]>i||(s.rows[t]=i,s.rowIndexes[n]=i,clearInterval(s.intIndexesSum),s.intIndexesSum=setTimeout(()=>{s.rowIndexesSum=[],e.each(s.rowIndexes,(e,t)=>{s.rowIndexesSum[t]=0===t?e:s.rowIndexesSum[t-1]+e})},1))},getRowsHeight(t){var i=this,n=0;return e.each(t,e=>{const t=e.get("id");n+=i.rows[t]}),n},onColumnResize(e,t){const i=this;i.rows={},"text"===t.column.type&&t.column.autoHeight&&setTimeout(()=>{i.widget.update(),i.onUpdate()},400)},onChangePage(){this.rows={}},onSort(){this.rows={}},waitToShow(){const e=this;if(e.waitingForParentVisibility)return;e.waitingForParentVisibility=!0;const t=e.widget,i=e.getHiddenParent(t.el);i&&(e.intWaitToShow=setInterval(()=>{"none"!==i.css("display")&&(clearInterval(e.intWaitToShow),e.widget.update(),e.onUpdate())},350))},getHiddenParent:function(e,t=0){if(!(++t>10)){if("none"===e.css("display"))return e;if("body"!==e.dom.tagName.toLocaleLowerCase())return e=e.parent(),this.getHiddenParent(e,t)}}})}(),function(){const e=Fancy,t=e.TOOLTIP_CLS,i=e.TOOLTIP_INNER_CLS;e.define("Fancy.grid.plugin.CellTip",{extend:e.Plugin,ptype:"grid.celltip",inWidgetName:"celltip",cellTip:"{value}",stopped:!0,constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){const t=this,i=t.widget,n=e.get(document);i.on("cellenter",t.onCellEnter,t),i.on("cellleave",t.onCellLeave,t),n.on("touchend",t.onTouchEnd,t),n.on("mousemove",t.onDocMove,t)},onCellEnter(t,i){let n=this,s=i.column,r=n.cellTip,o=i.e;if(i&&s.cellTip){if(e.isString(s.cellTip))r=s.cellTip;else if(e.isFunction(s.cellTip)&&!1===(r=s.cellTip(i)))return;const t=new e.Template(r),a={title:s.title,value:i.value,columnIndex:0,rowIndex:0};n.stopped=!1,e.apply(a,i.data),e.tip.update(t.getHTML(a)),e.tip.show(o.pageX+15,o.pageY-25)}},onCellLeave(){this.stopped=!0,e.tip.hide(500)},onTouchEnd(){this.stopped=!0,e.tip.hide(500)},onDocMove(n){if(!0===this.stopped)return;const s=this,r=s.widget;if("none"===r.el.css("display")||r.panel&&r.panel.el&&"none"===r.panel.el.css("display"))return s.stopped=!0,void e.tip.hide(500);const o=e.get(n.target);return"body"===o.prop("tagName").toLocaleLowerCase()?(s.stopped=!0,void e.tip.hide(500)):o.hasClass(t)||o.hasClass(i)||!1!==r.el.within(o)?void e.tip.show(n.pageX+15,n.pageY-25):(s.stopped=!0,void e.tip.hide(500))}})}(),function(){const e=Fancy,t=e.TOOLTIP_CLS,i=e.TOOLTIP_INNER_CLS;e.define("Fancy.grid.plugin.HeaderCellTip",{extend:e.Plugin,ptype:"grid.headercelltip",inWidgetName:"headercelltip",cellTip:"{title}",stopped:!0,constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){const t=this,i=t.widget,n=e.get(document);i.on("headercellenter",t.onCellEnter,t),i.on("headercellleave",t.onCellLeave,t),n.on("touchend",t.onTouchEnd,t),n.on("mousemove",t.onDocMove,t)},onCellEnter(t,i){var n=i.column,s=this.cellTip,r=i.e;if(n.headerCellTip){const t={title:n.title,columnIndex:i.columnIndex,side:i.side};if(e.isString(n.headerCellTip))s=n.headerCellTip;else if(e.isFunction(n.headerCellTip)&&(i.data=t,!1===(s=n.headerCellTip(i))))return;const o=new e.Template(s);this.stopped=!1,e.apply(t,i.data),e.tip.update(o.getHTML(t)),e.tip.show(r.pageX+15,r.pageY-25)}},onCellLeave(){this.stopped=!0,e.tip.hide(500)},onTouchEnd(){this.stopped=!0,e.tip.hide(500)},onDocMove(n){if(!0===this.stopped)return;const s=this,r=s.widget;if("none"===r.el.css("display")||r.panel&&r.panel.el&&"none"===r.panel.el.css("display"))return s.stopped=!0,void e.tip.hide(500);const o=e.get(n.target);return"body"===o.prop("tagName").toLocaleLowerCase()?(s.stopped=!0,void e.tip.hide(500)):o.hasClass(t)||o.hasClass(i)||!1!==r.el.within(o)?void e.tip.show(n.pageX+15,n.pageY-25):(s.stopped=!0,void e.tip.hide(500))}})}(),function(){const e=Fancy,t=e.MENU_ITEM_IMG_COPY_CLS,i=e.MENU_ITEM_IMG_DELETE_CLS,n=e.MENU_ITEM_IMG_DUPLICATE_CLS,s=e.MENU_ITEM_IMG_EDIT_CLS;e.define("Fancy.grid.plugin.ContextMenu",{extend:e.Plugin,ptype:"grid.contextmenu",inWidgetName:"contextmenu",defaultItems:["copy","copy+","delete","-","export"],width:200,constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){this.widget.on("contextmenu",this.onContextMenu,this)},onContextMenu(e,t){const i=this,n=t.e;i.activeItem=t,n.preventDefault(),i.menu||i.initMenu(),setTimeout(()=>{i.showMenu(n,!0)},50)},initMenu(){const r=this,o=r.widget,a=[],l=r.items||e.Array.copy(r.defaultItems);e.each(l,(l,d)=>{var c=l,h={};switch(l.type&&(c=l.type,e.apply(h,l)),c){case"copy":e.applyIf(h,{text:"Copy",sideText:"CTRL+C",imageCls:t,handler(){o.copy()}}),a.push(h);break;case"copyWidthHeader":case"copy+":e.applyIf(h,{text:"Copy with Headers",imageCls:t,handler(){o.copy(!0)}}),a.push(h);break;case"delete":e.applyIf(h,{text:"Delete",imageCls:i,handler(){switch(o.selection.selModel){case"rows":case"row":var e=o.getSelection();0===e.length&&r.activeItem&&(e=r.activeItem.data),o.remove(e),o.clearSelection()}}}),a.push(h);break;case"edit":r.editItemIndex=d,e.applyIf(h,{text:"Edit",imageCls:s,disabled:!0,handler(){if(o.rowEdit){const e=o.selection.getActiveCell(),t=o.getSideByCell(e),i=o.getBody(t).getEventParams({currentTarget:e.dom});o.rowedit.edit(i)}}}),a.push(h);break;case"export":e.applyIf(h,{text:"Export",items:[{text:"CSV Export",handler:function(){o.exportToCSV({header:!0})}},{text:"Excel Export",handler(){o.exportToExcel({header:!0})}}]}),a.push(h);break;case"duplicate":e.applyIf(h,{text:"Duplicate",imageCls:n,handler(){switch(o.selection.selModel){case"rows":case"row":var t,i=o.getSelection(),n=[];if(i.length)t=o.getRowById(i[i.length-1].id)+1,e.each(i,t=>{const i=e.Object.copy(t);i.id=e.id(null,"TEMP-"),n.push(i)});else{if(!r.activeItem)return;t=o.getRowById(r.activeItem.data.id)+1,(n=e.Object.copy(r.activeItem.data)).id=e.id(null,"TEMP-")}o.insert(t,n),e.each(n,e=>{const t=o.getRowById(e.id);o.flashRow(t)})}}}),a.push(h);break;default:a.push(l)}}),r.menu=new Fancy.Menu({width:r.width,theme:o.theme,items:a})},showMenu(t,i){var n=this,s=n.widget,r=s.selection,o=n.menu.el,a=Fancy.get(t.target).offset(),l=a.top+40,d=a.left;if(i&&(l=t.pageY+40,d=t.pageX),e.isTouch&&(l=t.targetTouches[0].clientY+20,d=t.targetTouches[0].clientX),o.css({position:"absolute",top:l,left:d}),n.menu.css("z-index",1e3+e.zIndex++),n.menu.show(),o.animate({duration:200,top:l-20}),r&&n.editItemIndex)switch(r.selModel){case"rows":case"row":var c=s.getSelection();0===c.length||c.length>1?n.menu.disableItem(n.editItemIndex):n.menu.enableItem(n.editItemIndex)}setTimeout(()=>{Fancy.get(document).once("click",()=>n.hideMenu())},50)},hideMenu(){const e=this;setTimeout(()=>e.menu.hide(),50),delete e.activeItem}})}(),Fancy.modules.filter=!0,function(){const e=Fancy,t=e.FIELD_CLS,i=e.FIELD_CHECKBOX_CLS,n=e.GRID_HEADER_CELL_DOUBLE_CLS,s=e.GRID_HEADER_CELL_TRIPLE_CLS,r=e.GRID_HEADER_CELL_FILTER_CLS,o=e.GRID_HEADER_CELL_FILTER_FULL_CLS,a=e.GRID_HEADER_CELL_FILTER_SMALL_CLS,l=e.GRID_HEADER_CELL_FILTERED_CLS,d=e.GRID_HEADER_CELL_CLS,c=e.GRID_SUB_HEADER_FILTER_CLS,h=e.GRID_SUB_HEADER_FILTER_CONTAINER_CLS,u=`.${d}`,g=`.${t}`;e.define("Fancy.grid.plugin.Filter",{extend:e.Plugin,ptype:"grid.filter",inWidgetName:"filter",autoEnterDelay:500,constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){const e=this,t=e.widget;t.once("render",()=>{e.render(),e.waitForComboData&&t.on("load",e.onLoadData,e)}),t.on("columnresize",e.onColumnResize,e),t.on("filter",e.onFilter,e),t.on("lockcolumn",e.onLockColumn,e),t.on("rightlockcolumn",e.onRightLockColumn,e),t.on("unlockcolumn",e.onUnLockColumn,e),t.on("columndrag",e.onColumnDrag,e),t.subHeaderFilter&&(t.on("columnhide",e.onColumnHide,e),t.on("columnshow",e.onColumnShow,e))},render(){const e=this,t=e.widget;t.header&&(t.subHeaderFilter?(e._renderSubHeaderFieldsContainer("left"),e._renderSubHeaderFieldsContainer("center"),e._renderSubHeaderFieldsContainer("right"),e.renderedContainers=!0):(e._renderSideFields(t.header,t.columns),e._renderSideFields(t.leftHeader,t.leftColumns),e._renderSideFields(t.rightHeader,t.rightColumns)))},_renderSubHeaderFieldsContainer(e){var t,i=this,n=i.widget,s=n.getHeader(e),r=n.cellHeight;if(!i.renderedContainers){switch((t=i.generateFilterRow(e)).css("height",r),t.firstChild().css("height",r),e){case"left":i.filterElLeft=t;break;case"center":i.filterElCenter=t;break;case"right":i.filterElRight=t}s.el.after(t.dom)}i._renderSubHeaderFields(e)},addSubHeaderFilterCellContainer(t){const i=this.widget,n=i.cellHeight,s=i.getSideEl(t).select(`.${c}`),r=e.newDomEl("div");r.className=d,r.style.height=n+"px",s.append(r)},generateFilterRow(t){var i=this.widget,n=i.cellHeight,s=i.getColumnsWidth(t),r=e.newEl("div"),o="";e.each(i.getColumns(t),(e,t)=>{var i="";e.hidden&&(i="display: none"),o+=['<div index="'+t+'" style="width:'+e.width+"px;height:"+n+"px;"+i+'" class="'+d+'">',"</div>"].join("")});var a=['<div style="position: relative;" class="'+c+'">',o,"</div>"].join("");return r.update(a),r.select(`.${c}`).css("width",s+"px"),r.addCls(h),r},_renderSideFields(e,t){const i=this;t.forEach((t,o)=>{const a=e.getCell(o),{filter:l,grouping:d,type:c}=t;l&&l.header?(i.renderFilter(c,t,a),i.groupHeader&&!d&&a.addCls(s),a.addCls(r)):i.header&&(i.groupHeader&&!d?a.addCls(s):d&&i.groupHeader?a.addCls(n):d||a.addCls(n))})},_renderSubHeaderFields(t){const i=this,n=i.widget.getColumns(t),s=i.getSubHeaderFilterEl(t).select(u);0!==s.length&&n.forEach((t,n)=>{const o=s.item(n),{filter:a,type:l}=t;a&&a.header&&(o.select(g).each(t=>{e.getWidget(t.id).destroy()}),o.update(""),i.renderFilter(l,t,o),o.addCls(r))})},_clearColumnsFields(t,i,n,s){const r=this,o=r.widget;let a;if(o.subHeaderFilter){const e=r.getSubHeaderFilterEl(i.side);a=e.select(u)}t.forEach((t,r)=>{const{filter:l,type:d}=t;if(l&&l.header){if(n&&t.index!==n)return;switch(d){case"date":let t,n,l;t=o.subHeaderFilter?a.item(r).select(g):i.getCell(r).select(g),n=e.getWidget(t.item(0).attr("id")),l=e.getWidget(t.item(1).attr("id")),n.clear(),l.clear();break;default:let c;const h=(c=o.subHeaderFilter?a.item(r):i.getCell(r)).select(g).attr("id"),u=e.getWidget(h);if(s){const e=u.get().split(",");if(e.length<2&&!s)u.clear();else{let t="";e.forEach(e=>{new RegExp(s).test(e)||(t+=e+",")}),","===t[t.length-1]&&(t=t.substring(0,t.length-1)),u.set(t)}}else u.clear()}}})},clearColumnsFields(e,t){const i=this.widget;this._clearColumnsFields(i.columns,i.header,e,t),this._clearColumnsFields(i.leftColumns,i.leftHeader,e,t),this._clearColumnsFields(i.rightColumns,i.rightHeader,e,t)},_addValuesInColumnFields(t,i,n,s,r){var o,a,l=this.widget,d=0,c=t.length;if(l.subHeaderFilter){a=this.getSubHeaderFilterEl(i.side).select(u)}for(;d<c;d++)if((o=t[d]).index===n&&o.filter&&o.filter.header)switch(o.type){case"date":var h;h=l.subHeaderFilter?a.item(d).select(g):i.getCell(d).select(g);const t=e.getWidget(h.item(0).attr("id")),c=e.getWidget(h.item(1).attr("id"));switch(r){case">":case">=":t.set(new Date(s));break;case"<":case"<=":c.set(new Date(s))}break;case"combo":var p=(l.subHeaderFilter?a.item(d):i.getCell(d)).select(g).attr("id"),m=e.getWidget(p);e.isArray(s),m.set(s);break;default:var f=l.getFilter(n),y="";for(var C in f){var v=f[C];y+=C,e.isArray(v)?e.each(v,(e,t)=>{y+=e,v.length-1!==t&&(y+=",")}):y+=v,y+="&"}"&"===y[y.length-1]&&(y=y.substring(0,y.length-1));p=(l.subHeaderFilter?a.item(d):i.getCell(d)).select(g).attr("id");(m=e.getWidget(p)).set(y)}},addValuesInColumnFields(t,i,n){const s=this.widget;void 0!==i&&null!==i&&0!==i.length&&(e.isFunction(i)||(this._addValuesInColumnFields(s.columns,s.header,t,i,n),this._addValuesInColumnFields(s.leftColumns,s.leftHeader,t,i,n),this._addValuesInColumnFields(s.rightColumns,s.rightHeader,t,i,n)))},renderFilter(t,i,n){var s,r=this,o=r.widget,a=o.store,l={position:"absolute",bottom:"3px"},d=i.filter,c=o.theme,h=d.tip,u="",g=a.filters[i.index];if(g)if("date"===g.type)u=[g[">="],g["<="]];else for(const e in g){const t=g[e];switch(e){case"":u+=t;break;default:if("combo"===i.type)if(u=u||[],Fancy.isObject(t))for(const e in t)u.push(e);else u.push(t);else u+=e+t+","}}if(","===u[u.length-1]&&(u=u.substring(0,u.length-1)),Fancy.isObject(d.header)){const t=d.header;e.apply(t,{renderTo:n.dom,label:!1,style:l,theme:c,widget:o,tip:h,value:u,padding:!1});const r={combo:"Combo"};"combo"===t.type&&e.apply(t,{width:i.width-8,height:28,multiSelect:i.multiSelect,itemCheckBox:i.itemCheckBox,minListWidth:i.minListWidth,listItemTpl:i.listItemTpl});const a=r[t.type];s=new e[a](t)}else switch(t){case"date":(p=[]).push({change:r.onDateChange,scope:r}),s=new e.DateRangeField({renderTo:n.dom,format:i.format,label:!1,padding:!1,style:l,events:p,width:i.width-8,emptyText:d.emptyText,dateImage:!1,value:u,theme:c});break;case"string":var p=[{enter:r.onEnter,scope:r}];!1!==r.autoEnterDelay&&p.push({key:r.onKey,scope:r}),s=new e.StringField({renderTo:n.dom,label:!1,padding:!1,style:l,events:p,emptyText:d.emptyText,tip:h,value:u,widget:o});break;case"number":case"grossloss":case"progressbar":case"progressdonut":p=[{enter:r.onEnter,scope:r}];!1!==r.autoEnterDelay&&p.push({key:r.onKey,scope:r}),s=new e.NumberField({renderTo:n.dom,label:!1,padding:!1,style:l,emptyText:d.emptyText,events:p,widget:o,value:u,tip:h});break;case"combo":var m,f,y="text",C="text";void 0!==i.displayKey&&(y=i.displayKey,C=i.valueKey||y),e.isObject(i.data)||e.isObject(i.data[0])?m=i.data:0===(m=r.configComboData(i.data)).length&&(i.waitForComboData=!0),i.filter&&i.filter.selectAll&&(f=i.filter.selectAll),s=new e.Combo({renderTo:n.dom,label:!1,padding:!1,style:l,width:i.width-8,displayKey:y,valueKey:C,value:u,height:28,emptyText:d.emptyText,theme:c,widget:o,tip:h,multiSelect:i.multiSelect,itemCheckBox:i.itemCheckBox,minListWidth:i.minListWidth,listItemTpl:i.listItemTpl,selectAllText:f,subSearch:i.subSearch,events:[{change:r.onEnter,scope:r},{empty(){this.set(-1)}}],data:m});break;case"select":o.selection&&/row/.test(o.selection.selModel)&&(s=new e.Combo({renderTo:n.dom,label:!1,padding:!1,style:l,displayKey:"text",valueKey:"value",width:i.width-8,emptyText:d.emptyText,value:u,editable:!1,subSearch:!1,events:[{change:r.onEnterSelect,scope:r}],data:[{value:"",text:""},{value:"false",text:o.lang.no},{value:"true",text:o.lang.yes}]}));break;case"checkbox":case"switcher":s=new e.Combo({theme:c,renderTo:n.dom,label:!1,padding:!1,style:l,displayKey:"text",valueKey:"value",width:i.width-8,emptyText:d.emptyText,value:u,editable:!1,subSearch:!1,events:[{change:r.onEnter,scope:r}],data:[{value:"",text:""},{value:"false",text:o.lang.no},{value:"true",text:o.lang.yes}]});break;default:p=[{enter:r.onEnter,scope:r}];!1!==r.autoEnterDelay&&p.push({key:r.onKey,scope:r}),s=new e.StringField({renderTo:n.dom,label:!1,style:l,padding:!1,value:u,emptyText:d.emptyText,events:p})}switch(s.filterIndex=i.index,s.column=i,"date"!==t&&(s.el.css("padding-left","4px"),s.el.css("padding-top","0px")),t){case"checkbox":case"combo":case"date":break;default:s.setInputSize({width:i.width-8})}i.filterField=s},onEnter(t,i){const n=this.widget;if(clearInterval(this.intervalAutoEnter),delete this.intervalAutoEnter,n.isRequiredChangeAllMemorySelection()&&(n.selection.memory.selectAllFiltered(),setTimeout(()=>{n.selection.updateHeaderCheckBox()},1)),0===i.length)return void n.clearFilter(t.filterIndex);const s=this.processFilterValue(i,t.column.type);if(n.clearFilter(t.filterIndex,null,!1),1===s.length)n.addFilter(t.filterIndex,s[0].value,s[0].operator,!1);else{const i=[];e.each(s,e=>{switch(e.operator){case"":case"=":i.push(e.value);break;default:n.addFilter(t.filterIndex,e.value,e.operator,!1)}}),i.length&&n.addFilter(t.filterIndex,i,"=",!1)}},onEnterOld(t,i,n){const s=this,r=s.widget,o=r.store,a=t.filterIndex;if(n=n||{},clearInterval(s.intervalAutoEnter),delete s.intervalAutoEnter,0===i.length)return o.filters[t.filterIndex]={},s.clearFilter(t.filterIndex,void 0,!1),s.updateStoreFilters(),void(r.grouping&&r.grouping.by&&r.grouping.reGroup());var l=s.processFilterValue(i,t.column.type),d=0,c=l.length;for(o.filters[a]={};d<c;d++){const i=l[d];""===i.operator&&t.column.filter&&t.column.filter.operator&&(i.operator=t.column.filter.operator),"&"===i.separator?e.isArray(o.filters[a][i.operator])?o.filters[a][i.operator].push(i.value):o.filters[a][i.operator]=[i.value]:o.filters[a][i.operator]=i.value,i.operator,"date"===t.column.type&&e.apply(o.filters[a],n)}o.remoteFilter?(o.once("serversuccess",()=>{r.fire("filter",o.filters)}),o.serverFilter()):s.updateStoreFilters(),r.grouping&&r.grouping.by&&(o.remoteSort?o.once("load",()=>{r.grouping.reGroup(),r.fire("filter",o.filters)}):r.grouping.reGroup()),r.setSidesHeight()},onEnterSelect(e,t){const i=this.widget,n=i.getSelection(),s=[];this.isRequiredChangeAllMemorySelection()&&(i.selection.memory.selectAllFiltered(),setTimeout(()=>{i.selection.updateHeaderCheckBox()},1)),Fancy.each(n,e=>{s.push(e.id)}),t===String(!0)?s.length?i.addFilter("id",s,"="):(i.clearFilter("id","="),i.clearFilter("id","!=")):t===String(!1)?(i.clearFilter("id","="),i.addFilter("id",s,"!=")):i.clearFilter("id")},processFilterValue(t,i){var n,s,r,o,a,l={"<":!0,">":!0,"!":!0,"=":!0,"|":!0},d=0,c=[];if(e.isArray(t))return s={},e.Array.each(t,e=>{s[String(e).toLocaleLowerCase()]=!0}),c.push({operator:"|",value:s}),c;var h=",";for(/\&/.test(t)&&(h="&"),o=0,a=(r=t.split(h)).length;o<a;o++){for(d=0,n="",s=r[o];d<3;d++)l[s[d]]&&(n+=s[d]);if(!((s=s.replace(new RegExp("^"+n),"")).length<1)){switch(i){case"number":s=Number(s);break;case"combo":n="=";break;case"date":isNaN(Number(s))||(s=new Date(Number(s)))}c.push({operator:n,value:s,separator:h})}}return c},updateStoreFilters(e){var t=this.widget,i=t.store,n=!1;t.filtering=!0;for(const e in i.filters){if(i.filters[e]){n=!0;break}}n||delete i.filteredData,!1!==e?(i.grouping&&i.grouping.by?(i.isFiltered()&&i.filterData(),this.reGroupAccordingToFilters(),i.changeDataView()):i.changeDataView(),!0===t.waitingForFilters||!t.inited&&t.state&&t.state.startState&&t.state.startState.filters||(t.update(),t.fire("filter",i.filters),t.setSidesHeight())):i.changeDataView(),n||(delete i.filteredData,delete i.filteredDataMap,delete i.filterOrder),delete t.filtering},forceUpdateStoreFilters(){const e=this.widget,t=e.store;t.changeDataView(),e.update(),e.fire("filter",t.filters),e.setSidesHeight()},onColumnResize(n,s){var r,o=this.widget,a=e.get(s.cell),l=s.width,d=a.select(`:not(.${i}).${t}`);if(o.subHeaderFilter){const e=a.attr("index");d=(a=this.getSubHeaderFilterEl(s.side).select(u).item(e)).select(`:not(.${i}).${t}`)}d.length,0===d.length||(2===d.length?((r=e.getWidget(d.item(0).dom.id)).setWidth((l-8)/2),(r=e.getWidget(d.item(1).dom.id)).setWidth((l-8)/2)):(r=e.getWidget(d.dom.id))&&("field.combo"===r.wtype?(r.size({width:l-8}),r.el.css("width",l-8+5)):r.setInputSize({width:l-8}))),o.subHeaderFilter&&this.updateSubHeaderFilterSizes(s.side)},updateSubHeaderFilterSizes(t){const i=this,n=i.widget;if(!t)return i.updateSubHeaderFilterSizes("center"),n.leftColumns.length&&i.updateSubHeaderFilterSizes("left"),void(n.rightColumns.length&&i.updateSubHeaderFilterSizes("right"));var s=i.getSubHeaderFilterEl(t),r=s.select(u),o=0,a=n.getColumns(t),l=e.ANIMATE_DURATION;e.each(a,(e,t)=>{o+=e.width;const i=r.item(t);e.hidden?i.css("display","none"):i.css("display",""),i.animate({width:e.width},l)}),s.firstChild().css({width:o})},removeSubHeaderCell(e,t){this.getSubHeaderFilterEl(e).select(u).item(t).destroy()},getSubHeaderFilterEl(e){switch(e){case"left":return this.filterElLeft;case"center":return this.filterElCenter;case"right":return this.filterElRight}},onKey(t,i,n){const s=this;n.keyCode!==e.key.ENTER&&(s.autoEnterTime=+new Date,s.intervalAutoEnter||(s.intervalAutoEnter=setInterval(()=>{const e=new Date;s.intervalAutoEnter&&e-s.autoEnterTime>s.autoEnterDelay&&(clearInterval(s.intervalAutoEnter),delete s.intervalAutoEnter,i=t.getValue(),s.onEnter(t,i))},200)))},onDateChange(t){var i,n,s,r=this,o=r.widget,a=t.format,l=o.store,d=t.dateField1.getDate(),c=t.dateField2.getDate(),h="Invalid Date"!==d.toString()&&e.isDate(d),u="Invalid Date"!==c.toString()&&e.isDate(c),g=l.remoteFilter;h&&(d=new Date(d.getFullYear(),d.getMonth(),d.getDate())),u&&(c=new Date(c.getFullYear(),c.getMonth(),c.getDate())),h&&u?(!0!==g?(n=Number(d),s=Number(c)):(n=e.Date.format(d,a.edit,a.mode),s=e.Date.format(c,a.edit,a.mode)),i=">="+n+",<="+s):h?(i=!0!==g?">="+Number(d):">="+e.Date.format(d,a.edit,a.mode),r.clearFilter(t.filterIndex,"<=",!1)):u?(i=!0!==g?"<="+Number(c):"<="+e.Date.format(c,a.edit,a.mode),r.clearFilter(t.filterIndex,">=",!1)):r.clearFilter(t.filterIndex),i&&r.onEnter(t,i,{type:"date",format:t.format})},clearFilter(e,t,i){const n=this,s=n.widget.store;s._clearedFilter=!0,setTimeout(()=>{delete s._clearedFilter},1),void 0===t?delete s.filters[e]:s.filters[e]&&delete s.filters[e][t],!1!==i&&n.updateStoreFilters()},onFilter(e,t){const i=this.widget;if(i.scroll(0),i.header&&t){i.el.select(`.${l}`).removeCls(l);for(const e in t){const t=i.getHeaderCell(e);t&&t.addCls(l)}}},configComboData(t){var i=0,n=t.length,s=[];if(e.isObject(t))return t;for(;i<n;i++)s.push({value:i,text:t[i]});return 0===s.length&&(this.waitForComboData=!0),s},destroyFields(){const t=this.widget;e.each(t.columns,e=>{e.filterField&&(e.filterField.destroy(),delete e.filterField)}),e.each(t.leftColumns,e=>{e.filterField&&(e.filterField.destroy(),delete e.filterField)}),e.each(t.rightColumns,e=>{e.filterField&&(e.filterField.destroy(),delete e.filterField)}),t.el.select(`.${r}`).removeCls(r),t.el.select(`.${o}`).removeCls(o),t.el.select(`.${a}`).removeCls(a),t.el.select(`.${n}`).removeCls(n),t.el.select(`.${s}`).removeCls(s)},onLockColumn(){},onUnLockColumn(){},onRightLockColumn(){},onColumnDrag(){const e=this,t=e.widget;e.updateFields(),t.subHeaderFilter&&e.updateSubHeaderFilterSizes()},updateFields(){this.destroyFields(),this.render()},reGroupAccordingToFilters(){const e=this.widget.grouping;e.initGroups("filteredData"),e.initOrder(),e.reFreshExpanded(),e.updateGroupRows(),e.setCellsPosition(),e.reFreshGroupTexts()},scrollLeft(e){this.filterElCenter&&this.filterElCenter.firstChild().css("left",e)},onColumnHide(){this.updateSubHeaderFilterSizes()},onColumnShow(){this.updateSubHeaderFilterSizes()},onLoadData(){this.updateFilterComboData()},updateFilterComboData(){const e=this.widget,t=e.store;e.getColumns().forEach(i=>{if("combo"===i.type&&i.index&&i.waitForComboData){const n=t.getColumnUniqueData(i.index);e.setColumnComboData(i.index,n)}})}})}(),Fancy.define("Fancy.grid.plugin.Search",{extend:Fancy.Plugin,ptype:"grid.search",inWidgetName:"searching",autoEnterDelay:500,constructor:function(){this.searches={},this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){const e=this;e.widget.once("init",()=>e.generateKeys())},search(e,t){const i=this,n=i.widget,s=n.store,r=n.selection;if(n.isRequiredChangeAllMemorySelection()&&(r.memory.clearAll(),r.memory.selectAllFiltered(),setTimeout(()=>{r.updateHeaderCheckBox()},1)),i.searches={},!e&&!t)return i.clear(),i.updateStoreSearches(),void(n.isGroupable()&&n.grouping.reGroup());!1!==Fancy.isArray(e)||t||(i.searches=e),i.setFilters(),s.remoteSort?s.serverFilter():(i.updateStoreSearches(),setTimeout(()=>{n.fire("filter",s.filters)},1)),n.isGroupable()&&(s.remoteSort?s.once("load",()=>n.grouping.reGroup()):n.grouping.reGroup())},updateStoreSearches(){const e=this.widget;e.store.changeDataView(),e.update()},setKeys(e){this.keys=e,this.setFilters(),this.updateStoreSearches()},generateKeys(){const e=this,t=e.widget;if(e.items)e.keys={},Fancy.each(e.items,t=>{e.keys[t.index]=!0});else if(!e.keys){e.keys={};var i=[];t.columns&&(i=i.concat(t.columns)),t.leftColumns&&(i=i.concat(t.leftColumns)),t.rightColumns&&(i=i.concat(t.rightColumns));var n=[];Fancy.each(i,e=>{const t=e.index;if(!1!==e.searchable){switch(e.type){case"color":case"combo":case"date":case"number":case"string":case"text":case"currency":break;default:return}t&&n.push(t)}}),Fancy.each(n,t=>{"$selected"!==t&&(e.keys[t]=!0)})}return e.keys},setFilters(){const e=this,t=e.widget.store,i=t.filters||{};if(void 0===e.searches||Fancy.isObject(e.searches))e.clear();else{for(const t in e.keys)!1!==e.keys[t]?(i[t]=i[t]||{},i[t]["*"]=e.searches):i[t]&&delete i[t]["*"];t.filters=i}},clear(){var e=this.widget,t=e.store,i=t.filters||{};for(const e in this.keys)void 0!==i[e]&&delete i[e]["*"];t.filters=i,delete this.searches,e.state&&e.state.onFilter()},clearBarField(){var e=this.getSearchField("tbar");e&&e.clear(),(e=this.getSearchField("subTBar"))&&e.clear()},setValueInField(e){var t=this.getSearchField("tbar");t&&t.set(e,!1),(t=this.getSearchField("subTBar"))&&t.set(e,!1)},getSearchField(e){for(var t,i=this.widget[e],n=0,s=(i||[]).length;n<s;n++)if("search"===(t=i[n]).type)return t;return t}}),Fancy.modules.dd=!0,function(){const e=Fancy,t=e.GRID_BODY_CLS,i=e.GRID_CLS,n=e.GRID_CELL_CLS;e.define("Fancy.grid.plugin.GridToGrid",{extend:e.Plugin,ptype:"grid.dragdrop",inWidgetName:"dragdrop",dropOK:!1,cellMaskCls:"fancy-drop-cell-mask",dropZoneCls:"fancy-drop-zone-active",dropOkCls:"fancy-drop-ok",dropNotOkCls:"fancy-drop-not-ok",dropHeaderMaskCls:"fancy-drop-header-mask",droppable:!0,dropZoneOverClass:t,constructor:function(){this.Super("const",arguments)},init(){const e=this;e.addEvents("drop"),e.Super("init",arguments),e.initDropCls(),e.initEnterLeave(),e.ons()},initDropCls(){let e=`.${this.dropGroup}`;e+=` .${this.dropZoneOverClass}`,this.dropCls=e},addDragDropCls(){this.widget.el.addCls(this.dragGroup)},ons(){const e=this,t=e.widget;t.on("render",function(){e.addDragDropCls()}),e.dropGroup&&(t.on("beforecellmousedown",e.onBeforeCellMouseDown,e),t.on("cellmousedown",e.onCellMouseDown,e),t.on("cellleave",e.onCellLeave,e),t.on("cellenter",e.onCellEnter,e)),e.on("drop",e.onDropItems,e)},onDropItems(e,t){const i=this,n=i.widget,s=i.dropGrid,r=void 0===s.activeRowEnterIndex?s.getViewTotal():s.activeRowEnterIndex;n.fire("dropitems",t,r),i.onDrop&&i.onDrop.apply(n,[t,r])},onBeforeCellMouseDown(t,i){var n=this,s=n.widget,r=s.lang,o=e.get(document),a=s.getSelection();if((!i.e.ctrlKey||!0!==s.multiSelect)&&a.length>1){var l=!1;if(e.each(a,e=>{if(e.id===i.id)return l=!0,!0}),!1===l)return;s.stopSelection(),o.once("mouseup",n.onDocMouseUp,n),o.on("mousemove",n.onDocMouseMove,n),o.once("mouseup",()=>{s.enableSelection()},n),a=s.getSelection();const t=e.String.format(r.dragText,[a.length,a.length>1?"s":""]);n.initTip(t),n.dragItems=s.getSelection(),n.cellMouseDown=!0}},onCellMouseDown(t,i){const n=this,s=n.widget,r=e.get(document);!1!==s.selection.enabled&&(i.e.ctrlKey&&!0===s.multiSelect||("$selected"===i.column.index||s.clearSelection(),r.once("mouseup",n.onDocMouseUp,n),r.on("mousemove",n.onDocMouseMove,n),n.cellMouseDown=!0,n.activeRowIndex=i.rowIndex))},initEnterLeave(){const t=this,i=e.select(t.dropCls);0!==i.length?(i.on("mouseenter",t.onMouseEnterDropGroup,t),i.on("mouseleave",t.onMouseLeaveDropGroup,t)):setTimeout(()=>{t.initEnterLeave()},500)},onMouseEnterDropGroup(t){const n=this;if(!n.cellMouseDown)return;const s=e.get(t.currentTarget);if(n.dropGrid=e.getWidget(s.closest(`.${i}`).attr("id")),n.dropGrid&&n.dropGrid.dragdrop&&!1===n.dropGrid.dragdrop.droppable)return n.dropOK=!1,void(n.tip&&n.tip.el.replaceClass(n.dropOkCls,n.dropNotOkCls));n.setDropGridCellsMask(),n.dropGridEventInited||n.onsDropGrid(),s.addCls(n.dropZoneCls),n.dropOK=!0,n.tip&&n.tip.el.replaceClass(n.dropNotOkCls,n.dropOkCls)},onMouseLeaveDropGroup(t){const i=this;i.cellMouseDown&&(e.get(t.currentTarget).removeCls(i.dropZoneCls),i.dropOK=!1,i.tip.el.replaceClass(i.dropOkCls,i.dropNotOkCls),i.clearCellsMask())},setDropGridCellsMask(){var e,t=this.dropGrid;t&&this.cellMouseDown&&(0===(e=t.getTotal())?t.el.addCls(this.dropHeaderMaskCls):t.el.select("."+n+'[index="'+(e-1)+'"]').addCls(this.cellMaskCls))},onsDropGrid(){const e=this;e.dropGrid.on("rowenter",e.onDropGridRowEnter,e),e.dropGrid.on("rowleave",e.onDropGridRowLeave,e),e.dropGridEventInited=!0},onDropGridRowEnter(e,t){const i=this;!1===i.cellMouseDown&&(i.dropGrid.un("rowenter",i.onDropGridRowEnter),i.dropGrid.un("rowleave",i.onDropGridRowLeave)),i.clearCellsMask(),0===t.rowIndex?e.el.addCls(i.dropHeaderMaskCls):e.el.select("."+n+'[index="'+(t.rowIndex-1)+'"]').addCls(i.cellMaskCls),!1===i.cellMouseDown&&i.clearCellsMask(),i.dropGrid&&(i.dropGrid.activeRowEnterIndex=t.rowIndex)},onDropGridRowLeave(){const e=this;e.clearCellsMask(),e.setDropGridCellsMask(),e.dropGrid&&delete e.dropGrid.activeRowEnterIndex},clearCellsMask(){const e=this,t=e.cellMaskCls;e.dropGrid&&(e.dropGrid.el.removeCls(e.dropHeaderMaskCls),e.dropGrid.el.select(`.${t}`).removeCls(t))},onDocMouseUp(){const t=this,i=t.widget,n=e.get(document);t.cellMouseDown=!1,t.tip&&t.tip.hide(),i.enableSelection(),n.un("mousemove",t.onDocMouseMove),!0===t.dropOK&&(i.clearSelection(),t.dropGrid.clearSelection(),t.fire("drop",t.dragItems)),delete t.dragItems,t.dropOK=!1,e.select(`.${t.dropZoneCls}`).removeCls(t.dropZoneCls),t.clearCellsMask(),t.dropGrid&&(t.dropGrid.un("rowenter",t.onDropGridRowEnter),t.dropGrid.un("rowleave",t.onDropGridRowLeave)),delete t.dropGridEventInited},onDocMouseMove(e){this.dragItems&&this.tip.show(e.pageX+20,e.pageY+20)},onCellLeave(t,i){const n=this,s=n.widget,r=s.lang;setTimeout(()=>{if(n.onceStopDrag)return void(n.onceStopDrag=!1);if(!0!==n.cellMouseDown||n.dragItems)return;const t=s.getSelection(),o=e.String.format(r.dragText,[t.length,t.length>1?"s":""]);s.stopSelection(),n.initTip(o,i.e),n.tip.show(),n.tip.el.css("display","block"),n.dragItems=t},1)},onCellEnter(e,t){const i=this;!0!==i.cellMouseDown||i.dragItems||t.rowIndex!==i.activeRowIndex&&(i.onceStopDrag=!0,i.activeRowIndex=t.rowIndex)},initTip(t,i){const n=this,s=n.dropNotOkCls;n.tip||(n.tip=new e.ToolTip({cls:s,text:t})),i&&n.tip.show(i.pageX+20,i.pageY+20),n.tip.update(t),n.tip.el.replaceClass(n.dropOkCls,s)}})}(),function(){const e=Fancy;e.define("Fancy.DragRowsManager",{singleton:!0,constructor:function(){this.draggingRows=[]},add(e,t){const i=this,n=Fancy.get(document);i.activeGrid=e,i.draggingRows=t,n.on("mouseenter",i.onMouseEnterGrid,i,`.${Fancy.GRID_CLS}`),i.activeGrid.dropZone&&i.activeGrid.el.on("mouseleave",i.onMouseLeaveActiveGrid,i)},remove(){const e=this,t=Fancy.get(document);e.activeGrid&&e.activeGrid.dropZone&&t.un("mousemove",e.onMouseMoveOutSideActiveGrid),delete e.activeGrid,delete e.draggingRows,delete e.toGrid,delete e.droppable,delete e.dropOutSideRowIndex,t.un("mouseenter",e.onMouseEnterGrid)},onMouseEnterGrid(t){const i=this,n=Fancy.get(t.currentTarget);if(n.id!==i.activeGrid.el.id){if(i.toGrid?i.toGrid.id!==n.id&&(i.toGrid=Fancy.getWidget(n.id)):i.toGrid=Fancy.getWidget(n.id),!i.toGrid)return!0;if(!0===i.toGrid.droppable||e.isFunction(i.toGrid.droppable)&&!0===i.toGrid.droppable(i.activeGrid,i.draggingRows)){i.droppable=!0;const t=Fancy.get(document);e.nojQuery?i.toGrid.el.on("mouseleave",i.onMouseLeaveGrid,i):t.once("mouseleave",i.onMouseLeaveGrid,i,"#"+i.toGrid.id),setTimeout(()=>{if(void 0===i.dropOutSideRowIndex&&i.toGrid){const e=i.toGrid.store.getDataView().length-1;i.toGrid.rowdragdrop.activeRowIndex=e+1,i.toGrid.rowdragdrop.insertItem=i.toGrid.get(e+1),i.dropOutSideRowIndex=e+1,i.toGrid.rowdragdrop.showCellsDropMask()}},100)}}},onMouseLeaveGrid(){const t=this;e.nojQuery&&t.toGrid&&t.toGrid.el.un("mouseleave",t.onMouseLeaveGrid,t),delete t.droppable,delete t.toGrid,delete t.dropOutSideRowIndex},onMouseLeaveActiveGrid(){const e=this,t=Fancy.get(document);e.activeGrid&&e.activeGrid.el&&(t.on("mousemove",e.onMouseMoveOutSideActiveGrid,e),e.activeGrid.el.on("mouseenter",function(){t.un("mousemove",e.onMouseMoveOutSideActiveGrid)}))},onMouseMoveOutSideActiveGrid(t){var i=this,n=t.target,s=n.tagName.toLocaleLowerCase();if(!i.dropEl){switch(s){case"html":case"document":case"body":return}i.hoverEl!==n&&(i.hoverEl=n,i.activeGrid.dropZone(i.hoverEl)?(i.dropEl=e.get(i.hoverEl),i.dropEl.once("mouseleave",()=>{delete i.dropEl,delete i.hoverEl,i.activeGrid&&(i.activeGrid.rowdragdrop.dropOK=!1)}),i.activeGrid.rowdragdrop.dropOK=!0):i.activeGrid.rowdragdrop.dropOK=!1)}}})}(),function(){const e=Fancy,t=e.DragRowsManager,i=e.GRID_BODY_CLS,n=e.GRID_COLUMN_CLS,s=e.GRID_CELL_CLS,r=e.GRID_CELL_SELECTED_CLS;e.define("Fancy.grid.plugin.RowDragDrop",{extend:e.Plugin,ptype:"grid.rowdragdrop",inWidgetName:"rowdragdrop",dropOK:!1,cellMaskCls:"fancy-drop-cell-mask",cellFirstRowMaskCls:"fancy-drop-cell-first-mask",dropZoneCls:"fancy-drop-zone-active",dropOkCls:"fancy-drop-ok",dropNotOkCls:"fancy-drop-not-ok",droppable:!0,dropZoneOverClass:i,tipShown:!1,constructor:function(){this.Super("const",arguments)},init(){const e=this;e.Super("init",arguments),e.addEvents("drop","start","dropoutside"),e.ons(),e.initDropCls(),e.initEnterLeave()},ons(){const e=this,t=e.widget;t.on("beforecellmousedown",e.onBeforeCellMouseDown,e),t.on("cellmousedown",e.onCellMouseDown,e),t.on("rowenter",e.onRowEnter,e),t.on("rowleave",e.onRowLeave,e,null,100),e.on("drop",e.onDrop,e),e.on("dropoutside",e.onDropOutSide,e),e.on("start",e.onStart,e)},disableSelectionMove(){this.widget.selection.disableSelectionMove()},showTip(e){var t=this,i=t.widget;0!==(t.singleRowToDrag?[t.singleRowToDrag.data]:i.getSelection()).length&&(t.tip||t.initTip(),t.updateTipText(),e&&t.tip.show(e.pageX+20,e.pageY+20),t.tipShown=!0)},hideTip(){const e=this;e.tip&&e.tip.hide(),e.tipShown=!1},onCellMouseDown(t,i){const n=e.get(document),s=e.get(i.e.target).dom.tagName.toLocaleLowerCase();"svg"!==s&&"path"!==s||(this.cellMouseDown=e.get(i.cell),n.once("mouseup",this.onDocMouseUp,this))},onDocMouseUp(){const i=this,n=i.widget,s=e.get(document);i.cellMouseDown=!1,i.mouseDownDragEl=!1,delete i.tipValue,i.tipShown&&(s.un("mousemove",i.onDocMouseMove),i.hideTip(),i.clearCellsMask(),i.dropOK?i.fire("drop"):t.droppable&&i.fire("dropoutside"),i.tipShown=!1),n.selection&&(setTimeout(()=>{n.selection.clearOverCells()},1),n.enableSelection()),t.remove(),delete i.singleRowToDrag},onRowEnter(i,n){const s=this,o=s.widget,a=s.singleRowToDrag?[s.singleRowToDrag.data]:o.getSelection();if(t.droppable&&t.toGrid.id===o.id)t.dropOutSideRowIndex=n.rowIndex;else if(!(s.cellMouseDown&&0!==a.length&&s.tipShown||s.singleRowToDrag))return;if(0!==n.rowIndex){var l=n.rowIndex-1;if(s.singleRowToDrag&&(s.singleRowToDrag.rowIndex===l||s.singleRowToDrag.rowIndex===n.rowIndex)||o.body.getCell(l,0).hasClass(r)&&!s.singleRowToDrag)return s.dropOK=!1,s.clearCellsMask(),void delete s.activeRowIndex;if(s.singleRowToDrag&&(n.rowIndex===s.singleRowToDrag.rowIndex||l===s.singleRowToDrag.rowIndex)||!s.singleRowToDrag&&o.body.getCell(n.rowIndex,0).hasClass(r)&&1===a.length)return s.dropOK=!1,s.clearCellsMask(),void delete s.activeRowIndex;if(a.length>1){var d=!0;if(e.each(a,e=>{if(void 0===l)return void(l=o.getRowById(e.id));const t=o.getRowById(e.id);if(l!==t-1)return d=!1,!0;l=t}),d&&o.body.getCell(n.rowIndex,0).hasClass(r))return s.dropOK=!1,s.clearCellsMask(),void delete s.activeRowIndex}s.dropOK=!0;const t=o.get(l);s.insertItem=t}else{if(o.body.getCell(n.rowIndex,0).hasClass(r)){if(!(a.length>1))return s.dropOK=!1,s.clearCellsMask(),void delete s.activeRowIndex;d=!0;if(e.each(a,e=>{if(void 0===l)return void(l=o.getRowById(e.id));const t=o.getRowById(e.id);if(l!==t-1)return d=!1,!0;l=t}),d&&o.body.getCell(n.rowIndex,0).hasClass(r))return s.dropOK=!1,s.clearCellsMask(),void delete s.activeRowIndex;s.dropOK=!0}else s.dropOK=!0;s.insertItem=0}const c=o.selection.memory;if(c&&c.all&&0===c.exceptedLength)return s.dropOK=!1,void delete s.activeRowIndex;s.activeRowIndex=n.rowIndex,s.showCellsDropMask()},initTip(){const t=this,i=t.dropNotOkCls;t.tip||(t.tip=new e.ToolTip({cls:i,text:""}))},updateTipText(){var i=this,n=i.widget,s=n.lang,r=i.singleRowToDrag?[i.singleRowToDrag.data]:n.getSelection(),o=e.String.format(s.dragText,[r.length,r.length>1?"s":""]);i.tipValue&&1===r.length&&"string"===e.typeOf(i.tipValue)&&(o=i.tipValue),i.tip.update(o),r.length&&0!=i.dropOK?i.tip.el.replaceClass(i.dropNotOkCls,i.dropOkCls):t.droppable?i.tip.el.replaceClass(i.dropNotOkCls,i.dropOkCls):i.tip.el.replaceClass(i.dropOkCls,i.dropNotOkCls)},onDocMouseMove(e){const i=this;i.singleRowToDrag||i.cellMouseDown&&i.cellMouseDown.hasClass(r)?(t.activeGrid||i.fire("start"),i.showTip(e)):i.hideTip()},showCellsDropMask(){const e=this,t=e.widget,i=e.activeRowIndex-1;e.clearCellsMask(),-1===i?t.el.select("."+n+'[grid="'+t.id+'"] .'+s+'[index="0"]').addCls(e.cellFirstRowMaskCls):t.el.select("."+n+'[grid="'+t.id+'"] .'+s+'[index="'+i+'"]').addCls(e.cellMaskCls)},clearCellsMask(){const e=this,t=e.widget;t.el.select("."+e.cellMaskCls).removeCls(e.cellMaskCls),t.el.select("."+e.cellFirstRowMaskCls).removeCls(e.cellFirstRowMaskCls)},onStart(){var e,i=this.widget;e=this.singleRowToDrag?[this.singleRowToDrag.data]:i.getSelection(),i.fire("dragstart",e),e.length&&t.add(i,e)},onDrop(){var i,n=this,s=n.widget,r=n.singleRowToDrag?[n.singleRowToDrag.data]:s.getSelection();if(t.dropEl)t.activeGrid.dropZoneFn&&t.activeGrid.dropZoneFn(r);else{if(s.draggingRows=!0,s.selection.memory||s.clearSelection(),s.remove(r,null,!1),0===n.insertItem)i=0;else if(i=s.getRowById(n.insertItem.id)+1,r.length){var o=0;e.each(r,e=>{s.getRowById(e.id)<i&&o++}),i-=o}s.insert(i,r,!1),s.store.changeDataView(),s.update(),s.selection.memory||e.each(r,e=>{const t=s.getRowById(e.id);s.flashRow(t)}),s.fire("dragrows",r,i),delete s.draggingRows,s.enableSelection()}},onDropOutSide(){const e=this.widget,i=this.singleRowToDrag?[this.singleRowToDrag.data]:e.getSelection(),n=t.dropOutSideRowIndex||0;!this.singleRowToDrag&&e.dropOutSideActions&&e.clearSelection(),e.dropOutSideActions&&(e.remove(i,null,!1),e.store.changeDataView(),e.update(),t.toGrid.insert(n,i,!1),t.toGrid.store.changeDataView(),t.toGrid.update()),t.toGrid.rowdragdrop.clearCellsMask(),t.toGrid.fire("dragrows",i,n),e.dropOutSideActions&&t.remove()},onBeforeCellMouseDown(t,i){const n=this,s=Fancy.get(document),o=n.widget,a=e.get(i.e.target);("rowdrag"===i.column.type||i.column.rowdrag)&&(i.column.rowdrag&&(n.tipValue=i.value),("rowdrag"===i.column.type||i.column.rowdrag)&&("svg"!==a.dom.tagName.toLocaleLowerCase()&&"svg"!==a.parent().dom.tagName.toLocaleLowerCase()||(Fancy.get(i.cell).hasClass(r)||(o.selection.row||o.selection.rows,n.singleRowToDrag=i),n.mouseDownDragEl=!0,s.once("mousemove",e=>{n.showTip(e),s.on("mousemove",n.onDocMouseMove,n)}),o.stopSelection())))},initDropCls(){const e="#"+this.widget.id+" ."+this.dropZoneOverClass;this.dropCls=e},initEnterLeave(){const t=this,i=e.select(t.dropCls);0!==i.length?i.on("mouseleave",t.onMouseLeaveDropGroup,t):setTimeout(()=>{t.initEnterLeave()},500)},onMouseLeaveDropGroup(){this.dropOK=!1,this.clearCellsMask()},onRowLeave(e,i){var n=this,s=n.widget,r=s.store.getDataView(),o=i.rowIndex,a=n.activeRowIndex;n.cellMouseDown?o===a&&r.length-1===o&&(n.activeRowIndex=n.activeRowIndex+1,n.showCellsDropMask(),n.insertItem=s.get(o)):t.droppable&&o===(a=t.toGrid.rowdragdrop.activeRowIndex)&&t.toGrid.getDisplayedData().length-1===o&&(t.toGrid.rowdragdrop.activeRowIndex=o+1,t.toGrid.rowdragdrop.showCellsDropMask(),t.toGrid.rowdragdrop.insertItem=t.toGrid.get(o+1),t.dropOutSideRowIndex=o+1)}})}(),Fancy.modules.exporter=!0,Fancy.define("Fancy.grid.plugin.Exporter",{extend:Fancy.Plugin,ptype:"grid.exporter",inWidgetName:"exporter",csvSeparator:",",csvHeader:!1,csvFileName:"export",excelFileName:"export",constructor:function(){this.Super("const",arguments),Fancy.fullBuilt&&Fancy.loadModule("excel")},init(){},exportToExcel(e={}){const t=this,i=t.widget,n=t.getColumnsData(e),s=t.getData(e),r=!1===e.header?s:[n].concat(s),o=function(){if(!(this instanceof o))return new o;this.SheetNames=[],this.Sheets={}},a=new o,l=t.sheet_from_array_of_arrays(r);l["!cols"]=[],Fancy.each(t.widths,e=>{l["!cols"].push({wch:e})});var d=i.title;e.fileName?d=e.fileName:Fancy.isObject(d)&&(d=d.text);const c=d||t.excelFileName;a.SheetNames.push(c),a.Sheets[c]=l;const h=window.XLSX.write(a,{bookType:"xlsx",bookSST:!0,type:"binary"});window.saveAs(new Blob([function(e){for(var t=new ArrayBuffer(e.length),i=new Uint8Array(t),n=0;n!=e.length;++n)i[n]=255&e.charCodeAt(n);return t}(h)],{type:"application/octet-stream"}),c+".xlsx")},getColumnsData(e){var t,i=this,n=i.widget.getColumns(),s=[];return i.widths=[],e&&e.indexes&&(t={},Fancy.each(e.indexes,e=>{t[e]=!0})),Fancy.each(n,e=>{t&&!0!==t[e.index]||i.isColumnExportable(e)&&(i.widths.push(e.width),s.push(e.title||""))}),s},getData(e={}){if(e&&e.data)return e.data;const t=this.widget,i=[],n=e.all?t.getDisplayedData(!0,e.ignoreRender,e.rowIds,!0,e.selection):t.getDisplayedData(null,e.ingoreRender,e.rowIds,!0,e.selection);return Fancy.each(n,e=>{var t=[];Fancy.each(e,function(e){t.push(e)}),i.push(t)}),i},sheet_from_array_of_arrays(e){var t={},i={s:{c:1e7,r:1e7},e:{c:0,r:0}},n=0,s=e.length;for(;n!=s;++n)for(var r=0;r!=e[n].length;++r){i.s.r>n&&(i.s.r=n),i.s.c>r&&(i.s.c=r),i.e.r<n&&(i.e.r=n),i.e.c<r&&(i.e.c=r);var o={v:e[n][r]};if(null==o.v)continue;const s=window.XLSX.utils.encode_cell({c:r,r:n});"number"==typeof o.v?o.t="n":"boolean"==typeof o.v?o.t="b":o.v instanceof Date?(o.t="n",o.z=window.XLSX.SSF._table[14],o.v=(a=o.v,void 0&&(a+=1462),(Date.parse(a)-new Date(Date.UTC(1899,11,30)))/864e5)):o.t="s",t[s]=o}var a;return i.s.c<1e7&&(t["!ref"]=window.XLSX.utils.encode_range(i)),t},getDataAsCsv(e={}){var t,i=this,n=i.widget,s=i.getData(e),r="",o=e.separator||i.csvSeparator,a=e.header||i.csvHeader;if(e&&e.indexes&&(t={},Fancy.each(e.indexes,e=>{t[e]=!0})),a){const e=function(e){t&&!0!==t[e.index]||i.isColumnExportable(e)&&(r+='"'+(e.title||"")+'"'+o)};Fancy.each(n.leftColumns,e),Fancy.each(n.columns,e),Fancy.each(n.rightColumns,e),r=r.substring(0,r.length-1),r+="\r\n"}return Fancy.each(s,e=>{Fancy.each(e,e=>{Fancy.isString(e)&&(e='"'+e+'"'),r+=e+o}),r=r.substring(0,r.length-1),r+="\r\n"}),r},exportToCSV(e={}){const t=this.getDataAsCsv(e),i=e.fileName||this.csvFileName,n=new Blob([t],{type:"text/csv;charset=utf-8;"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(n,i);else{const e=document.createElement("a");e.href=window.URL.createObjectURL(n),e.download=i+".csv",document.body.appendChild(e),e.click(),document.body.removeChild(e)}},isColumnExportable(e){if(/spark/.test(e.type))return!1;switch(e.type){case"select":case"action":case"expand":case"grossloss":case"hbar":case"rowdrag":return!1}return!e.hidden&&!1!==e.exportable}}),Fancy.modules.state=!0,function(){const e=Fancy;e.define("Fancy.grid.plugin.State",{extend:e.Plugin,ptype:"grid.state",inWidgetName:"state",stateful:!1,$log:{filter:!0,sort:!0,columnresize:!0,columndrag:!0,changepage:!0,columnhide:!0,resize:!0},constructor:function(){this.log=this.log||{},this.Super("const",arguments)},init(){this.Super("init",arguments),this.initLog(),this.ons()},ons(){const e=this,t=e.widget;t.on("beforeinit",e.onBeforeInit,e),e.stateful&&(e.log.sort&&t.on("sort",e.onSort,e),e.log.filter&&t.on("filter",e.onFilter,e),e.log.columnresize&&t.on("columnresize",e.onColumnResize,e),e.log.columndrag&&(t.on("columndrag",e.onColumnDrag,e),t.on("lockcolumn",e.onColumnLock,e),t.on("rightlockcolumn",e.onColumnRightLock,e),t.on("unlockcolumn",e.onColumnUnLock,e)),e.log.changepage&&t.on("changepage",e.onChangePage,e),e.log.columnhide&&(t.on("columnhide",e.onColumnHide,e),t.on("columnshow",e.onColumnShow,e)),t.on("columnremove",e.onColumnRemove,e),t.on("columnadd",e.onColumnAdd,e),t.on("init",()=>{t.panel&&e.log.resize&&t.panel.on("resize",e.onResize,e)}),t.on("changewidth",e.onChangeWidth,e),t.on("changeheight",e.onChangeHeight,e))},onSort(){var e=this.widget,t=e.store,i=e.getStateName(),n=localStorage.getItem(i)||"{}";(n=JSON.parse(n)).sorters=JSON.stringify(t.sorters),localStorage.setItem(i,JSON.stringify(n)),this.copyColumns(),this.widget.fire("statechange",this.getState(),"sorters",n.sorters)},onFilter(){var e=this.widget,t=e.store,i=e.getStateName(),n=localStorage.getItem(i)||"{}";(n=JSON.parse(n)).filters=JSON.stringify(t.filters),localStorage.setItem(i,JSON.stringify(n)),this.copyColumns(),this.widget.fire("statechange",this.getState(),"filters",n.filters)},onColumnResize(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnDrag(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnLock(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnRightLock(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnUnLock(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnHide(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnShow(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnRemove(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},onColumnAdd(){this.copyColumns(),this.widget.fire("statechange",this.getState(),"columns")},copyColumns(){var t=this.widget,i=t.getStateName(),n=localStorage.getItem(i)||"{}";n=JSON.parse(n);const s=t.getColumns(),r=[];e.each(s,t=>{const i={};e.each(t,(t,n)=>{switch(e.typeOf(t)){case"string":case"number":case"boolean":i[n]=t;break;case"object":switch(n){case"filterField":break;default:i[n]="OBJECT"}break;case"array":i[n]="ARRAY";break;case"function":i[n]="FUNCTION"}}),r.push(i)}),n.columns=JSON.stringify(r),localStorage.setItem(i,JSON.stringify(n))},onBeforeInit(){const t=this,i=t.widget,n=i.getStateName(),s=localStorage.getItem(n)||"{}",r=t.startState;"{}"===s&&i.autoColumnWidth&&(i.allowAutoWidthStateIsEmpty=!0);const o=function(){for(var e in r.filters){var t=r.filters[e];for(var n in t)"*"===n&&i.searching?i.addFilter(e,t[n],n,!1):i.addFilter(e,t[n],n)}},a=function(){e.each(r.sorters,e=>{i.sort(e.key,e.dir,!1)})};if(r){if(i.waitingForFilters=!0,i.stateIsWaiting=!0,i.WAIT_FOR_STATE_TO_LOAD&&(r.filters&&(o(),i.store.remoteFilter&&i.store.serverFilter(!1)),r.sorters&&a(),delete i.WAIT_FOR_STATE_TO_LOAD,i.store.loadData()),i.store.loading)return void i.once("load",()=>{t.onBeforeInit()},t);setTimeout(()=>{i.SERVER_FILTER_SORT||(r.filters&&o(),r.sorters&&a()),void 0!==r.page&&i.setPage(Number(r.page),!1),delete i.waitingForFilters,i.store.changeDataView(),delete i.stateIsWaiting,i.update(),i.setSidesHeight()},100)}s.width&&i.setWidth(s.width),s.height&&i.setHeight(s.height)},onChangePage(e,t){var i=this.widget,n=i.getStateName(),s=localStorage.getItem(n)||"{}";void 0!==t&&s&&i.inited&&((s=JSON.parse(s)).page=t+1,localStorage.setItem(n,JSON.stringify(s)),this.widget.fire("statechange",this.getState(),"page",s.page))},onResize(e,t){var i=this.widget,n=i.getStateName(),s=localStorage.getItem(n)||"{}";s=JSON.parse(s),i.responsiveWidth||i.wrapped||(s.width=t.width),i.responsiveHeight||i.wrapped||(s.height=t.height),localStorage.setItem(n,JSON.stringify(s)),this.widget.fire("statechange",this.getState(),"size",[s.width,s.height])},onChangeWidth(e,t){var i=this.widget,n=i.getStateName(),s=localStorage.getItem(n)||"{}";s=JSON.parse(s),i.responsiveWidth||i.wrapped||(s.width=t),localStorage.setItem(n,JSON.stringify(s)),this.widget.fire("statechange",this.getState(),"width",s.width)},onChangeHeight(e,t){var i=this.widget,n=i.getStateName(),s=localStorage.getItem(n)||"{}";s=JSON.parse(s),i.responsiveHeight||i.wrapped||(s.height=t),localStorage.setItem(n,JSON.stringify(s)),this.widget.fire("statechange",this.getState(),"height",s.height)},initLog(){e.applyIf(this.log,this.$log)},getState(){var t=this.widget.getStateName(),i=localStorage.getItem(t)||"{}";return"{}"===i&&(i=this.startState),e.isString(i)?JSON.parse(i):i}})}(),Fancy.define("Fancy.grid.plugin.Licence",{extend:Fancy.Plugin,ptype:"grid.licence",inWidgetName:"licence",constructor:function(){this.Super("const",arguments)},init(){this.Super("init",arguments),this.ons()},ons(){const e=this;e.widget.once("render",()=>e.render())},render(){const e=this,t=e.widget,i=t.body,n=Fancy.newEl("div");/fancygrid/.test(location.host)&&!t.watermark||(!0!==e.checkLicence()||t.watermark)&&(n.css({position:"absolute","z-index":2,width:"30px",height:"30px"}),t.nativeScroller?n.css({top:"2px",left:"2px"}):n.css({right:"4px",bottom:"0px"}),n.update('<a href="http://www.fancygrid.com" title="JavaScript Grid - FancyGrid" style="background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAPklEQVR42mNgGLGAo+/4f1IwTN+i8y/+k4JHLR61eNTiUYuHgcUjD5AbZORG0ajFoxaPWjxq8RC2eBQMWwAAuxzh7E9tdUsAAAAASUVORK5CYII=);color: #60B3E2;font-size: 25px;line-height: 30px;text-decoration: none;background-repeat: no-repeat;">&nbsp;&nbsp;&nbsp;&nbsp;</a>'),Fancy.get(i.el.append(n.dom)),e.licenceEl=n,t.watermark&&e.configWatermark(),e.showConsoleText())},showConsoleText(){window.console&&console.log&&Fancy.isChrome&&(console.log("%cFancy%cGrid%c %cTrial%c Version!","color:#A2CFE8;font-size: 14px;font-weight: bold;","color:#088EC7;font-size: 14px;font-weight: bold;","font-weight:bold;color: #515151;font-size: 12px;","color: red;font-weight: bold;font-size: 14px;","font-weight:bold;color: #515151;font-size: 12px;"),console.log("%cPurchase license for legal usage!\nSales email: sales@fancygrid.com","font-weight:bold;color: #515151;font-size: 12px;"))},configWatermark(){const e=this,t=e.widget.watermark;if(t.text){const i=e.licenceEl.firstChild();i.css("background-image","none"),i.css("font-size","11px"),i.update(t.text),e.licenceEl.css("width","initial")}t.style&&e.licenceEl.css(t.style)},checkLicence(){var e=this,t="FancyGrid";if(!Fancy.LICENSE&&!FancyGrid.LICENSE)return!1;var i,n,s=String(e.md5(location.host.replace(/^www\./,""),t)),r=Fancy.LICENSE||FancyGrid.LICENSE||[],o=e.md5("UNIVERSAL",t),a=e.md5("SAAS",t),l=e.md5("INTERNAL",t),d=e.md5("OEM",t),c=e.md5("ENTERPRISE",t);for(i=0,n=r.length;i<n;i++)switch(String(r[i])){case s:case o:case a:case l:case d:case c:return!0}return!1},md5(e,t,i){var n=function(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i},s=function(e,t,i,s,r,o){return n((a=n(n(t,e),n(s,o)))<<(l=r)|a>>>32-l,i);var a,l},r=function(e,t,i,n,r,o,a){return s(t&i|~t&n,e,t,r,o,a)},o=function(e,t,i,n,r,o,a){return s(t&n|i&~n,e,t,r,o,a)},a=function(e,t,i,n,r,o,a){return s(t^i^n,e,t,r,o,a)},l=function(e,t,i,n,r,o,a){return s(i^(t|~n),e,t,r,o,a)},d=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var i,s,d,c,h,u=1732584193,g=-271733879,p=-1732584194,m=271733878;for(i=0;i<e.length;i+=16)s=u,d=g,c=p,h=m,u=r(u,g,p,m,e[i],7,-680876936),m=r(m,u,g,p,e[i+1],12,-389564586),p=r(p,m,u,g,e[i+2],17,606105819),g=r(g,p,m,u,e[i+3],22,-1044525330),u=r(u,g,p,m,e[i+4],7,-176418897),m=r(m,u,g,p,e[i+5],12,1200080426),p=r(p,m,u,g,e[i+6],17,-1473231341),g=r(g,p,m,u,e[i+7],22,-45705983),u=r(u,g,p,m,e[i+8],7,1770035416),m=r(m,u,g,p,e[i+9],12,-1958414417),p=r(p,m,u,g,e[i+10],17,-42063),g=r(g,p,m,u,e[i+11],22,-1990404162),u=r(u,g,p,m,e[i+12],7,1804603682),m=r(m,u,g,p,e[i+13],12,-40341101),p=r(p,m,u,g,e[i+14],17,-1502002290),g=r(g,p,m,u,e[i+15],22,1236535329),u=o(u,g,p,m,e[i+1],5,-165796510),m=o(m,u,g,p,e[i+6],9,-1069501632),p=o(p,m,u,g,e[i+11],14,643717713),g=o(g,p,m,u,e[i],20,-373897302),u=o(u,g,p,m,e[i+5],5,-701558691),m=o(m,u,g,p,e[i+10],9,38016083),p=o(p,m,u,g,e[i+15],14,-660478335),g=o(g,p,m,u,e[i+4],20,-405537848),u=o(u,g,p,m,e[i+9],5,568446438),m=o(m,u,g,p,e[i+14],9,-1019803690),p=o(p,m,u,g,e[i+3],14,-187363961),g=o(g,p,m,u,e[i+8],20,1163531501),u=o(u,g,p,m,e[i+13],5,-1444681467),m=o(m,u,g,p,e[i+2],9,-51403784),p=o(p,m,u,g,e[i+7],14,1735328473),g=o(g,p,m,u,e[i+12],20,-1926607734),u=a(u,g,p,m,e[i+5],4,-378558),m=a(m,u,g,p,e[i+8],11,-2022574463),p=a(p,m,u,g,e[i+11],16,1839030562),g=a(g,p,m,u,e[i+14],23,-35309556),u=a(u,g,p,m,e[i+1],4,-1530992060),m=a(m,u,g,p,e[i+4],11,1272893353),p=a(p,m,u,g,e[i+7],16,-155497632),g=a(g,p,m,u,e[i+10],23,-1094730640),u=a(u,g,p,m,e[i+13],4,681279174),m=a(m,u,g,p,e[i],11,-358537222),p=a(p,m,u,g,e[i+3],16,-722521979),g=a(g,p,m,u,e[i+6],23,76029189),u=a(u,g,p,m,e[i+9],4,-640364487),m=a(m,u,g,p,e[i+12],11,-421815835),p=a(p,m,u,g,e[i+15],16,530742520),g=a(g,p,m,u,e[i+2],23,-995338651),u=l(u,g,p,m,e[i],6,-198630844),m=l(m,u,g,p,e[i+7],10,1126891415),p=l(p,m,u,g,e[i+14],15,-1416354905),g=l(g,p,m,u,e[i+5],21,-57434055),u=l(u,g,p,m,e[i+12],6,1700485571),m=l(m,u,g,p,e[i+3],10,-1894986606),p=l(p,m,u,g,e[i+10],15,-1051523),g=l(g,p,m,u,e[i+1],21,-2054922799),u=l(u,g,p,m,e[i+8],6,1873313359),m=l(m,u,g,p,e[i+15],10,-30611744),p=l(p,m,u,g,e[i+6],15,-1560198380),g=l(g,p,m,u,e[i+13],21,1309151649),u=l(u,g,p,m,e[i+4],6,-145523070),m=l(m,u,g,p,e[i+11],10,-1120210379),p=l(p,m,u,g,e[i+2],15,718787259),g=l(g,p,m,u,e[i+9],21,-343485551),u=n(u,s),g=n(g,d),p=n(p,c),m=n(m,h);return[u,g,p,m]},c=function(e){var t,i="";for(t=0;t<32*e.length;t+=8)i+=String.fromCharCode(e[t>>5]>>>t%32&255);return i},h=function(e){var t,i=[];for(i[(e.length>>2)-1]=void 0,t=0;t<i.length;t+=1)i[t]=0;for(t=0;t<8*e.length;t+=8)i[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return i},u=function(e){var t,i,n="";for(i=0;i<e.length;i+=1)t=e.charCodeAt(i),n+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return n},g=function(e){return unescape(encodeURIComponent(e))},p=function(e){return function(e){return c(d(h(e),8*e.length))}(g(e))},m=function(e,t){return function(e,t){var i,n,s=h(e),r=[],o=[];for(r[15]=o[15]=void 0,s.length>16&&(s=d(s,8*e.length)),i=0;i<16;i+=1)r[i]=909522486^s[i],o[i]=1549556828^s[i];return n=d(r.concat(h(t)),512+8*t.length),c(d(o.concat(n),640))}(g(e),g(t))};return function(e,t,i){return t?i?m(t,e):u(m(t,e)):i?p(e):u(p(e))}(e,t,i)}}),function(){const e=Fancy,t=e.GRID_CELL_CLS,i=e.GRID_CELL_EVEN_CLS,n=e.GRID_CELL_SELECTED_CLS,s=e.GRID_COLUMN_CLS,r=e.GRID_COLUMN_TEXT_CLS,o=e.GRID_COLUMN_ELLIPSIS_CLS,a=e.GRID_COLUMN_ORDER_CLS,l=e.GRID_COLUMN_SELECT_CLS,d=e.GRID_COLUMN_TREE_CLS,c=e.GRID_CELL_INNER_CLS,h=e.GRID_CELL_DIRTY_CLS,u=e.GRID_CELL_DIRTY_EL_CLS,g=e.GRID_PSEUDO_CELL_CLS,p=e.GRID_EMPTY_CLS,m=e.GRID_COLUMN_SPARKLINE_CLS,f=e.GRID_COLUMN_SPARKLINE_BULLET_CLS,y=e.GRID_COLUMN_CHART_CIRCLE_CLS,C=e.GRID_COLUMN_SPARK_PROGRESS_DONUT_CLS,v=e.GRID_COLUMN_GROSSLOSS_CLS,w=e.GRID_COLUMN_PROGRESS_CLS,b=e.GRID_COLUMN_PROGRESS_BAR_CLS,S=e.GRID_COLUMN_H_BAR_CLS,x=e.GRID_COLUMN_ROW_DRAG_CLS,I=e.GRID_ROW_DRAG_EL_CLS,E=`.${t}`,T=`.${t} .${c}`;e.ns("Fancy.grid.body.mixin"),e.grid.body.mixin.Updater=function(){},e.grid.body.mixin.Updater.prototype={update(e){let t,i=this,n=i.widget,s=n.store;switch(e){case"cell":case"cells":break;case"waitstate":return void i.checkDomColumns();default:i.checkDomColumns()}if(!s.loading){switch(e){case"row":case"rows":for(var r in t=s.changed){var o=t[r],a=n.getRowById(r);for(var l in o)switch(l){case"length":break;default:i.updateRows(a)}}break;case"cell":case"cells":for(var r in t=s.changed){o=t[r],a=n.getRowById(r);for(var l in o)switch(l){case"length":break;default:var d=n.getColumnOrderByKey(l);i.updateRows(a,d.order)}}break;default:i.checkDomCells(),i.updateRows()}i.showEmptyText()}},checkDomColumns(){var t=this,i=t.widget,n=t.el.select("."+s).length,c=t.getColumns(),h=0,u=c.length;if(!(u<=n)){for(;h<u;h++){const n=c[h],u=n.width,g=e.newEl("div");if(n.hidden&&g.css("display","none"),g.addCls(s),g.attr("grid",i.id),g.attr("role","presentation"),"$selected"===n.index||n.select)g.addCls(l);else switch(n.type){case"order":g.addCls(a);break;case"rowdrag":g.addCls(x)}if("tree"===n.type&&(g.addCls(d),n.folder&&g.addCls("fancy-grid-tree-column-folder")),n.rowdrag&&g.addCls(x),n.cls&&g.addCls(n.cls),"text"===n.type&&g.addCls(r),g.css({width:u+"px"}),g.attr("index",h),n.cellAlign&&g.css("text-align",n.cellAlign),!0===n.ellipsis)switch(n.type){case"string":case"text":case"number":case"currency":case"date":case"combo":case"tree":g.addCls(o)}t.el.dom.appendChild(g.dom)}t.fire("adddomcolumns")}},checkDomCells(r){var o,a,l=this,d=l.widget,c=d.body,h=d.store,u=0,p=h.dataView.length,m=0;switch(h.infinite&&(p=h.infiniteDisplayedRows)>h.dataView.length&&(p=h.dataView.length),l.side){case"left":a=d.leftColumns;break;case"center":a=d.columns;break;case"right":a=d.rightColumns}o=a.length;var f=l.el.select("."+s),y=h.getLength(),C=l.cellTpl;for(d.cellWrapper&&(C=l.cellWrapperTpl),void 0!==r&&(m=r,o=r);m<o;m++){var v=f.item(m);for(u=p-(y-v.select(E).length);u<p;u++){var w=C.getHTML({});(b=e.newEl("div")).attr("role","gridcell"),b.css({height:d.cellHeight+"px"}),b.addCls(t),b.attr("index",u),u%2!=0&&d.striped&&b.addCls(i),b.update(w),v.dom.appendChild(b.dom),c.el.select("."+t+"."+n+'[index="'+u+'"]').length&&b.addCls(n)}if(d.nativeScroller&&("left"===l.side||"right"===l.side)){v.select(`.${g}`).destroy();var b;w=C.getHTML({cellValue:"&nbsp;"});(b=e.newEl("div")).attr("role","gridcell"),b.css({height:d.cellHeight+"px"}),b.addCls(g),b.update(w),v.dom.appendChild(b.dom)}}},updateRows(e,t){var i,n,s=this,r=s.widget,o=0;switch(void 0===e?s.clearDirty():s.clearDirty(e),s.side){case"left":i=r.leftColumns;break;case"center":i=r.columns;break;case"right":i=r.rightColumns}if(n=i.length,!(void 0!==t&&(o=t,(n=t+1)>i.length))){for(;o<n;o++){const t=i[o];switch(t.type){case"string":case"number":case"combo":case"action":case"text":case"date":case"currency":s.renderUniversal(o,e);break;case"tree":s.renderTree(o,e);break;case"order":s.renderOrder(o,e);break;case"expand":s.renderExpand(o,e);break;case"select":s.renderSelect(o,e);break;case"color":s.renderColor(o,e);break;case"checkbox":s.renderCheckbox(o,e);break;case"switcher":s.renderCheckbox(o,e,!0);break;case"image":s.renderImage(o,e);break;case"sparklineline":s.renderSparkLine(o,e,"line");break;case"sparklinebar":s.renderSparkLine(o,e,"bar");break;case"sparklinetristate":s.renderSparkLine(o,e,"tristate");break;case"sparklinediscrete":s.renderSparkLine(o,e,"discrete");break;case"sparklinebullet":s.renderSparkLine(o,e,"bullet");break;case"sparklinepie":s.renderSparkLine(o,e,"pie");break;case"sparklinebox":s.renderSparkLine(o,e,"box");break;case"circle":s.renderCircle(o,e);break;case"progressdonut":s.renderProgressDonut(o,e);break;case"progressbar":s.renderProgressBar(o,e);break;case"hbar":s.renderHBar(o,e);break;case"grossloss":s.renderGrossLoss(o,e);break;case"rowdrag":s.renderRowDrag(o,e);break;default:throw new Error("[FancyGrid error] - not existed column type "+t.type)}t.select&&s.renderSelect(o,e,!0),t.rowdrag&&s.renderRowDrag(o,e,!0)}s.removeNotUsedCells()}},renderUniversal(e,i){var n,r,o,a=this,l=a.widget,d=l.lang,c=l.emptyValue,h=l.store,u=a.getColumns()[e],g=a.el.select(`.${s}`).item(e),p=g.select(E),m=g.select(T),f=u.currency||d.currencySign,y=!1;u.select&&(y=!0),u.rowdrag&&(y=!0),n=void 0!==u.index?u.index:"action"===u.type?"none":void 0,void 0!==i?(r=i,o=i+1):(r=0,o=h.getLength());var C=0;if(l.infinite){C=h.infiniteScrolledToRow;const e=l.getNumOfVisibleCells();o>e&&(o=e)}for(;r<o;r++){if(l.infinite){var v=h.dataView[r+C],w=p.item(r);if(void 0===v){l.el.select("."+t+'[index="'+r+'"]').css("visibility","hidden");break}if("hidden"===w.css("visibility")){l.el.select("."+t+'[index="'+r+'"]').css("visibility","");break}}var b,S=h.get(r+C),x=h.getId(r+C),I=m.item(r),F=(w=p.item(r),{rowIndex:r,data:S,style:{},column:u,id:x,item:h.getItem(r+C),inner:I,cell:w}),L=!1;switch(h.changed[F.id]&&h.changed[F.id][u.index]&&(L=!0),b=u.smartIndexFn?u.smartIndexFn(S):void 0===n?"":h.get(r+C,n),F.value=b,u.format&&(F.value=a.format(F.value,u.format,u.precision),b=F.value),u.type){case"currency":""!==b&&(b=f+b),F.value=b}switch(u.render&&(b=(F=u.render(F)).value),b){case"":case null:case void 0:b=c}if(l.cellStylingCls&&a.clearCls(w),F.cls&&w.addCls(F.cls),L&&l.dirtyEnabled&&a.enableCellDirty(w),w.css(F.style),y){const e=[];u.rowdrag&&e.push('<div class="fancy-grid-cell-inner-rowdrag"></div>'),u.select?e.push('<div class="fancy-grid-cell-inner-select"></div>'):u.rowdrag&&e.push('<div class="fancy-grid-cell-inner-rowdrag-fix"></div>');const t=I.select(".fancy-grid-cell-inner-text");t.length?t.update(b):(e.push('<span class="fancy-grid-cell-inner-text">'+b+"</span>"),I.update(e.join(" ")))}else F.column.widget||I.update(b);if(F.column.autoHeight){w.css("height","");let e=parseInt(w.css("height"))+4;l.rowheight.waitToShow(),e<l.cellHeight&&(e=l.cellHeight),l.rowheight.add(x,e,F.rowIndex)}}},renderOrder(e){var t=this.widget,i=t.store,n=this.getColumns()[e],r=this.el.select(`.${s}`).item(e),o=r.select(E),a=r.select(T),l=0,d=i.getLength(),c=0;if(t.paging&&(c+=i.showPage*i.pageSize),t.infinite){const e=t.getNumOfVisibleCells();d>e&&(d=e),c=i.infiniteScrolledToRow}for(;l<d;l++){var h=i.get(l),u=i.getId(l),g={rowIndex:l,data:h,style:{},column:n,id:u,item:i.getItem(l)},p=l+1+c;t.grouping&&(p+=t.grouping.getCollapsedRowsBefore(u)),g.value=p,n.render&&(p=(g=n.render(g)).value);const e=o.item(l);t.cellStylingCls&&this.clearCls(e),g.cls&&e.addCls(g.cls),e.css(g.style),a.item(l).update(p)}t.grouping&&delete t.grouping.collapsedRowsBefore},renderRowDrag(e,t,i){var n=this.widget,r=n.store,o=this.getColumns()[e],a=this.el.select(`.${s}`).item(e),l=a.select(E),d=a.select(T),c=0,h=r.getLength();if(n.infinite){const e=n.getNumOfVisibleCells();h>e&&(h=e)}for(;c<h;c++){const e={rowIndex:c,data:r.get(c),style:{},column:o,id:r.getId(c),item:r.getItem(c)},t='<svg class="'+I+'" style="opacity: 0;" viewBox="0 0 6 14"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 2h2V0H0v2zm0 4h2V4H0v2zm0 3.999h2V8H0v1.999zM0 14h2v-2H0v2zM4 0v2h2V0H4zm0 6h2V4H4v2zm0 3.999h2V8H4v1.999zM4 14h2v-2H4v2z"></path></svg>';e.value=t;const s=l.item(c);if(n.cellStylingCls&&this.clearCls(s),e.cls&&s.addCls(e.cls),s.css(e.style),i){d.item(c).select(".fancy-grid-cell-inner-rowdrag").item(0).update(t)}else d.item(c).update(t)}},renderTree(e,t){var i,n,r=this.widget,o=r.store,a=this.getColumns()[e],l=this.el.select(`.${s}`).item(e).select(T),d=a.index;if(void 0!==t?(i=t,n=t+1):(i=0,n=o.getLength()),r.infinite){const e=r.getNumOfVisibleCells();n>e&&(n=e)}for(;i<n;i++){var c=l.item(i),h=r.get(i),u=h.get(d),g=Number(h.get("$deep"))-1,p="fancy-grid-tree-expander";h.get("leaf")&&(p="fancy-grid-tree-expander-leaf"),h.get("expanded")&&(p+=" fancy-grid-tree-expander-expanded");let e=15*g,n="";if(a.render){const e=a.render({item:h,data:h.data,deep:g,leaf:h.get("leaf"),rowIndex:t,column:a,value:u});e.nodeImgCls&&(n='<span class="fancy-grid-tree-expander-node '+e.nodeImgCls+'"></span>'),void 0!==e.value&&(u=e.value)}if(a.folder){const e=h.get("leaf"),t=h.get("expanded");n=e?'<span class="fancy-grid-tree-folder-file"></span>':t?'<span class="fancy-grid-tree-folder-opened"></span>':'<span class="fancy-grid-tree-folder-closed"></span>'}h.get("leaf")&&(e-=8);const s=[];s.push('<span class="'+p+'" style="margin-left: '+e+'px;"></span>'),a.select&&s.push('<span class="fancy-grid-cell-inner-select" style="margin-left: 6px;"></span>'),s.push(n),s.push('<span class="fancy-grid-tree-expander-text">'+u+"</span>"),c.update(s.join(""))}},renderExpand(t,i){var n,r,o=this.widget,a=o.store,l=this.getColumns()[t],d=this.el.select(`.${s}`).item(t).select(T);if(void 0!==i?(n=i,r=i+1):(n=0,r=a.getLength()),o.infinite){const e=o.getNumOfVisibleCells();r>e&&(r=e)}for(;n<r;n++){var c,h=d.item(n).select(".fancy-field-checkbox"),u=0!==h.length,g=o.get(n).id;!1===u?(d.item(n).update(""),h=new e.CheckBox({renderTo:d.item(n).dom,renderId:!0,value:!1,label:!1,expander:!0,style:{padding:"0px",display:"inline-block"},events:[{change:function(e,t){i=e.el.parent().parent().attr("index"),t?o.expander.expand(i):o.expander.collapse(i)}}]})):(c=h.dom.id,h=e.getWidget(c),o.expander._expandedIds[g]?h.set(!0,!1):h.set(!1,!1));const t={rowIndex:n,data:a.get(n),style:{},column:l,id:a.getId(n),item:a.getItem(n)};l.render&&(!0===l.render(t).hidden?h.hide():h.show())}},clearCls(t){const i=this.widget;e.each(i.cellStylingCls,e=>t.removeCls(e))},renderColor(e,t){var i,n,r=this.widget,o=r.store,a=this.getColumns()[e],l=a.index,d=this.el.select("."+s).item(e).select(E);if(void 0!==t?(i=t,n=t+1):(i=0,n=o.getLength()),r.infinite){const e=r.getNumOfVisibleCells();n>e&&(n=e)}for(;i<n;i++){var h,u=o.get(i),g={rowIndex:i,data:u,style:{},column:a};h=a.smartIndexFn?a.smartIndexFn(u):o.get(i,l),a.render&&(h=(g=a.render(g)).value),g.value=h;const e=d.item(i);e.css(g.style),e.select(`.${c}`).update('<div class="fancy-grid-color-cell" style="background: '+h+';"></div>')}},renderCombo(e,t){var i,n,r=this.widget.store,o=this.getColumns()[e],a=o.index,l=this.el.select(`.${s}`).item(e),d=l.select(E),c=l.select(T);for(void 0!==t?(i=t,n=t+1):(i=0,n=r.getLength());i<n;i++){var h=r.get(i,a),u={rowIndex:i,value:h,style:{}};o.render&&(h=(u=o.render(u)).value),d.item(i).css(u.style),c.item(i).update(h)}},renderCheckbox(t,i,n){var r,o,a=this,l=a.widget,d=l.store,c=a.getColumns()[t],h=c.index,u=a.el.select(`.${s}`).item(t),g=u.select(E),p=u.select(T),m="CheckBox";if(n&&(m="Switcher"),void 0!==i?(r=i,o=i+1):(r=0,o=d.getLength()),l.infinite){const e=l.getNumOfVisibleCells();o>e&&(o=e)}for(;r<o;r++){var f,y=d.get(r),C=d.get(r,h),v=p.item(r),w=g.item(r),b=n?v.select(".fancy-field-switcher"):v.select(".fancy-field-checkbox"),S=0!==b.length,x=!1,I=d.getId(r),F={rowIndex:r,data:y,style:{},column:c,id:I,item:d.getItem(r),value:C};if(d.changed[F.id]&&d.changed[F.id][c.index]&&(x=!0),c.render&&(C=(F=c.render(F)).value),!1===S)if(F.stopped)p.item(r).update(C);else{let t=!0;l.rowEdit&&(t=!1),p.item(r).update(""),new e[m]({renderTo:p.item(r).dom,renderId:!0,value:C,label:!1,editable:t,style:{padding:"0px",display:"inline-block"},events:[{beforechange(e){"$selected"===c.index||c.select||!0!==c.editable&&(e.canceledChange=!0)}},{change(e,t){"$selected"===c.index||c.select||(l.celledit.checkBoxChangedValue=t)}}]})}else f=b.dom.id,b=e.getWidget(f),F.stopped?(b.destroy(),p.item(r).update(C)):b.set(C,!1);l.cellStylingCls&&a.clearCls(w),F.cls&&w.addCls(F.cls),w.css(F.style),x&&l.dirtyEnabled&&(w=g.item(r),a.enableCellDirty(w))}},renderSelect(t,i,r){let o;var a,l,d=this.widget,c=d.store,h=this.getColumns()[t],u=this.el.select(`.${s}`).item(t).select(T);if(void 0!==i?(a=i,l=i+1):(a=0,l=c.getLength()),d.infinite){const e=d.getNumOfVisibleCells();l>e&&(l=e)}for(;a<l;a++){var g,p,m=!1,f=c.get(a,"id"),y=u.item(a),C=0!==(o=y.select(".fancy-field-checkbox")).length,v=!0;if(d.selection.memory){if(d.selection.memory.all&&!d.selection.memory.excepted[f]?(m=!0,d.selection.domSelectRow(a)):d.selection.memory.has(f)?(m=!0,d.selection.domSelectRow(a)):(m=!1,d.selection.domDeSelectRow(a)),c.isTree){var w=(g=c.getItem(a)).get("$selected");if(w){const t=function(i){e.each(i,function(e){e.fields&&(!1!==e.get("$selected")?(g.set("$selected",void 0),e.set("$selected",!0),d.selection.memory.add(e.id),e.data.child&&e.data.child[0]&&e.data.child[0].fields&&t(e.data.child)):d.selection.memory.remove(e.id))})};t(g.data.child)}}}else y.parent().hasClass(n)&&(m=!0);if("select"===h.type||h.select)if(d.selection.disabled&&(v=!1),!1===C){let t=u.item(a);r?(t=t.select(".fancy-grid-cell-inner-select").item(0).dom,Fancy.isBoolean(m)||(m=!1)):(u.item(a).update(""),t=t.dom);const i={renderTo:t,renderId:!0,value:m,label:!1,stopIfCTRL:!0,editable:v,disabled:!v,style:{padding:"0px",display:"inline-block"},events:[{beforechange:function(e){d.selection.stopOneTick&&(e.canceledChange=!0)}}]};if(o=new e.CheckBox(i),c.isTree&&d.selection.memory&&d.selection.memory.tree.selected[f]&&!d.selection.memory.tree.allSelected[f]&&g){const e=g.get("child");e&&e.length&&o.setMiddle(!0)}}else p=o.dom.id,(o=e.getWidget(p)).set(m,!1)}},renderImage(e,t){var i,n,r=this.widget,o=r.store,a=this.getColumns()[e],l=a.index,d=this.el.select(`.${s}`).item(e),c=d.select(E),h=d.select(T);if(void 0!==t?(i=t,n=t+1):(i=0,n=o.getLength()),r.infinite){const e=r.getNumOfVisibleCells();n>e&&(n=e)}for(;i<n;i++){var u=o.get(i,l),g={rowIndex:i,value:u,data:o.get(i),style:{}},p="";if(a.render&&(u=(g=a.render(g)).value),g.attr)for(var m in g.attr)p+=m+'="'+g.attr[m]+'"';u="<img "+p+' src="'+g.value+'">',c.item(i).css(g.style),h.item(i).update(u)}},renderSparkLine(t,i,n){var r,o,a=this.widget,l=a.cellHeight,d=a.store,c=this.getColumns()[t],h=c.width,u=c.index,g=this.el.select(`.${s}`).item(t),p=g.select(E),y=g.select(T),C=c.sparkConfig||{};g.addCls(m),void 0!==i?(r=i,o=i+1):(r=0,o=d.getLength());var v,w=l-1,b=h-20;switch(n){case"line":case"pie":case"box":v="width";break;case"bullet":v="width",w-=11,g.addCls(f);break;case"discrete":v="width",b=h,w-=2;break;case"bar":case"tristate":v="barWidth"}if(a.infinite){const e=a.getNumOfVisibleCells();o>e&&(o=e)}for(;r<o;r++){var S=d.get(r,u),x={rowIndex:r,value:S,data:d.get(r),style:{}};if(c.render&&(S=(x=c.render(x)).value),e.isArray(c.values)){var I=0,F=c.values.length;for(S=[];I<F;I++)S.push(d.get(r,c.values[I]))}p.item(r).css(x.style);const t=y.item(r).dom,i={type:n,fillColor:"transparent",height:w};e.apply(i,C),"bar"!==n&&"tristate"!==n||(b=h-20,b/=S.length),i[v]=b,e.$(t).sparkline(S,i)}},renderProgressDonut(t,i){var n,r,o=this.widget,a=o.store,l=this.getColumns()[t],d=l.index,c=this.el.select(`.${s}`).item(t),h=c.select(E),u=c.select(T);if(c.addCls(C),void 0!==i?(n=i,r=i+1):(n=0,r=a.getLength()),o.infinite){const e=o.getNumOfVisibleCells();r>e&&(r=e)}for(;n<r;n++){var g,p=a.get(n),m={rowIndex:n,data:p,style:{},column:l};g=l.smartIndexFn?l.smartIndexFn(p):a.get(n,d),m.value=g,l.format&&(m.value=this.format(m.value,l.format),g=m.value),l.render&&(g=(m=l.render(m)).value),h.item(n).css(m.style);const t=l.sparkConfig||{},i=u.item(n).dom;e.apply(t,{renderTo:i,value:g}),t.size||t.height||t.width||(t.size=o.cellHeaderHeight-6),e.get(i).update(""),new e.spark.ProgressDonut(t)}},renderGrossLoss(t,i){var n,r,o=this.widget,a=o.store,l=this.getColumns()[t],d=l.index,c=this.el.select(`.${s}`).item(t),h=c.select(E),u=c.select(T);c.addCls(v),void 0!==i?(n=i,r=i+1):(n=0,r=a.getLength());const g=l.sparkConfig||{};if(g.showOnMax&&(g.maxValue=Math.max.apply(Math,a.getColumnData(d,l.smartIndexFn))),o.infinite){const e=o.getNumOfVisibleCells();r>e&&(r=e)}for(;n<r;n++){var p,m=a.get(n),f={rowIndex:n,data:m,style:{},column:l};p=l.smartIndexFn?l.smartIndexFn(m):a.get(n,d),f.value=p,l.format&&(f.value=this.format(f.value,l.format),p=f.value),l.render&&(p=(f=l.render(f)).value),h.item(n).css(f.style),e.apply(g,{renderTo:u.item(n).dom,value:p,column:l}),new e.spark.GrossLoss(g)}},renderProgressBar(t,i){var n,r,o=this,a=o.widget,l=a.store,d=o.getColumns()[t],c=d.index,h=o.el.select(`.${s}`).item(t),u=h.select(E),g=h.select(T),p=100;h.addCls(w),void 0!==i?(n=i,r=i+1):(n=0,r=l.getLength());const m=d.sparkConfig||{};if(!1===m.percents&&(p=Math.max.apply(Math,l.getColumnData(c))),a.infinite){const e=a.getNumOfVisibleCells();r>e&&(r=e)}for(;n<r;n++){var f,y=l.get(n),C={rowIndex:n,data:y,style:{},column:d},v=u.item(n);f=d.smartIndexFn?d.smartIndexFn(y):l.get(n,c),C.value=f,d.format&&(C.value=o.format(C.value,d.format),f=C.value),d.render&&(f=(C=d.render(C)).value),v.css(C.style),a.cellStylingCls&&o.clearCls(v),C.cls&&v.addCls(C.cls);const t=e.get(g.item(n).dom);if(t.select("."+b).length){const i=e.getWidget(t.select(`.${b}`).item(0).attr("id"));i.value=f,i.maxValue=p,i.update()}else e.apply(m,{renderTo:g.item(n).dom,value:f,column:d,maxValue:p}),new e.spark.ProgressBar(m)}},renderHBar(t,i){let n,r;var o,a,l=this.widget,d=l.store,c=this.getColumns()[t],h=c.index,u=this.el.select(`.${s}`).item(t),g=u.select(E),p=u.select(T),m=c.sparkConfig||{},f=c.disabled||{};u.addCls(S);var y,C,v={},w=(t=0,Number.MIN_VALUE);if(e.isArray(c.index))for(y=c.index.length;t<y;t++){const e=c.index[t];f[e]||(v[e]=d.getColumnData(e),(r=Math.max.apply(Math,v[e]))>w&&(w=r),C=v[e].length)}else{let e=[];for(y=(n=d.getColumnData(c.index)).length;t<y;t++){let e=0,i=n[t].length;for(;e<i;e++)f[e]||(v[e]=v[e]||[],v[e].push(n[t][e]))}for(var b in v)r=Math.max.apply(Math,v[b]),e.push(b),r>w&&(w=r),C=v[b].length;c.fields||(c.fields=e)}for(var x=[],I=0;I<C;I++)for(var b in x[I]=0,v)c.fields&&f[c.index+"."+b]||f[b]||(x[I]+=v[b][I]);const F=Math.max.apply(Math,x);if(m.maxItemValue=w,void 0!==i?(o=i,a=i+1):(o=0,a=d.getLength()),l.infinite){const e=l.getNumOfVisibleCells();a>e&&(a=e)}for(;o<a;o++){var L,_={rowIndex:o,data:n=d.get(o),style:{},column:c};L=c.smartIndexFn?c.smartIndexFn(n):d.get(o,h),_.value=L,c.format&&(_.value=this.format(_.value,c.format),L=_.value),c.render&&(L=(_=c.render(_)).value),g.item(o).css(_.style);const t=e.get(p.item(o).dom);if(t.select(".fancy-spark-hbar").length){const i=e.getWidget(t.select(".fancy-spark-hbar").item(0).attr("id"));i.maxValue=F,i.maxItemValue=w,i.update(n)}else e.apply(m,{renderTo:p.item(o).dom,value:L,data:n,column:c,maxValue:F,height:l.cellHeight-1}),new e.spark.HBar(m)}},renderCircle(e,t){var i,n,r=this.widget,o=r.store,a=this.getColumns()[e],l=a.index,d=this.el.select(`.${s}`).item(e),c=d.select(T),h=r.cellHeight-4;function u(e,t){const i="http://www.w3.org/2000/svg",n=document.createElementNS(i,"svg:svg");n.setAttribute("width",t),n.setAttribute("height",t),n.setAttribute("viewBox","0 0 "+t+" "+t);const s=document.createElementNS(i,"circle");s.setAttributeNS(null,"cx",t/2),s.setAttributeNS(null,"cy",t/2),s.setAttributeNS(null,"r",t/2);let r="#F0F0F0";t>50&&(r="F0F0F0"),e<0&&(r="#F9DDE0"),s.setAttributeNS(null,"fill",r),n.appendChild(s);var o=document.createElementNS(i,"path"),a=e*(2*Math.PI/100)-.001,l=t/2+t/2*Math.sin(0),d=t/2-t/2*Math.cos(0),c=t/2+t/2*Math.sin(a),h=t/2-t/2*Math.cos(a),u=0;a-0>Math.PI&&(u=1);var g="M "+t/2+","+t/2+" L "+l+","+d+" A "+t/2+","+t/2+" 0 "+u+" 1 "+c+","+h+" Z";o.setAttribute("d",g),e<0?o.setAttribute("fill","#EA7369"):o.setAttribute("fill","#44A4D3"),n.appendChild(o);const p=document.createElementNS(i,"circle");return p.setAttributeNS(null,"cx",t/2),p.setAttributeNS(null,"cy",t/2),p.setAttributeNS(null,"r",.25*t),p.setAttributeNS(null,"fill","#fff"),n.appendChild(p),n}if(d.addCls(y),void 0!==t?(i=t,n=t+1):(i=0,n=o.getLength()),r.infinite){const e=r.getNumOfVisibleCells();n>e&&(n=e)}for(;i<n;i++){var g,p=o.get(i),m={rowIndex:i,data:p,style:{}};g=a.smartIndexFn?a.smartIndexFn(p):o.get(i,l),m.value=g,a.render&&(g=(m=a.render(m)).value);const e=c.item(i).dom;""===e.innerHTML&&e.appendChild(u(g,h))}},removeNotUsedCells(){for(var e=this.widget.store,t=this.el.select("."+s),i=0,n=t.length;i<n;i++)for(var r=t.item(i).select(E),o=e.getLength(),a=r.length;o<a;o++)r.item(o).remove()},getFormat(t){const i=this.widget.lang;switch(t){case"number":return function(e,t){if(void 0===e)return"";const n=e.toString().split(i.decimalSeparator);if(t=t||0,n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,i.thousandSeparator),n[1]){if(t>0){if(n[1].length<t){for(var s="",r=n[1].length;r<t;r++)s+="0";return n[0]+i.decimalSeparator+n[1]+s}return n[1]=String(n[1]).substring(0,t),n[0]+i.decimalSeparator+n[1]}return n[0]}if(t>0&&""!==n[0]){for(s="",r=0;r<t;r++)s+="0";return n[0]+i.decimalSeparator+s}return n[0]};case"date":return function(n){const s=e.Date.parse(n,i.date.read,t.mode);return n=e.Date.format(s,i.date.write,t.mode)}}switch(t.type){case"date":return function(i){let n;return i&&0!==i.length?(n=e.isDate(i)?i:e.Date.parse(i,t.read,t.mode),i=e.Date.format(n,t.write,void 0,t.mode)):""}}},format(t,i,n){switch(e.typeOf(i)){case"string":t=this.getFormat(i)(t,n);break;case"function":t=i(t);break;case"object":const s=this.getFormat(i);s&&(t=s(t))}return t},enableCellDirty(e){e.hasCls(h)||(e.addCls(h),e.append('<div class="'+u+'"></div>'))},clearDirty(e){const i=this;if(void 0!==e)return i.el.select("."+t+'[index="'+e+'"] .'+u).destroy(),void i.el.select("."+h+'[index="'+e+'"]').removeCls(h);i.el.select(`.${u}`).destroy(),i.el.select(`.${h}`).removeCls(h)},showEmptyText:function(){const t=this,i=t.widget,n=i.store;if("center"===t.side&&(t.emptyTextEl&&(t.emptyTextEl.destroy(),delete t.emptyTextEl),0===n.dataView.length)){const n=e.newEl("div");n.addCls(p),n.update(i.emptyText),t.emptyTextEl=e.get(t.el.dom.appendChild(n.dom))}}}}(),function(){const e=Fancy,t=e.GRID_CELL_CLS,i=e.GRID_CELL_INNER_CLS,n=e.GRID_COLUMN_CLS,s=e.GRID_BODY_CLS,r=e.GRID_CELL_WRAPPER_CLS,o=e.GRID_COLUMN_SELECT_CLS,a=e.GRID_COLUMN_ELLIPSIS_CLS,l=e.GRID_COLUMN_ORDER_CLS,d=e.GRID_COLUMN_TEXT_CLS,c=e.GRID_COLUMN_TREE_CLS,h=e.GRID_COLUMN_SPARKLINE_CLS,u=e.GRID_COLUMN_CHART_CIRCLE_CLS,g=e.GRID_COLUMN_SPARK_PROGRESS_DONUT_CLS,p=e.GRID_COLUMN_GROSSLOSS_CLS,m=e.GRID_COLUMN_PROGRESS_CLS,f=e.GRID_COLUMN_H_BAR_CLS,y=e.GRID_COLUMN_ROW_DRAG_CLS,C=e.GRID_ROW_EXPAND_CLS,v=e.ANIMATE_DURATION,w={sparklineline:h,sparklinebar:h,sparklinetristate:h,sparklinediscrete:h,sparklinebullet:h,sparklinepie:h,sparklinebox:h,circle:u,progressdonut:g,grossloss:p,progressbar:m,hbar:f};e.define("Fancy.grid.Body",{extend:e.Widget,mixins:[e.grid.body.mixin.Updater],cls:s,cellTpl:['<div class="'+i+'">{cellValue}</div>'],cellWrapperTpl:['<div class="'+r+'">','<div class="'+i+'">{cellValue}</div>',"</div>"],constructor:function(){this.Super("const",arguments)},init(){const e=this;e.Super("init",arguments),e.addEvents("adddomcolumns"),e.initTpl(),e.render(),e.ons()},initTpl(){this.cellTpl=new e.Template(this.cellTpl),this.cellWrapperTpl=new e.Template(this.cellWrapperTpl)},ons(){const i=this,s=i.widget,r=s.id;s.on("afterrender",i.onAfterRender,i);const o=`.${n}[grid="${r}"]`,a=`${o} div.${t}`;i.el.on("click",i.onCellClick,i,a),Fancy.isTouch||i.el.on("dblclick",i.onCellDblClick,i,a),i.el.on("mouseenter",i.onCellMouseEnter,i,a),i.el.on("mouseleave",i.onCellMouseLeave,i,a),e.isTouch?i.el.on("touchend",i.onCellMouseDown,i,a):i.el.on("mousedown",i.onCellMouseDown,i,a),i.el.on("mouseenter",i.onColumnMouseEnter,i,o),i.el.on("mouseleave",i.onColumnMouseLeave,i,o),e.isTouch?i.initTouchContextMenu(a):i.el.on("contextmenu",i.onContextMenu,i,a),i.el.on("mouseleave",i.onBodyLeave,i)},render(){let t,i=this.widget,n=e.newEl("div");n.addCls(s),n.attr("role","presentation"),t=i.el.select(`.fancy-grid-${this.side}`).dom,this.el=e.get(t.appendChild(n.dom))},onAfterRender(){const e=this,t=e.widget,i=t.store;("left"!==e.side||t.leftColumns.length)&&("right"!==e.side||t.rightColumns.length)&&(!t.grouping||t.grouping&&!t.grouping.by?t.state&&t.state.startState&&(t.state.startState.sorters||t.state.startState.filters||void 0!==t.state.startState.page)?e.update("waitstate"):e.update():t.grouping&&"server"===i.proxyType&&e.update(),e.setHeight())},setColumnsPosition(t,i){var s=this.widget,r=this.getColumns(),o=0,a=r.length,l=0,d=this.el.select(`.${n}[grid="${s.id}"]`);for(l+=t=t||this.scrollLeft||0;o<a;o++){const t=r[o],n=d.item(o);i&&!e.nojQuery?n.animate({left:l+"px"},e.ANIMATE_DURATION):n.css({left:l+"px"}),t.hidden||(l+=t.width)}},wheelScroll(e){const t=this.widget,i=(t.store,t.knobOffSet),s=this.el.select(`.${n}[grid="${t.id}"]`);if(0!==s.length){var r=parseInt(s.item(0).css("top")),o=0,a=s.length,l=t.getBodyHeight(),d=t.getCellsViewHeight()-l+i,c={oldScroll:parseInt(s.item(0).css("top")),newScroll:parseInt(s.item(0).css("top"))+30*e,deltaScroll:30*e};for(d<0&&(d=0);o<a;o++){let t=s.item(o),n=parseInt(t.css("top"))+30*e;n>0?(n=0,c.newScroll=0):Math.abs(n)>d&&(n=-d-i,c.newScroll=n),n>0&&(n=0),t.css("top",n+"px")}return c.scrolled=r!==parseInt(s.item(0).css("top")),c}},scroll(e,t,i){var s=this,r=s.widget,o=r.scroller,a=r.store,l=s.el.select(`.${n}[grid="${r.id}"]`),d=0,c=l.length,h={};if(!1!==e&&null!==e&&void 0!==e)if(h.scrollTop=e,r.infinite){if(o.scrollTop!==e){const t=Math.round(e/r.cellHeight);if(a.infiniteScrolledToRow!==t){if(a.infiniteScrolledToRow=t,s.infiniteTimeOut){new Date-s.infiniteTimeOutDate<100&&clearInterval(s.infiniteTimeOut)}else s.infiniteTimeOutDate=new Date;s.infiniteTimeOut=setTimeout(function(){r.leftBody.update(),r.body.update(),r.rightBody.update(),clearInterval(s.infiniteTimeOut),delete s.infiniteTimeOut,delete s.infiniteTimeOutDate},1)}}}else for(;d<c;d++){l.item(d).css("top",-e+"px")}return!1!==t&&null!==t&&void 0!==t&&(h.scrollLeft=t,r.header&&r.header.scroll(t,i),s.scrollLeft=t,r.body.setColumnsPosition(t,i),"center"===s.side&&(r.grouping&&r.grouping.by&&r.grouping.scrollLeft(t),r.summary&&r.summary.scrollLeft(t),r.subHeaderFilter&&r.filter.scrollLeft(t))),h},setHeight(){const e=this.widget.getBodyHeight();this.css("height",`${e}px`)},onCellClick(t){const i=this,n=i.widget;if(e.isTouch)if(i.waitForDblClickInt){if(new Date-i.waitForDblClickDate<500)return n.fire("celldblclick",i.getEventParams(t)),n.fire("rowdblclick",i.getEventParams(t)),void n.fire("columndblclick",i.getColumnEventParams(t));delete i.waitForDblClickInt,delete i.waitForDblClickDate}else i.waitForDblClickDate=new Date,i.waitForDblClickInt=setTimeout(function(){delete i.waitForDblClickInt,delete i.waitForDblClickDate},500);n.fire("cellclick",i.getEventParams(t)),n.fire("rowclick",i.getEventParams(t)),n.fire("columnclick",i.getColumnEventParams(t)),!1===n.activated&&(n.activated=!0,n.fire("activate"))},onCellDblClick(e){const t=this.widget;t.fire("celldblclick",this.getEventParams(e)),t.fire("rowdblclick",this.getEventParams(e)),t.fire("columndblclick",this.getColumnEventParams(e))},getEventParams(t){const i=this.widget.store,n=this.getColumns(),s=t.currentTarget,r=e.get(t.currentTarget),o=r.parent();if(void 0===r.parent().dom)return!1;if(0===i.getLength())return!1;if(void 0===o.attr("index"))return!1;const a=i.infiniteScrolledToRow||0;let l=parseInt(o.attr("index")),d=parseInt(r.attr("index")),c=n[l],h=c.index,u=i.get(d+a,h),g=i.getId(d+a),p=i.get(d+a),m=i.getById(g);return c.smartIndexFn&&(u=c.smartIndexFn(p)),{e:t,id:g,side:this.side,cell:s,column:c,rowIndex:d,infiniteRowIndex:d+a,columnIndex:l,value:u,data:p,item:m}},getColumnEventParams(t){const i=this.widget,n=i.store,s=e.get(t.currentTarget),r=s.parent(),o=parseInt(r.attr("index")),a=this.getColumns()[o],l={e:t,side:this.side,columnIndex:o,column:a,columnDom:r.dom,cell:s.dom};return i.columnClickData&&(l.data=n.getColumnData(a.index,a.smartIndexFn)),l},getColumnHoverEventParams(i){let n=e.get(i.currentTarget),s=parseInt(n.attr("index")),r=this.getColumns()[s],o=i.target;return e.get(o).hasCls(t)||(o=e.get(o).parent("."+t).dom),{e:i,side:this.side,columnIndex:s,column:r,columnDom:n.dom,cell:o}},getColumns(){return this.widget.getColumns(this.side)},onCellMouseEnter(t){const i=this,n=i.widget,s=i.getEventParams(t),r=i.prevCellOver;e.nojQuery&&r&&i.fixZeptoBug&&(s.rowIndex===r.rowIndex&&s.columnIndex===r.columnIndex&&s.side===r.side||(n.fire("cellleave",r),s.rowIndex!==r.rowIndex&&n.fire("rowleave",r))),r?s.rowIndex!==i.prevCellOver.rowIndex&&n.fire("rowenter",s):n.fire("rowenter",s),n.fire("cellenter",s),i.prevCellOver=s},onCellMouseDown(t){const i=this.widget,n=this.getEventParams(t),s={e:n.e,side:n.side,columnDom:e.get(n.cell).parent().dom,column:n.column,columnIndex:n.columnIndex,cell:n.cell};2===t.button&&2===t.buttons||3===t.which||(i.fire("beforecellmousedown",n),i.fire("cellmousedown",n),i.fire("columnmousedown",s),!1===i.activated&&(i.activated=!0,i.fire("activate")))},onCellMouseLeave(t){const i=this,n=i.widget,s=i.getEventParams(t),r=i.prevCellOver;if(e.nojQuery){if(s.rowIndex+1===n.getDataView().length){const e=s.cell.getBoundingClientRect();if(t.clientY>e.top+e.height-2)return n.fire("rowleave",r),n.fire("cellleave",r),void delete i.prevCellOver}if(void 0===r)return;i.fixZeptoBug=s}else n.fire("rowleave",r),n.fire("cellleave",r),delete i.prevCellOver},onColumnMouseEnter(e){const t=this,i=t.widget,n=t.getColumnHoverEventParams(e);t.prevColumnOver?t.prevCellOver&&n.rowIndex!==t.prevCellOver.rowIndex&&i.fire("rowenter",n):i.fire("columnenter",n),t.prevColumnOver=n},onColumnMouseLeave(){this.widget.fire("columnleave",this.prevColumnOver),delete this.prevColumnOver},getCell(e,i){const s=this.widget;return this.el.select("."+n+'[index="'+i+'"][grid="'+s.id+'"] .'+t+'[index="'+e+'"]')},getDomCell(e,i){const s=this.widget;return this.el.select("."+n+'[index="'+i+'"][grid="'+s.id+'"] .'+t+'[index="'+e+'"]').dom},getDomColumn(e){const t=this.widget;return this.el.select("."+n+'[index="'+e+'"][grid="'+t.id+'"]').dom},destroy(){const i=this,s=i.el,r="div."+t,o="div."+n;s.un("click",i.onCellClick,i,r),Fancy.isTouch||s.un("dblclick",i.onCellDblClick,i,r),s.un("mouseenter",i.onCellMouseEnter,i,r),s.un("mouseleave",i.onCellMouseLeave,i,r),e.isTouch?s.un("touchend",i.onCellMouseDown,i,r):s.un("mousedown",i.onCellMouseDown,i,r),s.un("mouseenter",i.onColumnMouseEnter,i,o),s.un("mouseleave",i.onColumnMouseLeave,i,o)},hideColumn(e){var t=this.widget,i=this.getColumns(),s=this.el.select("."+n),r=s.item(e),o=0,a=i.length,l=0;for("center"===this.side&&(l-=t.scroller.scrollLeft),r.hide();o<a;o++){r=s.item(o);var d=i[o],c=parseInt(r.css("left"));d.hidden||(c!==l&&(r.stop(),r.animate({left:l},v)),l+=d.width)}},showColumn(t,i){var s=this.widget,r=this.getColumns(),o=this.el.select("."+n),a=o.item(t),l=0,d=0,c=r.length;for("center"===this.side&&(l-=s.scroller.scrollLeft),e.isNumber(i)&&a.css("width",i+"px"),a.show();d<c;d++){a=o.item(d);parseInt(a.css("left"));const e=r[d];e.hidden||(a.stop(),a.animate({left:l},v),l+=e.width)}},removeColumn(e){var t=this.el.select("."+n),i=t.item(e),s=parseInt(i.css("width")),r=e+1,o=t.length;for(i.destroy();r<o;r++){const e=t.item(r),i=parseInt(e.css("left"))-s;e.attr("index",r-1),e.css("left",i)}},insertColumn(t,i){var s,r=this,h=r.widget,u=r.getColumns(),g=r.el.select("."+n),p=i.width,m=e.newEl("div"),f=t,C=g.length,v=0,w=0,b=t;for("center"===r.side&&(v=-h.scroller.scrollLeft);w<b;w++)u[w].hidden||(v+=u[w].width);for(s=v;f<C;f++){if(u[f].hidden)continue;const e=g.item(f);v=parseInt(e.css("left"))+i.width,e.css("left",v),e.attr("index",f+1)}if(m.attr("role","presentation"),m.addCls(n),m.attr("grid",h.id),"$selected"===i.index||i.select)m.addCls(o);else switch(i.type){case"order":m.addCls(l);break;case"rowdrag":m.addCls(y)}if(i.cls&&m.addCls(i.cls),"tree"===i.type&&(m.addCls(c),i.folder&&m.addCls("fancy-grid-tree-column-folder")),"text"===i.type&&m.addCls(d),m.css({width:p+"px"}),m.attr("index",t),i.cellAlign&&m.css("text-align",i.cellAlign),!0===i.ellipsis)switch(i.type){case"string":case"text":case"number":case"date":case"combo":case"tree":m.addCls(a)}const S=h.scroller.getScroll();m.css("top",-S),0===t&&g.length?(m.css("left","0px"),r.el.dom.insertBefore(m.dom,g.item(t).dom)):0!==t&&g.length?t===g.length?(m.css("left",v+"px"),r.el.dom.appendChild(m.dom)):(m.css("left",s+"px"),r.el.dom.insertBefore(m.dom,g.item(t).dom)):(m.css("left",v+"px"),r.el.dom.appendChild(m.dom)),r.checkDomCells(),r.updateRows(void 0,t)},reSetIndexes(){this.el.select(`.${n}`).each((e,t)=>{e.attr("index",t)})},clearColumnsStyles(){this.el.select(`div.${t}`).each(e=>{e.css("color",""),e.css("background-color","")})},updateColumnsSizes(){let t=this,i=t.widget,s=t.getColumns(),r=0;"center"===t.side&&(r=-i.scroller.scrollLeft),e.each(s,(e,i)=>{if(e.hidden)return;const s=t.el.select(`.${n}[index="${i}"]`);Fancy.nojQuery?s.css({width:e.width,left:r}):(s.$dom.stop(),s.animate({width:e.width,left:r},v,void 0,()=>{s.css("overflow","")})),r+=e.width})},reSetColumnsAlign(){const e=this.getColumns();this.el.select(`.${n}`).each(function(t,i){const n=e[i];t.css("text-align",n.cellAlign||"")})},reSetColumnsCls(){const t=this.getColumns();this.el.select(`.${n}`).each((i,s)=>{const r=t[s],d=i.attr("class").split(" ");if(e.each(d,e=>{switch(e){case n:case r.cls:case w[r.type]:break;default:i.removeCls(e)}}),r.cls&&i.addCls(r.cls),r.ellipsis)switch(r.type){case"checkbox":break;default:i.addCls(a)}switch(r.type){case"order":i.addCls(l);break;case"select":i.addCls(o);break;case"rowdrag":i.addCls(y);break;case"tree":i.addCls(c),r.folder&&i.addCls("fancy-grid-tree-column-folder")}r.select&&i.addCls(o),r.rowdrag&&i.addCls(y)})},initTouchContextMenu(e){this.el.on("touchstart",this.onTouchStart,this,e)},onTouchStart(e){const t=this;t.touchEvent=e,t.intTouchStart=setTimeout(()=>{t.touchLongPress=!0},1e3),t.el.once("touchend",t.onTouchEnd,t),t.el.once("touchmove",t.onTouchMove,t)},onTouchEnd(){const e=this,t=e.widget;e.touchLongPress&&t.fire("contextmenu",e.getEventParams(e.touchEvent)),clearInterval(e.intTouchStart),e.el.un("touchmove",e.onTouchMove),delete e.touchLongPress},onTouchMove(){clearInterval(this.intTouchStart),delete this.touchLongPress,this.un("touchend",this.onTouchEnd)},onContextMenu(e){this.widget.fire("contextmenu",this.getEventParams(e))},updateColumnsVisibility(){const e=this.getColumns();this.el.parent().select(`:not(.${C}) .${n}`).each((t,i)=>{e[i].hidden?t.hide():"none"===t.css("display")&&t.show()})},onBodyLeave(){delete this.prevCellOver}})}(),function(){const e=Fancy,t=e.GRID_HEADER_COLUMN_TRIGGERED_CLS,i=e.GRID_HEADER_CELL_TRIGGER_UP_CLS,n=e.GRID_HEADER_CELL_TRIGGER_DOWN_CLS;e.Mixin("Fancy.grid.header.mixin.Menu",{triggeredColumnCls:t,triggerUpCls:i,triggerDownCls:n,showMenu(i,n,s,r){const o=this,a=o.widget,l=i.offset();s.menu&&s.menu.rendered&&"block"===s.menu.el.css("display")?o.hideMenu():(o.hideMenu(),i.addCls(t),s.menu.rendered?!1!==s.menuColumns&&o.updateColumnsMenu(s,r):(s._menu=s.menu,s.menu=o.generateMenu(s,r),s.menu=new e.Menu({column:s,items:s.menu,theme:a.theme,events:[{hide:o.onMenuHide,scope:o}]})),s.menu.showAt(l.left+parseInt(i.css("width"))-26,l.top+parseInt(i.css("height"))-1),o.activeMenu=s.menu,o.activeCell=i)},hideMenu(){const e=this,i=e.widget,n=i.header,s=i.rightHeader,r=i.leftHeader;switch(e.side){case"left":n.activeMenu&&(n.activeMenu.hide(),n.activeCell.removeCls(t),delete n.activeMenu,delete n.activeCell),s.activeMenu&&(s.activeMenu.hide(),s.activeCell.removeCls(t),delete s.activeMenu,delete s.activeCell);break;case"center":r.activeMenu&&(r.activeMenu.hide(),r.activeCell.removeCls(t),delete r.activeMenu,delete r.activeCell),s.activeMenu&&(s.activeMenu.hide(),s.activeCell.removeCls(t),delete s.activeMenu,delete s.activeCell);break;case"right":r.activeMenu&&(r.activeMenu.hide(),r.activeCell.removeCls(t),delete r.activeMenu,delete r.activeCell),n.activeMenu&&(n.activeMenu.hide(),n.activeCell.removeCls(t),delete n.activeMenu,delete n.activeCell)}e.activeMenu&&(e.activeMenu.hide(),e.activeCell.removeCls(t)),delete e.activeMenu,delete e.activeCell},generateMenu(t,s){for(var r,o=this,a=o.widget,l=a.lang,d=[],c=!1===t.sortable?"fancy-menu-item-disabled":"",h=t.sortable&&!1!==t.menuSortable,u=!1!==t.lockable&&!1!==t.menuLockable,g=!1!==t.menuColumns,p=0,m=s.length,f={text:l.sortAsc,cls:c,imageCls:i,handler(){a.sorter.sort("asc",t.index,o.side),t.menu.hide()}},y={text:l.sortDesc,cls:c,imageCls:n,handler(){a.sorter.sort("desc",t.index,o.side),t.menu.hide()}},C={text:l.columns,index:"columns",items:o.prepareColumns(s)},v={text:l.autoSizeColumn,cls:c,handler(){a.autoSizeColumn(t.index,o.side,t),t.menu.hide()}},w={text:l.autoSizeColumns,cls:c,handler(){a.autoSizeColumns(),t.menu.hide()}};p<m;p++)if(t.index===s[p].index){r=p;break}if("columns"===t.menu)return d=C.items;if("size"===t.menu)return d.push(v),d.push(w),d;if(Fancy.isArray(t.menu))e.each(t.menu,function(e){switch(e){case"|":d.push("-");break;case"sort":d.push(f),d.push(y);break;case"columns":d.push(C);break;case"size":d.push(v),d.push(w);break;case"lock":switch(o.side){case"left":case"right":d.push({text:l.unlock,handler(){t.menu.hide(),a.unLockColumn(r,o.side)}});break;case"center":d.push({text:l.lock,handler(){t.menu.hide(),a.lockColumn(r,o.side)}}),d.push({text:l.rightLock,handler(){t.menu.hide(),a.rightLockColumn(r,o.side)}})}break;default:d.push(e)}});else if(h&&(d.push(f),d.push(y),d.push("-")),g&&d.push(C),u)switch(o.side){case"left":case"right":!1!==t.menuColumns&&d.push("-"),d.push({text:l.unlock,handler(){t.menu.hide(),a.unLockColumn(r,o.side)}});break;case"center":!1!==t.menuColumns&&d.push("-"),d.push({text:l.lock,handler(){t.menu.hide(),a.lockColumn(r,o.side)}}),d.push({text:l.rightLock,handler(){t.menu.hide(),a.rightLockColumn(r,o.side)}})}return d},prepareColumns(t){var i,n=this,s=n.widget,r=[],o=[];return e.each(t,e=>{let t=!0;if(!1===e.columnMenu)return;e.hidden&&(t=!1);const a={text:e.title,checked:t,index:e.index,column:e,handler(t,i){!0!==i.checked||i.checkbox.get()||i.checkbox.set(!0),i.checked&&1===t.el.select(".fancy-checkbox-on").length?i.checkbox.set(!0):(i.checked=!i.checked,i.checkbox.set(i.checked),i.checked?s.showColumn(n.side,i.index,e):s.hideColumn(n.side,i.index,e),s.responsive&&s.onWindowResize())}};if(e.grouping)return(o=o||[]).push(a),void(i=e.grouping);o.length&&(r.push({text:i,items:o}),i=void 0,o=[]),r.push(a)}),o.length&&r.push({text:i,items:o}),r},onMenuHide(){this.el.select(`.${t}`).removeCls(t)},updateColumnsMenu(e,t,i){for(var n,s,r=e.menu,o=0,a=r.items.length;o<a;o++)if("columns"===(s=r.items[o]).index){n=s;break}if(!n)return;o=0,a=n.items.length;let l=!1;for(;o<a;o++){s=n.items[o];const e=t[o];s.checkbox&&(s.checkbox.set(!e.hidden,!1),l=!0)}l||i||(n.items=this.prepareColumns(t))},destroyMenus(){for(var t,i=this.widget.getColumns(this.side),n=0,s=i.length;n<s;n++)t=i[n],e.isObject(t.menu)&&t.menu.destroy()}})}(),function(){const e=Fancy,t=e.GRID_HEADER_CLS,i=e.GRID_HEADER_CELL_CLS,n=e.GRID_HEADER_CELL_CONTAINER_CLS,s=e.GRID_HEADER_CELL_TEXT_CLS,r=e.GRID_HEADER_CELL_LEFT_IMAGE_CLS,o=e.GRID_HEADER_CELL_CONTAINS_LI,a=e.GRID_HEADER_CELL_TRIGGER_CLS,l=e.GRID_HEADER_CELL_TRIGGER_IMAGE_CLS,d=e.GRID_HEADER_CELL_TRIGGER_DISABLED_CLS,c=e.GRID_HEADER_CELL_GROUP_LEVEL_1_CLS,h=e.GRID_HEADER_CELL_GROUP_LEVEL_2_CLS,u=e.GRID_HEADER_CELL_SELECT_CLS,g=e.GRID_HEADER_CELL_FILTER_FULL_CLS,p=e.GRID_HEADER_CELL_FILTER_SMALL_CLS,m=e.GRID_HEADER_CELL_TRIPLE_CLS,f=e.GRID_HEADER_CELL_CHECKBOX_CLS,y=e.GRID_HEADER_CELL_SORTABLE_CLS,C=e.GRID_HEADER_CELL_NOT_SORTABLE_CLS,v=e.FIELD_CHECKBOX_CLS,w=e.ANIMATE_DURATION;e.define("Fancy.grid.Header",{extend:e.Widget,cls:t,mixins:["Fancy.grid.header.mixin.Menu"],cellTpl:['<div role="columnheader" col-id="{id}" class="'+i+' {cls}" style="display:{display};width:{columnWidth}px;height: {height};left: {left};" {groupIndex} index="{index}">','<div class="'+n+'" style="height: {height};">','<span class="'+r+' {headerLImageCls}">&nbsp;</span>','<span class="'+s+'">{columnName}</span>','<span class="'+a+'">','<div class="'+l+'"></div>',"</span>","</div>","</div>"],constructor:function(){this.Super("const",arguments)},init(){const e=this;e.Super("init",arguments),e.initTpl(),e.render(),e.renderHeaderCheckBox(),e.setAlign(),e.setCellsPosition(),e.ons()},initTpl(){this.cellTpl=new e.Template(this.cellTpl)},ons(){const e=this,t=e.widget,n=e.el,r=`div.${i}`;t.on("render",e.onAfterRender,e),t.on("docmove",e.onDocMove,e),t.on("columndrag",e.onColumnDrag,e),n.on("click",e.onTriggerClick,e,`span.${a}`),n.on("click",e.onCellClick,e,r),n.on("mousemove",e.onCellMouseMove,e,r),n.on("mousedown",e.onCellMouseDown,e,r),n.on("mousedown",e.onMouseDown,e),n.on("dblclick",e.onCellTextDBLClick,e,`.${s}`),n.on("mouseenter",e.onCellMouseEnter,e,r),n.on("mouseleave",e.onCellMouseLeave,e,r)},render(){var t,i=this,n=i.widget,s=i.getColumns(),r=e.newEl("div"),a="",l=0,h=s.length,m=1,f={},v=0,w=n.filter&&n.filter.header&&!n.subHeaderFilter,b="full",S=n.cellHeaderHeight;for(n.groupheader&&(w&&!n.filter.groupHeader?b="small":m=2),w&&m++;l<h;l++){var x=s[l],I=x.title||x.header,E=S,T="",F="";if(void 0!==I&&""!==I&&" "!==I||(I="&nbsp;"),1!==m)if(x.grouping){if(!f[x.grouping]){const e=n.groupheader.groupsMap[x.grouping];f[x.grouping]={width:0,title:x.grouping,left:v,cls:e.headerCls||""}}E=w&&n.filter.groupHeader?2*S+"px":S+"px",x.hidden||(f[x.grouping].width+=x.width),F='group-index="{column.grouping}"',T=c}else E=m*S+"px";if(v+=x.width,("$selected"===x.index||x.select)&&(T+=" "+u),x.menu||(T+=" "+d),x.filter&&x.filter.header)switch(b){case"small":T+=" "+p;break;case"full":n.subHeaderFilter||(T+=" "+g)}x.headerLImageCls&&(T+=" "+o),x.headerCls&&(T+=" "+x.headerCls),x.sortable?T+=" "+y:T+=" "+C,e.isNumber(E)&&(E+="px");const t={cls:T,columnName:I,columnWidth:x.width,index:l,height:E,left:"initial",groupIndex:F,display:x.hidden?"none":"",id:x.id||"",headerLImageCls:x.headerLImageCls||""};a+=i.cellTpl.getHTML(t)}r.css({height:S*m+"px",width:i.getColumnsWidth()}),r.attr("role","presentation"),r.addCls(i.cls),n.groupheader&&(r.addCls("fancy-grid-header-grouped"),a+=i.getGroupingCellsHTML(f)),r.update(a),t=n.el.select(".fancy-grid-"+i.side).dom,i.el=e.get(t.appendChild(r.dom))},insertCell(t,i){var n,s=this,r=s.widget,o=s.getCells(),a=s.getColumns(),l="",c=i.title||i.header,g=0;if(o.length&&(n=parseInt(o.item(0).css("height"))),n=parseInt(r.header.el.css("height")),"center"===s.side&&(g=-r.scroller.scrollLeft),r.groupheader){const e=s.el.select(`.${h}`);t!==r.columns.length-1&&e.each(e=>{const t=parseInt(e.css("left")||0)+i.width;e.css("left",t)})}("$selected"===i.index||i.select)&&(l+=" "+u),i.menu||(l+=" "+d);for(var p=0,m=t;p<m;p++)a[p].hidden||(g+=a[p].width);"center"===s.side&&(g+=r.scroller.scrollLeft||0),i.headerCls&&(l+=" "+i.headerCls),i.sortable?l+=" "+y:l+=" "+C;var f=s.cellTpl.getHTML({cls:l,columnName:c,columnWidth:i.width,index:t,height:String(n)+"px",left:String(g)+"px",groupIndex:"",id:i.id||""});0===t&&o.length?e.get(o.item(0).before(f)):0!==t&&o.length?t===o.length?s.el.append(f):e.get(o.item(t).before(f)):s.el.append(f);var v=0,w=a.length,b=0;for(g=0,"center"===s.side&&(g-=r.scroller.scrollLeft),o=s.getCells();v<w;v++){if((i=a[v]).hidden)continue;o.item(v).css("left",g),g+=i.width,b+=i.width}const S=parseInt(s.css("width"));S>b&&(b=S),s.css("width",b),r.subHeaderFilter&&r.filter.addSubHeaderFilterCellContainer(s.side),s.reSetColumnsAlign(),s.reSetIndexes(),r.subHeaderFilter&&r.filter.updateSubHeaderFilterSizes()},setAlign(){for(var e=this.getColumns(),t=0,i=e.length;t<i;t++){const i=e[t];i.align&&this.getDomCell(t).css("text-align",i.align)}},onAfterRender(){},setCellsPosition(t){var i=this,n=i.widget,s=i.getColumns(),r=0,o=i.getCells();if(r+=i.scrollLeft||0,e.each(s,(e,t)=>{let i=o.item(t),s="0px";e.grouping&&(s=n.cellHeaderHeight+"px"),i.css({top:s,left:r+"px"}),e.hidden||(r+=e.width)}),n.groupheader){i.el.select(`.${h}`).each(function(n){const r=n.attr("index");i.el.select('[group-index="'+r+'"]');var o=i.scrollLeft||0,a=0;e.each(s,e=>{if(e.grouping===r)return!0;e.hidden||(o+=e.width)}),e.each(s,e=>{e.grouping!==r||e.hidden||(a+=e.width)}),t&&!e.nojQuery?(n.css({left:o,width:a}),0===a&&n.css({display:"none"})):n.css({left:o,width:a})})}},fixGroupHeaderSizing(){var t=this,i=t.widget,s=i.cellHeaderHeight,r=t.getColumns(),o=t.getCells(),a=0,l={},d={},u={},m=t.calcRows(),f=i.filter&&i.filter.header&&!i.subHeaderFilter,y=!1;"center"===t.side&&(a=i.scroller.scrollLeft),f&&e.each(r,e=>{e.grouping&&e.filter&&e.filter.header&&(y=!0)}),e.each(r,(e,t)=>{var r=o.item(t),h=e.grouping,C="0px",v=s*m;l[h]=!0,h?(void 0===d[h]?(d[h]=e.width,u[h]=a):d[h]+=e.width,r.addCls(c),C=s+"px",v=s,y&&(v=2*s),e.filter&&e.filter.header&&f&&setTimeout(function(){r.addCls(g)},30)):(r.removeCls(c),e.filter&&e.filter.header&&f&&(setTimeout(function(){r.addCls(p)},30),r.addCls(p))),!i.groupheader||v!==s||h||e.filter||f||(v=2*s),r.css({top:C,height:v}),r.select(`.${n}`).css({height:v}),a+=e.width});for(const e in d){t.el.select(`[index="${e}"]`).css({left:u[e],width:d[e]})}t.el.select(`.${h}`).each(e=>{const t=e.attr("index");l[t]||e.destroy()})},getColumnsWidth(){for(var e=this.getColumns(),t=0,i=0,n=e.length;i<n;i++){t+=e[i].width}return t},getColumns(){let e,t=this,i=t.widget;switch(t.side){case"left":e=i.leftColumns;break;case"center":e=i.columns;break;case"right":e=i.rightColumns}return e},getDomCell(e){return this.getCells().item(e)},onCellClick(t){const i=this,n=i.widget,s=n.columndrag,r=t.currentTarget,o=e.get(t.target),d=parseInt(e.get(r).attr("index")),c=i.getColumns()[d];s&&"dragging"===s.status||o.hasCls(a)||o.hasCls(l)||e.get(r).hasCls(h)||i.textDBLClick||(c.titleEditable?setTimeout(()=>{i.textDBLClick?setTimeout(()=>{delete i.textDBLClick},400):n.fire("headercellclick",{e:t,side:i.side,cell:r,index:d,column:c})},300):n.fire("headercellclick",{e:t,side:i.side,cell:r,index:d,column:c}))},onCellMouseMove(t){const i=this.widget,n=t.currentTarget,s=e.get(n).hasCls(h),r=parseInt(e.get(n).attr("index"));s||i.fire("headercellmousemove",{e:t,side:this.side,cell:n,index:r})},onMouseDown(t){"INPUT"===e.get(t.target).prop("tagName")||t.preventDefault()},onCellMouseDown(t){const i=this.widget,n=t.currentTarget,s=parseInt(e.get(n).attr("index"));i.fire("headercellmousedown",{e:t,side:this.side,cell:n,index:s})},scroll(e,t){this.scrollLeft=e,this.setCellsPosition(t)},getGroupingCellsHTML(t){var i=this,n=i.widget,s="";return e.each(t,(e,t)=>{s+=i.cellTpl.getHTML({cls:h+" "+e.cls,columnName:e.title,columnWidth:e.width,index:t,height:n.cellHeaderHeight+"px",left:e.left+"px",groupIndex:"",id:e.id||""})}),s},destroy(){const e=this,t=e.el,n=`div.${i}`;t.un("click",e.onCellClick,e,n),t.un("mousemove",e.onCellMouseMove,e,n),t.un("mousedown",e.onCellMouseDown,e,n),t.un("mousedown",e.onMouseDown,e),t.un("mouseenter",e.onCellMouseEnter,e,n),t.un("mouseleave",e.onCellMouseLeave,e,n)},getCell(e){return this.el.select(`.${i}[index="${e}"]`)},onTriggerClick(t){const i=e.get(t.currentTarget).parent().parent(),n=parseInt(i.attr("index")),s=this.getColumns(),r=s[n];t.stopPropagation(),this.showMenu(i,n,r,s)},hideCell(t){var i=this,n=i.widget,s=i.getCells(),r=s.item(t),o=parseInt(r.css("width")),a=0,l=s.length,d=i.getColumns();if(r.hasCls(c)){const e=r.attr("group-index"),t=i.el.select(`.${h}[index="${e}"]`).item(0),n=parseInt(t.css("width"));t.stop(),n-o==0?t.css({display:"none",width:n-o}):t.animate({width:n-o},w)}r.hide();var u={},g=0,p=0;for("center"===i.side&&(g-=p=n.scroller.scrollLeft);a<l;a++){const e=s.item(a),i=parseInt(e.css("left")),n=d[a];n.hidden||(n.grouping&&d[t].grouping!==n.grouping&&(u[n.grouping]=!0),i!==g&&(e.stop(),e.animate({left:g},w)),g+=n.width)}e.each(u,(t,s)=>{var r=i.el.select("."+h+'[index="'+s+'"]').item(0),o=0;"center"===i.side&&(p=n.scroller.scrollLeft,o-=p),e.each(d,e=>{if(!e.hidden)return e.grouping===s||void(o+=e.width)}),r.stop(),r.animate({left:o},w)})},showCell(t,i){var n,s=this,r=s.widget,o=s.getCells(),a=o.item(t),l=0,d=0,u=o.length,g=s.getColumns();if(e.isNumber(i)&&a.css("width",`${i}px`),a.show(),n=parseInt(a.css("width")),a.hasCls(c)){const e=a.attr("group-index"),t=s.el.select("."+h+'[index="'+e+'"]').item(0),i=parseInt(t.css("width"));t.stop(),"none"===t.css("display")&&t.show(),t.animate({width:i+n},w)}let p=0;"center"===s.side&&(l-=p=r.scroller.scrollLeft);const m={};for(;d<u;d++){const e=o.item(d),i=(parseInt(e.css("left")),g[d]);i.hidden||(i.grouping&&g[t].grouping!==i.grouping&&(m[i.grouping]=!0),e.stop(),e.animate({left:l},w),l+=i.width)}e.each(m,(t,i)=>{var n=s.el.select("."+h+'[index="'+i+'"]').item(0),o=0;"center"===s.side&&(p=r.scroller.scrollLeft,o-=p),e.each(g,e=>{if(!e.hidden)return e.grouping===i||void(o+=e.width)}),n.stop(),n.animate({left:o},w)})},removeCell(e){var t=this,i=t.widget,n=t.getCells(),s=n.item(e),r=parseInt(s.css("width")),o=e+1,a=n.length,l={},d=!1;for(s.attr("group-index")&&(l[d=s.attr("group-index")]=!0),s.destroy();o<a;o++){const e=n.item(o),t=parseInt(e.css("left"))-r;e.attr("group-index")&&(l[e.attr("group-index")]=!0),e.attr("index",o-1),e.css("left",t)}for(const e in l){var c=t.el.select(`[index="${e}"]`),h=parseInt(c.css("width"))-r,u=parseInt(c.css("left"))-r;d&&c?(c.css("width",h),c.attr("index")!==d&&c.css("left",u)):c.css("left",u)}d&&0===t.el.select(`[group-index="${d}"]`).length&&(c=t.el.select(`[index="${d}"]`)).destroy(),"center"!==t.side&&t.css("width",parseInt(t.css("width"))-r),i.subHeaderFilter&&i.filter.removeSubHeaderCell(t.side,e),t.reSetIndexes()},renderHeaderCheckBox(){for(var t=this.widget,i=this.getColumns(),n=0,r=i.length,o=this.getCells();n<r;n++){const r=i[n];if(e.isObject(r.headerCheckBox)){var a=r.headerCheckBox.el,l=a.attr("id");(a=e.get(l)).dom||(r.headerCheckBox=!0)}if(!0===r.headerCheckBox&&"select"!==r.type){var d=o.item(n),c=d.firstChild(),h=d.select(`.${s}`),g=!!r.title&&r.title,p=0;switch(r.type){case"checkbox":case"switcher":d.addCls(f);break;case"select":d.addCls(u)}h.update(""),g.length&&(p=15*g.width),r.headerCheckBox=new e.CheckBox({renderTo:c.dom,renderId:!0,labelWidth:p,value:!1,label:!1,labelAlign:"right",style:{padding:"0px",display:"inline-block"},events:[{change:(e,i)=>{for(var n=0,s=t.getViewTotal();n<s;n++)t.set(n,r.index,i)}}]})}}},reSetIndexes(){const e=this,t=e.widget,n=e.getCells(),s=e.getColumns();if(n.each((e,t)=>{e.attr("index",t);const i=s[t];e.attr("col-id",i.id)}),t.subHeaderFilter){t.filter.getSubHeaderFilterEl(e.side).select(`.${i}`).each((e,t)=>{e.attr("index",t)})}},reSetGroupIndexes(){const e=this.getColumns();this.getCells().each((t,i)=>{const n=e[i].grouping;t.attr("group-index")&&!n?t.removeAttr("group-index"):n&&t.attr("group-index")!==n&&t.attr("group-index",n)})},updateTitles(){const t=this,n=t.getColumns();e.each(n,(e,n)=>{e.headerCheckBox||t.el.select("div."+i+'[index="'+n+'"] .'+s).update(e.title||"")})},updateCellsSizes(){var t=this,n=t.widget,s=t.getColumns(),r=0;"center"===t.side&&(r=n.nativeScroller?-n.body.el.dom.scrollLeft:-n.scroller.scrollLeft),e.each(s,(e,n)=>{if(e.hidden)return;const s=t.el.select(`div.${i}[index="${n}"]`),o=parseInt(s.css("left")),a=parseInt(s.css("width"));o!==r||a!==e.width?(Fancy.nojQuery?s.css({width:e.width,left:r}):s.animate({width:e.width,left:r},w),r+=e.width):r+=e.width})},calcRows(){var e=this.widget,t=e.columns.concat(e.leftColumns).concat(e.rightColumns),i=1;if(Fancy.each(t,t=>{t.grouping&&(i<2&&(i=2),t.filter&&t.filter.header&&!e.subHeaderFilter&&i<3&&(i=3)),t.filter&&t.filter.header&&!e.subHeaderFilter&&i<2&&(i=2)}),e.groupheader&&2===i){e.el.select(`.${m}`).length&&(i=3)}return i},reSetColumnsAlign(){const e=this.getColumns();this.getCells().each((t,i)=>{const n=e[i];t.css("text-align",n.align||"")})},destroyMenus(){},onDocMove(){const e=this,t=e.widget;("none"===t.el.css("display")||t.panel&&t.panel.el&&"none"===t.panel.el.css("display")&&e.hideMenu)&&e.hideMenu()},reSetColumnsCls(){const t=this.getColumns(),i=this.getCells(),n=[];e.each(t,e=>{e.headerCls&&n.push(e.headerCls),e.sortable?n.push(y):n.push(C)}),i.each((i,s)=>{const r=t[s];e.each(n,e=>{i.removeCls(e)}),r.headerCls&&i.addCls(r.headerCls),r.sortable?i.addCls(y):i.addCls(C),r.menu?i.removeCls(d):i.addCls(d)})},updateCellsVisibility(){const e=this.getColumns();this.getCells().each((t,i)=>{e[i].hidden?t.hide():"none"===t.css("display")&&t.show()})},reSetCheckBoxes(){const t=this.getColumns(),i=this.getCells();e.each(t,(t,n)=>{const s=i.item(n),r=s.select(`.${v}`);if(r.length){if("select"===t.type||t.select)return;const i=e.getWidget(r.item(0).attr("id"));switch(s.removeCls(f,u),t.type){case"select":s.addCls(u);break;case"checkbox":s.addCls(f);break;default:t.headerCheckBox||i.destroy()}}}),this.renderHeaderCheckBox()},onCellTextDBLClick(e){const t=this,i=t.widget,n=Fancy.get(e.target).parent().parent(),s=n.attr("index"),r=t.getColumns()[s],o=r.title;r.titleEditable&&(t.textDBLClick=!0,t.activeEditColumnField&&(t.activeEditColumnField.destroy(),delete t.activeEditColumnField),t.activeEditColumnField=new Fancy.StringField({renderTo:t.el.dom,label:!1,theme:i.theme,padding:"0px 0px 0px",width:r.width+1,value:r.title||"",inputHeight:i.cellHeaderHeight+1,events:[{enter(e){e.destroy()}},{esc(e){i.setColumnTitle(r.index,o,t.side),e.destroy(),delete t.activeEditColumnField}},{input(e,n){i.setColumnTitle(r.index,n,t.side),delete t.activeEditColumnField}},{render(e){e.focus(),delete t.activeEditColumnField}}],style:{position:"absolute",top:-1,left:parseInt(n.css("left"))-1}}),i.once("scroll",()=>{t.activeEditColumnField&&(t.activeEditColumnField.destroy(),delete t.activeEditColumnField)}))},onCellMouseEnter(t){const i=this,n=i.widget,s=i.getEventParams(t),r=i.prevCellOver;if(e.nojQuery&&r&&i.fixZeptoBug){if(s.columnIndex===r.columnIndex&&s.side===r.side)return;n.fire("headercellleave",r)}n.fire("headercellenter",s),i.prevCellOver=s},onCellMouseLeave(t){const i=this,n=i.widget,s=i.getEventParams(t),r=i.prevCellOver;if(t.toElement&&i.el.within(t.toElement)||(n.fire("headercellleave",r),delete i.prevCellOver),e.nojQuery){if(void 0===r)return;i.fixZeptoBug=s}else n.fire("headercellleave",r),delete i.prevCellOver},getEventParams(t){const i=this.widget.store,n=this.getColumns(),s=t.currentTarget,r=e.get(t.currentTarget);if(void 0===r.parent().dom)return!1;if(0===i.getLength())return!1;if(void 0===r.attr("index"))return!1;const o=parseInt(r.attr("index")),a=n[o];return{e:t,side:this.side,cell:s,column:a,columnIndex:o}},updateLImages(){const t=this.getCells(),i=this.getColumns();t.each(t=>{const n=t.attr("index"),s=i[n],a=s.headerLImageCls,l=t.select(`.${r}`),d=l.getCls();e.each(d,e=>{e!==r&&(a&&e===s.headerLImageCls||l.removeCls(e))}),a?(l.addCls(a),t.addCls(o)):t.removeCls(o)})},getCells(){return this.el.select(`.${i}:not(.${h})`)},onColumnDrag(){this.reSetIndexes()}})}(),function(){const e=Fancy,t=e.PICKER_DATE_CELL_ACTIVE_CLS,i=e.PICKER_DATE_CLS,n=e.PICKER_DATE_CELL_TODAY_CLS,s=e.PICKER_DATE_CELL_OUT_RANGE_CLS,r=e.PICKER_BUTTON_BACK_CLS,o=e.PICKER_BUTTON_NEXT_CLS,a=e.PICKER_BUTTON_DATE_CLS,l=e.PICKER_BUTTON_DATE_WRAPPER_CLS,d=e.PICKER_BUTTON_TODAY_CLS,c=e.PICKER_BUTTON_TODAY_WRAPPER_CLS;e.define("Fancy.datepicker.Manager",{singleton:!0,opened:[],add(e){this.hide(),this.opened.push(e)},hide(){this.opened.forEach(e=>{e.hide()}),this.opened=[]}}),e.define(["Fancy.picker.Date","Fancy.DatePicker"],{extend:e.Grid,type:"datepicker",mixins:["Fancy.grid.mixin.Grid",e.panel.mixin.PrepareConfig,e.panel.mixin.methods,"Fancy.grid.mixin.PrepareConfig","Fancy.grid.mixin.ActionColumn","Fancy.grid.mixin.Edit"],width:308,height:299,frame:!1,i18n:"en",cellTrackOver:!0,cellStylingCls:[s,n,t],activeCellCls:t,todayCellCls:n,pickerDateCls:i,outRangeCellCls:s,buttonBackCls:r,buttonDateCls:a,buttonDateWrapperCls:l,buttonNextCls:o,buttonTodayCls:d,buttonTodayWrapperCls:c,defaults:{type:"string",width:44,align:"center",cellAlign:"center"},gridBorders:[1,0,1,1],panelBodyBorders:[0,0,0,0],barScrollEnabled:!1,cellHeight:32,constructor:function(t){const i=this;e.apply(i,t),i.initFormat(),i.initColumns(),i.initDate(),i.initData(),i.initBars(),i.Super("constructor",[i])},init(){const e=this;e.Super("init",arguments),e.onUpdate(),e.addEvents("changedate"),e.on("update",e.onUpdate,e),e.on("cellclick",e.onCellClick,e),e.addCls(i),e.el.on("mousewheel",e.onMouseWheel,e),e.panel.el.on("mousedown",e.onMouseDown,e)},initFormat(){const t=this;t.format||(t.format=e.i18n[t.i18n].date)},initMonthPicker(){const t=this;if(t.monthPicker)return void t.monthPicker.setDate(t.date);if(!e.fullBuilt&&!1!==e.MODULELOAD&&t.monthPicker&&!e.modules.grid)return;const i={theme:t.theme,date:t.date,renderTo:t.panel.el.dom,i18n:t.i18n,style:{position:"absolute",top:`-${t.panel.el.height()}px`,left:"0px"},events:[{cancelclick:t.onMonthCancelClick,scope:t},{okclick:t.onMonthOkClick,scope:t}]},n=e.themes[t.theme].config;n.datePickerHeight&&(i.height=n.datePickerHeight),t.monthPicker=new e.MonthPicker(i)},initData(){this.data=this.generateData()},initDate(){const e=this;void 0!==e.date&&"Invalid Date"!==e.date.toString()||(e.date=new Date),e.showDate=e.date,e.maxValue&&e.showDate>e.maxValue?e.showDate=e.maxValue:e.minValue&&e.showDate<e.minValue&&(e.showDate=e.minValue)},initColumns(){var i=this,r=i.format,o=r.days,a=r.startDay,l=a,d=o.length,c=e.Date.dayIndexes,h=[],u=new Date;const g=function(e){switch(e.cls="",e.rowIndex){case 0:Number(e.value)>20&&(e.cls+=" "+s);break;case 4:case 5:Number(e.value)<15&&(e.cls+=" "+s)}const r=i.date,o=i.showDate;u.getMonth()===o.getMonth()&&u.getFullYear()===o.getFullYear()&&e.value===u.getDate()&&(0===e.rowIndex?e.value<20&&(e.cls+=" "+n):4===e.rowIndex||5===e.rowIndex?e.value>20&&(e.cls+=" "+n):e.cls+=" "+n),r.getMonth()===o.getMonth()&&r.getFullYear()===o.getFullYear()&&e.value===r.getDate()&&(0===e.rowIndex?e.value<20&&(e.cls+=" "+t):4===e.rowIndex||5===e.rowIndex?e.value>20&&(e.cls+=" "+t):e.cls+=" "+t);const a=e.value;let l=o.getMonth(),d=o.getFullYear();Number(a)>20&&e.rowIndex<2?0===--l&&(d--,l=11):Number(a)<10&&e.rowIndex>3&&12===++l&&(d++,l=0);let c=new Date(d,l,a),h=!1;return i.maxValue&&i.maxValue<c&&(h=!0),i.minValue&&i.minValue>c&&(h=!0),h?e.cls+=" fancy-date-picker-cell-out-min-max":e.cell&&e.cell.removeCls("fancy-date-picker-cell-out-min-max"),e};let p=0;switch(i.i18n){case"zh-CN":case"zh-TW":p=2}for(;l<d;l++)h.push({index:c[l],title:o[l][p].toLocaleUpperCase(),render:g});for(l=0,d=a;l<d;l++)h.push({index:c[l],title:o[l][0].toLocaleUpperCase(),render:g});i.columns=h},getDataFields(){for(var t=[],i=this.format,n=i.days,s=i.startDay,r=s,o=n.length,a=e.Date.dayIndexes;r<o;r++)t.push(a[r]);for(r=0,o=s;r<o;r++)t.push(a[r]);return t},generateData(){for(var t=this.format.startDay,i=this.showDate,n=e.Date.getDaysInMonth(i),s=e.Date.getFirstDayOfMonth(i),r=[],o=this.getDataFields(),a=0,l=n,d=0;a<l;a++){let e=a+s-t+d;e<0&&(d=(e=7-t)+1),0===e&&(d=e=7),r[e]=a+1}var c=i.getMonth(),h=i.getFullYear(),u=i.getDate(),g=i.getHours(),p=i.getMinutes(),m=i.getSeconds(),f=i.getMilliseconds();0===c?(c=11,h--):c--;var y=new Date(h,c,u,g,p,m,f),C=e.Date.getDaysInMonth(y);for(a=7;a--;)void 0===r[a]&&(r[a]=C,C--);a=28,l=42;for(var v=1;a<l;a++)void 0===r[a]&&(r[a]=v,v++);var w=[];for(a=0,l=6;a<l;a++)w[a]=r.splice(0,7);return{fields:o,items:w}},initBars(){this.initTBar(),this.initBBar()},initTBar(){const e=this,t=[];t.push({cls:r,handler:e.onBackClick,scope:e,style:{}}),t.push({cls:a,i18n:e.i18n,wrapper:{cls:l},handler:e.onDateClick,scope:e,text:"                       "}),t.push("side"),t.push({cls:o,handler:e.onNextClick,scope:e}),e.tbar=t},initBBar(){const e=this,t=[];t.push({text:e.format.today,i18n:e.i18n,cls:d,wrapper:{cls:c},handler:e.onClickToday,scope:e}),e.bbar=t},onBackClick(){var e=this,t=e.showDate,i=t.getMonth(),n=t.getFullYear(),s=t.getDate(),r=t.getHours(),o=t.getMinutes(),a=t.getSeconds(),l=t.getMilliseconds();0===i?(i=11,n--):i--,e.showDate=new Date(n,i,s,r,o,a,l);const d=e.generateData();e.store.setData(d.items),e.update()},onNextClick(){var e=this,t=e.showDate,i=t.getMonth(),n=t.getFullYear(),s=t.getDate(),r=t.getHours(),o=t.getMinutes(),a=t.getSeconds(),l=t.getMilliseconds();11===i?(i=0,n++):i++,e.showDate=new Date(n,i,s,r,o,a,l);const d=e.generateData();e.store.setData(d.items),e.update()},onUpdate(){var t=e.Date.format(this.showDate,"F Y",{date:this.format}),i=9*t.length+35;switch(this.i18n){case"zh-CN":case"zh-TW":case"ja":case"ko":i=10*t.length+35}this.tbar[1].setText(t,i)},onClickToday(){const e=this,t=new Date;e.showDate=t,e.date=t;const i=e.generateData();e.store.setData(i.items),e.update()},onCellClick(i,n){var r,o=this,a=o.showDate,l=a.getFullYear(),d=a.getMonth(),c=a.getHours(),h=a.getMinutes(),u=a.getSeconds(),g=a.getMilliseconds(),p=e.get(n.cell);if(!p.hasCls("fancy-date-picker-cell-out-min-max")&&(o.date=new Date(l,d,Number(n.value),c,h,u,g),o.el.select(`.${t}`).removeCls(t),p.addCls(t),o.fire("changedate",o.date),p.hasCls(s))){r=Number(n.value),n.rowIndex<3?0===d?(l--,d=11):d--:11===d?(l++,d=11):d++,o.date=new Date(l,d,r,c,h,u,g),o.showDate=o.date;const e=o.generateData();o.store.setData(e.items),o.update()}},onMouseWheel(t){e.getWheelDelta(t.originalEvent||t)<0?this.onBackClick():this.onNextClick()},onDateClick(){const t=this;t.initMonthPicker(),t.monthPicker.panel.css("display","block"),e.$.fn.animate?t.monthPicker.panel.el.animate({top:"0px"}):t.monthPicker.panel.css({top:"0px"})},onMonthCancelClick(){this.hideMonthPicker()},onMonthOkClick(){var e=this,t=e.monthPicker.date,i=t.getMonth(),n=t.getFullYear(),s=e.date.getDate(),r=e.date.getHours(),o=e.date.getMinutes(),a=e.date.getSeconds(),l=e.date.getMilliseconds();e.hideMonthPicker(),s>28&&(s=1),e.date=new Date(n,i,s,r,o,a,l),e.showDate=e.date;const d=e.generateData();e.store.setData(d.items),e.update(),e.fire("changedate",e.date,!1)},hideMonthPicker(){const t=this.monthPicker.panel.el;e.$.fn.animate?t.animate({top:"-"+t.css("height")},{complete:()=>{t.css("display","none")}}):t.css("display","none")},onMouseDown(e){e.preventDefault()},setDate(e,t){const i=this;i.date=e,t&&i.showDate||(i.showDate=e),i.store.setData(i.generateData().items),i.update()}})}(),function(){const e=Fancy,t=e.PICKER_MONTH_CELL_ACTIVE_CLS,i=e.PICKER_MONTH_CLS,n=e.PICKER_BUTTON_BACK_CLS,s=e.PICKER_BUTTON_NEXT_CLS,r=e.PICKER_MONTH_ACTION_BUTTONS_CLS;e.define(["Fancy.picker.Month","Fancy.MonthPicker"],{extend:e.Grid,type:"monthpicker",mixins:["Fancy.grid.mixin.Grid",e.panel.mixin.PrepareConfig,e.panel.mixin.methods,"Fancy.grid.mixin.PrepareConfig","Fancy.grid.mixin.ActionColumn","Fancy.grid.mixin.Edit"],width:308,height:299,frame:!1,cellHeight:37,i18n:"en",cellTrackOver:!0,cellStylingCls:[t],activeCellCls:t,buttonBackCls:n,buttonNextCls:s,actionButtonsCls:r,defaults:{type:"string",width:76,align:"center",cellAlign:"center"},gridBorders:[1,0,1,1],panelBodyBorders:[0,0,0,0],header:!1,constructor:function(t){const i=this;e.apply(i,t),i.initLang(),i.initColumns(),i.initDate(),i.initData(),i.initBars(),i.Super("constructor",[i])},init(){const e=this;e.Super("init",arguments),e.addEvents("cancelclick","okclick"),e.addEvents("changedate"),e.on("cellclick",e.onCellClick,e),e.panel.addCls(i)},initData(){this.data=this.generateData()},initDate(){const e=this;void 0===e.date&&(e.date=new Date),e.showDate=e.date},initLang(){this.lang||(this.lang=e.Object.copy(e.i18n[this.i18n||"en"]))},initColumns(){const e=this,i=i=>{const n=e.date.getMonth();return e.lang.date.months[n].substr(0,3)===i.value&&(i.cls=t),i},n=i=>{return e.date.getFullYear()===Number(i.value)&&(i.cls=t),i};e.columns=[{index:"month1",render:i,locked:!0},{index:"month2",render:i,locked:!0,width:77},{index:"year1",render:n,width:77},{index:"year2",render:n,width:77}]},generateData(){var e,t,i=this.lang,n=this.showDate.getFullYear(),s=i.date.months,r=[],o=[];for(e=0,t=12;e<t;e++)o.push(n-5+e);for(e=0,t=6;e<t;e++)r[e]={},r[e].month1=s[e].substr(0,3),r[e].month2=s[6+e].substr(0,3),r[e].year1=o[e],r[e].year2=o[6+e];return{fields:["month1","month2","year1","year2"],items:r}},initBars(){this.initTBar(),this.initBBar()},initTBar(){const e=this,t=[];t.push("side"),t.push({cls:n,handler:e.onBackClick,scope:e}),t.push({width:30,cls:s,handler:e.onNextClick,scope:e}),e.tbar=t},initBBar(){const e=this,t=[],i=e.lang;t.push({type:"wrapper",cls:r,items:[{text:i.date.ok,i18n:e.i18n,handler:e.onClickOk,scope:e},{text:i.date.cancel,i18n:e.i18n,handler:e.onClickCancel,scope:e}]}),e.bbar=t},onBackClick(){var e=this,t=e.showDate,i=t.getFullYear(),n=t.getMonth(),s=t.getDate(),r=t.getHours(),o=t.getMinutes(),a=t.getSeconds(),l=t.getMilliseconds();i-=10,e.showDate=new Date(i,n,s,r,o,a,l);const d=e.generateData();e.store.setData(d.items),e.update()},onNextClick(){var e=this,t=e.showDate,i=t.getFullYear(),n=t.getMonth(),s=t.getDate(),r=t.getHours(),o=t.getMinutes(),a=t.getSeconds(),l=t.getMilliseconds();i+=10,e.showDate=new Date(i,n,s,r,o,a,l);const d=e.generateData();e.store.setData(d.items),e.update()},onClickOk(){this.fire("okclick")},onClickCancel(){this.fire("cancelclick")},onCellClick(i,n){var s,r=this,o=r.date,a=o.getFullYear(),l=o.getMonth(),d=o.getDate(),c=o.getHours(),h=o.getMinutes(),u=o.getSeconds(),g=o.getMilliseconds(),p=e.get(n.cell);"center"===n.side?(s=r.body,a=Number(n.value)):(s=r.leftBody,l=n.rowIndex+6*n.columnIndex),s.el.select(`.${t}`).removeCls(t),p.addCls(t),d>28&&(d=1),r.showDate=new Date(a,l,d,c,h,u,g),r.date=r.showDate,r.fire("changedate",r.date)},onMouseWheel(t){e.getWheelDelta(t.originalEvent||t)<0?this.onBackClick():this.onNextClick()},setDate(e){const t=this;t.date=e,t.showDate=e;const i=t.generateData();t.store.setData(i.items),t.update()}})}(),Fancy.define("Fancy.spark.ProgressDonut",{svgns:"http://www.w3.org/2000/svg",sum:100,prefix:"fancy-spark-progress-donut-",colorBGPlus:"#eee",colorPlus:"#44A4D3",colorBGMinus:"#F9DDE0",colorMinus:"#EA7369",tipTpl:"{value}",tip:!0,tooltip:!0,constructor:function(e){Fancy.apply(this,e),this.init()},init(){const e=this;e.initId(),e.initChart(),e.setSize(),e.setRadius(),e.setInnerRadius(),e.setParams(),e.iniColors(),e.preRender(),e.render(),!0!==e.inited&&(e.renderTo.appendChild(e.chart),e.ons())},initId(){const e=this,t=e.prefix||Fancy.prefix;e.id=e.id||Fancy.id(null,t),Fancy.addWidget(e.id,e)},ons(){const e=this;e.el.on("mouseenter",e.onMouseEnter,e),e.el.on("mouseleave",e.onMouseLeave,e),e.el.on("mousemove",e.onMouseMove,e)},onMouseEnter(){let e=this,t=e.el.attr("value");if(!e.tip||!e.tipTpl)return;t=new Fancy.Template(e.tipTpl).getHTML({value:t}),Fancy.tip.update('<span style="color: '+e.color+';">●</span> '+t)},onMouseLeave(){this.tip&&this.tipTpl&&Fancy.tip.hide(500)},onMouseMove(e){this.tooltip&&this.tip&&this.tipTpl&&Fancy.tip.show(e.pageX+15,e.pageY-25)},iniColors(){const e=this;e.value<0?(e.backColor=e.colorBGMinus,e.color=e.colorMinus):(e.backColor=e.colorBGPlus,e.color=e.colorPlus)},preRender(){const e=this.size,t=this.chart;t.setAttribute("width",e),t.setAttribute("height",e),t.setAttribute("viewBox","0 0 "+e+" "+e)},render(){this.renderBack(),this.renderProgress()},renderBack(){const e=this,t=e.radius,i=e.innerRadius,n=["M",e.cx,e.y1,"A",t,t,0,1,1,e.x2,e.y1,"L",e.x2,e.y2,"A",i,i,0,1,0,e.cx,e.y2].join(" "),s=document.createElementNS(e.svgns,"path");s.setAttribute("d",n),s.setAttribute("fill",e.backColor),e.chart.appendChild(s)},renderProgress(){var e=this,t=e.radius,i=e.innerRadius,n=document.createElementNS(e.svgns,"path"),s=e.value,r=0;s>99&&(s=99.99999),s<-99&&(s=99.99999),s<0&&(r=100+s,s*=-1);const o=s/e.sum,a=r+s;var l=["M"].concat(e.scale(r,t),"A",t,t,0,o>.5?1:0,1,e.scale(a,t),"L");i&&(l=l.concat(e.scale(a,i),"A",i,i,0,o>.5?1:0,0,e.scale(r,i))),l=l.join(" "),n.setAttribute("d",l),n.setAttribute("fill",e.color),e.chart.appendChild(n)},initChart(){const e=this,t=Fancy.get(e.renderTo);e.renderTo=Fancy.get(e.renderTo).dom,0===t.select("svg").length?e.chart=document.createElementNS(e.svgns,"svg:svg"):(e.chart=t.select("svg").dom,e.chart.innerHTML="",e.inited=!0),e.el=Fancy.get(e.chart),e.el.attr("id",e.id),e.value<1&&e.value>0?e.el.attr("value",e.value.toFixed(1)):e.value>-1&&e.value<0?e.el.attr("value",e.value.toFixed(1)):e.el.attr("value",e.value.toFixed(0))},scale(e,t){const i=Math.PI,n=e/this.sum*i*2-i/2;return[t*Math.cos(n)+this.cx,t*Math.sin(n)+this.cy]},radians:e=>e*Math.PI/180,setSize(){const e=this;e.width=e.width||e.height||e.size||30,e.height=e.height||e.width||e.size||30,e.size=e.size||e.height},setRadius(){this.radius=this.radius||this.height/2},setInnerRadius(){this.innerRadius=this.innerRadius||this.height/2-this.height/4},setParams(){const e=this,t=e.radius,i=e.innerRadius,n=e.height,s=e.width;e.cy=n/2,e.y1=e.cy-t,e.y2=e.cy-i,e.cx=s/2,e.x2=e.cx-.01}}),Fancy.modules.spark=!0,Fancy.define("Fancy.spark.GrossLoss",{maxValue:100,tipTpl:'<span style="color: {color};">●</span> {value} {suffix}',tip:!0,constructor:function(e){Fancy.apply(this,e),this.init()},init(){const e=this;e.preRender(),e.render(),!0!==e.inited&&e.ons()},ons(){const e=this;e.el.on("mouseenter",e.onMouseEnter,e),e.el.on("mouseleave",e.onMouseLeave,e),e.el.on("mousemove",e.onMouseMove,e)},onMouseEnter(){let e,t=this,i=t.el.attr("value"),n=t.el.css("background-color"),s="";if(!t.tipTpl||!t.tip)return;t.percents&&(s=" %"),e=new Fancy.Template(t.tipTpl).getHTML({value:i,color:n,suffix:s}),Fancy.tip.update(e)},onMouseLeave(){this.tipTpl&&this.tip&&Fancy.tip.hide(500)},onMouseMove(e){this.tipTpl&&this.tip&&Fancy.tip.show(e.pageX+15,e.pageY-25)},preRender(){},render(){var e=this,t=e.column.width/e.maxValue,i=0,n=0,s=e.value,r="";s<0?(i=-s*t/2,e.lossColor&&(r="background-color:"+e.lossColor+";"),s='<div class="fancy-grid-grossloss-loss" style="'+r+"width:"+i+'%">&nbsp;</div>'):(n=s*t/2,e.grossColor&&(r="background-color:"+e.grossColor+";"),s='<div class="fancy-grid-grossloss-gross" style="'+r+"width:"+n+'%">&nbsp;</div>'),e.renderTo.innerHTML=s,e.value<0?e.el=Fancy.get(e.renderTo).select(".fancy-grid-grossloss-loss").item(0):e.el=Fancy.get(e.renderTo).select(".fancy-grid-grossloss-gross").item(0),e.el.attr("value",e.value.toFixed(2))}}),Fancy.define("Fancy.spark.ProgressBar",{tipTpl:"{value} {suffix}",tip:!0,constructor:function(e){Fancy.apply(this,e),this.init()},init(){const e=this;e.initId(),e.render(),!0!==e.inited&&e.ons()},initId(){const e=this,t=e.prefix||Fancy.prefix;e.id=e.id||Fancy.id(null,t),Fancy.addWidget(e.id,e)},ons(){const e=this;!1!==e.tip&&(e.el.on("mouseenter",e.onMouseEnter,e),e.el.on("mouseleave",e.onMouseLeave,e),e.el.on("mousemove",e.onMouseMove,e))},onMouseEnter(){var e,t=this,i=t.el.attr("value"),n="%";if(!1===t.percents&&(n=""),!1!==t.tip&&t.tipTpl){if(Fancy.isFunction(t.tipTpl))e=t.tipTpl({value:i,suffix:n});else e=new Fancy.Template(t.tipTpl).getHTML({value:i,suffix:n});Fancy.tip.update(e)}},onMouseLeave(){this.tip&&this.tipTpl&&Fancy.tip.hide(500)},onMouseMove(e){this.tip&&this.tipTpl&&Fancy.tip.show(e.pageX+15,e.pageY-25)},render(){var e,t=this,i=t.column,n=(i.width-18)/t.maxValue,s=t.value*n,r=t.value,o=i.sparkConfig;r=!1===t.percents?t.value:r<1?t.value.toFixed(1):t.value.toFixed(0);var a="&nbsp;",l="",d="";if(o.label)switch(o.label.type){case"left":a='<div class="fancy-grid-bar-label" style="float: left;">'+r+"</div>",s<7*String(r).length&&(a="&nbsp;",l='<div class="fancy-grid-bar-label-out" style="">'+r+"</div>");break;case"right":a='<div class="fancy-grid-bar-label" style="float: right;">'+r+"</div>",s<7*String(r).length&&(a="&nbsp;",l="right"===o.align?'<div class="fancy-grid-bar-label-out-left" style="">'+r+"</div>":'<div class="fancy-grid-bar-label-out" style="">'+r+"</div>");break;default:a='<div class="fancy-grid-bar-label" style="float: left;">'+r+"</div>",s<7*String(r).length&&(a="&nbsp;",d='<div class="fancy-grid-bar-label-out-left" style="">'+r+"</div>")}var c="width:"+s+"px;",h="";if(o.align&&(h="float:"+o.align+";"),e='<div id="'+t.id+'" value="'+r+'" class="fancy-grid-column-progress-bar" style="'+c+h+'">'+a+"</div>"+l+d,t.renderTo.innerHTML=e,t.el=Fancy.get(t.renderTo).select(".fancy-grid-column-progress-bar").item(0),Fancy.isFunction(t.style)){var u=t.style({value:t.value,column:t.column,rowIndex:t.rowIndex,data:t.data});t.el.css(u)}},update(){var e=this,t=e.column,i=(t.width-18)/e.maxValue,n=e.value,s=n*i,r=t.sparkConfig,o=e.el.parent();if(e.el.css("width",s),e.el.attr("value",n),r.label)if("right"===r.label.type){var a=o.select(".fancy-grid-column-progress-bar"),l=o.select(".fancy-grid-bar-label"),d=o.select(".fancy-grid-bar-label-out");10*String(n).length+10>s?(l.dom&&(a.update("&nbsp;"),l.destroy()),d.dom?d.update(n):o.append('<div class="fancy-grid-bar-label-out">'+n+"</div>")):(l.dom||(a.append('<div class="fancy-grid-bar-label" style="float: right;"></div>'),l=o.select(".fancy-grid-bar-label")),l.update(n),d.dom&&d.destroy())}else{a=o.select(".fancy-grid-column-progress-bar"),l=o.select(".fancy-grid-bar-label");var c=o.select(".fancy-grid-bar-label-out-left");10*String(n).length+10>s?(l.dom&&(a.update("&nbsp;"),l.destroy()),c.dom?c.update(n):o.append('<div class="fancy-grid-bar-label-out-left">'+n+"</div>")):(l.dom||(a.append('<div class="fancy-grid-bar-label" style="float: left;"></div>'),l=o.select(".fancy-grid-bar-label")),l.update(n),c.dom&&c.destroy())}}}),Fancy.define("Fancy.spark.HBar",{tipTpl:"{value}",tip:!0,maxValue:100,stacked:!1,fullStack:!1,constructor:function(e){Fancy.apply(this,e),this.init()},init(){const e=this;e.initId(),e.render(),!0!==e.inited&&e.ons()},initId(){const e=this,t=e.prefix||Fancy.prefix;e.id=e.id||Fancy.id(null,t),Fancy.addWidget(e.id,e)},ons(){const e=this;!1!==e.tip&&(e.el.on("mouseenter",e.onMouseEnter,e,".fancy-grid-column-h-bar-node"),e.el.on("mouseleave",e.onMouseLeave,e,".fancy-grid-column-h-bar-node"),e.el.on("mousemove",e.onMouseMove,e,".fancy-grid-column-h-bar-node"))},onMouseEnter(e){var t=this,i=Fancy.get(e.target),n=i.attr("key"),s=i.attr("data-title"),r=Number(i.attr("value")),o=Number(i.attr("percents"));if(!t.tip||!t.tipTpl)return;if(t.tipFormat){const e={value:r,percents:o,key:n,column:t.column,data:t.data,title:s};r=t.tipFormat(e)}const a=new Fancy.Template(t.tipTpl).getHTML({value:r});Fancy.tip.update(a)},onMouseLeave(){this.tip&&this.tipTpl&&Fancy.tip.hide(500)},onMouseMove(e){this.tip&&this.tipTpl&&Fancy.tip.show(e.pageX+15,e.pageY-25)},render(){var e,t,i=this,n=i.column,s=(n.width-18)/100,r=n.index,o=0,a=n.disabled||{},l="",d="",c=0,h=r.length;n.fields?(h=n.fields.length,Fancy.each(n.fields,e=>{const t=n.index+"."+e;a[t]||(o+=i.data[n.index][t])})):Fancy.each(r,e=>{a[e]||(o+=i.data[e])}),i.stacked?i.fullStack||(o=i.maxValue):(o=i.maxItemValue,l="line-height:"+((i.height-1)/r.length-2)+"px;"),e=o/100,c=0;let u="fancy-spark-hbar";for(i.stacked&&(u+=" fancy-spark-stacked "),t='<div id="'+i.id+'" class="'+u+'">';c<h;c++){if(n.fields)var g=n.fields[c],p=i.data[n.index][g];else g=r[c],p=i.data[g];var m=p/e,f=m*s;if(!a[g]){0!==c&&f--,i.stacked||(d="margin-top:2px;"),f>0&&f<1&&(f=2);var y="background: "+Fancy.COLORS[c]+";",C="width:"+f+";",v="",w='data-title=""';0===f&&(v="display: none;"),i.title&&(w='data-title="'+i.title[c]+'" '),t+="<div "+w+('key="'+g+'" ')+(p='value="'+p+'" ')+('percents="'+m+'" ')+'" class="fancy-grid-column-h-bar-node" style="'+v+C+y+l+d+'">&nbsp;</div>'}}t+="</div>",i.renderTo.innerHTML=t,i.el=Fancy.get(i.renderTo)},update(e){var t,i,n=this,s=n.column,r=(s.width-18)/100,o=s.index,a=0,l=s.disabled||{};n.data=e;var d=0,c=o.length,h=0;for(s.fields?(c=s.fields.length,Fancy.each(s.fields,e=>{l[s.index+"."+e]?h++:a+=n.data[s.index][e]})):Fancy.each(o,e=>{l[e]?h++:a+=n.data[e]}),n.stacked?n.fullStack||(a=n.maxValue):(a=n.maxItemValue,i=(n.height-1)/(o.length-h)-2),t=a/100,d=0;d<c;d++){if(s.fields)var u=s.fields[d],g=n.data[s.index][u];else u=o[d],g=n.data[u];var p=g/t*r,m=n.el.select('.fancy-grid-column-h-bar-node[key="'+u+'"]');s.fields&&l[s.index+"."+u]?(m.css("width","0px"),m.hide()):l[u]?(m.css("width","0px"),m.hide()):(0!==d&&p--,n.stacked||(m.css("line-height",i+"px"),m.css("margin-top","2px")),0===p||-1===p?m.css("display","none"):m.css("display","block"),p>0&&p<2&&(p=2),m.animate({duration:2,width:p}))}}}),function(){const e=Fancy,t=e.TOOLTIP_CLS,i=e.TOOLTIP_INNER_CLS;e.define("Fancy.ToolTip",{extend:e.Widget,constructor:function(){this.Super("const",arguments)},init(){this.initTpl(),this.render(),this.ons()},tpl:[`<div class="${i}">{text}</div>`],widgetCls:t,cls:"",extraCls:"",render(){const t=this,i=e.get(t.renderTo||document.body).dom,n=e.newEl("div");n.addCls(e.cls,t.widgetCls,t.cls,t.extraCls),n.update(t.tpl.getHTML({text:t.text})),t.el=e.get(i.appendChild(n.dom))},show(e,t){const i=this;clearInterval(i.timeout),delete i.timeout,"none"===i.css("display")&&i.css({display:"block"}),i.css({left:e,top:t})},hide(e){const t=this;clearInterval(t.timeout),e?t.timeout=setTimeout(()=>{t.el.hide(),delete t.timeout},e):t.el.hide()},destroy(){this.el.destroy()},update(e){this.el.select(`.${i}`).update(e)},ons(){this.el.on("mouseenter",this.onMouseEnter,this)},onMouseEnter(){this.hide(500)}}),e.tip={update(t){e.tip=new e.ToolTip({text:t})},show(t,i){e.tip=new e.ToolTip({text:" "}),e.tip.show(t,i)},hide(){e.tip=new e.ToolTip({text:" "})}}}(),function(){"use strict";function e(t,n){var s;if(n=n||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=n.touchBoundary||10,this.layer=t,this.tapDelay=n.tapDelay||200,this.tapTimeout=n.tapTimeout||700,!e.notNeeded(t)){for(var r=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],o=0,a=r.length;o<a;o++)this[r[o]]=l(this[r[o]],this);i&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,i,n){var s=Node.prototype.removeEventListener;"click"===e?s.call(t,e,i.hijacked||i,n):s.call(t,e,i,n)},t.addEventListener=function(e,i,n){var s=Node.prototype.addEventListener;"click"===e?s.call(t,e,i.hijacked||(i.hijacked=function(e){e.propagationStopped||i(e)}),n):s.call(t,e,i,n)}),"function"==typeof t.onclick&&(s=t.onclick,t.addEventListener("click",function(e){s(e)},!1),t.onclick=null)}function l(e,t){return function(){return e.apply(t,arguments)}}}Fancy.modules.touch=!0;var t=navigator.userAgent.indexOf("Windows Phone")>=0,i=navigator.userAgent.indexOf("Android")>0&&!t,n=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,s=n&&/OS 4_\d(_\d)?/.test(navigator.userAgent),r=n&&/OS [6-7]_\d/.test(navigator.userAgent),o=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(n&&"file"===e.type||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!i;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var i,n;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),n=t.changedTouches[0],(i=document.createEvent("MouseEvents")).initMouseEvent(this.determineEventType(e),!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),i.forwardedTouchEvent=!0,e.dispatchEvent(i)},e.prototype.determineEventType=function(e){return i&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},e.prototype.focus=function(e){var t;n&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type&&"month"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,i;if(!(t=e.fastClickScrollParent)||!t.contains(e)){i=e;do{if(i.scrollHeight>i.offsetHeight){t=i,e.fastClickScrollParent=i;break}i=i.parentElement}while(i)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,i,r;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),i=e.targetTouches[0],n){if((r=window.getSelection()).rangeCount&&!r.isCollapsed)return!0;if(!s){if(i.identifier&&i.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=i.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=i.pageX,this.touchStartY=i.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],i=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>i||Math.abs(t.pageY-this.touchStartY)>i},e.prototype.onTouchMove=function(e){return!this.trackingClick||((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0)},e.prototype.findControl=function(e){return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var t,o,a,l,d,c=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,o=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,r&&(d=e.changedTouches[0],(c=document.elementFromPoint(d.pageX-window.pageXOffset,d.pageY-window.pageYOffset)||c).fastClickScrollParent=this.targetElement.fastClickScrollParent),"label"===(a=c.tagName.toLowerCase())){if(t=this.findControl(c)){if(this.focus(c),i)return!1;c=t}}else if(this.needsFocus(c))return e.timeStamp-o>100||n&&window.top!==window&&"input"===a?(this.targetElement=null,!1):(this.focus(c),this.sendClick(c,e),n&&"select"===a||(this.targetElement=null,e.preventDefault()),!1);return!(!n||s||!(l=c.fastClickScrollParent)||l.fastClickLastScrollTop===l.scrollTop)||(this.needsClick(c)||(e.preventDefault(),this.sendClick(c,e)),!1)},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return!this.targetElement||(!!e.forwardedTouchEvent||(!e.cancelable||(!(!this.needsClick(this.targetElement)||this.cancelNextClick)||(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1))))},e.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail||((t=this.onMouse(e))||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;i&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var t,n,s;if(void 0===window.ontouchstart)return!0;if(n=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!i)return!0;if(t=document.querySelector("meta[name=viewport]")){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(n>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(o&&(s=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/))[1]>=10&&s[2]>=3&&(t=document.querySelector("meta[name=viewport]"))){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===e.style.msTouchAction||"manipulation"===e.style.touchAction||(!!(+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]>=27&&(t=document.querySelector("meta[name=viewport]"))&&(-1!==t.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))||("none"===e.style.touchAction||"manipulation"===e.style.touchAction))},e.attach=function(t,i){return new e(t,i)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e}(),Fancy.enableCompo=(()=>{var e,t=document,i=0,n={};function s(){if(0!==i)for(const i in n){var e,s,o=n[i],a=t.querySelectorAll(i),l=o.appPreSelector?o.appPreSelector+"-":"data-",d=o.preSelector?o.preSelector+"-":"fancy-",c=0,h=a.length;if(0===a.length)return;for(;c<h;c++){var u={},g=a[c],p=g.id||"rand-id-"+ +new Date,m=g.attributes;for(e=0,s=m.length;e<s;e++){var f=m[e],y=f.name,C=f.value;new RegExp(l).test(y)&&(C=r(C),u[y.replace(l,"")]=C)}!function(){var t=g.getElementsByTagName("*");for(e=0,s=t.length;e<s;e++){var i,n,o=t[e],a=o.tagName.toLowerCase();new RegExp(d).test(a)&&(i=a.replace(d,""),n=r(o.innerHTML),u[i.replace(l,"")]=n)}}(),g.outerHTML='<div id="'+p+'"></div>',o.init(t.getElementById(p),u)}}}function r(e){return/\[/.test(e)||/\{/.test(e)?(e=e.replace(/\n/g,""),e=new Function("return "+e+";")()):e=isNaN(Number(e))?e.replace(/\n/g,""):Number(e),e}Fancy.Component=function(e,t){i++,n[e]=t},Fancy.stopWatch=function(){clearInterval(e)},s(),t.addEventListener("DOMContentLoaded",function(){s()}),setTimeout(function(){s()},1),e=setInterval(function(){s()},250),Fancy.Component("fancy-grid",{preSelector:"fancy",attrPreSelector:"data",init:function(e,t){t.renderTo=e,window[e.id]=new FancyGrid(t)}}),Fancy.Component("fancy-form",{preSelector:"fancy",attrPreSelector:"data",init:function(e,t){t.renderTo=e,window[e.id]=new FancyForm(t)}}),Fancy.Component("fancy-tab",{preSelector:"fancy",attrPreSelector:"data",init:function(e,t){t.renderTo=e,window[e.id]=new FancyTab(t)}})}),Fancy});