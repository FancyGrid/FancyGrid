Fancy.define("Fancy.spark.ProgressDonut",{svgns:"http://www.w3.org/2000/svg",sum:100,prefix:"fancy-spark-progress-donut-",constructor:function(a){var b=this;Fancy.apply(b,a),b.init()},init:function(){var a=this;a.initId(),a.initChart(),a.setSize(),a.setRadius(),a.setInnerRadius(),a.setParams(),a.iniColors(),a.preRender(),a.render(),!0!==a.inited&&(a.renderTo.appendChild(a.chart),a.ons())},initId:function(){var a=this,b=a.prefix||Fancy.prefix;a.id=a.id||Fancy.id(null,b),Fancy.addWidget(a.id,a)},ons:function(){var a=this;a.el.on("mouseenter",a.onMouseEnter,a),a.el.on("mouseleave",a.onMouseLeave,a),a.el.on("mousemove",a.onMouseMove,a)},onMouseEnter:function(a){var b=this,c=b.el.attr("value");if(b.tipTpl){c=new Fancy.Template(b.tipTpl).getHTML({value:c})}b.tooltip=new Fancy.ToolTip({text:'<span style="color: '+b.color+';">●</span> '+c})},onMouseLeave:function(a){this.tooltip.destroy()},onMouseMove:function(a){var b=this;b.tooltip&&(b.tooltip.css("display","block"),b.tooltip.show(a.pageX+15,a.pageY-25))},iniColors:function(){var a=this;a.value<0?(a.backColor="#F9DDE0",a.color="#EA7369"):(a.backColor="#eee",a.color="#44A4D3")},preRender:function(){var a=this,b=a.size,c=a.chart;c.setAttribute("width",b),c.setAttribute("height",b),c.setAttribute("viewBox","0 0 "+b+" "+b)},render:function(){var a=this;a.renderBack(),a.renderProgress()},renderBack:function(){var a=this,b=a.radius,c=a.innerRadius,d=["M",a.cx,a.y1,"A",b,b,0,1,1,a.x2,a.y1,"L",a.x2,a.y2,"A",c,c,0,1,0,a.cx,a.y2].join(" "),e=document.createElementNS(a.svgns,"path");e.setAttribute("d",d),e.setAttribute("fill",a.backColor),a.chart.appendChild(e)},renderProgress:function(){var a=this,b=a.radius,c=a.innerRadius,d=document.createElementNS(a.svgns,"path"),e=a.value,f=0;e>99&&(e=99.99999),e<-99&&(e=99.99999),e<0&&(f=100+e,e*=-1);var g=e/a.sum,h=f+e,i=["M"].concat(a.scale(f,b),"A",b,b,0,g>.5?1:0,1,a.scale(h,b),"L");c?i=i.concat(a.scale(h,c),"A",c,c,0,g>.5?1:0,0,a.scale(f,c)):i.push(cx,cy),i=i.join(" "),d.setAttribute("d",i),d.setAttribute("fill",a.color),a.chart.appendChild(d)},initChart:function(){var a=this,b=Fancy.get(a.renderTo);a.renderTo=Fancy.get(a.renderTo).dom,0===b.select("svg").length?a.chart=document.createElementNS(a.svgns,"svg:svg"):(a.chart=b.select("svg").dom,a.chart.innerHTML="",a.inited=!0),a.el=Fancy.get(a.chart),a.el.attr("id",a.id),a.value<1&&a.value>0?a.el.attr("value",a.value.toFixed(1)):a.value>-1&&a.value<0?a.el.attr("value",a.value.toFixed(1)):a.el.attr("value",a.value.toFixed(0))},scale:function(a,b){var c=this,d=Math.PI,e=c.sum,f=a/e*d*2-d/2;return[b*Math.cos(f)+c.cx,b*Math.sin(f)+c.cy]},radians:function(a){return a*Math.PI/180},setSize:function(){var a=this;a.width=a.width||a.height||a.size||30,a.height=a.height||a.width||a.size||30,a.size=a.size||a.height},setRadius:function(){var a=this;a.radius=a.radius||a.height/2},setInnerRadius:function(){var a=this;a.innerRadius=a.innerRadius||a.height/2-a.height/4},setParams:function(){var a=this,b=a.radius,c=a.innerRadius,d=a.height,e=a.width;a.cy=d/2,a.y1=a.cy-b,a.y2=a.cy-c,a.cx=e/2,a.x2=a.cx-.01}}),Fancy.define("Fancy.spark.GrossLoss",{maxValue:100,tipTpl:'<span style="color: {color};">●</span> {value} {suffix}',constructor:function(a){Fancy.apply(this,a),this.init()},init:function(){var a=this;a.preRender(),a.render(),!0!==a.inited&&a.ons()},ons:function(){var a=this;a.el.on("mouseenter",a.onMouseEnter,a),a.el.on("mouseleave",a.onMouseLeave,a),a.el.on("mousemove",a.onMouseMove,a)},onMouseEnter:function(){var a,b=this,c=b.el.attr("value"),d=b.el.css("background-color"),e="";b.percents&&(e=" %"),a=new Fancy.Template(b.tipTpl).getHTML({value:c,color:d,suffix:e}),b.tooltip=new Fancy.ToolTip({text:a})},onMouseLeave:function(){this.tooltip.destroy()},onMouseMove:function(a){this.tooltip.el.css("display","block"),this.tooltip.show(a.pageX+15,a.pageY-25)},preRender:function(){},render:function(){var a=this,b=a.column,c=b.width,d=c/a.maxValue,e=0,f=0,g=a.value,h="";g<0?(e=-g*d/2,a.lossColor&&(h="background-color:"+a.lossColor+";"),g='<div class="fancy-grid-grossloss-loss" style="'+h+"width:"+e+'%">&nbsp;</div>'):(f=g*d/2,a.grossColor&&(h="background-color:"+a.grossColor+";"),g='<div class="fancy-grid-grossloss-gross" style="'+h+"width:"+f+'%">&nbsp;</div>'),a.renderTo.innerHTML=g,a.value<0?a.el=Fancy.get(a.renderTo).select(".fancy-grid-grossloss-loss").item(0):a.el=Fancy.get(a.renderTo).select(".fancy-grid-grossloss-gross").item(0),a.el.attr("value",a.value.toFixed(2))}}),Fancy.define("Fancy.spark.ProgressBar",{tipTpl:"{value} {suffix}",constructor:function(a){var b=this;Fancy.apply(b,a),b.init()},init:function(){var a=this;a.initId(),a.render(),!0!==a.inited&&a.ons()},initId:function(){var a=this,b=a.prefix||Fancy.prefix;a.id=a.id||Fancy.id(null,b),Fancy.addWidget(a.id,a)},ons:function(){var a=this;!1!==a.tip&&(a.el.on("mouseenter",a.onMouseEnter,a),a.el.on("mouseleave",a.onMouseLeave,a),a.el.on("mousemove",a.onMouseMove,a))},onMouseEnter:function(a){var b=this,c=b.el.attr("value"),d="%";!1===b.percents&&(d="");var e=new Fancy.Template(b.tipTpl),f=e.getHTML({value:c,suffix:d});Fancy.tip.update(f)},onMouseLeave:function(a){Fancy.tip.hide(500)},onMouseMove:function(a){Fancy.tip.show(a.pageX+15,a.pageY-25)},render:function(){var a,b=this,c=b.column,d=c.width-18,e=d/b.maxValue,f=b.value*e,g=b.value,h=c.sparkConfig;g=!1===b.percents?b.value:g<1?b.value.toFixed(1):b.value.toFixed(0);var i="&nbsp;",j="",k="";if(h.label)switch(h.label.type){case"left":i='<div class="fancy-grid-bar-label" style="float: left;">'+g+"</div>",f<7*String(g).length&&(i="&nbsp;",j='<div class="fancy-grid-bar-label-out" style="">'+g+"</div>");break;case"right":i='<div class="fancy-grid-bar-label" style="float: right;">'+g+"</div>",f<7*String(g).length&&(i="&nbsp;",j="right"===h.align?'<div class="fancy-grid-bar-label-out-left" style="">'+g+"</div>":'<div class="fancy-grid-bar-label-out" style="">'+g+"</div>");break;default:i='<div class="fancy-grid-bar-label" style="float: left;">'+g+"</div>",f<7*String(g).length&&(i="&nbsp;",k='<div class="fancy-grid-bar-label-out-left" style="">'+g+"</div>")}var l="width:"+f+"px;",m="";if(h.align&&(m="float:"+h.align+";"),a='<div id="'+b.id+'" value="'+g+'" class="fancy-grid-column-progress-bar" style="'+l+m+'">'+i+"</div>"+j+k,b.renderTo.innerHTML=a,b.el=Fancy.get(b.renderTo).select(".fancy-grid-column-progress-bar").item(0),Fancy.isFunction(b.style)){var n=b.style({value:b.value,column:b.column,rowIndex:b.rowIndex,data:b.data});b.el.css(n)}},update:function(){var a=this,b=a.column,c=b.width-18,d=10,e=c/a.maxValue,f=a.value,g=f*e,h=b.sparkConfig,i=a.el.parent();if(a.el.css("width",g),a.el.attr("value",f),h.label)if("right"===h.label.type){var j=i.select(".fancy-grid-column-progress-bar"),k=i.select(".fancy-grid-bar-label"),l=i.select(".fancy-grid-bar-label-out");String(f).length*d+10>g?(k.dom&&(j.update("&nbsp;"),k.destroy()),l.dom?l.update(f):i.append('<div class="fancy-grid-bar-label-out">'+f+"</div>")):(k.dom||(j.append('<div class="fancy-grid-bar-label" style="float: right;"></div>'),k=i.select(".fancy-grid-bar-label")),k.update(f),l.dom&&l.destroy())}else{var j=i.select(".fancy-grid-column-progress-bar"),k=i.select(".fancy-grid-bar-label"),m=i.select(".fancy-grid-bar-label-out-left");String(f).length*d+10>g?(k.dom&&(j.update("&nbsp;"),k.destroy()),m.dom?m.update(f):i.append('<div class="fancy-grid-bar-label-out-left">'+f+"</div>")):(k.dom||(j.append('<div class="fancy-grid-bar-label" style="float: left;"></div>'),k=i.select(".fancy-grid-bar-label")),k.update(f),m.dom&&m.destroy())}}}),Fancy.define("Fancy.spark.HBar",{tipTpl:"{value}",maxValue:100,stacked:!1,fullStack:!1,constructor:function(a){var b=this;Fancy.apply(b,a),b.init()},init:function(){var a=this;a.initId(),a.render(),!0!==a.inited&&a.ons()},initId:function(){var a=this,b=a.prefix||Fancy.prefix;a.id=a.id||Fancy.id(null,b),Fancy.addWidget(a.id,a)},ons:function(){var a=this;!1!==a.tip&&(a.el.on("mouseenter",a.onMouseEnter,a,".fancy-grid-column-h-bar-node"),a.el.on("mouseleave",a.onMouseLeave,a,".fancy-grid-column-h-bar-node"),a.el.on("mousemove",a.onMouseMove,a,".fancy-grid-column-h-bar-node"))},onMouseEnter:function(a){var b=this,c=Fancy.get(a.target),d=c.attr("key"),e=c.attr("data-title"),f=Number(c.attr("value")),g=Number(c.attr("percents"));if(b.tipFormat){var h={value:f,percents:g,key:d,column:b.column,data:b.data,title:e};f=b.tipFormat(h)}var i=new Fancy.Template(b.tipTpl),j=i.getHTML({value:f});Fancy.tip.update(j)},onMouseLeave:function(a){Fancy.tip.hide(500)},onMouseMove:function(a){Fancy.tip.show(a.pageX+15,a.pageY-25)},render:function(){var a,b,c=this,d=c.column,e=d.width-18,f=e/100,g=d.index,h=0,i=d.disabled||{},j="",k="",l=2,m=0,n=g.length;d.fields?(n=d.fields.length,Fancy.each(d.fields,function(a){var b=d.index+"."+a;i[b]||(h+=c.data[d.index][b])})):Fancy.each(g,function(a){i[a]||(h+=c.data[a])}),c.stacked?c.fullStack||(h=c.maxValue):(h=c.maxItemValue,j="line-height:"+((c.height-1)/g.length-l)+"px;"),a=h/100,m=0;var o="fancy-spark-hbar";for(c.stacked&&(o+=" fancy-spark-stacked "),b='<div id="'+c.id+'" class="'+o+'">';m<n;m++){if(d.fields)var p=d.fields[m],q=c.data[d.index][p];else var p=g[m],q=c.data[p];var r=q/a,s=r*f;if(!i[p]){0!==m&&s--,c.stacked||(k="margin-top:"+l+"px;"),s>0&&s<1&&(s=2);var t="background: "+Fancy.COLORS[m]+";",u="width:"+s+";",v="",w='data-title=""';0===s&&(v="display: none;"),c.title&&(w='data-title="'+c.title[m]+'" ');var x='key="'+p+'" ';q='value="'+q+'" ';b+="<div "+w+x+q+('percents="'+r+'" ')+'" class="fancy-grid-column-h-bar-node" style="'+v+u+t+j+k+'">&nbsp;</div>'}}b+="</div>",c.renderTo.innerHTML=b,c.el=Fancy.get(c.renderTo)},update:function(a){var b,c,d=this,e=d.column,f=e.width-18,g=f/100,h=e.index,i=0,j=e.disabled||{},k=2;d.data=a;var l=0,m=h.length,n=0;for(e.fields?(m=e.fields.length,Fancy.each(e.fields,function(a){if(j[e.index+"."+a])return void n++;i+=d.data[e.index][a]})):Fancy.each(h,function(a){if(j[a])return void n++;i+=d.data[a]}),d.stacked?d.fullStack||(i=d.maxValue):(i=d.maxItemValue,c=(d.height-1)/(h.length-n)-k),b=i/100,l=0;l<m;l++){if(e.fields)var o=e.fields[l],p=d.data[e.index][o];else var o=h[l],p=d.data[o];var q=p/b,r=q*g,s=d.el.select('.fancy-grid-column-h-bar-node[key="'+o+'"]');e.fields&&j[e.index+"."+o]?(s.css("width","0px"),s.hide()):j[o]?(s.css("width","0px"),s.hide()):(0!==l&&r--,d.stacked||(s.css("line-height",c+"px"),s.css("margin-top",k+"px")),0===r||-1===r?s.css("display","none"):s.css("display","block"),r>0&&r<2&&(r=2),s.animate({duration:2,width:r}))}}});