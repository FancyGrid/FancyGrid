Fancy.modules.selection=!0,function(){const e=Fancy,t=e.GRID_CELL_CLS,l=e.GRID_CELL_OVER_CLS,o=e.GRID_CELL_SELECTED_CLS,n=e.GRID_CELL_ACTIVE_CLS,c=e.GRID_COLUMN_CLS,s=e.GRID_COLUMN_OVER_CLS,r=e.GRID_COLUMN_SELECT_CLS,i=e.GRID_COLUMN_SELECTED_CLS,d=e.GRID_ROW_OVER_CLS,a=e.GRID_HEADER_CELL_SELECT_CLS,m=e.GRID_HEADER_CELL_TEXT_CLS,u=e.GRID_COLUMN_TREE_EXPANDER_CLS,g=e.GRID_ACTIVE_CELL_ENABLED,h=e.FIELD_CHECKBOX_CLS,C=e.FIELD_CHECKBOX_ON_CLS,w=e.FIELD_CHECKBOX_INPUT_CLS,x=e.GRID_COPY_TEXTAREA,f=e.FIELD_CHECKBOX_MIDDLE_CLS,y=`.${o}`,I=`.${n}`;e.define("Fancy.grid.plugin.Selection",{extend:e.Plugin,ptype:"grid.selection",inWidgetName:"selection",mixins:["Fancy.grid.selection.mixin.Navigation"],enabled:!0,checkboxRow:!1,checkOnly:!1,memory:!1,disabled:!1,selectLeafsOnly:!1,keyNavigation:!0,allowDeselect:!1,constructor:function(){this.Super("const",arguments)},init(){const e=this,t=e.widget;e.Super("init",arguments),e.memory&&e.initMemory(),e.ons(),e.activeCell&&t.once("init",()=>t.el.addCls(g))},ons(){const t=this,l=t.widget;l.once("render",()=>{t.initTrackOver(),t.initColumnTrackOver(),t.initCellTrackOver(),t.initCellSelection(),t.initRowSelection(),t.initColumnSelection(),t.keyNavigation&&t.initNavigation(),t.initCopyKeys(),l.on("changepage",t.onChangePage,t),l.on("load",t.onLoad,t),e.nojQuery&&t.initFixTrackOver(),t.initCopyEl()}),l.on("sort",t.onSort,t),l.on("columndrag",t.onColumnDrag,t),l.on("lockcolumn",t.onColumnLock,t),l.on("rightlockcolumn",t.onColumnRightLock,t),l.on("unlockcolumn",t.onUnColumnLock,t),l.on("filter",t.onFilter,t),l.on("expand",t.onExpand,t),l.on("collapse",t.onCollapse,t),l.on("dragrows",t.onDragRows,t),l.on("remove",t.onRemoveRows,t),l.on("treeexpand",t.onTreeExpand,t),l.on("treecollapse",t.onTreeCollapse,t)},initMemory(){const t=this,l=t.widget,o=l.store;t.memory={all:!1,exceptedLength:0,selectedLength:0,excepted:{},selected:{},tree:{selected:{},allSelected:{},selectedLength:{}},addDirtyParent(o,n,c){if("rows"!==t.selModel)return;const s=l.getById(o).get("child");var r;s?!1!==c?(delete t.memory.tree.selected[o],n&&(t.memory.tree.allSelected[o]||t.memory.tree.selected[o]||t.memory.tree.selectedLength[n]++),t.memory.tree.allSelected[o]=!0,t.memory.tree.selectedLength[o]=s.length,t.memory.clearChild(s)):(s&&(t.memory.tree.selected[o]=!0),t.memory.tree.selectedLength[o]||(t.memory.tree.selectedLength[o]=1)):n&&(t.memory.tree.selected[n]=!0,t.memory.tree.selectedLength[n]=t.memory.tree.selectedLength[n]||0,t.memory.tree.selectedLength[n]++,(r=l.getById(n)).get("child").length===t.memory.tree.selectedLength[n]&&(t.memory.tree.allSelected[n]=!0,delete t.memory.tree.selected[n]));n&&((r=l.getById(n)).data.parentId&&t.memory.addDirtyParent(n,r.data.parentId,!1),s.length&&t.memory.addDirtyParent(n,r.data.parentId,!1));if(s){var i=0;e.each(s,e=>{const l=e.id;if(!l)return!0;t.memory.tree.allSelected[l]&&i++}),s.length===i&&(delete t.memory.tree.selected[o],t.memory.tree.allSelected[o]=!0)}},removeDirtyParent(e,o){if("rows"===t.selModel){var n,c=l.getById(o);if(c&&(n=c.get("child")),t.memory.tree.allSelected[e]&&(delete t.memory.tree.allSelected[e],delete t.memory.tree.selectedLength[e]),t.memory.selected[e]&&(delete t.memory.selected[e],t.memory.selectedLength--),delete t.memory.tree.selected[e],t.memory.tree.allSelected[o]&&(delete t.memory.tree.allSelected[o],t.memory.tree.selectedLength[o]=n.length,1!==n.length?t.memory.tree.selected[o]=!0:delete t.memory.tree.selected[o]),t.memory.tree.selectedLength[o]&&t.memory.tree.selectedLength[o]--,0===t.memory.tree.selectedLength[o]){delete t.memory.tree.selected[o],delete t.memory.tree.selectedLength[o];const e=c.get("parentId");e&&t.memory.removeDirtyParent(o,e)}}},clearChild(l){e.Array.each(l,e=>{const l=e.id;if(t.memory.tree.selectedLength[l]){t.memory.selected[l]=!0,delete t.memory.tree.allSelected[l],delete t.memory.tree.selected[l],delete t.memory.tree.selectedLength[l];const o=e.get("child");o&&t.memory.clearChild(o)}})},setAll(){const o=l.store.filteredDataMap;if(o){for(const e in o)t.memory.add(e);t.memory.all=!0}else e.apply(t.memory,{all:!0,exceptedLength:0,selectedLength:0,excepted:{},selected:{}})},clearAll(){o.hasFilters&&o.hasFilters()?t.memory.all=!1:e.apply(t.memory,{all:!1,exceptedLength:0,selectedLength:0,excepted:{},selected:{}})},selectAllFiltered(){t.memory.clearAll();const o=l.getDataFiltered();e.each(o,e=>t.memory.add(e.id))},add(e){const o=l.getById(e);o&&o.set("$selected",!0),t.row&&t.memory.clearAll(),t.memory.selected[e]||(t.memory.selected[e]=o.data,t.memory.selectedLength++),!0===t.memory.excepted[e]&&(delete t.memory.excepted[e],t.memory.exceptedLength--)},remove(e){const o=l.getById(e);o&&o.set("$selected",!1),t.memory.selected[e]&&(delete t.memory.selected[e],t.memory.selectedLength--),!0===t.memory.all&&(t.memory.excepted[e]||(t.memory.excepted[e]=!0,t.memory.exceptedLength++));const n=l.getTotal();t.memory.exceptedLength===n&&t.memory.clearAll()},has:e=>!!t.memory.selected[e]&&!t.memory.excepted[e]}},initTrackOver(){const e=this,t=e.widget;t.on("rowenter",e.onRowEnter,e),t.on("rowleave",e.onRowLeave,e)},initCellTrackOver(){const e=this,t=e.widget;t.on("cellenter",e.onCellEnter,e),t.on("cellleave",e.onCellLeave,e)},initColumnTrackOver(){const e=this,t=e.widget;t.on("columnenter",e.onColumnEnter,e),t.on("columnleave",e.onColumnLeave,e)},onCellEnter(t,o){const n=this.widget;!n.cellTrackOver||n.startResizing||e.isTouch||e.get(o.cell).addCls(l)},onCellLeave(t,o){const n=this.widget;n.cellTrackOver&&!n.startResizing&&e.get(o.cell).removeCls(l)},onColumnEnter(t,l){const o=this.widget,n=o.columndrag,c=o.scroller;n&&"dragging"===n.status||e.isTouch||o.startResizing||!o.columnTrackOver||c.bottomKnobDown||c.rightKnobDown||!1===l.column.trackOver||this.keyNavigating||e.get(l.columnDom).addCls(s)},onColumnLeave(t,l){const o=this.widget;o.startResizing||o.columnTrackOver&&e.get(l.columnDom).removeCls(s)},onRowEnter(t,l){const o=this.widget,n=o.columndrag,c=o.scroller;if(n&&"dragging"===n.status)return;if(e.isTouch)return;if(o.startResizing)return;if(!1===this.enabled)return;if(!o.trackOver||c.bottomKnobDown||c.rightKnobDown||this.keyNavigating)return;const s=o.getDomRow(l.rowIndex);e.each(s,t=>e.get(t).addCls(d)),o.fire("rowtrackenter",l)},onRowLeave(t,l){const o=this.widget;if(o.startResizing)return;if(!1===this.enabled)return;if(!o.trackOver)return;const n=o.getDomRow(l.rowIndex);e.each(n,t=>e.get(t).removeCls(d)),o.fire("rowtrackleave",l)},onChangePage(){this.memory||this.clearSelection()},onLoad(){this.memory||this.clearSelection()},initCellSelection(){const e=this,t=e.widget;t.on("cellclick",e.onCellClick,e),t.on("cellmousedown",e.onCellMouseDownCells,e),t.on("cellenter",e.onCellEnterSelection,e)},initRowSelection(){const e=this,t=e.widget;t.checkboxRowSelection&&(e.checkboxRow=!0,setTimeout(()=>{"rows"===e.selModel&&e.renderHeaderCheckBox()},1)),t.on("rowclick",e.onRowClick,e),t.on("cellmousedown",e.onCellMouseDownRows,e),t.on("cellclick",e.onCellClickRows,e),t.on("rowenter",e.onRowEnterSelection,e),t.on("columndrag",e.onColumnDrag,e)},onCellMouseDownRows(t,l){const c=this,s=c.widget,r=s.store,i=e.get(l.e.target),d=l.column,a=r.isTree&&c.memory,m=e.get(document.body);if(s._preventTouchDown)return void delete s._preventTouchDown;if(c.stopOneTick&&delete c.stopOneTick,c.checkOnly&&!e.get(l.e.target).hasClass(w))return void(c.activeCell&&(c.clearActiveCell(),e.get(l.cell).addCls(n)));if(c.disabled)return;if(c.selectLeafsOnly&&!l.data.leaf)return void(c.stopOneTick=!0);if(!c.rows||!c.enabled)return;if(c.checkOnly&&"$selected"!==l.column.index&&!l.column.select)return;if("tree"===d.type&&i.hasCls(u))return;if(!c.selectLeafsOnly&&!l.data.leaf&&i.hasClass(w)){const t=!e.getWidget(i.parent().parent().attr("id")).get();c.selectNodesChilds(l.id,t)}document.activeElement&&document.activeElement.blur();const g=l.e,C=g.target,x=g.ctrlKey,f=l.rowIndex,y=s.getDomRow(f);if((x||c.allowDeselect)&&s.multiSelect)e.get(y[0]).hasCls(o)?(c.domDeSelectRow(f),c.checkboxRow&&c.deSelectCheckBox(f),a&&(c.memory.removeDirtyParent(l.id,l.data.parentId),m.once("mouseup",()=>{setTimeout(()=>c.updateSelectCheckBoxes(),100)}))):(c.domSelectRow(f),c.checkboxRow&&c.selectCheckBox(f),a&&c.memory.addDirtyParent(l.id,l.data.parentId));else if("$selected"===l.column.index||l.column.select){const t=e.getWidget(e.get(l.cell).select(`.${h}`).attr("id"));t.el.within(C)?!0===t.get()?(c.domDeSelectRow(f),a&&(c.memory.removeDirtyParent(l.id,l.data.parentId),m.once("mouseup",()=>{setTimeout(()=>c.updateSelectCheckBoxes(),100)}))):(c.domSelectRow(f),a&&c.memory.addDirtyParent(l.id,l.data.parentId)):(c.clearSelection(),c.domSelectRow(f),c.checkboxRow&&c.selectCheckBox(f),a&&c.memory.addDirtyParent(l.id,l.data.parentId))}else c.clearSelection(),c.domSelectRow(f),c.checkboxRow&&c.selectCheckBox(f),a&&c.memory.addDirtyParent(l.id,l.data.parentId);c.isMouseDown=!0,c.startRowSelection=f,e.$(document).one("mouseup",function(){delete c.isMouseDown,delete c.startCellSelection}),c.clearActiveCell(),e.get(l.cell).addCls(n),s.fire("select",c.getSelection()),a&&c.updateTreeSelection()},selectCheckBox(l){const o=this,n=o.widget;n.el.select("."+r+" ."+t+'[index="'+l+'"] .'+h).each(t=>{e.getWidget(t.attr("id")).set(!0)}),"rows"===n.selModel&&o.updateHeaderCheckBox()},deSelectCheckBox(l){const o=this,n=o.widget,c=n.store,s=n.el.select("."+r+" ."+t+'[index="'+l+'"] .'+h),i=c.get(l,"id");i&&(o.memory&&o.memory.remove(i),s.each(function(t){e.getWidget(t.attr("id")).set(!1)}),o.updateHeaderCheckBox())},domSelectRow(t){if(this.widget.inited){var l,n=this.widget,c=n.store.get(t,"id"),s=!1;n.startResizing||(this.memory&&(n.sorting||n.filtering||this.deselectingAll||n.draggingRows||this.memory.add(c)),l=n.getDomRow(t),e.each(l,t=>{(t=e.get(t)).hasClass(o)?s=!0:t.addCls(o)}),!1===s&&n.fire("selectrow",t,n.get(t)))}},domDeSelectRow(t){if(this.widget.inited){var l,n=this.widget,c=n.store.get(t,"id"),s=!0;this.memory&&(n.filtering||this.deselectingAll||n.draggingRows||n.sorting||this.memory.remove(c)),l=n.getDomRow(t),e.each(l,t=>{(t=e.get(t)).hasClass(o)?t.removeCls(o):s=!1}),s&&n.fire("deselectrow",t,n.get(t))}},onColumnEnterSelection(e,t){const l=this,o=l.widget;if(!l.columns||!0!==l.isMouseDown)return;const n={columnIndex:l.startColumnColumnIndex,side:l.startColumnSide},c={columnIndex:t.columnIndex,side:t.side};if(n.side===c.side){switch(n.side){case"center":l.clearSelection("right"),l.clearSelection("left");break;case"left":l.clearSelection("center"),l.clearSelection("right");break;case"right":l.clearSelection("center"),l.clearSelection("left")}l.selectColumns(n.columnIndex,c.columnIndex,n.side)}else"center"===n.side&&"right"===c.side?(l.selectColumns(n.columnIndex,o.columns.length,"center"),l.selectColumns(0,c.columnIndex,"right")):"center"===n.side&&"left"===c.side?(l.selectColumns(0,n.columnIndex,"center"),l.selectColumns(c.columnIndex,o.leftColumns.length,"left")):"left"===n.side&&"center"===c.side?(l.clearSelection("right"),l.selectColumns(n.columnIndex,o.leftColumns.length,"left"),l.selectColumns(0,c.columnIndex,"center")):"left"===n.side&&"right"===c.side?(l.selectColumns(n.columnIndex,o.leftColumns.length,"left"),l.selectColumns(0,o.columns.length,"center"),l.selectColumns(0,c.columnIndex,"right")):"right"===n.side&&"center"===c.side?(l.clearSelection("left"),l.selectColumns(0,n.columnIndex,"right"),l.selectColumns(c.columnIndex,o.columns.length,"center")):"right"===n.side&&"left"===c.side&&(l.selectColumns(0,n.columnIndex,"right"),l.selectColumns(0,o.columns.length,"center"),l.selectColumns(c.columnIndex,o.leftColumns.length,"left"));l.clearActiveCell()},onRowEnterSelection(t,l){const o=this,c=o.widget;if(!1!==l&&!c.startResizing&&!1!==o.enabled&&o.rows&&!0===o.isMouseDown&&o.mouseMoveSelection){var s=o.startRowSelection,r=l.rowIndex,i={};s>r&&(s=l.rowIndex,r=o.startRowSelection);for(var d=s,a=r+1;d<a;d++)i[d]=!0;var m=o.getSelectedRowByColumn(l.columnIndex,l.side),u={},g={};for(var h in i)!0!==m[h]&&(u[h]=!0);for(var h in m)!0!==i[h]&&(g[h]=!0);for(var h in u)o.domSelectRow(h),o.checkboxRow&&o.selectCheckBox(h);for(var h in g)o.domDeSelectRow(h),o.checkboxRow&&o.deSelectCheckBox(h);o.clearActiveCell(),e.get(l.cell).addCls(n),c.fire("select",o.getSelection())}},getSelectedRowByColumn(e,t){var l,o=this.widget;switch(t){case"left":l=o.leftBody;break;case"center":l=o.body;break;case"right":l=o.rightBody}const n={};return l.el.select(`.${c}[index="${e}"][grid="${o.id}"]`).select(y).each(e=>{n[Number(e.attr("index"))]=!0}),n},getSelectedRow(){const e=this.widget.body.el.select(y);return 0===e.length?-1:Number(e.item(0).attr("index"))},getSelectedRows(){const e=this.widget,t=[];return e.body.el.select("."+c+'[index="0"][grid="'+e.id+'"]').select(y).each(function(e){t.push(Number(e.attr("index")))}),t},initColumnSelection(){const e=this,t=e.widget;e.selectedColumns=[],t.on("columnclick",e.onColumnClick,e),t.on("columnmousedown",e.onColumnMouseDown,e),t.on("columnenter",e.onColumnEnterSelection,e)},onColumnClick(t,l){const o=this;if(!o.column||!1===l.column.selectable)return;const c=e.get(l.columnDom);o.column&&(o.selectedColumns[0]=l),o.clearSelection(),c.addCls(i),e.get(l.cell).addCls(n)},onRowClick(t,l){const c=this,s=c.widget,r=l.rowIndex,i=e.get(l.e.target);if(c.disabled)return;if(!c.row||!1===l)return;if(c.checkOnly&&"$selected"!==l.column.index&&!l.column.select)return;if(c.selectLeafsOnly&&!l.data.leaf)return;var d=l.column,a=!0;if("tree"===d.type&&i.hasCls(u))return;"action"===d.type&&d.items&&e.each(d.items,e=>{"remove"===e.action&&(a=!1)});const m=e.get(l.cell).hasClass(o);if("$selected"===l.column.index||l.column.select){const t=e.getWidget(e.get(l.cell).select("."+h).attr("id")),o=t.get();if(t.el.within(i))c.clearSelection(),!0===o?(c.selectCheckBox(r),c.domSelectRow(r)):c.deSelectCheckBox(r);else{if(c.checkOnly)return;c.clearSelection(),!0!==o?(c.selectCheckBox(r),c.domSelectRow(r)):c.deSelectCheckBox(r)}s.fire("select",c.getSelection())}else a&&(c.clearSelection(),c.allowDeselect&&m||(c.domSelectRow(r),c.selectCheckBox(r)),s.fire("select",c.getSelection()));e.get(l.cell).addCls(n)},onCellClickRows(t,l){const o=this,n=o.widget;if(o.disabled)return;if(!o.rows||!o.enabled)return;if(o.checkOnly&&"$selected"!==l.column.index&&!l.column.select)return;const c=l.e.ctrlKey,s=l.rowIndex;if((c||o.allowDeselect)&&n.multiSelect);else if("$selected"===l.column.index||l.column.select){const t=e.getWidget(e.get(l.cell).select("."+h).attr("id"));!0!==t.middle&&(!0===t.get()?o.selectCheckBox(s):o.deSelectCheckBox(s))}},selectRow(l,o,n,s){const r=this,i=r.widget,d=i.leftBody,a=i.body,m=i.rightBody;if(void 0===o&&(o=!0),n=n||!1,!i.startResizing){if(!r.row&&!r.rows)throw new Error("[FancyGrid Error] - row selection was not enabled");n||r.clearSelection(),o?r.domSelectRow(l):r.domDeSelectRow(l),e.each(i.columns,(e,n)=>{if("select"===e.type||e.select){const e=a.el.select("."+c+'[index="'+n+'"] .'+t+'[index="'+l+'"] .'+h),s=Fancy.getWidget(e.attr("id"));s&&s.set(o)}}),e.each(i.leftColumns,(e,n)=>{if("select"===e.type||e.select){const e=d.el.select("."+c+'[index="'+n+'"] .'+t+'[index="'+l+'"] .'+h),s=Fancy.getWidget(e.attr("id"));s&&s.set(o)}}),e.each(i.rightColumns,(e,n)=>{if("select"===e.type||e.select){const e=m.el.select("."+c+'[index="'+n+'"] .'+t+'[index="'+l+'"] .'+h),s=Fancy.getWidget(e.attr("id"));s&&s.set(o)}}),!1!==s&&i.fire("select",r.getSelection())}},selectById(e,t,l){var o=this,n=o.widget,c=n.find("id",String(e))[0];void 0!==c?o.selectRow(c,t,l):void 0!==(c=n.find("id",Number(e))[0])?o.selectRow(c,t,l):o.memory&&(!0===t||void 0===t?o.memory.add(e):o.memory.remove(e))},onCellClick(t,l){const c=this.widget;this.cell&&(this.clearSelection(),e.get(l.cell).addCls(o,n),c.fire("select",this.getSelection()))},clearSelection(e){const n=this,c=n.widget;if(n.checkboxRow){const e={};c.el.select("."+r+" ."+C).each(l=>{const o=l.closest("."+t).attr("index");e[o]||(e[o]=!0,n.deSelectCheckBox(o))})}if(n.memory&&n.memory.clearAll(),e)switch(e){case"left":c.leftBody.el.select(y).removeCls(o),c.leftBody.el.select("."+i).removeCls(i),c.leftBody.el.select("."+l).removeCls(l);break;case"center":c.body.el.select(y).removeCls(o),c.body.el.select("."+i).removeCls(i),c.body.el.select("."+l).removeCls(l);break;case"right":c.rightBody.el.select(y).removeCls(o),c.rightBody.el.select("."+i).removeCls(i),c.rightBody.el.select("."+l).removeCls(l)}else c.el.select(y).removeCls(o),c.el.select("."+i).removeCls(i),c.el.select("."+l).removeCls(l);n.clearActiveCell(),c.fire("clearselect"),c.fire("select",c.getSelection())},onSort(){const e=this;e.clearActiveCell(),e.memory?e.updateSelection():e.clearSelection()},onCellEnterSelection(t,l){var o=this,c=o.widget,s=c.columndrag;if(s&&"dragging"===s.status)return;if(!o.cells||!0!==o.isMouseDown)return;o.prevCellsSelection=l.cell,o.prevCellRowIndex=l.rowIndex,o.prevCellColumnIndex=l.columnIndex,o.prevCellSide=l.side;const r={rowIndex:o.startCellRowIndex,columnIndex:o.startCellColumnIndex,side:o.startCellSide},i={rowIndex:l.rowIndex,columnIndex:l.columnIndex,side:l.side};l.rowIndex<o.startCellRowIndex&&(r.rowIndex=l.rowIndex,i.rowIndex=o.startCellRowIndex),o.startCellSide===l.side?(l.columnIndex<o.startCellColumnIndex&&(r.columnIndex=l.columnIndex,i.columnIndex=o.startCellColumnIndex),o.selectCells(r,i,r.side),"left"===o.startCellSide?(o.clearSelection("center"),o.clearSelection("right")):"center"===o.startCellSide?(o.clearSelection("left"),o.clearSelection("right")):"right"===o.startCellSide&&(o.clearSelection("left"),o.clearSelection("center"))):"left"===o.startCellSide?(o.selectCells(r,{rowIndex:l.rowIndex,columnIndex:c.leftColumns.length-1},"left"),"center"===l.side?(o.selectCells({columnIndex:0,rowIndex:r.rowIndex},i,"center"),o.clearSelection("right")):"right"===l.side&&(o.selectCells({columnIndex:0,rowIndex:r.rowIndex},{columnIndex:c.columns.length-1,rowIndex:i.rowIndex},"center"),o.selectCells({columnIndex:0,rowIndex:r.rowIndex},i,"right"))):"center"===o.startCellSide?"left"===l.side?(o.selectCells({columnIndex:0,rowIndex:r.rowIndex},{rowIndex:i.rowIndex,columnIndex:r.columnIndex},"center"),o.selectCells({columnIndex:i.columnIndex,rowIndex:r.rowIndex},{rowIndex:i.rowIndex,columnIndex:c.leftColumns.length-1},"left")):"right"===l.side&&(o.selectCells({columnIndex:r.columnIndex,rowIndex:r.rowIndex},{columnIndex:c.columns.length-1,rowIndex:i.rowIndex},"center"),o.selectCells({columnIndex:0,rowIndex:r.rowIndex},{columnIndex:i.columnIndex,rowIndex:i.rowIndex},"right")):"right"===o.startCellSide&&(o.selectCells({columnIndex:0,rowIndex:r.rowIndex},{columnIndex:r.columnIndex,rowIndex:i.rowIndex},"right"),"center"===l.side?(o.selectCells({columnIndex:i.columnIndex,rowIndex:r.rowIndex},{columnIndex:c.columns.length-1,rowIndex:i.rowIndex},"center"),o.clearSelection("left")):"left"===l.side&&(o.selectCells({columnIndex:0,rowIndex:r.rowIndex},{columnIndex:c.columns.length-1,rowIndex:i.rowIndex},"center"),o.selectCells({columnIndex:i.columnIndex,rowIndex:r.rowIndex},{columnIndex:c.leftColumns.length-1,rowIndex:i.rowIndex},"left"))),o.endCellRowIndex=i.rowIndex,o.clearActiveCell(),e.get(l.cell).addCls(n),c.fire("select",o.getSelection())},onColumnMouseDown(t,l){const o=this,c=o.widget;if(!o.columns||!1===l.column.selectable||!o.enabled)return;document.activeElement&&document.activeElement.blur();const s=e.get(l.columnDom);o.isMouseDown=!0,o.startColumnColumnIndex=l.columnIndex,o.startColumnSide=l.side,o.clearSelection(),s.addCls(i),e.$(document).one("mouseup",function(){delete o.isMouseDown}),e.get(l.cell).addCls(n),c.fire("select",o.getSelection())},onCellMouseDownCells(t,l){const c=this,s=c.widget;if(s.celledit&&s.celledit.hideEditor(),!c.cells||!c.enabled)return;document.activeElement&&document.activeElement.blur();const r=e.get(l.cell);c.clearSelection(),s.el.select(I).removeCls(n),r.addCls(o,n),c.isMouseDown=!0,c.startCellSelection=l.cell,c.startCellRowIndex=l.rowIndex,c.startCellColumnIndex=l.columnIndex,c.startCellSide=l.side,e.$(document).one("mouseup",function(){delete c.isMouseDown,delete c.startCellSelection}),s.fire("select",c.getSelection())},selectCell(t){const l=this.widget,c=t.id,s=t.index,r=l.getRowById(c),i=l.getColumnOrderByKey(s),d=i.order,a=l.getBody(i.side).getCell(r,d);l.clearSelection(),this.clearActiveCell(),e.get(t.cell).addCls(n),a.addCls(o),l.scroller.scrollToCell(a.dom,!0,t.firstRow)},selectCells(e,t,l){var n,c,s,r=this.widget,i=r.body,d=r.leftBody,a=r.rightBody,m=e.rowIndex,u=t.rowIndex,g=this.getSelectedCells(l||"center"),h={},C={},w={};for(m=e.rowIndex,u=t.rowIndex+1;m<u;m++)for(h[m]=h[m]||{},c=e.columnIndex,s=t.columnIndex+1;c<s;c++)h[m][c]=!0;for(var x in h)if(void 0===g[x])C[x]=h[x];else for(var f in h[x])!0!==g[x][f]&&(C[x]=C[x]||{},C[x][f]=!0);for(var x in g)if(void 0===h[x])w[x]=g[x];else for(var f in g[x])!0!==h[x][f]&&(w[x]=w[x]||{},w[x][f]=!0);switch(l){case"left":n=d;break;case"center":n=i;break;case"right":n=a;break;default:n=i}for(var x in C)for(var f in C[x]){n.getCell(x,f).addCls(o)}for(var x in w)for(var f in w[x]){n.getCell(x,f).removeCls(o)}},getSelectedCells(e="center"){for(var t=this.widget.getBody(e).el.select(y),l={},o=0,n=t.length;o<n;o++){var c=t.item(o),s=Number(c.parent().attr("index")),r=Number(c.attr("index"));l[r]=l[r]||{},l[r][s]=!0}return l},getNumberSelectedCells(){return this.widget.el.select(y).length},getSelectedColumns(e){for(var t={},l=this.widget.getBody(e).el.select("."+i),o=0,n=l.length;o<n;o++)t[l.item(o).attr("index")]=!0;return t},selectColumns(e,t,l){var o=this.getSelectedColumns(l||"center"),n={},c={},s={},r=e,i=t;for(i<r&&(r=t,i=e),i++;r<i;r++)n[r]=!0;for(var d in n)!0!==o[d]&&(c[d]=!0);for(var d in o)!0!==n[d]&&(s[d]=!0);for(var d in c)this.selectColumn(d,l);for(var d in s)this.deselectColumn(d,l)},selectColumn(t,l="center"){const o=this.widget.getBody(l);e.get(o.getDomColumn(t)).addCls(i)},deselectColumn(t,l="center"){const o=this.widget.getBody(l);e.get(o.getDomColumn(t)).removeCls(i)},getSelection(t){var l,o=this,n=o.widget,c=n.store,s={};switch(o.selModel){case"row":s.row=o.getSelectedRow(),-1!==s.row?(s.items=[c.get(s.row)],s.rows=[s.row]):(s.items=[],s.rows=[]);break;case"rows":if(s.rows=o.getSelectedRows(),o.memory&&o.memory.all)l=o.memory.excepted,c.filteredDataMap?s.items=Fancy.Array.copy(c.filteredData):s.items=Fancy.Array.copy(c.data);else if(s.items=[],o.memory&&!Fancy.Object.isEmpty(o.memory.selected)){var r=o.memory.selected;if(c.filteredDataMap)for(var i in r)c.filteredDataMap[i]&&s.items.push(c.getById(i));else for(var i in r){var d=c.getById(i);d?s.items.push(d):s.items.push(o.memory.selected[i])}}else for(var a=0,m=s.rows.length;a<m;a++)s.items.push(c.get(s.rows[a]));break;case"cells":if(s.items=o.getSelectedData(),t){var u=n.el.select(y);u.length>1?(s.nodes=[],e.each(u.dom,function(t){s.nodes.push(o.getNodeInfo(new e.Element(t)))})):1===u.length?s.nodes=[this.getNodeInfo(u)]:s.nodes=[]}break;case"cell":if(s.items=o.getSelectedData(),t){var g=n.el.select(y);g.length?s.nodes=[this.getNodeInfo(g)]:s.nodes=[]}}if(l){var h=[];e.each(s.items,(t,o)=>{e.isObject(t.data)&&(s.items[o]=t.data);var n=s.items[o].id;l[n]||h.push(s.items[o])}),s.items=h}else e.each(s.items,(t,l)=>{t&&e.isObject(t.data)&&(s.items[l]=t.data)});return t?s:s.items||[]},renderHeaderCheckBox(){const e=this,t=this.widget;t.header&&(e._renderHeaderCheckBox(t.leftHeader,t.leftColumns),e._renderHeaderCheckBox(t.header,t.columns),e._renderHeaderCheckBox(t.rightHeader,t.rightColumns))},_renderHeaderCheckBox(t,l){const o=this,n=o.widget,c=o.memory,s=n.getSelection();e.each(l,(l,r)=>{if(("$selected"===l.index||l.select)&&!1!==l.headerCheckBox){const d=t.getCell(r);d.addCls(a);const u=d.firstChild(),g=!o.disabled,C=d.select("."+m);if(l.select?C.update(l.title||""):C.update(""),u.select("."+h).length)e.getWidget(u.select("."+h).item(0).attr("id")).destroy();var i=!1;o.memory?c.all&&(i=!0):s.length===n.getViewTotal()&&0!==s.length&&(i=!0),l.headerCheckBox=new e.CheckBox({renderTo:u.dom,renderBefore:l.select?C:void 0,renderId:!0,value:i,label:!1,editable:g,disabled:o.disabled,style:{padding:"0px",display:"inline-block"},events:[{change(e,t){t?(c&&c.setAll(),o.selectAll()):(c&&c.clearAll(),o.deSelectAll()),o.updateHeaderCheckBox()}}]})}})},selectAll(){var l=this,o=l.widget,n=o.store,c=o.el.select("."+a+" ."+h),s=0,i=o.getViewTotal();for(l.memory&&n.isTree&&(l.memory.tree.selected={},l.memory.tree.allSelected={},l.memory.tree.selectedLength={},l.updateTreeSelection()),l.selectingAll=!0;s<i;s++){for(var d=o.el.select("."+r+" ."+t+'[index="'+s+'"] .'+h),m=0,u=d.length;m<u;m++){e.getWidget(d.item(m).attr("id")).setValue(!0)}l.domSelectRow(s)}c.each(t=>{e.getWidget(t.attr("id")).setValue(!0,!1)}),o.fire("select",o.getSelection()),setTimeout(()=>{delete l.selectingAll},1)},deSelectAll(){var l=this,o=l.widget,n=o.store,c=0,s=o.getViewTotal();for(l.memory&&n.isTree&&(l.memory.tree.selected={},l.memory.tree.allSelected={},l.memory.tree.selectedLength={},l.updateTreeSelection()),l.deselectingAll=!0;c<s;c++){o.el.select("."+r+" ."+t+'[index="'+c+'"] .'+h).each(t=>{e.getWidget(t.attr("id")).setValue(!1)}),l.domDeSelectRow(c)}l.updateHeaderCheckBox(),o.fire("clearselect"),o.fire("select",o.getSelection()),delete l.deselectingAll},updateHeaderCheckBox(){const t=this,l=t.widget,o=l.getTotal();l.el.select(`.${a} .${h}`).each(l=>{const n=e.getWidget(l.attr("id"));t.memory?t.memory.selectedLength>0||t.memory.all?t.memory.selectedLength===o?(n.setValue(!0,!1),n.setMiddle(!1)):t.memory.all&&0===t.memory.exceptedLength?(n.setValue(!0,!1),n.setMiddle(!1)):(n.setMiddle(!0),n.setValue(!1,!1)):(n.setMiddle(!1),n.setValue(!1,!1)):t.selectingAll?n.setValue(!0,!1):n.setValue(!1,!1)})},stopSelection(){this.enabled=!1},enableSelection(e){const t=this;!0===t.disabled&&t.enableHeaderCheckBoxes(),t.disabled=!1,t.disabled=!1,this.enabled=void 0===e||e},initFixTrackOver(){const e=this,t=e.widget;t.columns&&(t.body.el.on("mouseleave",e.onBodyMouseLeave,e),t.body.el.on("mouseenter",e.onBodyMouseEnter,e)),t.leftColumns&&(t.leftBody.el.on("mouseleave",e.onLeftBodyMouseLeave,e),t.leftBody.el.on("mouseenter",e.onLeftBodyMouseEnter,e)),t.rightColumns&&(t.rightBody.el.on("mouseleave",e.onRightBodyMouseLeave,e),t.rightBody.el.on("mouseenter",e.onRightBodyMouseEnter,e))},onBodyMouseLeave(){const e=this.widget;this.clearBodyTrackCls(e.body)},onBodyMouseEnter(){const e=this;e.rowTrackFixInBody=!0,setTimeout(()=>{e.rowTrackFixInBody=!1},30)},onLeftBodyMouseLeave(){const e=this.widget;this.clearBodyTrackCls(e.leftBody)},onLeftBodyMouseEnter(){const e=this;e.rowTrackFixInBody=!0,setTimeout(()=>{e.rowTrackFixInBody=!1},30)},onRightBodyMouseLeave(){const e=this.widget;this.clearBodyTrackCls(e.rightBody)},onRightBodyMouseEnter(){const e=this;e.rowTrackFixInBody=!0,setTimeout(()=>{e.rowTrackFixInBody=!1},30)},clearBodyTrackCls(e){const t=this,o=t.widget;o.cellTrackOver&&e.el.select("."+l).removeCls(l),o.trackOver&&(delete e.prevCellOver,clearInterval(t.rowTrackFixInterval),delete t.rowTrackFixInterval,t.rowTrackFixInterval=setTimeout(()=>{t.rowTrackFixInBody||o.el.select("."+d).removeCls(d)},20))},onColumnLock(){let t,l=this,o=l.widget;l.cells||l.cell||l.column||l.columns?l.clearSelection():(t=l.getSelection(!0),e.each(t.rows,e=>{o.selectRow(e,!0,"rows"===o.selModel)},100),setTimeout(()=>{l.renderHeaderCheckBox()},100))},onColumnRightLock(){var t,l=this,o=l.widget;l.cells||l.cell||l.column||l.columns?l.clearSelection():(setTimeout(()=>{t=l.getSelection(!0),e.each(t.rows,e=>{o.selectRow(e,!0,"rows"===o.selModel)})},100),setTimeout(()=>{l.renderHeaderCheckBox()},100))},onUnColumnLock(){var t,l=this,o=l.widget;l.cells||l.cell||l.column||l.columns?l.clearSelection():(setTimeout(()=>{t=l.getSelection(!0),e.each(t.rows,e=>{o.selectRow(e,!0,"rows"===o.selModel)})},100),setTimeout(()=>{l.renderHeaderCheckBox()},100))},disableSelection(){this.disabled=!0,this.enableHeaderCheckBoxes(!1)},enableHeaderCheckBoxes(t){var l=this.widget,o=l.body,n=l.leftBody,s=l.rightBody,r="enable";!1===t&&(r="disable"),e.each(l.columns,(t,l)=>{"select"===t.type&&t.headerCheckBox&&(t.headerCheckBox[r](),o.el.select("."+c+'[index="'+l+'"] .'+h).each(function(t){e.getWidget(t.attr("id"))[r]()}))}),e.each(l.leftColumns,(t,l)=>{"select"===t.type&&t.headerCheckBox&&(t.headerCheckBox[r](),n.el.select("."+c+'[index="'+l+'"] .'+h).each(t=>{e.getWidget(t.attr("id"))[r]()}))}),e.each(l.rightColumns,(t,l)=>{"select"===t.type&&t.headerCheckBox&&(t.headerCheckBox[r](),s.el.select("."+c+'[index="'+l+'"] .'+h).each(t=>{e.getWidget(t.attr("id"))[r]()}))})},onFilter(){const t=this,l=t.widget;t.clearActiveCell(),t.memory||t.clearSelection(),"rows"===t.selModel&&(e.each(l.leftColumns,(o,n)=>{if("select"===o.type){const o=l.leftHeader.getCell(n),c=e.getWidget(o.select("."+h).attr("id"));c&&(t.memory&&t.memory.all||c.set(!1,!1))}}),e.each(l.columns,(o,n)=>{if("select"===o.type){const o=l.header.getCell(n),c=e.getWidget(o.select("."+h).attr("id"));c&&(t.memory&&t.memory.all||c.set(!1,!1))}}),e.each(l.rightColumns,(o,n)=>{if("select"===o.type){const o=l.rightHeader.getCell(n),c=e.getWidget(o.select("."+h).attr("id"));c&&(t.memory&&t.memory.all||c.set(!1,!1))}}))},onExpand(){const e=this;e.clearActiveCell(),e.memory||e.clearSelection()},onCollapse(){const e=this;e.clearActiveCell(),e.memory||e.clearSelection()},getActiveCell(){let e=this.widget,t=e.el.select(I);return t.dom||(t=(t=e.el.select(y)).dom?t.item(0):e.body.getCell(0,0)),t},getActiveCellInfo(e){var t=this.widget;e=e||this.getActiveCell();return{side:t.getSideByCell(e),rowIndex:Number(e.attr("index")),columnIndex:Number(e.parent().attr("index")),value:(e.dom?e.dom.innerHTML:e.innerHTML).replace(/(<([^>]+)>)/gi,"")}},clearActiveCell(){this.widget.el.select(I).removeCls(n)},initCopyEl(){const t=this.widget,l=e.newEl("textarea");l.addCls(x),l.attr("aria-hidden","true"),this.copyEl=e.get(t.el.dom.appendChild(l.dom))},copy(t){var l,o=this,n=o.widget,c=o.copyEl;switch(o.selModel){case"cells":case"cell":var s=o.getSelectedData(t),r="";e.each(s,e=>{r+=e.join("\t")+"\n"}),c.dom.value=r;break;case"rows":case"row":l=o.getSelection();var i=n.getColumns();r="";if(t){const t=[];e.each(i,e=>{switch(e.index){case"$selected":case"$rowdrag":return}switch(e.type){case"action":case"color":case"image":case"rowdrag":case"grossloss":case"progressbar":case"progressdonut":case"hbar":case"sparklineline":case"sparklinebar":case"sparklinetristate":case"sparklinediscrete":case"sparklinebullet":case"sparklinepie":case"sparklinebox":return}t.push(e.index||"")}),r+=t.join("\t")+"\n"}else 0===l.length&&o.activeCell&&(r=o.getActiveCellInfo().value);e.each(l,t=>{const l=[];e.each(i,e=>{switch(e.index){case"$selected":case"$rowdrag":return}switch(e.type){case"action":case"color":case"image":case"rowdrag":case"grossloss":case"progressbar":case"progressdonut":case"hbar":case"sparklineline":case"sparklinebar":case"sparklinetristate":case"sparklinediscrete":case"sparklinebullet":case"sparklinepie":case"sparklinebox":return}var o="";e.smartIndexFn?o=e.smartIndexFn(t):e.index&&(o=t[e.index]),l.push(o)}),r+=l.join("\t")+"\n"}),c.dom.value=r;break;case"columns":case"column":s=[];var d=n.getDataView();const a=function(l){const c=n.getColumns(l),r=o.getSelectedColumns(l);for(const l in r){const o=c[l];t&&(s.push([]),s[0].push(o.title||"")),o.index&&e.each(d,(e,l)=>{t&&l++,void 0===s[l]&&(s[l]=[]),s[l].push(e[o.index])})}};n.leftColumns&&a("left"),n.columns&&a("center"),n.rightColumns&&a("right");r="";e.each(s,e=>{r+=e.join("\t")+"\n"}),c.dom.value=r}c.dom.select(),c.dom.focus(),document.execCommand("copy")},initCopyKeys(){Fancy.get(document).on("keydown",this.onKeyDownCopy,this)},onKeyDownCopy(e){const t=this,l=t.widget,o=e.keyCode,n=Fancy.key;if(!1!==l.activated&&(e.ctrlKey||e.metaKey))switch(o){case n.C:if(l.celledit&&l.celledit.activeEditor)return;if(l.textSelection)return;t.copy();break;case n.V:t.copyEl.dom.value="",t.copyEl.dom.focus(),setTimeout(()=>{t.insertDataFromBuffer()},1)}},insertDataFromBuffer(){const t=this.widget,l=this.getDataFromCopyEl(),o=this.getColumnIdToInsert(l),n=this.getRowIdToInsert(l);e.each(n,(n,c)=>{e.each(o,(e,o)=>{const s=t.getColumnById(e),r=s.index,i=l[c][o];void 0!==r&&!s.smartIndexFn&&s.editable&&t.setById(n,r,i)})})},getRowIdToInsert(e){const t=this,l=t.widget,o=[];if(0===e.length)return[];var n;if(t.activeCell)n=t.getActiveCellInfo();else{const e=l.el.select(y).item(0);n=t.getActiveCellInfo(e)}for(var c=n.rowIndex,s=c+e.length;c<s;c++){const e=l.get(c);if(!e)break;o.push(e.id)}return o},getColumnIdToInsert(e){const t=this,l=t.widget,o=[];if(0===e.length)return[];var n;if(t.activeCell)n=t.getActiveCellInfo();else{const e=l.el.select(y).item(0);n=t.getActiveCellInfo(e)}for(var c=l.getColumns(n.side),s=n.columnIndex,r=s+e[0].length;s<r;s++){const e=c[s];if(void 0===e)break;e.hidden?r++:o.push(e.id)}return o},getDataFromCopyEl(){const t=[],l=this.copyEl.dom.value.split("\n");return""===l[l.length-1]&&l.pop(),e.each(l,l=>{var o=[],n=l.split("\t");1===n.length&&(n=l.split("    ")),e.each(n,e=>o.push(e)),t.push(o)}),t},onColumnDrag(){const e=this;setTimeout(()=>{e.renderHeaderCheckBox()},100)},disableSelectionMove(){this.mouseMoveSelection=!1},getSelectedData(e){const t=this,l=t.widget,o=[];var n=function(n){var c=l.getColumns(n),s=t.getSelectedCells(n),r=0,i=!1;for(var d in s){var a=l.get(d),m=s[d];if(!i&&e){for(var u in o.push([]),m){(g=c[u]).index,o[0].push(g.title||"")}r++,i=!0}for(var u in m){var g=c[u];o[r]||(o[r]=[]),g.index&&o[r].push(a.get(g.index))}r++}};return n("left"),n("center"),n("right"),o},selectNodesChilds(t,l){const o=this,n=o.widget,c=n.getById(t);!1===l&&o.memory&&o.memory.remove(t),c.set("$selected",l);const s=function(c){e.each(c,e=>{if(e.$selected=l,!e.id)return!0;const c=n.getRowById(e.id);void 0!==c&&n.selectRow(c,l,!0),!1===l&&o.memory&&o.memory.remove(t),e.data&&e.data.child&&s(e.data.child)})};s(c.data.child)},clearOverCells(){this.widget.el.select(`.${l}`).removeCls(l)},onDragRows(){this.clearActiveCell()},onRemoveRows(){const e=this;e.rows&&(clearInterval(e._interval),e._interval=setTimeout(()=>{e.updateHeaderCheckBox(),delete e._interval},1))},onTreeExpand(){const e=this,t=e.widget;e.memory?(e.updateSelection(),e.updateTreeSelection()):t.clearSelection()},onTreeCollapse(){const e=this,t=e.widget;e.memory?(e.updateSelection(),e.updateTreeSelection()):t.clearSelection()},updateSelection(){const e=this,t=e.widget,l=t.store,n=t.body;if(e.memory){n.el.select("."+c+'[index="0"] .'+o).each(o=>{var n=o.attr("index"),c=t.get(n),s=c.id;(c=t.infinite?t.get(n+l.infiniteScrolledToRow):t.get(n))?(s=c.id,e.memory.has(s)||e.domDeSelectRow(n)):e.domDeSelectRow(0)});for(const l in e.memory.selected){const o=t.getRowById(l);void 0!==o&&e.domSelectRow(o)}}else if(t.infinite)switch(e.selModel){case"row":case"rows":n.el.select(`.${c}[index="0"] .${o}`).each(t=>{const l=t.attr("index");e.domDeSelectRow(l)})}},updateSelectCheckBoxes(){const l=this,o=l.widget;l.memory&&o.el.select("."+r+" ."+C).each(n=>{const c=n.closest("."+t).attr("index"),s=o.get(c).id;if(!l.memory.has(s)){e.getWidget(n.attr("id")).set(!1,!1),l.domDeSelectRow(c)}})},updateTreeSelection(){const l=this,n=l.widget;for(var s in l.memory.tree.selected){const o=n.getRowById(s),c=n.el.select("."+r+" ."+t+'[index="'+o+'"] .'+h);l.memory.tree.allSelected[s]?c.each(t=>{const n=t.attr("id"),c=e.getWidget(n);setTimeout(()=>{c.set(!0,!1),c.setMiddle(!1),l.memory.add(s),l.domSelectRow(o)},200)}):c.each(t=>{const l=t.attr("id");e.getWidget(l).setMiddle(!0)})}n.el.select("."+c+"."+r+" ."+f).each(c=>{const s=c.closest(`.${t}`),r=s.attr("index"),i=n.get(r,"id"),d=e.getWidget(c.attr("id"));l.memory.tree.selected[i]||(d.setMiddle(!1),l.memory.tree.allSelected[i]?d.setMiddle(!1):d.set(!1,!1)),l.memory.tree.allSelected[i]&&setTimeout(()=>{d.set(!0,!1),d.setMiddle(!1),l.memory.add(i),l.domSelectRow(r)},200),d.hasCls(C)&&(d.removeCls(f),l.domSelectRow(r),l.memory.add(i),l.memory.removeDirtyParent(i)),s.hasCls(o)&&!d.hasCls(C)&&d.set(!0,!1)})},getNodeInfo(e){var t=this.widget,l=e.parent(),o=l.parent().parent(),n="";o.hasCls("fancy-grid-center")?n="center":o.hasCls("fancy-grid-left")?n="left":o.hasCls("fancy-grid-right")&&(n="right");const c=t.getColumns(n);return{side:n,columnIndex:Number(l.attr("index")),index:c[Number(l.attr("index"))].index,column:c[Number(l.attr("index"))],rowIndex:Number(e.attr("index")),cell:e,value:e.select(".fancy-grid-cell-inner").dom.innerHTML}}})}(),function(){const e=Fancy,t=e.GRID_CELL_ACTIVE_CLS,l=e.GRID_CELL_SELECTED_CLS;e.Mixin("Fancy.grid.selection.mixin.Navigation",{initNavigation(){this.addEvents("up","down","left","right"),this.onsNav()},onsNav(){Fancy.get(document).on("keydown",this.onKeyDown,this)},onKeyDown(t){const l=this,o=l.widget,n=t.keyCode,c=Fancy.key;if(!1!==o.activated){if(!l.keyNavigating){e.get(document).once("keyup",()=>delete l.keyNavigating)}if(!(o.celledit&&o.celledit.activeEditor||o.rowedit&&o.rowedit.el&&o.rowedit.isVisible()))switch(n){case c.TAB:break;case c.UP:l.keyNavigating=!0,t.preventDefault(),clearInterval(l.intervalUp),l.intervalUp=setTimeout(()=>{l.moveUp(),delete l.intervalUp},1);break;case c.DOWN:l.keyNavigating=!0,t.preventDefault(),clearInterval(l.intervalDown),l.intervalDown=setTimeout(()=>{l.moveDown(),delete l.intervalDown},1);break;case c.LEFT:l.keyNavigating=!0,t.preventDefault(),l.moveLeft();break;case c.RIGHT:l.keyNavigating=!0,t.preventDefault(),l.moveRight();break;case c.PAGE_UP:t.preventDefault(),l.scrollPageUP();break;case c.PAGE_DOWN:t.preventDefault(),l.scrollPageDOWN();break;case c.HOME:t.preventDefault(),l.scrollHome();break;case c.END:t.preventDefault(),l.scrollEnd();break;case c.SPACE:if(o.celledit&&!o.celledit.activeEditor)if(o.selection&&"cell"===o.selection.selModel||"cells"===o.selection.selModel)if(d=o.selection.getActiveCell()){var s=o.selection.getActiveCellInfo(),r=o.getColumns(s.side);if(s.column=r[s.columnIndex],!0!==s.column.editable)return;switch(s.column.type){case"checkbox":case"switcher":s.cell=d.dom;var i=o.get(s.rowIndex);s.item=i,s.data=i.data,s.column.smartIndexFn?s.value=s.column.smartIndexFn(s.data):s.value=o.store.get(s.rowIndex,s.column.index),o.celledit.edit(s)}}break;case c.ENTER:if(o.celledit&&!o.celledit.activeEditor)if(o.selection&&"cell"===o.selection.selModel||"cells"===o.selection.selModel||o.selection.activeCell)if(d=o.selection.getActiveCell()){s=o.selection.getActiveCellInfo(),r=o.getColumns(s.side);if(s.column=r[s.columnIndex],!0!==s.column.editable)return;switch(s.column.type){case"switcher":case"checkbox":return}s.cell=d.dom;i=o.get(s.rowIndex);s.item=i,s.data=i.data,s.column.smartIndexFn?s.value=s.column.smartIndexFn(s.data):s.value=o.store.get(s.rowIndex,s.column.index),o.celledit.edit(s)}break;case c.BACKSPACE:case c.DELETE:if(o.selection&&("cell"===o.selection.selModel||o.selection.activeCell))if(d=o.selection.getActiveCell()){s=o.selection.getActiveCellInfo(),r=o.getColumns(s.side);if(s.column=r[s.columnIndex],!0!==s.column.editable)return;s.cell=d.dom;i=o.get(s.rowIndex);s.item=i,s.data=i.data,s.value="",o.celledit.edit(s)}break;case c.ESC:case c.ALT:case c.CTRL:case c.SHIFT:case c.CAPS_LOCK:case c.F1:case c.F2:case c.F3:case c.F4:case c.F5:case c.F6:case c.F7:case c.F8:case c.F9:case c.F10:case c.F11:case c.F12:break;default:var d;if(o.startEditByTyping&&o.celledit&&!o.celledit.activeEditor)if(o.selection&&"cell"===o.selection.selModel||"cells"===o.selection.selModel||o.selection.activeCell)if(d=o.selection.getActiveCell()){s=o.selection.getActiveCellInfo(),r=o.getColumns(s.side);if(s.column=r[s.columnIndex],!0!==s.column.editable)return;s.cell=d.dom;i=o.get(s.rowIndex);s.item=i,s.data=i.data,s.value="",o.celledit.edit(s)}}}},moveRight(){var o,n=this,c=n.widget,s=n.getActiveCellInfo(),r=c.getBody(s.side);if(s.columnIndex++,!(o=r.getCell(s.rowIndex,s.columnIndex)).dom)switch(s.side){case"left":c.columns&&(s.columnIndex=0,r=c.getBody("center"),s.side="center",o=r.getCell(s.rowIndex,s.columnIndex));break;case"center":c.rightColumns&&c.rightColumns.length&&(e.each(c.rightColumns,(e,t)=>{if(!e.hidden)return s.columnIndex=t,r=c.getBody("right"),s.side="right",!0}),o=r.getCell(s.rowIndex,s.columnIndex));break;case"right":return}if(o.dom){switch(s.side){case"left":if(c.leftColumns[s.columnIndex].hidden){for(var i=s.columnIndex,d=c.leftColumns.length,a=!1;i<d;i++)if(!c.leftColumns[i].hidden){a=!0,s.columnIndex=i;break}if(!a){s.columnIndex--;for(i=s.columnIndex,d=c.columns.length,a=!1;i<d;i++)if(!c.columns[i].hidden){a=!0,s.columnIndex=i;break}a&&(s.side="center",r=c.getBody(s.side))}o=r.getCell(s.rowIndex,s.columnIndex)}break;case"center":if(c.columns[s.columnIndex].hidden){for(i=s.columnIndex,d=c.columns.length,a=!1;i<d;i++)if(!c.columns[i].hidden){a=!0,s.columnIndex=i;break}if(!a){a=!1;e.each(c.rightColumns,(e,t)=>{if(!e.hidden)return a=!0,s.columnIndex=t,s.side="right",!0}),a?r=c.getBody(s.side):s.columnIndex--}o=r.getCell(s.rowIndex,s.columnIndex)}break;case"right":if(c.rightColumns[s.columnIndex].hidden){for(i=s.columnIndex,d=c.rightColumns.length,a=!1;i<d;i++)if(!c.rightColumns[i].hidden){a=!0,s.columnIndex=i;break}a||s.columnIndex--,o=r.getCell(s.rowIndex,s.columnIndex)}}switch(n.selModel){case"cell":case"cells":n.clearSelection(),o.addCls(t,l),c.scroller.scrollToCell(o.dom,!0);break;case"column":case"columns":c.selection&&c.selection.activeCell?(c.selection.clearActiveCell(),o.addCls(t),c.scroller.scrollToCell(o.dom,!0)):(n.clearSelection(),n.selectColumn(s.columnIndex,s.side),o.addCls(t,l),c.scroller.scrollToCell(o.dom,!0));break;case"row":case"rows":c.selection&&c.selection.activeCell&&(c.selection.clearActiveCell(),o.addCls(t),c.scroller.scrollToCell(o.dom,!0))}return o}},moveLeft(){var e,o,n=this,c=n.widget,s=n.getActiveCellInfo(),r=c.getBody(s.side);if(s.columnIndex--,s.columnIndex<0)switch(s.side){case"left":return;case"center":if(!c.leftColumns||!c.leftColumns.length)return;if(s.columnIndex=c.leftColumns.length-1,r=c.getBody("left"),s.side="left",e=r.getCell(s.rowIndex,s.columnIndex),c.leftColumns[s.columnIndex].hidden)for(var i=s.columnIndex-1,d=!1;i>=0;i--)if(!c.leftColumns[i].hidden){d=!0,s.columnIndex=i;break}e=r.getCell(s.rowIndex,s.columnIndex);break;case"right":if(c.columns&&c.columns.length){for(i=c.columns.length,d=!1;i--;){if(!c.columns[i].hidden){s.columnIndex=i,r=c.getBody("center"),s.side="center",d=!0;break}}if(!d&&c.leftColumns.length)for(i=c.leftColumns.length;i--;){if(!c.leftColumns[i].hidden){s.columnIndex=i,r=c.getBody("left"),s.side="left",d=!0;break}}e=r.getCell(s.rowIndex,s.columnIndex)}}else{switch(s.side){case"left":if(c.leftColumns[s.columnIndex].hidden){for(i=s.columnIndex-1,d=!1;i>=0;i--)if(!c.leftColumns[i].hidden){d=!0,s.columnIndex=i;break}d||s.columnIndex++}break;case"center":if(c.columns[s.columnIndex].hidden){for(i=s.columnIndex-1,d=!1;i>=0;i--)if(!c.columns[i].hidden){d=!0,s.columnIndex=i;break}if(!d&&(s.columnIndex++,c.leftColumns)){for(i=c.leftColumns.length-1,d=!1;i>=0;i--)if(!c.leftColumns[i].hidden){d=!0,s.columnIndex=i;break}d&&(o="left",r=c.getBody(o))}}break;case"right":if(c.rightColumns[s.columnIndex].hidden){for(i=s.columnIndex-1,d=!1;i>=0;i--)if(!c.rightColumns[i].hidden){d=!0,s.columnIndex=i;break}if(!d){s.columnIndex++;i=c.columns.length-1,d=!1;for(o="center",r=c.getBody(o);i>=0;i--)if(!c.columns[i].hidden){d=!0,s.columnIndex=i;break}}}}e=r.getCell(s.rowIndex,s.columnIndex)}if(e.dom)switch(n.selModel){case"cell":case"cells":n.clearSelection(),e.addCls(t,l),c.scroller.scrollToCell(e.dom,!0);break;case"column":case"columns":c.selection&&c.selection.activeCell?(c.selection.clearActiveCell(),e.addCls(t),c.scroller.scrollToCell(e.dom,!0)):(n.clearSelection(),n.selectColumn(s.columnIndex,s.side),e.addCls(t,l),c.scroller.scrollToCell(e.dom,!0));break;case"row":case"rows":c.selection.clearActiveCell(),e.addCls(t),c.scroller.scrollToCell(e.dom,!0)}},moveUp(){var e,o=this,n=o.widget,c=n.store,s=o.getActiveCellInfo(),r=n.getBody(s.side);if(n.infinite&&0===s.rowIndex){var i=c.infiniteScrolledToRow-1;i<0&&(i=0),c.infiniteScrolledToRow=i,n.update(),n.selection&&n.selection.updateSelection()}if(s.rowIndex--,!(s.rowIndex<0)&&(e=r.getCell(s.rowIndex,s.columnIndex)).dom){switch(o.selModel){case"cell":case"cells":o.clearSelection(),e.addCls(t,l),n.infinite||n.scroller.scrollToCell(e.dom,!0);break;case"row":case"rows":n.selection&&n.selection.activeCell?(n.selection.clearActiveCell(),e.addCls(t),n.infinite||n.scroller.scrollToCell(e.dom,!0)):(o.clearSelection(),o.selectRow(s.rowIndex),e.addCls(t,l),n.infinite||n.scroller.scrollToCell(e.dom,!0),"rows"===o.selModel&&o.updateHeaderCheckBox());break;case"column":case"columns":n.selection&&n.selection.activeCell&&(n.selection.clearActiveCell(),e.addCls(t),n.infinite||n.scroller.scrollToCell(e.dom,!0))}return e}},moveDown(){var e,o=this,n=o.widget,c=n.store,s=o.getActiveCellInfo(),r=n.getBody(s.side);if(n.infinite&&s.rowIndex>n.numOfVisibleCells-3){var i=c.infiniteScrolledToRow+1;return i>c.getNumOfInfiniteRows()-(n.numOfVisibleCells-1)&&(i=c.getNumOfInfiniteRows()-(n.numOfVisibleCells-1)),c.infiniteScrolledToRow=i,n.update(),void(n.selection&&n.selection.updateSelection())}if(s.rowIndex++,(e=r.getCell(s.rowIndex,s.columnIndex)).dom){switch(o.selModel){case"cell":case"cells":o.clearSelection(),e.addCls(t,l),n.infinite||n.scroller.scrollToCell(e.dom,!0);break;case"row":case"rows":n.selection&&n.selection.activeCell?(n.selection.clearActiveCell(),e.addCls(t),n.infinite||n.scroller.scrollToCell(e.dom,!0)):(o.clearSelection(),o.selectRow(s.rowIndex),e.addCls(t,l),n.infinite||n.scroller.scrollToCell(e.dom,!0),"rows"===o.selModel&&o.updateHeaderCheckBox());break;case"column":case"columns":n.selection&&n.selection.activeCell&&(n.selection.clearActiveCell(),e.addCls(t),n.scroller.scrollToCell(e.dom,!0))}return e}},scrollPageUP(){var e,t=this.widget,l=parseInt(t.body.el.height()),o=t.scroller;(e=t.nativeScroller?t.body.el.dom.scrollTop-l:o.scrollTop-l)<0&&(e=0),t.scroll(e)},scrollPageDOWN(){var e,t=this.widget,l=t.gridBorders,o=t.getBodyHeight()-l[0]-l[2],n=t.getCellsViewHeight()-l[0]-l[2],c=t.scroller;(e=t.nativeScroller?t.body.el.dom.scrollTop+o:c.scrollTop+o)>n-o&&(e=n-o),e<0&&(e=0),t.scroll(e)},scrollHome(){this.widget.scroll(0)},scrollEnd(){this.widget.scroll(1e6)}})}();