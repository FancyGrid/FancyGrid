Fancy.modules.dd=!0,function(){const e=Fancy,o=e.GRID_BODY_CLS,t=e.GRID_CLS,r=e.GRID_CELL_CLS;e.define("Fancy.grid.plugin.GridToGrid",{extend:e.Plugin,ptype:"grid.dragdrop",inWidgetName:"dragdrop",dropOK:!1,cellMaskCls:"fancy-drop-cell-mask",dropZoneCls:"fancy-drop-zone-active",dropOkCls:"fancy-drop-ok",dropNotOkCls:"fancy-drop-not-ok",dropHeaderMaskCls:"fancy-drop-header-mask",droppable:!0,dropZoneOverClass:o,constructor:function(){this.Super("const",arguments)},init(){const e=this;e.addEvents("drop"),e.Super("init",arguments),e.initDropCls(),e.initEnterLeave(),e.ons()},initDropCls(){let e=`.${this.dropGroup}`;e+=` .${this.dropZoneOverClass}`,this.dropCls=e},addDragDropCls(){this.widget.el.addCls(this.dragGroup)},ons(){const e=this,o=e.widget;o.on("render",function(){e.addDragDropCls()}),e.dropGroup&&(o.on("beforecellmousedown",e.onBeforeCellMouseDown,e),o.on("cellmousedown",e.onCellMouseDown,e),o.on("cellleave",e.onCellLeave,e),o.on("cellenter",e.onCellEnter,e)),e.on("drop",e.onDropItems,e)},onDropItems(e,o){const t=this,r=t.widget,i=t.dropGrid,d=void 0===i.activeRowEnterIndex?i.getViewTotal():i.activeRowEnterIndex;r.fire("dropitems",o,d),t.onDrop&&t.onDrop.apply(r,[o,d])},onBeforeCellMouseDown(o,t){var r=this,i=r.widget,d=i.lang,n=e.get(document),s=i.getSelection();if((!t.e.ctrlKey||!0!==i.multiSelect)&&s.length>1){var l=!1;if(e.each(s,e=>{if(e.id===t.id)return l=!0,!0}),!1===l)return;i.stopSelection(),n.once("mouseup",r.onDocMouseUp,r),n.on("mousemove",r.onDocMouseMove,r),n.once("mouseup",()=>{i.enableSelection()},r),s=i.getSelection();const o=e.String.format(d.dragText,[s.length,s.length>1?"s":""]);r.initTip(o),r.dragItems=i.getSelection(),r.cellMouseDown=!0}},onCellMouseDown(o,t){const r=this,i=r.widget,d=e.get(document);!1!==i.selection.enabled&&(t.e.ctrlKey&&!0===i.multiSelect||("$selected"===t.column.index||i.clearSelection(),d.once("mouseup",r.onDocMouseUp,r),d.on("mousemove",r.onDocMouseMove,r),r.cellMouseDown=!0,r.activeRowIndex=t.rowIndex))},initEnterLeave(){const o=this,t=e.select(o.dropCls);0!==t.length?(t.on("mouseenter",o.onMouseEnterDropGroup,o),t.on("mouseleave",o.onMouseLeaveDropGroup,o)):setTimeout(()=>{o.initEnterLeave()},500)},onMouseEnterDropGroup(o){const r=this;if(!r.cellMouseDown)return;const i=e.get(o.currentTarget);if(r.dropGrid=e.getWidget(i.closest(`.${t}`).attr("id")),r.dropGrid&&r.dropGrid.dragdrop&&!1===r.dropGrid.dragdrop.droppable)return r.dropOK=!1,void(r.tip&&r.tip.el.replaceClass(r.dropOkCls,r.dropNotOkCls));r.setDropGridCellsMask(),r.dropGridEventInited||r.onsDropGrid(),i.addCls(r.dropZoneCls),r.dropOK=!0,r.tip&&r.tip.el.replaceClass(r.dropNotOkCls,r.dropOkCls)},onMouseLeaveDropGroup(o){const t=this;t.cellMouseDown&&(e.get(o.currentTarget).removeCls(t.dropZoneCls),t.dropOK=!1,t.tip.el.replaceClass(t.dropOkCls,t.dropNotOkCls),t.clearCellsMask())},setDropGridCellsMask(){var e,o=this.dropGrid;o&&this.cellMouseDown&&(0===(e=o.getTotal())?o.el.addCls(this.dropHeaderMaskCls):o.el.select("."+r+'[index="'+(e-1)+'"]').addCls(this.cellMaskCls))},onsDropGrid(){const e=this;e.dropGrid.on("rowenter",e.onDropGridRowEnter,e),e.dropGrid.on("rowleave",e.onDropGridRowLeave,e),e.dropGridEventInited=!0},onDropGridRowEnter(e,o){const t=this;!1===t.cellMouseDown&&(t.dropGrid.un("rowenter",t.onDropGridRowEnter),t.dropGrid.un("rowleave",t.onDropGridRowLeave)),t.clearCellsMask(),0===o.rowIndex?e.el.addCls(t.dropHeaderMaskCls):e.el.select("."+r+'[index="'+(o.rowIndex-1)+'"]').addCls(t.cellMaskCls),!1===t.cellMouseDown&&t.clearCellsMask(),t.dropGrid&&(t.dropGrid.activeRowEnterIndex=o.rowIndex)},onDropGridRowLeave(){const e=this;e.clearCellsMask(),e.setDropGridCellsMask(),e.dropGrid&&delete e.dropGrid.activeRowEnterIndex},clearCellsMask(){const e=this,o=e.cellMaskCls;e.dropGrid&&(e.dropGrid.el.removeCls(e.dropHeaderMaskCls),e.dropGrid.el.select(`.${o}`).removeCls(o))},onDocMouseUp(){const o=this,t=o.widget,r=e.get(document);o.cellMouseDown=!1,o.tip&&o.tip.hide(),t.enableSelection(),r.un("mousemove",o.onDocMouseMove),!0===o.dropOK&&(t.clearSelection(),o.dropGrid.clearSelection(),o.fire("drop",o.dragItems)),delete o.dragItems,o.dropOK=!1,e.select(`.${o.dropZoneCls}`).removeCls(o.dropZoneCls),o.clearCellsMask(),o.dropGrid&&(o.dropGrid.un("rowenter",o.onDropGridRowEnter),o.dropGrid.un("rowleave",o.onDropGridRowLeave)),delete o.dropGridEventInited},onDocMouseMove(e){this.dragItems&&this.tip.show(e.pageX+20,e.pageY+20)},onCellLeave(o,t){const r=this,i=r.widget,d=i.lang;setTimeout(()=>{if(r.onceStopDrag)return void(r.onceStopDrag=!1);if(!0!==r.cellMouseDown||r.dragItems)return;const o=i.getSelection(),n=e.String.format(d.dragText,[o.length,o.length>1?"s":""]);i.stopSelection(),r.initTip(n,t.e),r.tip.show(),r.tip.el.css("display","block"),r.dragItems=o},1)},onCellEnter(e,o){const t=this;!0!==t.cellMouseDown||t.dragItems||o.rowIndex!==t.activeRowIndex&&(t.onceStopDrag=!0,t.activeRowIndex=o.rowIndex)},initTip(o,t){const r=this,i=r.dropNotOkCls;r.tip||(r.tip=new e.ToolTip({cls:i,text:o})),t&&r.tip.show(t.pageX+20,t.pageY+20),r.tip.update(o),r.tip.el.replaceClass(r.dropOkCls,i)}})}(),function(){const e=Fancy;e.define("Fancy.DragRowsManager",{singleton:!0,constructor:function(){this.draggingRows=[]},add(e,o){const t=this,r=Fancy.get(document);t.activeGrid=e,t.draggingRows=o,r.on("mouseenter",t.onMouseEnterGrid,t,`.${Fancy.GRID_CLS}`),t.activeGrid.dropZone&&t.activeGrid.el.on("mouseleave",t.onMouseLeaveActiveGrid,t)},remove(){const e=this,o=Fancy.get(document);e.activeGrid&&e.activeGrid.dropZone&&o.un("mousemove",e.onMouseMoveOutSideActiveGrid),delete e.activeGrid,delete e.draggingRows,delete e.toGrid,delete e.droppable,delete e.dropOutSideRowIndex,o.un("mouseenter",e.onMouseEnterGrid)},onMouseEnterGrid(o){const t=this,r=Fancy.get(o.currentTarget);if(r.id!==t.activeGrid.el.id){if(t.toGrid?t.toGrid.id!==r.id&&(t.toGrid=Fancy.getWidget(r.id)):t.toGrid=Fancy.getWidget(r.id),!t.toGrid)return!0;if(!0===t.toGrid.droppable||e.isFunction(t.toGrid.droppable)&&!0===t.toGrid.droppable(t.activeGrid,t.draggingRows)){t.droppable=!0;const o=Fancy.get(document);e.nojQuery?t.toGrid.el.on("mouseleave",t.onMouseLeaveGrid,t):o.once("mouseleave",t.onMouseLeaveGrid,t,"#"+t.toGrid.id),setTimeout(()=>{if(void 0===t.dropOutSideRowIndex&&t.toGrid){const e=t.toGrid.store.getDataView().length-1;t.toGrid.rowdragdrop.activeRowIndex=e+1,t.toGrid.rowdragdrop.insertItem=t.toGrid.get(e+1),t.dropOutSideRowIndex=e+1,t.toGrid.rowdragdrop.showCellsDropMask()}},100)}}},onMouseLeaveGrid(){const o=this;e.nojQuery&&o.toGrid&&o.toGrid.el.un("mouseleave",o.onMouseLeaveGrid,o),delete o.droppable,delete o.toGrid,delete o.dropOutSideRowIndex},onMouseLeaveActiveGrid(){const e=this,o=Fancy.get(document);e.activeGrid&&e.activeGrid.el&&(o.on("mousemove",e.onMouseMoveOutSideActiveGrid,e),e.activeGrid.el.on("mouseenter",function(){o.un("mousemove",e.onMouseMoveOutSideActiveGrid)}))},onMouseMoveOutSideActiveGrid(o){var t=this,r=o.target,i=r.tagName.toLocaleLowerCase();if(!t.dropEl){switch(i){case"html":case"document":case"body":return}t.hoverEl!==r&&(t.hoverEl=r,t.activeGrid.dropZone(t.hoverEl)?(t.dropEl=e.get(t.hoverEl),t.dropEl.once("mouseleave",()=>{delete t.dropEl,delete t.hoverEl,t.activeGrid&&(t.activeGrid.rowdragdrop.dropOK=!1)}),t.activeGrid.rowdragdrop.dropOK=!0):t.activeGrid.rowdragdrop.dropOK=!1)}}})}(),function(){const e=Fancy,o=e.DragRowsManager,t=e.GRID_BODY_CLS,r=e.GRID_COLUMN_CLS,i=e.GRID_CELL_CLS,d=e.GRID_CELL_SELECTED_CLS;e.define("Fancy.grid.plugin.RowDragDrop",{extend:e.Plugin,ptype:"grid.rowdragdrop",inWidgetName:"rowdragdrop",dropOK:!1,cellMaskCls:"fancy-drop-cell-mask",cellFirstRowMaskCls:"fancy-drop-cell-first-mask",dropZoneCls:"fancy-drop-zone-active",dropOkCls:"fancy-drop-ok",dropNotOkCls:"fancy-drop-not-ok",droppable:!0,dropZoneOverClass:t,tipShown:!1,constructor:function(){this.Super("const",arguments)},init(){const e=this;e.Super("init",arguments),e.addEvents("drop","start","dropoutside"),e.ons(),e.initDropCls(),e.initEnterLeave()},ons(){const e=this,o=e.widget;o.on("beforecellmousedown",e.onBeforeCellMouseDown,e),o.on("cellmousedown",e.onCellMouseDown,e),o.on("rowenter",e.onRowEnter,e),o.on("rowleave",e.onRowLeave,e,null,100),e.on("drop",e.onDrop,e),e.on("dropoutside",e.onDropOutSide,e),e.on("start",e.onStart,e)},disableSelectionMove(){this.widget.selection.disableSelectionMove()},showTip(e){var o=this,t=o.widget;0!==(o.singleRowToDrag?[o.singleRowToDrag.data]:t.getSelection()).length&&(o.tip||o.initTip(),o.updateTipText(),e&&o.tip.show(e.pageX+20,e.pageY+20),o.tipShown=!0)},hideTip(){const e=this;e.tip&&e.tip.hide(),e.tipShown=!1},onCellMouseDown(o,t){const r=e.get(document),i=e.get(t.e.target).dom.tagName.toLocaleLowerCase();"svg"!==i&&"path"!==i||(this.cellMouseDown=e.get(t.cell),r.once("mouseup",this.onDocMouseUp,this))},onDocMouseUp(){const t=this,r=t.widget,i=e.get(document);t.cellMouseDown=!1,t.mouseDownDragEl=!1,delete t.tipValue,t.tipShown&&(i.un("mousemove",t.onDocMouseMove),t.hideTip(),t.clearCellsMask(),t.dropOK?t.fire("drop"):o.droppable&&t.fire("dropoutside"),t.tipShown=!1),r.selection&&(setTimeout(()=>{r.selection.clearOverCells()},1),r.enableSelection()),o.remove(),delete t.singleRowToDrag},onRowEnter(t,r){const i=this,n=i.widget,s=i.singleRowToDrag?[i.singleRowToDrag.data]:n.getSelection();if(o.droppable&&o.toGrid.id===n.id)o.dropOutSideRowIndex=r.rowIndex;else if(!(i.cellMouseDown&&0!==s.length&&i.tipShown||i.singleRowToDrag))return;if(0!==r.rowIndex){var l=r.rowIndex-1;if(i.singleRowToDrag&&(i.singleRowToDrag.rowIndex===l||i.singleRowToDrag.rowIndex===r.rowIndex)||n.body.getCell(l,0).hasClass(d)&&!i.singleRowToDrag)return i.dropOK=!1,i.clearCellsMask(),void delete i.activeRowIndex;if(i.singleRowToDrag&&(r.rowIndex===i.singleRowToDrag.rowIndex||l===i.singleRowToDrag.rowIndex)||!i.singleRowToDrag&&n.body.getCell(r.rowIndex,0).hasClass(d)&&1===s.length)return i.dropOK=!1,i.clearCellsMask(),void delete i.activeRowIndex;if(s.length>1){var a=!0;if(e.each(s,e=>{if(void 0===l)return void(l=n.getRowById(e.id));const o=n.getRowById(e.id);if(l!==o-1)return a=!1,!0;l=o}),a&&n.body.getCell(r.rowIndex,0).hasClass(d))return i.dropOK=!1,i.clearCellsMask(),void delete i.activeRowIndex}i.dropOK=!0;const o=n.get(l);i.insertItem=o}else{if(n.body.getCell(r.rowIndex,0).hasClass(d)){if(!(s.length>1))return i.dropOK=!1,i.clearCellsMask(),void delete i.activeRowIndex;a=!0;if(e.each(s,function(e){if(void 0===l)return void(l=n.getRowById(e.id));const o=n.getRowById(e.id);if(l!==o-1)return a=!1,!0;l=o}),a&&n.body.getCell(r.rowIndex,0).hasClass(d))return i.dropOK=!1,i.clearCellsMask(),void delete i.activeRowIndex;i.dropOK=!0}else i.dropOK=!0;i.insertItem=0}const c=n.selection.memory;if(c&&c.all&&0===c.exceptedLength)return i.dropOK=!1,void delete i.activeRowIndex;i.activeRowIndex=r.rowIndex,i.showCellsDropMask()},initTip(){const o=this,t=o.dropNotOkCls;o.tip||(o.tip=new e.ToolTip({cls:t,text:""}))},updateTipText(){var t=this,r=t.widget,i=r.lang,d=t.singleRowToDrag?[t.singleRowToDrag.data]:r.getSelection(),n=e.String.format(i.dragText,[d.length,d.length>1?"s":""]);t.tipValue&&1===d.length&&"string"===e.typeOf(t.tipValue)&&(n=t.tipValue),t.tip.update(n),d.length&&0!=t.dropOK?t.tip.el.replaceClass(t.dropNotOkCls,t.dropOkCls):o.droppable?t.tip.el.replaceClass(t.dropNotOkCls,t.dropOkCls):t.tip.el.replaceClass(t.dropOkCls,t.dropNotOkCls)},onDocMouseMove(e){const t=this;t.singleRowToDrag||t.cellMouseDown&&t.cellMouseDown.hasClass(d)?(o.activeGrid||t.fire("start"),t.showTip(e)):t.hideTip()},showCellsDropMask(){const e=this,o=e.widget,t=e.activeRowIndex-1;e.clearCellsMask(),-1===t?o.el.select("."+r+'[grid="'+o.id+'"] .'+i+'[index="0"]').addCls(e.cellFirstRowMaskCls):o.el.select("."+r+'[grid="'+o.id+'"] .'+i+'[index="'+t+'"]').addCls(e.cellMaskCls)},clearCellsMask(){const e=this,o=e.widget;o.el.select("."+e.cellMaskCls).removeCls(e.cellMaskCls),o.el.select("."+e.cellFirstRowMaskCls).removeCls(e.cellFirstRowMaskCls)},onStart(){var e,t=this.widget;e=this.singleRowToDrag?[this.singleRowToDrag.data]:t.getSelection(),t.fire("dragstart",e),e.length&&o.add(t,e)},onDrop(){var t,r=this,i=r.widget,d=r.singleRowToDrag?[r.singleRowToDrag.data]:i.getSelection();if(o.dropEl)o.activeGrid.dropZoneFn&&o.activeGrid.dropZoneFn(d);else{if(i.draggingRows=!0,i.selection.memory||i.clearSelection(),i.remove(d,null,!1),0===r.insertItem)t=0;else if(t=i.getRowById(r.insertItem.id)+1,d.length){var n=0;e.each(d,e=>{i.getRowById(e.id)<t&&n++}),t-=n}i.insert(t,d,!1),i.store.changeDataView(),i.update(),i.selection.memory||e.each(d,e=>{const o=i.getRowById(e.id);i.flashRow(o)}),i.fire("dragrows",d,t),delete i.draggingRows,i.enableSelection()}},onDropOutSide(){const e=this.widget,t=this.singleRowToDrag?[this.singleRowToDrag.data]:e.getSelection(),r=o.dropOutSideRowIndex||0;!this.singleRowToDrag&&e.dropOutSideActions&&e.clearSelection(),e.dropOutSideActions&&(e.remove(t,null,!1),e.store.changeDataView(),e.update(),o.toGrid.insert(r,t,!1),o.toGrid.store.changeDataView(),o.toGrid.update()),o.toGrid.rowdragdrop.clearCellsMask(),o.toGrid.fire("dragrows",t,r),e.dropOutSideActions&&o.remove()},onBeforeCellMouseDown(o,t){const r=this,i=Fancy.get(document),n=r.widget,s=e.get(t.e.target);("rowdrag"===t.column.type||t.column.rowdrag)&&(t.column.rowdrag&&(r.tipValue=t.value),("rowdrag"===t.column.type||t.column.rowdrag)&&("svg"!==s.dom.tagName.toLocaleLowerCase()&&"svg"!==s.parent().dom.tagName.toLocaleLowerCase()||(Fancy.get(t.cell).hasClass(d)||(n.selection.row||n.selection.rows,r.singleRowToDrag=t),r.mouseDownDragEl=!0,i.once("mousemove",e=>{r.showTip(e),i.on("mousemove",r.onDocMouseMove,r)}),n.stopSelection())))},initDropCls(){const e="#"+this.widget.id+" ."+this.dropZoneOverClass;this.dropCls=e},initEnterLeave(){const o=this,t=e.select(o.dropCls);0!==t.length?t.on("mouseleave",o.onMouseLeaveDropGroup,o):setTimeout(()=>{o.initEnterLeave()},500)},onMouseLeaveDropGroup(){this.dropOK=!1,this.clearCellsMask()},onRowLeave(e,t){var r=this,i=r.widget,d=i.store.getDataView(),n=t.rowIndex,s=r.activeRowIndex;r.cellMouseDown?n===s&&d.length-1===n&&(r.activeRowIndex=r.activeRowIndex+1,r.showCellsDropMask(),r.insertItem=i.get(n)):o.droppable&&n===(s=o.toGrid.rowdragdrop.activeRowIndex)&&o.toGrid.getDisplayedData().length-1===n&&(o.toGrid.rowdragdrop.activeRowIndex=n+1,o.toGrid.rowdragdrop.showCellsDropMask(),o.toGrid.rowdragdrop.insertItem=o.toGrid.get(n+1),o.dropOutSideRowIndex=n+1)}})}();